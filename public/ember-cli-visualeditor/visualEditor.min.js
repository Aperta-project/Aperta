!function(a){"use strict";var b,c,d=Array.prototype.slice;c=function(b){this.options=a.extend({},c.defaults,b),this.parser=this.options.parser,this.locale=this.options.locale,this.messageStore=this.options.messageStore,this.languages={},this.init()},c.prototype={init:function(){var b=this;String.locale=b.locale,String.prototype.toLocaleString=function(){var c,d,e,f,g,h,i;for(e=this.valueOf(),f=b.locale,g=0;f;){c=f.split("-"),d=c.length;do{if(h=c.slice(0,d).join("-"),i=b.messageStore.get(h,e))return i;d--}while(d);if("en"===f)break;f=a.i18n.fallbacks[b.locale]&&a.i18n.fallbacks[b.locale][g]||b.options.fallbackLocale,a.i18n.log("Trying fallback locale for "+b.locale+": "+f),g++}return""}},destroy:function(){a.removeData(document,"i18n")},load:function(a,b){return this.messageStore.load(a,b)},parse:function(b,c){var d=b.toLocaleString();return this.parser.language=a.i18n.languages[a.i18n().locale]||a.i18n.languages["default"],""===d&&(d=b),this.parser.parse(d,c)}},a.i18n=function(b,e){var f,g=a.data(document,"i18n"),h="object"==typeof b&&b;return h&&h.locale&&g&&g.locale!==h.locale&&(String.locale=g.locale=h.locale),g||(g=new c(h),a.data(document,"i18n",g)),"string"==typeof b?(f=void 0!==e?d.call(arguments,1):[],g.parse(b,f)):g},a.fn.i18n=function(){var b=a.data(document,"i18n");return b||(b=new c,a.data(document,"i18n",b)),String.locale=b.locale,this.each(function(){var c=a(this),d=c.data("i18n");d?c.text(b.parse(d)):c.find("[data-i18n]").i18n()})},String.locale=String.locale||a("html").attr("lang"),String.locale||(void 0!==typeof window.navigator?(b=window.navigator,String.locale=b.language||b.userLanguage||""):String.locale=""),a.i18n.languages={},a.i18n.messageStore=a.i18n.messageStore||{},a.i18n.parser={parse:function(a,b){return a.replace(/\$(\d+)/g,function(a,c){var d=parseInt(c,10)-1;return void 0!==b[d]?b[d]:"$"+c})},emitter:{}},a.i18n.fallbacks={},a.i18n.debug=!1,a.i18n.log=function(){window.console&&a.i18n.debug&&window.console.log.apply(window.console,arguments)},c.defaults={locale:String.locale,fallbackLocale:"en",parser:a.i18n.parser,messageStore:a.i18n.messageStore},a.i18n.constructor=c}(jQuery),function(a){"use strict";function b(b){return a.getJSON(b).fail(function(c,d,e){a.i18n.log("Error in loading messages from "+b+" Exception: "+e)})}var c=function(){this.messages={},this.sources={}};c.prototype={load:function(c,d){var e=null,f=null,g=[],h=this;if("string"==typeof c)return a.i18n.log("Loading messages from: "+c),f=b(c).done(function(a){h.set(d,a)}),f.promise();if(d)return h.set(d,c),a.Deferred().resolve();for(e in c)Object.prototype.hasOwnProperty.call(c,e)&&(d=e,g.push(h.load(c[e],d)));return a.when.apply(a,g)},set:function(b,c){this.messages[b]=this.messages[b]?a.extend(this.messages[b],c):c},get:function(a,b){return this.messages[a]&&this.messages[a][b]}},a.extend(a.i18n.messageStore,new c)}(jQuery,window),function(a){"use strict";var b=function(b){this.options=a.extend({},a.i18n.parser.defaults,b),this.language=a.i18n.languages[String.locale]||a.i18n.languages["default"],this.emitter=a.i18n.parser.emitter};b.prototype={constructor:b,simpleParse:function(a,b){return a.replace(/\$(\d+)/g,function(a,c){var d=parseInt(c,10)-1;return void 0!==b[d]?b[d]:"$"+c})},parse:function(b,c){return b.indexOf("{{")<0?this.simpleParse(b,c):(this.emitter.language=a.i18n.languages[a.i18n().locale]||a.i18n.languages["default"],this.emitter.emit(this.ast(b),c))},ast:function(a){function b(a){return function(){var b,c;for(b=0;b<a.length;b++)if(c=a[b](),null!==c)return c;return null}}function c(a){var b,c,d=I,e=[];for(b=0;b<a.length;b++){if(c=a[b](),null===c)return I=d,null;e.push(c)}return e}function d(a,b){return function(){for(var c=I,d=[],e=b();null!==e;)d.push(e),e=b();return d.length<a?(I=c,null):d}}function e(b){var c=b.length;return function(){var d=null;return a.substr(I,c)===b&&(d=b,I+=c),d}}function f(b){return function(){var c=a.substr(I).match(b);return null===c?null:(I+=c[0].length,c[0])}}function g(a,b){return function(){var c=a();return null===c?null:b(c)}}function h(){var a=d(1,z)();return null===a?null:a.join("")}function i(){var a=d(1,A)();return null===a?null:a.join("")}function j(){var a=c([s,t]);return null===a?null:a[1]}function k(){var a=c([u,v]);return null===a?null:["REPLACE",parseInt(a[1],10)-1]}function l(){var a,b=c([q,d(0,G)]);return null===b?null:(a=b[1],a.length>1?["CONCAT"].concat(a):a[0])}function m(){var a=c([C,r,k]);return null===a?null:[a[0],a[2]]}function n(){var a=c([C,r,G]);return null===a?null:[a[0],a[2]]}function o(){var a=c([D,B,E]);return null===a?null:a[1]}function p(){var a=d(0,F)();return null===a?null:["CONCAT"].concat(a)}var q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I=0;if(q=e("|"),r=e(":"),s=e("\\"),t=f(/^./),u=e("$"),v=f(/^\d+/),w=f(/^[^{}\[\]$\\]/),x=f(/^[^{}\[\]$\\|]/),y=f(/^[^{}\[\]$\s]/),b([j,y]),z=b([j,x]),A=b([j,w]),C=g(f(/^[ !"$&'()*,.\/0-9;=?@A-Z\^_`a-z~\x80-\xFF+\-]+/),function(a){return a.toString()}),B=b([function(){var a=c([b([m,n]),d(0,l)]);return null===a?null:a[0].concat(a[1])},function(){var a=c([C,d(0,l)]);return null===a?null:[a[0]].concat(a[1])}]),D=e("{{"),E=e("}}"),F=b([o,k,i]),G=b([o,k,h]),H=p(),null===H||I!==a.length)throw new Error("Parse error at position "+I.toString()+" in input: "+a);return H}},a.extend(a.i18n.parser,new b)}(jQuery),function(a){"use strict";var b=function(){this.language=a.i18n.languages[String.locale]||a.i18n.languages["default"]};b.prototype={constructor:b,emit:function(b,c){var d,e,f,g=this;switch(typeof b){case"string":case"number":d=b;break;case"object":if(e=a.map(b.slice(1),function(a){return g.emit(a,c)}),f=b[0].toLowerCase(),"function"!=typeof g[f])throw new Error('unknown operation "'+f+'"');d=g[f](e,c);break;case"undefined":d="";break;default:throw new Error("unexpected type in AST: "+typeof b)}return d},concat:function(b){var c="";return a.each(b,function(a,b){c+=b}),c},replace:function(a,b){var c=parseInt(a[0],10);return c<b.length?b[c]:"$"+(c+1)},plural:function(a){var b=parseFloat(this.language.convertNumber(a[0],10)),c=a.slice(1);return c.length?this.language.convertPlural(b,c):""},gender:function(a){var b=a[0],c=a.slice(1);return this.language.gender(b,c)},grammar:function(a){var b=a[0],c=a[1];return c&&b&&this.language.convertGrammar(c,b)}},a.extend(a.i18n.parser.emitter,new b)}(jQuery),function(a){"use strict";var b={pluralRules:{ak:{one:"n = 0..1"},am:{one:"i = 0 or n = 1"},ar:{zero:"n = 0",one:"n = 1",two:"n = 2",few:"n % 100 = 3..10",many:"n % 100 = 11..99"},be:{one:"n % 10 = 1 and n % 100 != 11",few:"n % 10 = 2..4 and n % 100 != 12..14",many:"n % 10 = 0 or n % 10 = 5..9 or n % 100 = 11..14"},bh:{one:"n = 0..1"},bn:{one:"i = 0 or n = 1"},br:{one:"n % 10 = 1 and n % 100 != 11,71,91",two:"n % 10 = 2 and n % 100 != 12,72,92",few:"n % 10 = 3..4,9 and n % 100 != 10..19,70..79,90..99",many:"n != 0 and n % 1000000 = 0"},bs:{one:"v = 0 and i % 10 = 1 and i % 100 != 11 or f % 10 = 1 and f % 100 != 11",few:"v = 0 and i % 10 = 2..4 and i % 100 != 12..14 or f % 10 = 2..4 and f % 100 != 12..14"},cs:{one:"i = 1 and v = 0",few:"i = 2..4 and v = 0",many:"v != 0"},cy:{zero:"n = 0",one:"n = 1",two:"n = 2",few:"n = 3",many:"n = 6"},da:{one:"n = 1 or t != 0 and i = 0,1"},fa:{one:"i = 0 or n = 1"},ff:{one:"i = 0,1"},fil:{one:"i = 0..1 and v = 0"},fr:{one:"i = 0,1"},ga:{one:"n = 1",two:"n = 2",few:"n = 3..6",many:"n = 7..10"},gd:{one:"n = 1,11",two:"n = 2,12",few:"n = 3..10,13..19"},gu:{one:"i = 0 or n = 1"},guw:{one:"n = 0..1"},gv:{one:"n % 10 = 1",two:"n % 10 = 2",few:"n % 100 = 0,20,40,60"},he:{one:"i = 1 and v = 0",two:"i = 2 and v = 0",many:"v = 0 and n != 0..10 and n % 10 = 0"},hi:{one:"i = 0 or n = 1"},hr:{one:"v = 0 and i % 10 = 1 and i % 100 != 11 or f % 10 = 1 and f % 100 != 11",few:"v = 0 and i % 10 = 2..4 and i % 100 != 12..14 or f % 10 = 2..4 and f % 100 != 12..14"},hy:{one:"i = 0,1"},is:{one:"t = 0 and i % 10 = 1 and i % 100 != 11 or t != 0"},iu:{one:"n = 1",two:"n = 2"},iw:{one:"i = 1 and v = 0",two:"i = 2 and v = 0",many:"v = 0 and n != 0..10 and n % 10 = 0"},kab:{one:"i = 0,1"},kn:{one:"i = 0 or n = 1"},kw:{one:"n = 1",two:"n = 2"},lag:{zero:"n = 0",one:"i = 0,1 and n != 0"},ln:{one:"n = 0..1"},lt:{one:"n % 10 = 1 and n % 100 != 11..19",few:"n % 10 = 2..9 and n % 100 != 11..19",many:"f != 0"},lv:{zero:"n % 10 = 0 or n % 100 = 11..19 or v = 2 and f % 100 = 11..19",one:"n % 10 = 1 and n % 100 != 11 or v = 2 and f % 10 = 1 and f % 100 != 11 or v != 2 and f % 10 = 1"},mg:{one:"n = 0..1"},mk:{one:"v = 0 and i % 10 = 1 or f % 10 = 1"},mo:{one:"i = 1 and v = 0",few:"v != 0 or n = 0 or n != 1 and n % 100 = 1..19"},mr:{one:"i = 0 or n = 1"},mt:{one:"n = 1",few:"n = 0 or n % 100 = 2..10",many:"n % 100 = 11..19"},naq:{one:"n = 1",two:"n = 2"},nso:{one:"n = 0..1"},pa:{one:"n = 0..1"},pl:{one:"i = 1 and v = 0",few:"v = 0 and i % 10 = 2..4 and i % 100 != 12..14",many:"v = 0 and i != 1 and i % 10 = 0..1 or v = 0 and i % 10 = 5..9 or v = 0 and i % 100 = 12..14"},pt:{one:"i = 1 and v = 0 or i = 0 and t = 1"},pt_PT:{one:"n = 1 and v = 0"},ro:{one:"i = 1 and v = 0",few:"v != 0 or n = 0 or n != 1 and n % 100 = 1..19"},ru:{one:"v = 0 and i % 10 = 1 and i % 100 != 11",many:"v = 0 and i % 10 = 0 or v = 0 and i % 10 = 5..9 or v = 0 and i % 100 = 11..14"},se:{one:"n = 1",two:"n = 2"},sh:{one:"v = 0 and i % 10 = 1 and i % 100 != 11 or f % 10 = 1 and f % 100 != 11",few:"v = 0 and i % 10 = 2..4 and i % 100 != 12..14 or f % 10 = 2..4 and f % 100 != 12..14"},shi:{one:"i = 0 or n = 1",few:"n = 2..10"},si:{one:"n = 0,1 or i = 0 and f = 1"},sk:{one:"i = 1 and v = 0",few:"i = 2..4 and v = 0",many:"v != 0"},sl:{one:"v = 0 and i % 100 = 1",two:"v = 0 and i % 100 = 2",few:"v = 0 and i % 100 = 3..4 or v != 0"},sma:{one:"n = 1",two:"n = 2"},smi:{one:"n = 1",two:"n = 2"},smj:{one:"n = 1",two:"n = 2"},smn:{one:"n = 1",two:"n = 2"},sms:{one:"n = 1",two:"n = 2"},sr:{one:"v = 0 and i % 10 = 1 and i % 100 != 11 or f % 10 = 1 and f % 100 != 11",few:"v = 0 and i % 10 = 2..4 and i % 100 != 12..14 or f % 10 = 2..4 and f % 100 != 12..14"},ti:{one:"n = 0..1"},tl:{one:"i = 0..1 and v = 0"},tzm:{one:"n = 0..1 or n = 11..99"},uk:{one:"v = 0 and i % 10 = 1 and i % 100 != 11",few:"v = 0 and i % 10 = 2..4 and i % 100 != 12..14",many:"v = 0 and i % 10 = 0 or v = 0 and i % 10 = 5..9 or v = 0 and i % 100 = 11..14"},wa:{one:"n = 0..1"},zu:{one:"i = 0 or n = 1"}},convertPlural:function(b,c){var d,e,f,g,h,i=new RegExp("\\d+=","i");if(!c||0===c.length)return"";for(f=0;f<c.length;f++)if(h=c[f],i.test(h)){if(g=parseInt(h.substring(0,h.indexOf("=")),10),g===b)return h.substr(h.indexOf("=")+1);c[f]=void 0}return c=a.map(c,function(a){return void 0!==a?a:void 0}),(d=this.pluralRules[a.i18n().locale])?(e=this.getPluralForm(b,d),e=Math.min(e,c.length-1),c[e]):1===b?c[0]:c[1]},getPluralForm:function(a,b){var c,d=["zero","one","two","few","many","other"],e=0;for(c=0;c<d.length;c++)if(b[d[c]]){if(pluralRuleParser(b[d[c]],a))return e;e++}return e},convertNumber:function(b,c){var d,e,f,g,h,i;if(g=this.digitTransformTable(a.i18n().locale),h=""+b,i="",!g)return b;if(c){if(parseFloat(b,10)===b)return b;d=[];for(e in g)d[g[e]]=e;g=d}for(f=0;f<h.length;f++)i+=g[h[f]]?g[h[f]]:h[f];return c?parseFloat(i,10):i},convertGrammar:function(a){return a},gender:function(a,b){if(!b||0===b.length)return"";for(;b.length<2;)b.push(b[b.length-1]);return"male"===a?b[0]:"female"===a?b[1]:3===b.length?b[2]:b[0]},digitTransformTable:function(a){var b={ar:"٠١٢٣٤٥٦٧٨٩",fa:"۰۱۲۳۴۵۶۷۸۹",ml:"൦൧൨൩൪൫൬൭൮൯",kn:"೦೧೨೩೪೫೬೭೮೯",lo:"໐໑໒໓໔໕໖໗໘໙",or:"୦୧୨୩୪୫୬୭୮୯",kh:"០១២៣៤៥៦៧៨៩",pa:"੦੧੨੩੪੫੬੭੮੯",gu:"૦૧૨૩૪૫૬૭૮૯",hi:"०१२३४५६७८९",my:"၀၁၂၃၄၅၆၇၈၉",ta:"௦௧௨௩௪௫௬௭௮௯",te:"౦౧౨౩౪౫౬౭౮౯",th:"๐๑๒๓๔๕๖๗๘๙",bo:"༠༡༢༣༤༥༦༧༨༩"};return b[a]?b[a].split(""):!1}};a.extend(a.i18n.languages,{"default":b})}(jQuery),function(a){"use strict";a.i18n=a.i18n||{},a.extend(a.i18n.fallbacks,{ab:["ru"],ace:["id"],aln:["sq"],als:["gsw","de"],an:["es"],anp:["hi"],arn:["es"],arz:["ar"],av:["ru"],ay:["es"],ba:["ru"],bar:["de"],"bat-smg":["sgs","lt"],bcc:["fa"],"be-x-old":["be-tarask"],bh:["bho"],bjn:["id"],bm:["fr"],bpy:["bn"],bqi:["fa"],bug:["id"],"cbk-zam":["es"],ce:["ru"],crh:["crh-latn"],"crh-cyrl":["ru"],csb:["pl"],cv:["ru"],"de-at":["de"],"de-ch":["de"],"de-formal":["de"],dsb:["de"],dtp:["ms"],egl:["it"],eml:["it"],ff:["fr"],fit:["fi"],"fiu-vro":["vro","et"],frc:["fr"],frp:["fr"],frr:["de"],fur:["it"],gag:["tr"],gan:["gan-hant","zh-hant","zh-hans"],"gan-hans":["zh-hans"],"gan-hant":["zh-hant","zh-hans"],gl:["pt"],glk:["fa"],gn:["es"],gsw:["de"],hif:["hif-latn"],hsb:["de"],ht:["fr"],ii:["zh-cn","zh-hans"],inh:["ru"],iu:["ike-cans"],jut:["da"],jv:["id"],kaa:["kk-latn","kk-cyrl"],kbd:["kbd-cyrl"],khw:["ur"],kiu:["tr"],kk:["kk-cyrl"],"kk-arab":["kk-cyrl"],"kk-latn":["kk-cyrl"],"kk-cn":["kk-arab","kk-cyrl"],"kk-kz":["kk-cyrl"],"kk-tr":["kk-latn","kk-cyrl"],kl:["da"],"ko-kp":["ko"],koi:["ru"],krc:["ru"],ks:["ks-arab"],ksh:["de"],ku:["ku-latn"],"ku-arab":["ckb"],kv:["ru"],lad:["es"],lb:["de"],lbe:["ru"],lez:["ru"],li:["nl"],lij:["it"],liv:["et"],lmo:["it"],ln:["fr"],ltg:["lv"],lzz:["tr"],mai:["hi"],"map-bms":["jv","id"],mg:["fr"],mhr:["ru"],min:["id"],mo:["ro"],mrj:["ru"],mwl:["pt"],myv:["ru"],mzn:["fa"],nah:["es"],nap:["it"],nds:["de"],"nds-nl":["nl"],"nl-informal":["nl"],no:["nb"],os:["ru"],pcd:["fr"],pdc:["de"],pdt:["de"],pfl:["de"],pms:["it"],pt:["pt-br"],"pt-br":["pt"],qu:["es"],qug:["qu","es"],rgn:["it"],rmy:["ro"],"roa-rup":["rup"],rue:["uk","ru"],ruq:["ruq-latn","ro"],"ruq-cyrl":["mk"],"ruq-latn":["ro"],sa:["hi"],sah:["ru"],scn:["it"],sg:["fr"],sgs:["lt"],sli:["de"],sr:["sr-ec"],srn:["nl"],stq:["de"],su:["id"],szl:["pl"],tcy:["kn"],tg:["tg-cyrl"],tt:["tt-cyrl","ru"],"tt-cyrl":["ru"],ty:["fr"],udm:["ru"],ug:["ug-arab"],uk:["ru"],vec:["it"],vep:["et"],vls:["nl"],vmf:["de"],vot:["fi"],vro:["et"],wa:["fr"],wo:["fr"],wuu:["zh-hans"],xal:["ru"],xmf:["ka"],yi:["he"],za:["zh-hans"],zea:["nl"],zh:["zh-hans"],"zh-classical":["lzh"],"zh-cn":["zh-hans"],"zh-hant":["zh-hans"],"zh-hk":["zh-hant","zh-hans"],"zh-min-nan":["nan"],"zh-mo":["zh-hk","zh-hant","zh-hans"],"zh-my":["zh-sg","zh-hans"],"zh-sg":["zh-hans"],"zh-tw":["zh-hant","zh-hans"],"zh-yue":["yue"]})}(jQuery),function(a){"use strict";a.uls=a.uls||{},a.uls.data={languages:{aa:["Latn",["AF"],"Qafár af"],ab:["Cyrl",["EU"],"Аҧсшәа"],ace:["Latn",["AS","PA"],"Acèh"],ady:["Cyrl",["EU","ME"],"Адыгэбзэ"],"ady-cyrl":["ady"],"ady-latn":["Latn",["EU","ME"],"Adygabze"],aeb:["Arab",["AF"],"زَوُن"],af:["Latn",["AF"],"Afrikaans"],ahr:["Deva",["AS"],"अहिराणी"],ak:["Latn",["AF"],"Akan"],akz:["Latn",["AM"],"Albaamo innaaɬiilka"],aln:["Latn",["EU"],"Gegë"],am:["Ethi",["AF"],"አማርኛ"],an:["Latn",["EU"],"aragonés"],ang:["Latn",["EU"],"Ænglisc"],anp:["Deva",["AS"],"अङ्गिका"],ar:["Arab",["ME"],"العربية"],arc:["Syrc",["ME"],"ܐܪܡܝܐ"],arn:["Latn",["AM"],"mapudungun"],aro:["Latn",["AM"],"Araona"],arq:["Latn",["AF"],"Dziri"],ary:["Latn",["ME"],"Maġribi"],arz:["Arab",["ME"],"مصرى"],as:["Beng",["AS"],"অসমীয়া"],ase:["Sgnw",["AM"],"American sign language"],ast:["Latn",["EU"],"asturianu"],av:["Cyrl",["EU"],"авар"],avk:["Latn",["WW"],"Kotava"],ay:["Latn",["AM"],"Aymar aru"],az:["az-latn"],"az-latn":["Latn",["EU","ME"],"azərbaycanca"],"az-arab":["Arab",["EU","ME"],"آذربايجانجا"],"az-cyrl":["Latn",["EU","ME"],"азәрбајҹанҹа"],azb:["az-arab"],ba:["Cyrl",["EU"],"башҡортса"],bar:["Latn",["EU"],"Boarisch"],"bat-smg":["sgs"],"bbc-latn":["Latn",["AS"],"Batak Toba"],"bbc-batk":["Batk",["AS"],"Batak Toba"],bbc:["Latn",["AS"],"Batak Toba"],bcc:["Arab",["AS","ME"],"بلوچی مکرانی"],bcl:["Latn",["AS"],"Bikol Central"],"be-tarask":["Cyrl",["EU"],"беларуская (тарашкевіца)"],"be-x-old":["be-tarask"],be:["Cyrl",["EU"],"беларуская"],bew:["Latn",["AS"],"Bahasa Betawi"],bfq:["Taml",["AS"],"படகா"],bg:["Cyrl",["EU"],"български"],bh:["Deva",["AS"],"भोजपुरी"],bho:["Deva",["AS"],"भोजपुरी"],bi:["Latn",["PA"],"Bislama"],bjn:["Latn",["AS"],"Bahasa Banjar"],bm:["Latn",["AF"],"bamanankan"],bn:["Beng",["AS"],"বাংলা"],bo:["Tibt",["AS"],"བོད་ཡིག"],bpy:["Beng",["AS"],"বিষ্ণুপ্রিয়া মণিপুরী"],bqi:["Arab",["ME"],"بختياري"],br:["Latn",["EU"],"brezhoneg"],brh:["Latn",["ME","AS"],"Bráhuí"],brx:["Deva",["AS"],"बड़ो"],bs:["Latn",["EU"],"bosanski"],bto:["Latn",["AS"],"Iriga Bicolano"],bug:["Bugi",["AS"],"ᨅᨔ ᨕᨘᨁᨗ"],bxr:["Cyrl",["AS"],"буряад"],ca:["Latn",["EU"],"català"],"cbk-zam":["Latn",["AS"],"Chavacano de Zamboanga"],cdo:["Latn",["AS"],"Mìng-dĕ̤ng-ngṳ̄"],ce:["Cyrl",["EU"],"нохчийн"],ceb:["Latn",["AS"],"Cebuano"],ch:["Latn",["PA"],"Chamoru"],cho:["Latn",["AM"],"Choctaw"],chr:["Cher",["AM"],"ᏣᎳᎩ"],chy:["Latn",["AM"],"Tsetsêhestâhese"],ckb:["Arab",["ME"],"کوردی"],co:["Latn",["EU"],"corsu"],cps:["Latn",["AS"],"Capiceño"],cr:["Cans",["AM"],"ᓀᐦᐃᔭᐍᐏᐣ"],"cr-cans":["cr"],"cr-latn":["Latn",["AM"],"Nēhiyawēwin"],crh:["Latn",["EU"],"qırımtatarca"],"crh-cyrl":["Cyrl",["EU"],"къырымтатарджа"],"crh-latn":["crh"],cs:["Latn",["EU"],"česky"],csb:["Latn",["EU"],"kaszëbsczi"],cu:["Cyrl",["EU"],"словѣньскъ / ⰔⰎⰑⰂⰡⰐⰠⰔⰍⰟ"],cv:["Cyrl",["EU"],"Чӑвашла"],cy:["Latn",["EU"],"Cymraeg"],da:["Latn",["EU"],"dansk"],"de-at":["Latn",["EU"],"Österreichisches Deutsch"],"de-ch":["Latn",["EU"],"Schweizer Hochdeutsch"],"de-formal":["Latn",["EU"],"Deutsch (Sie-Form)"],de:["Latn",["EU"],"Deutsch"],diq:["Latn",["EU","AS"],"Zazaki"],dsb:["Latn",["EU"],"dolnoserbski"],dtp:["Latn",["AS"],"Dusun Bundu-liwan"],dv:["Thaa",["AS"],"ދިވެހިބަސް"],dz:["Tibt",["AS"],"ཇོང་ཁ"],ee:["Latn",["AF"],"eʋegbe"],egl:["Latn",["EU"],"Emiliàn"],el:["Grek",["EU"],"Ελληνικά"],eml:["Latn",["EU"],"emiliàn e rumagnòl"],"en-ca":["Latn",["AM"],"Canadian English"],"en-gb":["Latn",["EU","AS","PA"],"British English"],en:["Latn",["EU","AM","AF","ME","AS","PA","WW"],"English"],eo:["Latn",["WW"],"Esperanto"],"es-419":["Latn",["AM"],"español de America Latina"],"es-formal":["Latn",["EU","AM","AF","WW"],"español (formal)"],es:["Latn",["EU","AM","AF","WW"],"español"],esu:["Latn",["AM"],"Yup'ik"],et:["Latn",["EU"],"eesti"],eu:["Latn",["EU"],"euskara"],ext:["Latn",["EU"],"estremeñu"],fa:["Arab",["ME"],"فارسی"],ff:["Latn",["AF"],"Fulfulde"],fi:["Latn",["EU"],"suomi"],fil:["tl"],fit:["Latn",["EU"],"meänkieli"],"fiu-vro":["vro"],fj:["Latn",["PA"],"Na Vosa Vakaviti"],fo:["Latn",["EU"],"føroyskt"],fr:["Latn",["EU","AM","WW"],"français"],frc:["Latn",["AM"],"français cadien"],frp:["Latn",["EU"],"arpetan"],frr:["Latn",["EU"],"Nordfriisk"],fur:["Latn",["EU"],"furlan"],fy:["Latn",["EU"],"Frysk"],ga:["Latn",["EU"],"Gaeilge"],gag:["Latn",["EU"],"Gagauz"],gah:["Latn",["AS"],"Alekano"],"gan-hans":["Hans",["AS"],"赣语（简体）"],"gan-hant":["gan"],gan:["Hant",["AS"],"贛語"],gbz:["Latn",["AS"],"Dari"],gcf:["Latn",["AM"],"Guadeloupean Creole French"],gd:["Latn",["EU"],"Gàidhlig"],gl:["Latn",["EU"],"galego"],glk:["Arab",["ME"],"گیلکی"],gn:["Latn",["AM"],"Avañe'ẽ"],gom:["Deva",["AS"],"कोंकणी"],"gom-deva":["gom"],"gom-latn":["Latn",["AS"],"Konknni"],got:["Goth",["EU"],"𐌲𐌿𐍄𐌹𐍃𐌺"],grc:["Grek",["EU"],"Ἀρχαία ἑλληνικὴ"],gsw:["Latn",["EU"],"Alemannisch"],gu:["Gujr",["AS"],"ગુજરાતી"],guc:["Latn",["AM"],"Wayúu"],gur:["Latn",["AF"],"Gurenɛ"],gv:["Latn",["EU"],"Gaelg"],"ha-arab":["Arab",["AF"],"هَوُسَ"],"ha-latn":["Latn",["AF"],"Hausa"],ha:["ha-latn"],hak:["Latn",["AS"],"Hak-kâ-fa"],haw:["Latn",["AM","PA"],"Hawai`i"],he:["Hebr",["ME"],"עברית"],hi:["Deva",["AS"],"हिन्दी"],hif:["Latn",["PA","AS"],"Fiji Hindi"],"hif-deva":["Deva",["AS"],"फ़ीजी हिन्दी"],"hif-latn":["hif"],hil:["Latn",["AS"],"Ilonggo"],hne:["Deva",["AS"],"छत्तीसगढ़ी"],ho:["Latn",["PA"],"Hiri Motu"],hr:["Latn",["EU"],"hrvatski"],hsb:["Latn",["EU"],"hornjoserbsce"],hsn:["Hans",["AS"],"湘语"],ht:["Latn",["AM"],"Kreyòl ayisyen"],"hu-formal":["Latn",["EU"],"Magyar (magázó)"],hu:["Latn",["EU"],"magyar"],hy:["Armn",["EU","ME"],"Հայերեն"],hz:["Latn",["AF"],"Otsiherero"],ia:["Latn",["WW"],"interlingua"],id:["Latn",["AS"],"Bahasa Indonesia"],ie:["Latn",["WW"],"Interlingue"],ig:["Latn",["AF"],"Igbo"],ii:["Yiii",["AS"],"ꆇꉙ"],ik:["Latn",["AM"],"Iñupiak"],"ike-cans":["Cans",["AM"],"ᐃᓄᒃᑎᑐᑦ"],"ike-latn":["Latn",["AM"],"inuktitut"],ilo:["Latn",["AS"],"Ilokano"],inh:["Cyrl",["EU"],"ГӀалгӀай"],io:["Latn",["WW"],"Ido"],is:["Latn",["EU"],"íslenska"],it:["Latn",["EU"],"italiano"],iu:["Cans",["AM"],"ᐃᓄᒃᑎᑐᑦ"],ja:["Jpan",["AS"],"日本語"],jam:["Latn",["AM"],"Patois"],jbo:["Latn",["WW"],"lojban"],jut:["Latn",["EU"],"jysk"],jv:["Latn",["AS","PA"],"Basa Jawa"],"jv-java":["Java",["AS","PA"],"ꦧꦱꦗꦮ"],ka:["Geor",["EU"],"ქართული"],kaa:["Latn",["AS"],"Qaraqalpaqsha"],kab:["Latn",["AF","EU"],"Taqbaylit"],"kbd-cyrl":["kbd"],"kbd-latn":["Latn",["EU"],"Qabardjajəbza"],kbd:["Cyrl",["EU","ME"],"Адыгэбзэ"],kea:["Latn",["AF"],"Kabuverdianu"],kg:["Latn",["AF"],"Kongo"],kgp:["Latn",["AM"],"Kaingáng"],khw:["Arab",["ME","AS"],"کھوار"],ki:["Latn",["AF"],"Gĩkũyũ"],kiu:["Latn",["EU","ME"],"Kırmancki"],kj:["Latn",["AF"],"Kwanyama"],kk:["kk-cyrl"],"kk-arab":["Arab",["EU","AS"],"قازاقشا (تٶتە)"],"kk-cn":["kk-arab"],"kk-cyrl":["Cyrl",["EU","AS"],"қазақша"],"kk-kz":["kk-cyrl"],"kk-latn":["Latn",["EU","AS","ME"],"qazaqşa"],"kk-tr":["kk-latn"],kl:["Latn",["AM","EU"],"kalaallisut"],km:["Khmr",["AS"],"ភាសាខ្មែរ"],kn:["Knda",["AS"],"ಕನ್ನಡ"],"ko-kp":["Kore",["AS"],"한국어 (조선)"],ko:["Kore",["AS"],"한국어"],koi:["Cyrl",["EU"],"Перем Коми"],kr:["Latn",["AF"],"Kanuri"],krc:["Cyrl",["EU"],"къарачай-малкъар"],kri:["Latn",["AF"],"Krio"],krj:["Latn",["ME","EU"],"Kinaray-a"],krl:["Latn",["EU"],"Karjala"],"ks-arab":["Arab",["AS"],"کٲشُر"],"ks-deva":["Deva",["AS"],"कॉशुर"],ks:["Arab",["AS"],"کٲشُر"],ksf:["Latn",["AF"],"Bafia"],ksh:["Latn",["EU"],"Ripoarisch"],ku:["ku-latn"],"ku-arab":["Arab",["EU","ME"],"كوردي"],"ku-latn":["Latn",["EU","ME"],"Kurdî"],kv:["Cyrl",["EU"],"коми"],kw:["Latn",["EU"],"kernowek"],ky:["Cyrl",["AS"],"Кыргызча"],la:["Latn",["EU"],"Latina"],lad:["lad-latn"],"lad-latn":["Latn",["ME","EU","AM"],"Ladino"],"lad-hebr":["Hebr",["ME","EU","AM"],"לאדינו"],lb:["Latn",["EU"],"Lëtzebuergesch"],lbe:["Cyrl",["EU"],"лакку"],lez:["Cyrl",["EU"],"лезги"],lfn:["Latn",["WW"],"Lingua Franca Nova"],lg:["Latn",["AF"],"Luganda"],li:["Latn",["EU"],"Limburgs"],lij:["Latn",["EU"],"Ligure"],liv:["Latn",["EU"],"Līvõ kēļ"],lld:["Latn",["EU"],"Ladin"],lmo:["Latn",["EU"],"lumbaart"],ln:["Latn",["AF"],"lingála"],lo:["Laoo",["AS"],"ລາວ"],loz:["Latn",["AF"],"Silozi"],lt:["Latn",["EU"],"lietuvių"],lrc:["Arab",["AS"],"لوری"],ltg:["Latn",["EU"],"latgaļu"],lus:["Latn",["AS"],"Mizo ţawng"],lut:["Latn",["AM"],"dxʷləšucid"],lv:["Latn",["EU"],"latviešu"],lzh:["Hant",["AS"],"文言"],lzz:["Latn",["EU","ME"],"Lazuri"],mai:["Deva",["AS"],"मैथिली"],"map-bms":["Latn",["AS"],"Basa Banyumasan"],mdf:["Cyrl",["EU"],"мокшень"],mfe:["Latn",["AM"],"Morisyen"],mg:["Latn",["AF"],"Malagasy"],mh:["Latn",["PA"],"Ebon"],mhr:["Cyrl",["EU"],"олык марий"],mi:["Latn",["PA"],"Māori"],mic:["Latn",["AM"],"Mi'kmaq"],min:["Latn",["AS"],"Baso Minangkabau"],mk:["Cyrl",["EU"],"македонски"],ml:["Mlym",["AS","ME"],"മലയാളം"],mn:["Cyrl",["AS"],"монгол"],mnc:["Mong",["AS"],"ᠮᠠᠨᠵᡠ ᡤᡳᠰᡠᠨ"],mni:["Beng",["AS"],"মেইতেই লোন্"],mnw:["Mymr",["AS"],"ဘာသာ မန်"],mo:["Cyrl",["EU"],"молдовеняскэ"],mr:["Deva",["AS","ME"],"मराठी"],mrj:["Cyrl",["EU"],"кырык мары"],ms:["Latn",["AS"],"Bahasa Melayu"],mt:["Latn",["EU"],"Malti"],mui:["Latn",["AS"],"Musi"],mus:["Latn",["AM"],"Mvskoke"],mwl:["Latn",["EU"],"Mirandés"],mwv:["Latn",["AS"],"Behase Mentawei"],my:["Mymr",["AS"],"မြန်မာဘာသာ"],myv:["Cyrl",["EU"],"эрзянь"],mzn:["Arab",["ME","AS"],"مازِرونی"],na:["Latn",["PA"],"Dorerin Naoero"],nah:["Latn",["AM"],"Nāhuatl"],nan:["Latn",["AS"],"Bân-lâm-gú"],nap:["Latn",["EU"],"Nnapulitano"],nb:["Latn",["EU"],"norsk (bokmål)"],"nds-nl":["Latn",["EU"],"Nedersaksisch"],nds:["Latn",["EU"],"Plattdüütsch"],ne:["Deva",["AS"],"नेपाली"],"new":["Deva",["AS"],"नेपाल भाषा"],ng:["Latn",["AF"],"Oshiwambo"],niu:["Latn",["PA"],"ko e vagahau Niuē"],njo:["Latn",["AS"],"Ao"],"nl-informal":["Latn",["EU","AM"],"Nederlands (informeel)"],nl:["Latn",["EU","AM"],"Nederlands"],nn:["Latn",["EU"],"norsk (nynorsk)"],no:["Latn",["EU"],"norsk"],nov:["Latn",["WW"],"Novial"],nqo:["Nkoo",["AF"],"ߒߞߏ"],nrm:["Latn",["EU"],"Nouormand"],nso:["Latn",["AF"],"Sesotho sa Leboa"],nv:["Latn",["AM"],"Diné bizaad"],ny:["Latn",["AF"],"Chi-Chewa"],oc:["Latn",["EU"],"occitan"],om:["Latn",["AF"],"Oromoo"],or:["Orya",["AS"],"ଓଡ଼ିଆ"],os:["Cyrl",["EU"],"Ирон"],ota:["Latn",["AS","EU"],"Ottoman Turkish"],pa:["pa-guru"],"pa-guru":["Guru",["AS"],"ਪੰਜਾਬੀ"],pag:["Latn",["AS"],"Pangasinan"],pam:["Latn",["AS"],"Kapampangan"],pap:["Latn",["AM"],"Papiamentu"],pcd:["Latn",["EU"],"Picard"],pdc:["Latn",["EU","AM"],"Deitsch"],pdt:["Latn",["EU","AM"],"Plautdietsch"],pfl:["Latn",["EU"],"Pälzisch"],pi:["Deva",["AS"],"पालि"],pih:["Latn",["PA"],"Norfuk / Pitkern"],pis:["Latn",["PA"],"Pijin"],pko:["Latn",["AF"],"Pökoot"],pl:["Latn",["EU"],"polski"],pms:["Latn",["EU"],"Piemontèis"],pnb:["Arab",["AS","ME"],"پنجابی"],pnt:["Grek",["EU"],"Ποντιακά"],ppl:["Latn",["AM"],"Nawat"],prg:["Latn",["EU"],"Prūsiskan"],ps:["Arab",["AS","ME"],"پښتو"],"pt-br":["Latn",["AM"],"português do Brasil"],pt:["Latn",["EU","AM","AS","PA","AF","WW"],"português"],qu:["Latn",["AM"],"Runa Simi"],qug:["Latn",["AM"],"Runa shimi"],rap:["Latn",["AM"],"arero rapa nui"],rgn:["Latn",["EU"],"Rumagnôl"],rif:["Latn",["AF"],"Tarifit"],rki:["Mymr",["AS"],"ရခိုင်"],rm:["Latn",["EU"],"rumantsch"],rmf:["Latn",["EU"],"kaalengo tšimb"],rmy:["Latn",["EU"],"Romani"],rn:["Latn",["AF"],"Kirundi"],ro:["Latn",["EU"],"română"],"roa-rup":["rup"],"roa-tara":["Latn",["EU"],"tarandíne"],rtm:["Latn",["PA"],"Faeag Rotuma"],ru:["Cyrl",["EU","AS","ME"],"русский"],rue:["Cyrl",["EU"],"русиньскый"],rup:["Latn",["EU"],"Armãneashce"],ruq:["Cyrl",["EU"],"Влахесте"],"ruq-cyrl":["ruq"],"ruq-grek":["Grek",["EU"],"Megleno-Romanian (Greek script)"],"ruq-latn":["Latn",["EU"],"Vlăheşte"],rw:["Latn",["AF"],"Kinyarwanda"],rwr:["Deva",["AS"],"मारवाड़ी"],ryu:["Kana",["AS"],"ʔucināguci"],sa:["Deva",["AS"],"संस्कृतम्"],sah:["Cyrl",["EU","AS"],"саха тыла"],sat:["Latn",["AS"],"Santali"],saz:["Saur",["AS"],"ꢱꣃꢬꢵꢯ꣄ꢡ꣄ꢬꢵ"],sc:["Latn",["EU"],"sardu"],scn:["Latn",["EU"],"sicilianu"],sco:["Latn",["EU"],"Scots"],sd:["Arab",["AS"],"سنڌي"],sdc:["Latn",["EU"],"Sassaresu"],se:["Latn",["EU"],"sámegiella"],ses:["Latn",["AF"],"Koyraboro Senni"],sei:["Latn",["AM"],"Cmique Itom"],sg:["Latn",["AF"],"Sängö"],sgs:["Latn",["EU"],"žemaitėška"],sh:["Latn",["EU"],"srpskohrvatski"],"shi-latn":["Latn",["AF"],"Tašlḥiyt"],"shi-tfng":["Tfng",["AF"],"ⵜⴰⵛⵍⵃⵉⵜ"],shi:["shi-latn"],shn:["Mymr",["AS"],"လိၵ်ႈတႆး"],si:["Sinh",["AS"],"සිංහල"],simple:["Latn",["WW"],"Simple English"],sk:["Latn",["EU"],"slovenčina"],sl:["Latn",["EU"],"slovenščina"],sli:["Latn",["EU"],"Schläsch"],slr:["Latn",["AS"],"Salırça"],sly:["Latn",["AS"],"Bahasa Selayar"],syc:["Syrc",["ME"],"ܣܘܪܝܝܐ"],sm:["Latn",["PA"],"Gagana Samoa"],sma:["Latn",["EU"],"åarjelsaemien"],smj:["Latn",["EU"],"julevsámegiella"],smn:["Latn",["EU"],"anarâškielâ"],sms:["Latn",["EU"],"sää´mǩiõll"],sn:["Latn",["AF"],"chiShona"],so:["Latn",["AF"],"Soomaaliga"],sq:["Latn",["EU"],"shqip"],sr:["sr-cyrl"],"sr-ec":["sr-cyrl"],"sr-cyrl":["Cyrl",["EU"],"српски"],"sr-el":["sr-latn"],"sr-latn":["Latn",["EU"],"srpski"],srn:["Latn",["AM","EU"],"Sranantongo"],ss:["Latn",["AF"],"SiSwati"],st:["Latn",["AF"],"Sesotho"],stq:["Latn",["EU"],"Seeltersk"],su:["Latn",["AS"],"Basa Sunda"],sv:["Latn",["EU"],"svenska"],sw:["Latn",["AF"],"Kiswahili"],swb:["Latn",["AF"],"Shikomoro"],sxu:["Latn",["EU"],"Säggssch"],szl:["Latn",["EU"],"ślůnski"],ta:["Taml",["AS"],"தமிழ்"],tcy:["Knda",["AS"],"ತುಳು"],te:["Telu",["AS"],"తెలుగు"],tet:["Latn",["AS","PA"],"tetun"],"tg-cyrl":["Cyrl",["AS"],"тоҷикӣ"],"tg-latn":["Latn",["AS"],"tojikī"],tg:["Cyrl",["AS"],"тоҷикӣ"],th:["Thai",["AS"],"ไทย"],ti:["Ethi",["AF"],"ትግርኛ"],tk:["Latn",["AS"],"Türkmençe"],tkr:["Cyrl",["AS"],"ЦӀаьхна миз"],tl:["Latn",["AS"],"Tagalog"],tly:["Cyrl",["EU","AS","ME"],"толышә зывон"],tn:["Latn",["AF"],"Setswana"],to:["Latn",["PA"],"lea faka-Tonga"],tokipona:["Latn",["WW"],"Toki Pona"],tpi:["Latn",["PA","AS"],"Tok Pisin"],tr:["Latn",["EU","ME"],"Türkçe"],trp:["Latn",["AS"],"Kokborok (Tripuri)"],tru:["Latn",["AS"],"Ṫuroyo"],ts:["Latn",["AF"],"Xitsonga"],tsd:["Grek",["EU"],"Τσακωνικά"],tt:["Cyrl",["EU"],"татарча"],"tt-cyrl":["tt"],"tt-latn":["Latn",["EU"],"tatarça"],ttt:["Cyrl",["AS"],"Tati"],tum:["Latn",["AF"],"chiTumbuka"],tw:["Latn",["AF"],"Twi"],twd:["Latn",["EU"],"Tweants"],ty:["Latn",["PA"],"Reo Mā`ohi"],tyv:["Cyrl",["AS"],"тыва дыл"],tzm:["Tfng",["AF"],"ⵜⴰⵎⴰⵣⵉⵖⵜ"],udm:["Cyrl",["EU"],"удмурт"],ug:["ug-arab"],"ug-arab":["Arab",["AS"],"ئۇيغۇرچە"],"ug-latn":["Latn",["AS"],"uyghurche"],"ug-cyrl":["Cyrl",["AS"],"уйғурчә"],uk:["Cyrl",["EU"],"українська"],ur:["Arab",["AS","ME"],"اردو"],uz:["Latn",["AS"],"oʻzbekcha"],ve:["Latn",["AF"],"Tshivenda"],vec:["Latn",["EU"],"vèneto"],vep:["Latn",["EU"],"vepsän kel’"],vi:["Latn",["AS"],"Tiếng Việt"],vls:["Latn",["EU"],"West-Vlams"],vmf:["Latn",["EU"],"Mainfränkisch"],vo:["Latn",["WW"],"Volapük"],vot:["Latn",["EU"],"Vaďďa"],vro:["Latn",["EU"],"Võro"],wa:["Latn",["EU"],"walon"],war:["Latn",["AS"],"Winaray"],wls:["Latn",["PA"],"Faka'uvea"],wo:["Latn",["AF"],"Wolof"],wuu:["Hans",["AS"],"吴语"],xal:["Cyrl",["EU"],"хальмг"],xh:["Latn",["AF"],"isiXhosa"],xmf:["Geor",["EU"],"მარგალური"],ydd:["Hebr",["AS","EU"],"Eastern Yiddish"],yi:["Hebr",["ME","EU","AM"],"ייִדיש"],yo:["Latn",["AF"],"Yorùbá"],yrk:["Cyrl",["AS"],"Ненэцяʼ вада"],yrl:["Latn",["AM"],"ñe'engatú"],yua:["Latn",["AM"],"Maaya T'aan"],yue:["Hant",["AS"],"粵語"],za:["Latn",["AS"],"Vahcuengh"],zea:["Latn",["EU"],"Zeêuws"],zh:["Hans",["AS"],"中文"],"zh-classical":["Hant",["AS"],"文言"],"zh-cn":["Hans",["AS"],"中文（中国大陆）"],"zh-hans":["Hans",["AS"],"中文（简体）"],"zh-hant":["Hant",["AS"],"中文（繁體）"],"zh-hk":["Hant",["AS"],"中文（香港）"],"zh-min-nan":["nan"],"zh-mo":["Hant",["AS"],"中文（澳門）"],"zh-my":["Hans",["AS"],"中文（马来西亚）"],"zh-sg":["Hans",["AS"],"中文（新加坡）"],"zh-tw":["Hant",["AS"],"中文（台灣）"],"zh-yue":["yue"],zu:["Latn",["AF"],"isiZulu"]},scriptgroups:{Latin:["Latn","Goth"],Greek:["Grek"],WestCaucasian:["Armn","Geor"],Arabic:["Arab"],MiddleEastern:["Hebr","Syrc"],African:["Ethi","Nkoo","Tfng"],SouthAsian:["Beng","Deva","Gujr","Guru","Knda","Mlym","Orya","Saur","Sinh","Taml","Telu","Tibt","Thaa"],Cyrillic:["Cyrl"],CJK:["Hans","Hant","Kana","Kore","Jpan","Yiii"],SouthEastAsian:["Batk","Bugi","Java","Khmr","Laoo","Mymr","Thai"],Mongolian:["Mong"],SignWriting:["Sgnw"],NativeAmerican:["Cher","Cans"],Special:["Zyyy"]},rtlscripts:["Arab","Hebr","Syrc","Nkoo","Thaa"],regiongroups:{WW:1,SP:1,AM:2,EU:3,ME:3,AF:3,AS:4,PA:4},territories:{AC:["en"],AD:["ca","es","fr"],AE:["ar","ml","ps","bal","fa"],AF:["fa","ps","haz","uz-arab","tk-latn","prd","bal","ug-arab","kk-arab"],AG:["en","pt"],AI:["en"],AL:["sq","el","mk"],AM:["hy","az-latn","ku-latn"],AO:["pt","umb","kmb","ln"],AQ:["und"],AR:["es","cy","gn"],AS:["sm","en"],AT:["de","hr","sl","hu"],AU:["en","zh-hant","it"],AW:["nl","pap","en"],AX:["sv"],AZ:["az-latn","az-cyrl","ku-latn"],BA:["bs-cyrl","bs-latn","hr","sr-cyrl","sr-latn"],BB:["en"],BD:["bn","rkt","syl","ccp","my","grt","mni"],BE:["nl","en","fr","wa","de"],BF:["mos","dyu","fr"],BG:["bg","tr"],BH:["ar","ml"],BI:["rn","fr","sw"],BJ:["fr","fon","yo"],BL:["fr"],BM:["en"],BN:["ms-latn","zh-hant","ms-arab","en"],BO:["es","qu","ay","gn"],BQ:["pap","nl"],BR:["pt","de","it","ja","ko","kgp","gub","xav"],BS:["en"],BT:["dz","ne","tsj","lep"],BV:["und"],BW:["en","tn","af"],BY:["be","ru"],BZ:["en","es"],CA:["en","fr","it","de","cr-cans","crk","yi","iu","moe","crj","atj","crl","csw","crm","ikt","dgr","den","scs","nsk","chp","gwi"],CC:["ms-arab","en"],CD:["sw","lua","swc","fr","ln","lu","kg","lol","rw"],CF:["fr","sg","ln"],CG:["fr","ln"],CH:["de","fr","gsw","it","lmo","rm","rmo","wae"],CI:["fr","bci","sef","daf","kfo","bqv"],CK:["en"],CL:["es"],CM:["fr","en","bum","ff","ewo","ybb","bbj","nnh","bkm","bas","bax","byv","mua","maf","bfd","bss","kkj","dua","mgo","ar","jgo","ksf","agq","ha-arab","nmg","yav"],CN:["zh-hans","ii","ug-arab","za","mn-mong","bo","ko","kk-arab","lis","ky-arab","nbf","khb","tdd","lcp","en","ru","vi","uz-cyrl"],CO:["es"],CP:["und"],CR:["es"],CU:["es"],CV:["kea","pt"],CW:["pap","nl","es"],CX:["en"],CY:["el","tr","hy","ar"],CZ:["cs","de","pl"],DE:["de","en","nds","tr","hr","it","ku-latn","ru","el","ksh","pl","es","nl","da","dsb"],DG:["en"],DJ:["aa","so","ar","fr"],DK:["da","de","kl"],DM:["en"],DO:["es","en"],DZ:["ar","fr","kab"],EA:["es"],EC:["es"],EE:["et","ru"],EG:["ar","el"],EH:["ar"],ER:["ti","en","tig","ar","aa","ssy","byn"],ES:["es","en","ca","gl","eu","ast"],ET:["en","am","om","so","ti","sid","wal","aa"],FI:["fi","sv","ru","en","et","rmf","se","smn","sms"],FJ:["en","hi","fj"],FK:["en"],FM:["chk","pon","kos","yap","en","uli"],FO:["fo"],FR:["fr","en","oc","it","pt","gsw","br","co","ca","nl","eu","ia"],GA:["fr","puu"],GB:["en","sco","pa-guru","cy","bn","zh-hant","syl","el","it","ks-arab","gd","yi","ml","ga","fr","kw"],GD:["en"],GE:["ka","ru","hy","ab","os","ku-latn"],GF:["fr","gcr","zh-hant"],GG:["en"],GH:["ak","en","ee","abr","gaa","ha-latn","saf"],GI:["en"],GL:["kl","da"],GM:["en","man-latn"],GN:["fr","ff","man-nkoo","sus","kpe"],GP:["fr"],GQ:["es","fan","fr","bvb"],GR:["el","mk","tr","bg","sq"],GS:["und"],GT:["es"],GU:["en","ch"],GW:["pt"],GY:["en"],HK:["zh-hant","en","zh-hans"],HM:["und"],HN:["es","en"],HR:["hr","it"],HT:["ht","fr"],HU:["hu","de","ro","hr","sk","sl"],IC:["es"],ID:["id","jv","su","mad","ms-arab","min","bya","bjn","ban","bug","ace","bew","sas","bbc","zh-hant","mak","ljp","rej","gor","nij","kge","aoz","kvr","lbw","rob","mdr","sxn"],IE:["en","ga"],IL:["he","ar","ru","ro","yi","en","pl","hu","am","ti","ml"],IM:["en","gv"],IN:["hi","en","bn","te","mr","ta","ur","gu","kn","ml","or","pa-guru","bho","awa","as","bgc","mag","mwr","mai","hne","dcc","bjj","ne","sat","wtm","rkt","ks-arab","kok","swv","gbm","lmn","sd-arab","gon-telu","kfy","doi","kru","sck","tcy","wbq","xnr","wbr","khn","brx","noe","bhb","mni","raj","hoc","mtr","unr-beng","bhi","hoj","kha","kfr","grt","unx-beng","bfy","srx","saz","ccp","sd-deva","bfq","ria","bo","bft","bra","lep","btv","lif-deva","lah","sa","kht","dv","dz"],IO:["en"],IQ:["ar","ckb","fa","syr"],IR:["fa","az-arab","glk","ckb","tk-latn","sdh","lrc","ar","bal","rmt","bqi","luz","lki","prd","hy","ps","ka","kk-arab"],IS:["is","da"],IT:["it","en","nap","scn","fur","de","fr","sl","ca","el","hr"],JE:["en"],JM:["en"],JO:["ar"],JP:["ja","ryu","ko"],KE:["en","sw","ki","luy","luo","kam","kln","guz","mer","mas","ebu","so","dav","teo","pko","om","saq","ar","pa-guru","gu"],KG:["ky-cyrl","ru"],KH:["km","cja","kdt"],KI:["en","gil"],KM:["ar","fr","zdj"],KN:["en"],KP:["ko"],KR:["ko"],KW:["ar"],KY:["en"],KZ:["ru","kk-cyrl","de","ug-cyrl"],LA:["lo","kjg","kdt"],LB:["ar","hy","ku-arab","fr","en"],LC:["en"],LI:["de","gsw","wae"],LK:["si","ta","en"],LR:["en","kpe","vai-vaii","men","vai-latn"],LS:["st","zu","ss","en","xh"],LT:["lt","ru"],LU:["fr","lb","de"],LV:["lv","ru"],LY:["ar"],MA:["ar","zgh","fr","tzm-latn","shi-latn","shi-tfng","rif","es"],MC:["fr"],MD:["ro","uk","bg","gag","ru"],ME:["sr-latn","sq","sr-cyrl"],MF:["fr"],MG:["mg","fr","en"],MH:["en","mh"],MK:["mk","sq","tr"],ML:["bm","fr","ffm","snk","mwk","ses","tmh","khq","dtm","kao","ar","bmq","bze"],MM:["my","shn","mnw","kht"],MN:["mn-cyrl","kk-arab","zh-hans","ru","ug-cyrl"],MO:["zh-hant","pt","zh-hans","en"],MP:["en","ch"],MQ:["fr"],MR:["ar","fr","ff","wo"],MS:["en"],MT:["mt","en"],MU:["mfe","en","bho","ur","fr","ta"],MV:["dv"],MW:["en","ny","tum","zu"],MX:["es","yua","nhe","nhw","maz","nch"],MY:["ms-latn","en","zh-hant","ta","bjn","jv","zmi","ml","bug"],MZ:["pt","vmw","ndc","ts","ngl","seh","mgh","rng","ny","yao","sw","zu"],NA:["af","kj","ng","naq","en","de","tn"],NC:["fr"],NE:["ha-latn","fr","dje","fuq","tmh","ar","twq"],NF:["en"],NG:["en","pcm","ha-latn","ig","yo","fuv","tiv","efi","ibb","ha-arab","bin","kaj","kcg","ar","cch","amo"],NI:["es"],NL:["nl","en","li","fy","gos","id","zea","rif","tr"],NO:["nb","nn","se"],NP:["ne","mai","bho","new","jml","taj","awa","thl","bap","tdg","thr","mgp","lif-deva","thq","mrd","bfy","xsr","rjs","tsf","hi","ggn","gvr","bo","tkt","tdh","bn","unr-deva","lep"],NR:["en","na"],NU:["en","niu"],NZ:["en","mi"],OM:["ar","bal","fa"],PA:["es","en","zh-hant"],PE:["es","qu","ay"],PF:["fr","ty","zh-hant"],PG:["tpi","en","ho"],PH:["en","fil","es","ceb","ilo","hil","bik","war","bhk","pam","pag","mdh","tsg","zh-hant","bto","hnn","tbw","bku"],PK:["ur","pa-arab","en","lah","ps","sd-arab","skr","bal","brh","hno","fa","hnd","tg-arab","gju","bft","kvx","khw","mvy","kxp","gjk","ks-arab","btv"],PL:["pl","be","uk","csb","de","lt"],PM:["fr","en"],PN:["en"],PR:["es","en"],PS:["ar"],PT:["pt","gl"],PW:["pau","en"],PY:["gn","es","de"],QA:["ar","fa","ml"],RE:["fr","rcf","ta"],RO:["ro","hu","de","tr","sr-latn","bg","el","pl"],RS:["sr-cyrl","sr-latn","sq","hu","ro","hr","sk","uk"],RU:["ru","tt","ba","cv","hy","ce","av","udm","chm","sah","os","kbd","myv","dar","bua","mdf","kum","kv","lez","krc","inh","tyv","az-cyrl","ady","krl","koi","lbe","mrj","alt","fi","sr-latn","mn-cyrl","cu"],RW:["rw","fr","en"],SA:["ar"],SB:["en"],SC:["crs","fr","en"],SD:["ar","en","nus","ha-arab"],SE:["sv","fi","fit","se","rmu","yi","smj","sma","ia"],SG:["en","zh-hans","ms-latn","ta","ml","pa-guru"],SH:["en"],SI:["sl","hu","it"],SJ:["nb","ru"],SK:["sk","hu","uk","pl","de"],SL:["kri","en","men","tem"],SM:["it","eo"],SN:["fr","wo","ff","srr","dyo"],SO:["so","ar","sw","om"],SR:["nl","srn","zh-hant"],SS:["ar","en"],ST:["pt"],SV:["es"],SX:["en","es","vic","nl"],SY:["ar","ku-latn","fr","hy","syr"],SZ:["en","ss","zu","ts"],TA:["en"],TC:["en"],TD:["fr","ar"],TF:["fr"],TG:["fr","ee"],TH:["th","tts","nod","sou","mfa","zh-hant","kxm","kdt","mnw","shn","lcp","lwl"],TJ:["tg-cyrl","fa","ar"],TK:["en","tkl"],TL:["pt","tet"],TM:["tk-latn","ru","uz-latn","ku-latn"],TN:["ar","fr"],TO:["to","en"],TR:["tr","ku-latn","zza","kbd","az-latn","ar","bgx","bg","ady","hy","ka","sr-latn","sq","ab","el","uz-latn","ky-latn","kk-cyrl"],TT:["en","es"],TV:["tvl","en"],TW:["zh-hant","trv"],TZ:["sw","en","suk","nym","kde","bez","ksb","mas","mgy","asa","lag","jmc","rof","vun","rwk","sbp"],UA:["uk","ru","pl","yi","rue","be","ro","bg","tr","hu","el"],UG:["sw","lg","nyn","cgg","xog","en","teo","laj","ach","myx","rw","ttj","hi"],UM:["en"],US:["en","es","zh-hant","fr","de","fil","it","vi","ko","ru","nv","yi","haw","chr","lkt","ik"],UY:["es"],UZ:["uz-latn","uz-cyrl","ru","kaa","tr"],VA:["it","la"],VC:["en"],VE:["es"],VG:["en"],VI:["en"],VN:["vi","zh-hant","cjm"],VU:["bi","en","fr"],WF:["wls","fr","fud"],WS:["sm","en"],XK:["sq","sr-cyrl","sr-latn"],YE:["ar"],YT:["swb","fr","buc","sw"],ZA:["en","zu","xh","af","nso","tn","st","ts","ss","ve","hi","nr","sw"],ZM:["en","bem","ny","loz"],ZW:["en","sn","nd","mxc","ndc","kck","ny","ve","tn"],ZZ:[]}}
}(jQuery),function(a){"use strict";a.uls.data.isRedirect=function(b){return void 0!==a.uls.data.languages[b]&&1===a.uls.data.languages[b].length?a.uls.data.languages[b][0]:!1},a.uls.data.getScript=function(b){var c=a.uls.data.isRedirect(b);return c?a.uls.data.getScript(c):a.uls.data.languages[b]?a.uls.data.languages[b][0]:"Zyyy"},a.uls.data.getRegions=function(b){var c=a.uls.data.isRedirect(b);return c?a.uls.data.getRegions(c):a.uls.data.languages[b]&&a.uls.data.languages[b][1]||"UNKNOWN"},a.uls.data.getAutonym=function(b){var c=a.uls.data.isRedirect(b);return c?a.uls.data.getAutonym(c):a.uls.data.languages[b]&&a.uls.data.languages[b][2]||b},a.uls.data.getAutonyms=function(){var b,c={};for(b in a.uls.data.languages)a.uls.data.isRedirect(b)||(c[b]=a.uls.data.getAutonym(b));return c},a.uls.data.getAllRegions=function(){var b,c=[];for(b in a.uls.data.regiongroups)c.push(b);return c},a.uls.data.getLanguagesInScript=function(b){return a.uls.data.getLanguagesInScripts([b])},a.uls.data.getLanguagesInScripts=function(b){var c,d,e=[];for(c in a.uls.data.languages)if(!a.uls.data.isRedirect(c))for(d=0;d<b.length;d++)if(b[d]===a.uls.data.getScript(c)){e.push(c);break}return e},a.uls.data.getLanguagesInRegion=function(b){return a.uls.data.getLanguagesInRegions([b])},a.uls.data.getLanguagesInRegions=function(b){var c,d,e=[];for(c in a.uls.data.languages)if(!a.uls.data.isRedirect(c))for(d=0;d<b.length;d++)if(-1!==a.inArray(b[d],a.uls.data.getRegions(c))){e.push(c);break}return e},a.uls.data.getLanguagesInRegionGroup=function(b){return a.uls.data.getLanguagesInRegions(a.uls.data.getRegionsInGroup(b))},a.uls.data.getLanguagesByScriptInRegion=function(b){var c,d,e={};for(c in a.uls.data.languages)a.uls.data.isRedirect(c)||-1!==a.inArray(b,a.uls.data.getRegions(c))&&(d=a.uls.data.getScript(c),void 0===e[d]&&(e[d]=[]),e[d].push(c));return e},a.uls.data.getLanguagesByScriptGroupInRegion=function(b){return a.uls.data.getLanguagesByScriptGroupInRegions([b])},a.uls.data.getAllLanguagesByScriptGroup=function(){return a.uls.data.getLanguagesByScriptGroupInRegions(a.uls.data.getAllRegions())},a.uls.data.getLanguagesByScriptGroup=function(b){var c,d,e,f={};for(c in b)d=a.uls.data.isRedirect(c)||c,e=a.uls.data.getScriptGroupOfLanguage(d),f[e]||(f[e]=[]),-1===a.inArray(d,f[e])&&f[e].push(d);return f},a.uls.data.getLanguagesByScriptGroupInRegions=function(b){var c,d,e,f={};for(c in a.uls.data.languages)if(!a.uls.data.isRedirect(c))for(d=0;d<b.length;d++)if(-1!==a.inArray(b[d],a.uls.data.getRegions(c))){e=a.uls.data.getScriptGroupOfLanguage(c),void 0===f[e]&&(f[e]=[]),f[e].push(c);break}return f},a.uls.data.getAllLanguagesByRegionAndScript=function(){var b,c,d,e,f,g,h,i={};for(b in a.uls.data.regiongroups)c=a.uls.data.regiongroups[b],void 0===i[c]&&(i[c]={}),i[c][b]={};for(d in a.uls.data.languages)if(!a.uls.data.isRedirect(d))for(e=a.uls.data.getScript(d),f=a.uls.data.getGroupOfScript(e),g=a.uls.data.getRegions(d),h=0;h<g.length;h++)b=g[h],c=a.uls.data.regiongroups[b],void 0===i[c][b][f]&&(i[c][b][f]={}),void 0===i[c][b][f][e]&&(i[c][b][f][e]=[]),i[c][b][f][e].push(d);return i},a.uls.data.getRegionsInGroup=function(b){var c,d=[];for(c in a.uls.data.regiongroups)a.uls.data.regiongroups[c]===b&&d.push(c);return d},a.uls.data.getGroupOfScript=function(b){var c;for(c in a.uls.data.scriptgroups)if(-1!==a.inArray(b,a.uls.data.scriptgroups[c]))return c;return"Other"},a.uls.data.getScriptGroupOfLanguage=function(b){return a.uls.data.getGroupOfScript(a.uls.data.getScript(b))},a.uls.data.sortByAutonym=function(b,c){var d=a.uls.data.getAutonym(b)||b,e=a.uls.data.getAutonym(c)||c;return d.toLowerCase()<e.toLowerCase()?-1:1},a.uls.data.isRtl=function(b){return-1!==a.inArray(a.uls.data.getScript(b),a.uls.data.rtlscripts)},a.uls.data.getDir=function(b){return a.uls.data.isRtl(b)?"rtl":"ltr"},a.uls.data.getLanguagesInTerritory=function(b){return a.uls.data.territories[b]},a.uls.data.addLanguage=function(b,c){a.uls.data.languages[b]=c.target?[c.target]:[c.script,c.regions,c.autonym]},a.uls.data.deleteLanguage=function(b){return a.uls.data.languages[b]?(delete a.uls.data.languages[b],!0):!1}}(jQuery),function(a){"use strict";function b(a,b,c){var d,e,f,g={},h=[];for(d=0,e=b.length;e>d;d++)g[b[d]]=!0;for(d=0,e=a.length;e>d;d++)f=!!g[a[d]],f===c&&h.push(a[d]);return h}{var c={},d=c.hasOwnProperty;c.toString}c.initClass=function(a){a["static"]=a["static"]||{}},c.inheritClass=function(a,b){if(a.prototype instanceof b)throw new Error("Target already inherits from origin");var d=a.prototype.constructor;a["super"]=a.parent=b,a.prototype=Object.create(b.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),c.initClass(b),a["static"]=Object.create(b["static"])},c.mixinClass=function(a,b){var e;for(e in b.prototype)"constructor"!==e&&d.call(b.prototype,e)&&(a.prototype[e]=b.prototype[e]);if(c.initClass(a),b["static"])for(e in b["static"])d.call(b["static"],e)&&(a["static"][e]=b["static"][e]);else c.initClass(b)},c.getProp=function(a){var b,c=a;for(b=1;b<arguments.length;b++){if(void 0===c||null===c)return void 0;c=c[arguments[b]]}return c},c.setProp=function(a){var b,c=a;if(Object(a)===a){for(b=1;b<arguments.length-2;b++){if(void 0===c[arguments[b]]&&(c[arguments[b]]={}),Object(c[arguments[b]])!==c[arguments[b]])return;c=c[arguments[b]]}c[arguments[arguments.length-2]]=arguments[arguments.length-1]}},c.cloneObject=function(a){var b,c;c=Object.create(a.constructor.prototype);for(b in a)d.call(a,b)&&(c[b]=a[b]);return c},c.getObjectValues=function(a){var b,c;if(a!==Object(a))throw new TypeError("Called on non-object");c=[];for(b in a)d.call(a,b)&&(c[c.length]=a[b]);return c},c.compare=function(a,b,e){var f,g,h,i,j;if(a===b)return!0;a=a||{},b=b||{};for(j in a)if(d.call(a,j)&&void 0!==a[j]&&(f=a[j],g=b[j],h=typeof f,i=typeof g,h!==i||("string"===h||"number"===h||"boolean"===h)&&f!==g||f===Object(f)&&!c.compare(f,g,e)))return!1;return e?!0:c.compare(b,a,!0)},c.copy=function(a,b,d){var e,f;if(d&&(f=d(a),void 0!==f))return f;if(Array.isArray(a))f=new Array(a.length);else{if(a&&"function"==typeof a.clone)return b?b(a.clone()):a.clone();if(a&&"function"==typeof a.cloneNode)return b?b(a.cloneNode(!0)):a.cloneNode(!0);if(!c.isPlainObject(a))return b?b(a):a;f={}}for(e in a)f[e]=c.copy(a[e],b,d);return f},c.getHash=function(a){return JSON.stringify(a,c.getHash.keySortReplacer)},c.getHash.keySortReplacer=function(a,b){var c,d,e,f;if(b&&"function"==typeof b.getHashObject&&(b=b.getHashObject()),Array.isArray(b)||Object(b)!==b)return b;for(c={},d=Object.keys(b).sort(),e=0,f=d.length;f>e;e+=1)c[d[e]]=b[d[e]];return c},c.simpleArrayUnion=function(){var a,b,c,d,e,f={},g=[];for(a=0,b=arguments.length;b>a;a++)for(c=arguments[a],d=0,e=c.length;e>d;d++)f[c[d]]||(f[c[d]]=!0,g.push(c[d]));return g},c.simpleArrayIntersection=function(a,c){return b(a,c,!0)},c.simpleArrayDifference=function(a,c){return b(a,c,!1)},c.isPlainObject=$.isPlainObject,function(){function a(a,b){if("string"==typeof a){if(void 0===b||null===b)throw new Error('Method name "'+a+'" has no context.');if("function"!=typeof b[a])throw new Error('Property "'+a+'" is not a function')}else if("function"!=typeof a)throw new Error("Invalid callback. Function or method name expected.")}c.EventEmitter=function(){this.bindings={}},c.initClass(c.EventEmitter),c.EventEmitter.prototype.on=function(b,c,e,f){var g;return a(c,f),g=d.call(this.bindings,b)?this.bindings[b]:this.bindings[b]=[],g.push({method:c,args:e,context:arguments.length<4?null:f}),this},c.EventEmitter.prototype.once=function(a,b){var c=this,d=function(){c.off(a,d),b.apply(c,Array.prototype.slice.call(arguments,0))};return this.on(a,d)},c.EventEmitter.prototype.off=function(b,c,e){var f,g;if(1===arguments.length)return delete this.bindings[b],this;if(a(c,e),!d.call(this.bindings,b)||!this.bindings[b].length)return this;for(arguments.length<3&&(e=null),g=this.bindings[b],f=g.length;f--;)g[f].method===c&&g[f].context===e&&g.splice(f,1);return 0===g.length&&delete this.bindings[b],this},c.EventEmitter.prototype.emit=function(a){var b,c,e,f,g,h=[];if(d.call(this.bindings,a)){for(f=this.bindings[a].slice(),b=1,c=arguments.length;c>b;b++)h.push(arguments[b]);for(b=0,c=f.length;c>b;b++)e=f[b],g="string"==typeof e.method?e.context[e.method]:e.method,g.apply(e.context,e.args?e.args.concat(h):h);return!0}return!1},c.EventEmitter.prototype.connect=function(a,b){var c,d,e;for(e in b)c=b[e],Array.isArray(c)?(d=c.slice(1),c=c[0]):d=[],this.on(e,c,d,a);return this},c.EventEmitter.prototype.disconnect=function(a,b){var c,d,e;if(b)for(d in b)this.off(d,b[d],a);else for(d in this.bindings)for(e=this.bindings[d],c=e.length;c--;)e[c]&&e[c].context===a&&this.off(d,e[c].method,a);return this}}(),c.Registry=function(){c.EventEmitter.call(this),this.registry={}},c.mixinClass(c.Registry,c.EventEmitter),c.Registry.prototype.register=function(a,b){var c,d;if("string"==typeof a)this.registry[a]=b,this.emit("register",a,b);else{if(!Array.isArray(a))throw new Error("Name must be a string or array, cannot be a "+typeof a);for(c=0,d=a.length;d>c;c++)this.register(a[c],b)}},c.Registry.prototype.lookup=function(a){return d.call(this.registry,a)?this.registry[a]:void 0},c.Factory=function(){c.Factory.parent.call(this),this.entries=[]},c.inheritClass(c.Factory,c.Registry),c.Factory.prototype.register=function(a){var b;if("function"!=typeof a)throw new Error("constructor must be a function, cannot be a "+typeof a);if(b=a["static"]&&a["static"].name,"string"!=typeof b||""===b)throw new Error("Name must be a string and must not be empty");this.entries.push(b),c.Factory.parent.prototype.register.call(this,b,a)},c.Factory.prototype.create=function(a){var b,c,d=[],e=this.lookup(a);if(!e)throw new Error("No class registered by that name: "+a);for(c=1;c<arguments.length;c++)d.push(arguments[c]);return b=Object.create(e.prototype),e.apply(b,d),b},"undefined"!=typeof module&&module.exports?module.exports=c:a.OO=c}(this),function(a){"use strict";a.ui={},a.ui.bind=$.proxy,a.ui.Keys={UNDEFINED:0,BACKSPACE:8,DELETE:46,LEFT:37,RIGHT:39,UP:38,DOWN:40,ENTER:13,END:35,HOME:36,TAB:9,PAGEUP:33,PAGEDOWN:34,ESCAPE:27,SHIFT:16,SPACE:32},a.ui.getUserLanguages=function(){return["en"]},a.ui.getLocalValue=function(b,c,d){var e,f,g;if(b[c])return b[c];for(g=a.ui.getUserLanguages(),e=0,f=g.length;f>e;e++)if(c=g[e],b[c])return b[c];if(b[d])return b[d];for(c in b)return b[c];return void 0},a.ui.contains=function(a,b,c){var d;for(Array.isArray(a)||(a=[a]),d=a.length-1;d>=0;d--)if(c&&b===a[d]||$.contains(a[d],b))return!0;return!1},function(){var b={"ooui-outline-control-move-down":"Move item down","ooui-outline-control-move-up":"Move item up","ooui-outline-control-remove":"Remove item","ooui-toolbar-more":"More","ooui-toolgroup-expand":"More","ooui-toolgroup-collapse":"Fewer","ooui-dialog-message-accept":"OK","ooui-dialog-message-reject":"Cancel","ooui-dialog-process-error":"Something went wrong","ooui-dialog-process-dismiss":"Dismiss","ooui-dialog-process-retry":"Try again","ooui-dialog-process-continue":"Continue"};a.ui.msg=function(a){var c=b[a],d=Array.prototype.slice.call(arguments,1);return c="string"==typeof c?c.replace(/\$(\d+)/g,function(a,b){var c=parseInt(b,10);return void 0!==d[c-1]?d[c-1]:"$"+b}):"["+a+"]"},a.ui.deferMsg=function(){var b=arguments;return function(){return a.ui.msg.apply(a.ui,b)}},a.ui.resolveMsg=function(a){return $.isFunction(a)?a():a}}(),a.ui.PendingElement=function(a){a=a||{},this.pending=0,this.$pending=null,this.setPendingElement(a.$pending||this.$element)},a.initClass(a.ui.PendingElement),a.ui.PendingElement.prototype.setPendingElement=function(a){this.$pending&&this.$pending.removeClass("oo-ui-pendingElement-pending"),this.$pending=a,this.pending>0&&this.$pending.addClass("oo-ui-pendingElement-pending")},a.ui.PendingElement.prototype.isPending=function(){return!!this.pending},a.ui.PendingElement.prototype.pushPending=function(){return 0===this.pending&&(this.$pending.addClass("oo-ui-pendingElement-pending"),this.updateThemeClasses()),this.pending++,this},a.ui.PendingElement.prototype.popPending=function(){return 1===this.pending&&(this.$pending.removeClass("oo-ui-pendingElement-pending"),this.updateThemeClasses()),this.pending=Math.max(0,this.pending-1),this},a.ui.ActionSet=function(b){b=b||{},a.EventEmitter.call(this),this.list=[],this.categories={actions:"getAction",flags:"getFlags",modes:"getModes"},this.categorized={},this.special={},this.others=[],this.organized=!1,this.changing=!1,this.changed=!1},a.mixinClass(a.ui.ActionSet,a.EventEmitter),a.ui.ActionSet["static"].specialFlags=["safe","primary"],a.ui.ActionSet.prototype.onActionChange=function(){this.organized=!1,this.changing?this.changed=!0:this.emit("change")},a.ui.ActionSet.prototype.isSpecial=function(a){var b;for(b in this.special)if(a===this.special[b])return!0;return!1},a.ui.ActionSet.prototype.get=function(a){var b,c,d,e,f,g,h,i;if(a){this.organize(),i=[];for(e in this.categorized)if(d=a[e])for(Array.isArray(d)||(d=[d]),b=0,c=d.length;c>b;b++)f=this.categorized[e][d[b]],Array.isArray(f)&&i.push.apply(i,f);for(b=0,c=i.length;c>b;b++)h=i[b],(void 0!==a.visible&&h.isVisible()!==a.visible||void 0!==a.disabled&&h.isDisabled()!==a.disabled)&&(i.splice(b,1),c--,b--);for(b=0,c=i.length;c>b;b++)for(h=i[b],g=i.lastIndexOf(h);g!==b;)i.splice(g,1),c--,g=i.lastIndexOf(h);return i}return this.list.slice()},a.ui.ActionSet.prototype.getSpecial=function(){return this.organize(),$.extend({},this.special)},a.ui.ActionSet.prototype.getOthers=function(){return this.organize(),this.others.slice()},a.ui.ActionSet.prototype.setMode=function(a){var b,c,d;for(this.changing=!0,b=0,c=this.list.length;c>b;b++)d=this.list[b],d.toggle(d.hasMode(a));return this.organized=!1,this.changing=!1,this.emit("change"),this},a.ui.ActionSet.prototype.setAbilities=function(a){var b,c,d,e;for(b=0,c=this.list.length;c>b;b++)e=this.list[b],d=e.getAction(),void 0!==a[d]&&e.setDisabled(!a[d]);return this},a.ui.ActionSet.prototype.forEach=function(a,b){return this.changed=!1,this.changing=!0,this.get(a).forEach(b),this.changing=!1,this.changed&&this.emit("change"),this},a.ui.ActionSet.prototype.add=function(a){var b,c,d;for(this.changing=!0,b=0,c=a.length;c>b;b++)d=a[b],d.connect(this,{click:["emit","click",d],resize:["emit","resize",d],toggle:["onActionChange"]}),this.list.push(d);return this.organized=!1,this.emit("add",a),this.changing=!1,this.emit("change"),this},a.ui.ActionSet.prototype.remove=function(a){var b,c,d,e;for(this.changing=!0,b=0,c=a.length;c>b;b++)e=a[b],d=this.list.indexOf(e),-1!==d&&(e.disconnect(this),this.list.splice(d,1));return this.organized=!1,this.emit("remove",a),this.changing=!1,this.emit("change"),this},a.ui.ActionSet.prototype.clear=function(){var a,b,c,d=this.list.slice();for(this.changing=!0,a=0,b=this.list.length;b>a;a++)c=this.list[a],c.disconnect(this);return this.list=[],this.organized=!1,this.emit("remove",d),this.changing=!1,this.emit("change"),this},a.ui.ActionSet.prototype.organize=function(){var a,b,c,d,e,f,g,h,i,j,k=this.constructor["static"].specialFlags;if(!this.organized){for(this.categorized={},this.special={},this.others=[],a=0,b=this.list.length;b>a;a++)if(f=this.list[a],f.isVisible()){for(g in this.categories)for(this.categorized[g]||(this.categorized[g]={}),h=f[this.categories[g]](),Array.isArray(h)||(h=[h]),c=0,d=h.length;d>c;c++)i=h[c],this.categorized[g][i]||(this.categorized[g][i]=[]),this.categorized[g][i].push(f);for(j=!1,c=0,d=k.length;d>c;c++)if(e=k[c],!this.special[e]&&f.hasFlag(e)){this.special[e]=f,j=!0;break}j||this.others.push(f)}this.organized=!0}return this},a.ui.Element=function(a){a=a||{},this.$=$,this.data=a.data,this.$element=$(document.createElement(this.getTagName())),this.elementGroup=null,this.debouncedUpdateThemeClassesHandler=this.debouncedUpdateThemeClasses.bind(this),this.updateThemeClassesPending=!1,$.isArray(a.classes)&&this.$element.addClass(a.classes.join(" ")),a.id&&this.$element.attr("id",a.id),a.text&&this.$element.text(a.text),a.$content&&this.$element.append(a.$content)},a.initClass(a.ui.Element),a.ui.Element["static"].tagName="div",a.ui.Element["static"].getJQuery=function(a,b){function c(a){return $(a,c.context)}return c.context=this.getDocument(a),b&&(c.$iframe=b),c},a.ui.Element["static"].getDocument=function(a){return a[0]&&a[0].ownerDocument||a.context||a.ownerDocument||a.document||9===a.nodeType&&a||null},a.ui.Element["static"].getWindow=function(a){var b=this.getDocument(a);return b.parentWindow||b.defaultView},a.ui.Element["static"].getDir=function(a){var b,c;return a instanceof jQuery&&(a=a[0]),b=9===a.nodeType,c=void 0!==a.document,(b||c)&&(c&&(a=a.document),a=a.body),$(a).css("direction")},a.ui.Element["static"].getFrameOffset=function(a,b,c){var d,e,f,g,h;if(b||(b=window),c||(c={top:0,left:0}),a.parent===a)return c;for(f=a.parent.document.getElementsByTagName("iframe"),d=0,e=f.length;e>d;d++)if(f[d].contentWindow===a){g=f[d];break}return g&&(h=g.getBoundingClientRect(),c.left+=h.left,c.top+=h.top,a!==b&&this.getFrameOffset(a.parent,c)),c},a.ui.Element["static"].getRelativePosition=function(a,b){for(var c,d,e=a.offset(),f=b.offset(),g=this.getDocument(a),h=this.getDocument(b);g!==h;){if(c=g.defaultView.frameElement,!c)throw new Error("$element frame is not contained in $anchor frame");d=$(c).offset(),e.left+=d.left,e.top+=d.top,g=c.ownerDocument}return e.left-=f.left,e.top-=f.top,e},a.ui.Element["static"].getBorders=function(a){var b=a.ownerDocument,c=b.parentWindow||b.defaultView,d=c&&c.getComputedStyle?c.getComputedStyle(a,null):a.currentStyle,e=$(a),f=parseFloat(d?d.borderTopWidth:e.css("borderTopWidth"))||0,g=parseFloat(d?d.borderLeftWidth:e.css("borderLeftWidth"))||0,h=parseFloat(d?d.borderBottomWidth:e.css("borderBottomWidth"))||0,i=parseFloat(d?d.borderRightWidth:e.css("borderRightWidth"))||0;return{top:f,left:g,bottom:h,right:i}},a.ui.Element["static"].getDimensions=function(a){var b,c,d=a.ownerDocument||a.document,e=d.parentWindow||d.defaultView;return e===a||a===d.documentElement?(c=$(e),{borders:{top:0,left:0,bottom:0,right:0},scroll:{top:c.scrollTop(),left:c.scrollLeft()},scrollbar:{right:0,bottom:0},rect:{top:0,left:0,bottom:c.innerHeight(),right:c.innerWidth()}}):(b=$(a),{borders:this.getBorders(a),scroll:{top:b.scrollTop(),left:b.scrollLeft()},scrollbar:{right:b.innerWidth()-a.clientWidth,bottom:b.innerHeight()-a.clientHeight},rect:a.getBoundingClientRect()})},a.ui.Element["static"].getRootScrollableElement=function(b){var c,d;return void 0===a.ui.scrollableElement&&(d=b.ownerDocument.body,c=d.scrollTop,d.scrollTop=1,1===d.scrollTop?(d.scrollTop=c,a.ui.scrollableElement="body"):a.ui.scrollableElement="documentElement"),b.ownerDocument[a.ui.scrollableElement]},a.ui.Element["static"].getClosestScrollableContainer=function(a,b){var c,d,e=["overflow"],f=$(a).parent();for(("x"===b||"y"===b)&&e.push("overflow-"+b);f.length;){if(f[0]===this.getRootScrollableElement(a))return f[0];for(c=e.length;c--;)if(d=f.css(e[c]),"auto"===d||"scroll"===d)return f[0];f=f.parent()}return this.getDocument(a).body},a.ui.Element["static"].scrollIntoView=function(a,b){b=b||{};var c,d={},e="function"==typeof b.complete&&b.complete,f=this.getClosestScrollableContainer(a,b.direction),g=$(f),h=this.getDimensions(a),i=this.getDimensions(f),j=$(this.getWindow(a));c=g.is("html, body")?{top:h.rect.top,bottom:j.innerHeight()-h.rect.bottom,left:h.rect.left,right:j.innerWidth()-h.rect.right}:{top:h.rect.top-(i.rect.top+i.borders.top),bottom:i.rect.bottom-i.borders.bottom-i.scrollbar.bottom-h.rect.bottom,left:h.rect.left-(i.rect.left+i.borders.left),right:i.rect.right-i.borders.right-i.scrollbar.right-h.rect.right},b.direction&&"y"!==b.direction||(c.top<0?d.scrollTop=i.scroll.top+c.top:c.top>0&&c.bottom<0&&(d.scrollTop=i.scroll.top+Math.min(c.top,-c.bottom))),b.direction&&"x"!==b.direction||(c.left<0?d.scrollLeft=i.scroll.left+c.left:c.left>0&&c.right<0&&(d.scrollLeft=i.scroll.left+Math.min(c.left,-c.right))),$.isEmptyObject(d)?e&&e():(g.stop(!0).animate(d,b.duration||"fast"),e&&g.queue(function(a){e(),a()}))},a.ui.Element["static"].reconsiderScrollbars=function(a){for(var b,c,d=[];a.firstChild;)d.push(a.firstChild),a.removeChild(a.firstChild);for(void a.offsetHeight,b=0,c=d.length;c>b;b++)a.appendChild(d[b])},a.ui.Element.prototype.getData=function(){return this.data},a.ui.Element.prototype.setData=function(a){return this.data=a,this},a.ui.Element.prototype.supports=function(a){var b,c,d=0;for(a=$.isArray(a)?a:[a],b=0,c=a.length;c>b;b++)$.isFunction(this[a[b]])&&d++;return a.length===d},a.ui.Element.prototype.updateThemeClasses=function(){this.updateThemeClassesPending||(this.updateThemeClassesPending=!0,setTimeout(this.debouncedUpdateThemeClassesHandler))},a.ui.Element.prototype.debouncedUpdateThemeClasses=function(){a.ui.theme.updateElementClasses(this),this.updateThemeClassesPending=!1},a.ui.Element.prototype.getTagName=function(){return this.constructor["static"].tagName},a.ui.Element.prototype.isElementAttached=function(){return $.contains(this.getElementDocument(),this.$element[0])},a.ui.Element.prototype.getElementDocument=function(){return a.ui.Element["static"].getDocument(this.$element)},a.ui.Element.prototype.getElementWindow=function(){return a.ui.Element["static"].getWindow(this.$element)},a.ui.Element.prototype.getClosestScrollableElementContainer=function(){return a.ui.Element["static"].getClosestScrollableContainer(this.$element[0])},a.ui.Element.prototype.getElementGroup=function(){return this.elementGroup},a.ui.Element.prototype.setElementGroup=function(a){return this.elementGroup=a,this},a.ui.Element.prototype.scrollElementIntoView=function(b){return a.ui.Element["static"].scrollIntoView(this.$element[0],b)},a.ui.Layout=function(b){b=b||{},a.ui.Layout["super"].call(this,b),a.EventEmitter.call(this),this.$element.addClass("oo-ui-layout")},a.inheritClass(a.ui.Layout,a.ui.Element),a.mixinClass(a.ui.Layout,a.EventEmitter),a.ui.Widget=function(b){b=$.extend({disabled:!1},b),a.ui.Widget["super"].call(this,b),a.EventEmitter.call(this),this.visible=!0,this.disabled=null,this.wasDisabled=null,this.$element.addClass("oo-ui-widget"),this.setDisabled(!!b.disabled)},a.inheritClass(a.ui.Widget,a.ui.Element),a.mixinClass(a.ui.Widget,a.EventEmitter),a.ui.Widget.prototype.isDisabled=function(){return this.disabled},a.ui.Widget.prototype.isVisible=function(){return this.visible},a.ui.Widget.prototype.setDisabled=function(a){var b;return this.disabled=!!a,b=this.isDisabled(),b!==this.wasDisabled&&(this.$element.toggleClass("oo-ui-widget-disabled",b),this.$element.toggleClass("oo-ui-widget-enabled",!b),this.$element.attr("aria-disabled",b.toString()),this.emit("disable",b),this.updateThemeClasses()),this.wasDisabled=b,this},a.ui.Widget.prototype.toggle=function(a){return a=void 0===a?!this.visible:!!a,a!==this.isVisible()&&(this.visible=a,this.$element.toggleClass("oo-ui-element-hidden",!this.visible),this.emit("toggle",a)),this},a.ui.Widget.prototype.updateDisabled=function(){return this.setDisabled(this.disabled),this},a.ui.Window=function(b){b=b||{},a.ui.Window["super"].call(this,b),a.EventEmitter.call(this),this.manager=null,this.size=b.size||this.constructor["static"].size,this.$frame=$("<div>"),this.$overlay=$("<div>"),this.$content=$("<div>"),this.$overlay.addClass("oo-ui-window-overlay"),this.$content.addClass("oo-ui-window-content").attr("tabIndex",0),this.$frame.addClass("oo-ui-window-frame").append(this.$content),this.$element.addClass("oo-ui-window").append(this.$frame,this.$overlay),this.visible=!1,this.$element.addClass("oo-ui-element-hidden")},a.inheritClass(a.ui.Window,a.ui.Element),a.mixinClass(a.ui.Window,a.EventEmitter),a.ui.Window["static"].size="medium",a.ui.Window.prototype.onMouseDown=function(a){return a.target===this.$element[0]?!1:void 0},a.ui.Window.prototype.isInitialized=function(){return!!this.manager},a.ui.Window.prototype.isVisible=function(){return this.visible},a.ui.Window.prototype.isOpening=function(){return this.manager.isOpening(this)},a.ui.Window.prototype.isClosing=function(){return this.manager.isClosing(this)},a.ui.Window.prototype.isOpened=function(){return this.manager.isOpened(this)},a.ui.Window.prototype.getManager=function(){return this.manager},a.ui.Window.prototype.getSize=function(){return this.size},a.ui.Window.prototype.withoutSizeTransitions=function(a){var b,c=this.$frame[0].style;b=c.transition||c.OTransition||c.MsTransition||c.MozTransition||c.WebkitTransition,c.transition=c.OTransition=c.MsTransition=c.MozTransition=c.WebkitTransition="none",a(),this.$frame.height(),c.transition=c.OTransition=c.MsTransition=c.MozTransition=c.WebkitTransition=b},a.ui.Window.prototype.getContentHeight=function(){var a,b=this,c=this.$body[0].style,d=this.$frame[0].style;return this.withoutSizeTransitions(function(){var e=d.height,f=c.position;d.height="1px",c.position="relative",a=b.getBodyHeight(),d.height=e,c.position=f}),this.$frame.outerHeight()-this.$frame.innerHeight()+(this.$head.outerHeight(!0)+a+this.$foot.outerHeight(!0))},a.ui.Window.prototype.getBodyHeight=function(){return this.$body[0].scrollHeight},a.ui.Window.prototype.getDir=function(){return this.dir},a.ui.Window.prototype.getSetupProcess=function(){return new a.ui.Process},a.ui.Window.prototype.getReadyProcess=function(){return new a.ui.Process},a.ui.Window.prototype.getHoldProcess=function(){return new a.ui.Process},a.ui.Window.prototype.getTeardownProcess=function(){return new a.ui.Process},a.ui.Window.prototype.toggle=function(a){return a=void 0===a?!this.visible:!!a,a!==this.isVisible()&&(this.visible=a,this.$element.toggleClass("oo-ui-element-hidden",!this.visible),this.emit("toggle",a)),this},a.ui.Window.prototype.setManager=function(a){if(this.manager)throw new Error("Cannot set window manager, window already has a manager");return this.manager=a,this.initialize(),this},a.ui.Window.prototype.setSize=function(a){return this.size=a,this.updateSize(),this},a.ui.Window.prototype.updateSize=function(){if(!this.manager)throw new Error("Cannot update window size, must be attached to a manager");return this.manager.updateWindowSize(this),this},a.ui.Window.prototype.setDimensions=function(a){var b,c=this,d=this.$frame[0].style;return void 0===a.height?this.withoutSizeTransitions(function(){var e=d.width;c.$frame.css("width",a.width||""),b=c.getContentHeight(),d.width=e}):b=a.height,this.$frame.css({width:a.width||"",minWidth:a.minWidth||"",maxWidth:a.maxWidth||"",height:b||"",minHeight:a.minHeight||"",maxHeight:a.maxHeight||""}),this},a.ui.Window.prototype.initialize=function(){if(!this.manager)throw new Error("Cannot initialize window, must be attached to a manager");return this.$head=$("<div>"),this.$body=$("<div>"),this.$foot=$("<div>"),this.$innerOverlay=$("<div>"),this.dir=a.ui.Element["static"].getDir(this.$content)||"ltr",this.$document=$(this.getElementDocument()),this.$element.on("mousedown",this.onMouseDown.bind(this)),this.$head.addClass("oo-ui-window-head"),this.$body.addClass("oo-ui-window-body"),this.$foot.addClass("oo-ui-window-foot"),this.$innerOverlay.addClass("oo-ui-window-inner-overlay"),this.$content.append(this.$head,this.$body,this.$foot,this.$innerOverlay),this},a.ui.Window.prototype.open=function(a){if(!this.manager)throw new Error("Cannot open window, must be attached to a manager");return this.manager.openWindow(this,a)},a.ui.Window.prototype.close=function(a){if(!this.manager)throw new Error("Cannot close window, must be attached to a manager");return this.manager.closeWindow(this,a)},a.ui.Window.prototype.setup=function(a){var b=this,c=$.Deferred();return this.toggle(!0),this.getSetupProcess(a).execute().done(function(){b.$element.addClass("oo-ui-window-active oo-ui-window-setup").width(),b.$content.addClass("oo-ui-window-content-setup").width(),c.resolve()}),c.promise()},a.ui.Window.prototype.ready=function(a){var b=this,c=$.Deferred();return this.$content.focus(),this.getReadyProcess(a).execute().done(function(){b.$element.addClass("oo-ui-window-ready").width(),b.$content.addClass("oo-ui-window-content-ready").width(),c.resolve()}),c.promise()},a.ui.Window.prototype.hold=function(b){var c=this,d=$.Deferred();return this.getHoldProcess(b).execute().done(function(){var b=c.$content.find(a.ui.Element["static"].getDocument(c.$content).activeElement);b.length&&b[0].blur(),c.$element.removeClass("oo-ui-window-ready").width(),c.$content.removeClass("oo-ui-window-content-ready").width(),d.resolve()}),d.promise()},a.ui.Window.prototype.teardown=function(a){var b=this;return this.getTeardownProcess(a).execute().done(function(){b.$element.removeClass("oo-ui-window-active oo-ui-window-setup").width(),b.$content.removeClass("oo-ui-window-content-setup").width(),b.toggle(!1)})},a.ui.Dialog=function(b){a.ui.Dialog["super"].call(this,b),a.ui.PendingElement.call(this),this.actions=new a.ui.ActionSet,this.attachedActions=[],this.currentAction=null,this.onDocumentKeyDownHandler=this.onDocumentKeyDown.bind(this),this.actions.connect(this,{click:"onActionClick",resize:"onActionResize",change:"onActionsChange"}),this.$element.addClass("oo-ui-dialog").attr("role","dialog")},a.inheritClass(a.ui.Dialog,a.ui.Window),a.mixinClass(a.ui.Dialog,a.ui.PendingElement),a.ui.Dialog["static"].name="",a.ui.Dialog["static"].title="",a.ui.Dialog["static"].actions=[],a.ui.Dialog["static"].escapable=!0,a.ui.Dialog.prototype.onDocumentKeyDown=function(b){b.which===a.ui.Keys.ESCAPE&&(this.close(),b.preventDefault(),b.stopPropagation())},a.ui.Dialog.prototype.onActionResize=function(){},a.ui.Dialog.prototype.onActionClick=function(a){this.isPending()||(this.currentAction=a,this.executeAction(a.getAction()))},a.ui.Dialog.prototype.onActionsChange=function(){this.detachActions(),this.isClosing()||this.attachActions()},a.ui.Dialog.prototype.getActions=function(){return this.actions},a.ui.Dialog.prototype.getActionProcess=function(b){return(new a.ui.Process).next(function(){b||this.close()},this)},a.ui.Dialog.prototype.getSetupProcess=function(b){return b=b||{},a.ui.Dialog["super"].prototype.getSetupProcess.call(this,b).next(function(){var c,d,e=[],f=this.constructor["static"],g=void 0!==b.actions?b.actions:f.actions;for(this.title.setLabel(void 0!==b.title?b.title:this.constructor["static"].title),c=0,d=g.length;d>c;c++)e.push(new a.ui.ActionWidget(g[c]));this.actions.add(e),this.constructor["static"].escapable&&this.$document.on("keydown",this.onDocumentKeyDownHandler)},this)},a.ui.Dialog.prototype.getTeardownProcess=function(b){return a.ui.Dialog["super"].prototype.getTeardownProcess.call(this,b).first(function(){this.constructor["static"].escapable&&this.$document.off("keydown",this.onDocumentKeyDownHandler),this.actions.clear(),this.currentAction=null},this)},a.ui.Dialog.prototype.initialize=function(){a.ui.Dialog["super"].prototype.initialize.call(this),this.title=new a.ui.LabelWidget,this.$content.addClass("oo-ui-dialog-content"),this.setPendingElement(this.$head)},a.ui.Dialog.prototype.attachActions=function(){this.attachedActions=this.actions.get()},a.ui.Dialog.prototype.detachActions=function(){var a,b;for(a=0,b=this.attachedActions.length;b>a;a++)this.attachedActions[a].$element.detach();this.attachedActions=[]},a.ui.Dialog.prototype.executeAction=function(a){return this.pushPending(),this.getActionProcess(a).execute().always(this.popPending.bind(this))},a.ui.WindowManager=function(b){b=b||{},a.ui.WindowManager["super"].call(this,b),a.EventEmitter.call(this),this.factory=b.factory,this.modal=void 0===b.modal||!!b.modal,this.windows={},this.opening=null,this.opened=null,this.closing=null,this.preparingToOpen=null,this.preparingToClose=null,this.currentWindow=null,this.$ariaHidden=null,this.onWindowResizeTimeout=null,this.onWindowResizeHandler=this.onWindowResize.bind(this),this.afterWindowResizeHandler=this.afterWindowResize.bind(this),this.$element.addClass("oo-ui-windowManager").toggleClass("oo-ui-windowManager-modal",this.modal)},a.inheritClass(a.ui.WindowManager,a.ui.Element),a.mixinClass(a.ui.WindowManager,a.EventEmitter),a.ui.WindowManager["static"].sizes={small:{width:300},medium:{width:500},large:{width:700},larger:{width:900},full:{width:"100%",height:"100%"}},a.ui.WindowManager["static"].defaultSize="medium",a.ui.WindowManager.prototype.onWindowResize=function(){clearTimeout(this.onWindowResizeTimeout),this.onWindowResizeTimeout=setTimeout(this.afterWindowResizeHandler,200)
},a.ui.WindowManager.prototype.afterWindowResize=function(){this.currentWindow&&this.updateWindowSize(this.currentWindow)},a.ui.WindowManager.prototype.isOpening=function(a){return a===this.currentWindow&&!!this.opening&&"pending"===this.opening.state()},a.ui.WindowManager.prototype.isClosing=function(a){return a===this.currentWindow&&!!this.closing&&"pending"===this.closing.state()},a.ui.WindowManager.prototype.isOpened=function(a){return a===this.currentWindow&&!!this.opened&&"pending"===this.opened.state()},a.ui.WindowManager.prototype.hasWindow=function(a){var b;for(b in this.windows)if(this.windows[b]===a)return!0;return!1},a.ui.WindowManager.prototype.getSetupDelay=function(){return 0},a.ui.WindowManager.prototype.getReadyDelay=function(){return 0},a.ui.WindowManager.prototype.getHoldDelay=function(){return 0},a.ui.WindowManager.prototype.getTeardownDelay=function(){return this.modal?250:0},a.ui.WindowManager.prototype.getWindow=function(b){var c=$.Deferred(),d=this.windows[b];return d instanceof a.ui.Window?c.resolve(d):this.factory?this.factory.lookup(b)?(d=this.factory.create(b,this),this.addWindows([d]),c.resolve(d)):c.reject(new a.ui.Error("Cannot auto-instantiate window: symbolic name is unrecognized by the factory")):c.reject(new a.ui.Error("Cannot get unmanaged window: symbolic name unrecognized as a managed window")),c.promise()},a.ui.WindowManager.prototype.getCurrentWindow=function(){return this.currentWindow},a.ui.WindowManager.prototype.openWindow=function(b,c){var d=this,e=$.Deferred();return"string"==typeof b?this.getWindow(b).then(function(a){return d.openWindow(a,c)}):(this.hasWindow(b)?(this.preparingToOpen||this.opening||this.opened)&&e.reject(new a.ui.Error("Cannot open window: another window is opening or open")):e.reject(new a.ui.Error("Cannot open window: window is not attached to manager")),"rejected"!==e.state()&&(this.preparingToOpen=$.when(this.closing),this.preparingToOpen.done(function(){d.modal&&(d.toggleGlobalEvents(!0),d.toggleAriaIsolation(!0)),d.currentWindow=b,d.opening=e,d.preparingToOpen=null,d.emit("opening",b,e,c),setTimeout(function(){b.setup(c).then(function(){d.updateWindowSize(b),d.opening.notify({state:"setup"}),setTimeout(function(){b.ready(c).then(function(){d.opening.notify({state:"ready"}),d.opening=null,d.opened=$.Deferred(),e.resolve(d.opened.promise(),c)})},d.getReadyDelay())})},d.getSetupDelay())})),e.promise())},a.ui.WindowManager.prototype.closeWindow=function(b,c){var d,e=this,f=$.Deferred();return"string"==typeof b?b=this.windows[b]:this.hasWindow(b)||(b=null),b?b!==this.currentWindow?f.reject(new a.ui.Error("Cannot close window: window already closed with different data")):(this.preparingToClose||this.closing)&&f.reject(new a.ui.Error("Cannot close window: window already closing with different data")):f.reject(new a.ui.Error("Cannot close window: window is not attached to manager")),"rejected"!==f.state()&&(this.preparingToClose=$.when(this.opening),this.preparingToClose.done(function(){e.closing=f,e.preparingToClose=null,e.emit("closing",b,f,c),d=e.opened,e.opened=null,d.resolve(f.promise(),c),setTimeout(function(){b.hold(c).then(function(){f.notify({state:"hold"}),setTimeout(function(){b.teardown(c).then(function(){f.notify({state:"teardown"}),e.modal&&(e.toggleGlobalEvents(!1),e.toggleAriaIsolation(!1)),e.closing=null,e.currentWindow=null,f.resolve(c)})},e.getTeardownDelay())})},e.getHoldDelay())})),f.promise()},a.ui.WindowManager.prototype.addWindows=function(a){var b,c,d,e,f;if($.isArray(a))for(f={},b=0,c=a.length;c>b;b++){if(e=a[b].constructor["static"].name,"string"!=typeof e)throw new Error("Cannot add window");f[e]=a[b]}else $.isPlainObject(a)&&(f=a);for(e in f)d=f[e],this.windows[e]=d.toggle(!1),this.$element.append(d.$element),d.setManager(this)},a.ui.WindowManager.prototype.removeWindows=function(a){var b,c,d,e,f,g=this,h=[],i=function(a,b){delete g.windows[a],b.$element.detach()};for(b=0,c=a.length;c>b;b++){if(e=a[b],d=this.windows[e],!d)throw new Error("Cannot remove window");f=i.bind(null,e,d),h.push(this.closeWindow(e).then(f,f))}return $.when.apply($,h)},a.ui.WindowManager.prototype.clearWindows=function(){return this.removeWindows(Object.keys(this.windows))},a.ui.WindowManager.prototype.updateWindowSize=function(b){if(b===this.currentWindow){var c=a.ui.Element["static"].getDimensions(b.getElementWindow()),d=this.constructor["static"].sizes,e=b.getSize();return d[e]||(e=this.constructor["static"].defaultSize),"full"!==e&&c.rect.right-c.rect.left<d[e].width&&(e="full"),this.$element.toggleClass("oo-ui-windowManager-fullscreen","full"===e),this.$element.toggleClass("oo-ui-windowManager-floating","full"!==e),b.setDimensions(d[e]),this.emit("resize",b),this}},a.ui.WindowManager.prototype.toggleGlobalEvents=function(a){return a=void 0===a?!!this.globalEvents:!!a,a?this.globalEvents||($(this.getElementWindow()).on({"orientationchange resize":this.onWindowResizeHandler}),$(this.getElementDocument().body).css("overflow","hidden"),this.globalEvents=!0):this.globalEvents&&($(this.getElementWindow()).off({"orientationchange resize":this.onWindowResizeHandler}),$(this.getElementDocument().body).css("overflow",""),this.globalEvents=!1),this},a.ui.WindowManager.prototype.toggleAriaIsolation=function(a){return a=void 0===a?!this.$ariaHidden:!!a,a?this.$ariaHidden||(this.$ariaHidden=$("body").children().not(this.$element.parentsUntil("body").last()).attr("aria-hidden","")):this.$ariaHidden&&(this.$ariaHidden.removeAttr("aria-hidden"),this.$ariaHidden=null),this},a.ui.WindowManager.prototype.destroy=function(){this.toggleGlobalEvents(!1),this.toggleAriaIsolation(!1),this.clearWindows(),this.$element.remove()},a.ui.Error=function(a,b){b=b||{},this.message=a instanceof jQuery?a:String(a),this.recoverable=void 0===b.recoverable||!!b.recoverable,this.warning=!!b.warning},a.initClass(a.ui.Error),a.ui.Error.prototype.isRecoverable=function(){return this.recoverable},a.ui.Error.prototype.isWarning=function(){return this.warning},a.ui.Error.prototype.getMessage=function(){return this.message instanceof jQuery?this.message.clone():$("<div>").text(this.message).contents()},a.ui.Error.prototype.getMessageText=function(){return this.message instanceof jQuery?this.message.text():this.message},a.ui.Process=function(a,b){this.steps=[],void 0!==a&&this.next(a,b)},a.initClass(a.ui.Process),a.ui.Process.prototype.execute=function(){function b(b){return function(){var c,d=b.callback.call(b.context);if(d===!1)return $.Deferred().reject([]).promise();if("number"==typeof d){if(0>d)throw new Error("Cannot go back in time: flux capacitor is out of service");return c=$.Deferred(),setTimeout(c.resolve,d),c.promise()}return d instanceof a.ui.Error?$.Deferred().reject([d]).promise():$.isArray(d)&&d.length&&d[0]instanceof a.ui.Error?$.Deferred().reject(d).promise():d&&$.isFunction(d.promise)?d.promise():$.Deferred().resolve().promise()}}var c,d,e;if(this.steps.length)for(e=b(this.steps[0])(),c=1,d=this.steps.length;d>c;c++)e=e.then(b(this.steps[c]));else e=$.Deferred().resolve().promise();return e},a.ui.Process.prototype.createStep=function(a,b){if("number"==typeof a||$.isFunction(a.promise))return{callback:function(){return a},context:null};if($.isFunction(a))return{callback:a,context:b};throw new Error("Cannot create process step: number, promise or function expected")},a.ui.Process.prototype.first=function(a,b){return this.steps.unshift(this.createStep(a,b)),this},a.ui.Process.prototype.next=function(a,b){return this.steps.push(this.createStep(a,b)),this},a.ui.ToolFactory=function(){a.ui.ToolFactory["super"].call(this)},a.inheritClass(a.ui.ToolFactory,a.Factory),a.ui.ToolFactory.prototype.getTools=function(b,c,d,e){var f,g,h,i,j,k=[],l={};for(h=a.simpleArrayDifference(this.extract(b),this.extract(c)),i=this.extract(d,l),j=this.extract(e,l),f=0,g=h.length;g>f;f++)l[h[f]]||k.push(h[f]);return i.concat(k).concat(j)},a.ui.ToolFactory.prototype.extract=function(b,c){var d,e,f,g,h,i=[];if("*"===b)for(g in this.registry)h=this.registry[g],!h["static"].autoAddToCatchall||c&&c[g]||(i.push(g),c&&(c[g]=!0));else if($.isArray(b))for(d=0,e=b.length;e>d;d++)if(f=b[d],"string"==typeof f&&(f={name:f}),a.isPlainObject(f))if(f.group)for(g in this.registry)h=this.registry[g],h["static"].group!==f.group||!h["static"].autoAddToGroup||c&&c[g]||(i.push(g),c&&(c[g]=!0));else!f.name||c&&c[f.name]||(i.push(f.name),c&&(c[f.name]=!0));return i},a.ui.ToolGroupFactory=function(){a.Factory.call(this);var b,c,d=this.constructor["static"].getDefaultClasses();for(b=0,c=d.length;c>b;b++)this.register(d[b])},a.inheritClass(a.ui.ToolGroupFactory,a.Factory),a.ui.ToolGroupFactory["static"].getDefaultClasses=function(){return[a.ui.BarToolGroup,a.ui.ListToolGroup,a.ui.MenuToolGroup]},a.ui.Theme=function(a){a=a||{}},a.initClass(a.ui.Theme),a.ui.Theme.prototype.getElementClasses=function(){return{on:[],off:[]}},a.ui.Theme.prototype.updateElementClasses=function(a){var b=this.getElementClasses(a);a.$element.removeClass(b.off.join(" ")).addClass(b.on.join(" "))},a.ui.TabIndexedElement=function(a){a=a||{},this.$tabIndexed=null,this.tabIndex=null,this.connect(this,{disable:"onDisable"}),this.setTabIndex(a.tabIndex||0),this.setTabIndexedElement(a.$tabIndexed||this.$element)},a.initClass(a.ui.TabIndexedElement),a.ui.TabIndexedElement.prototype.setTabIndexedElement=function(a){this.$tabIndexed&&this.$tabIndexed.removeAttr("tabindex aria-disabled"),this.$tabIndexed=a,null!==this.tabIndex&&this.$tabIndexed.attr({tabindex:this.isDisabled()?-1:this.tabIndex,"aria-disabled":this.isDisabled().toString()})},a.ui.TabIndexedElement.prototype.setTabIndex=function(a){return a="number"==typeof a?a:null,this.tabIndex!==a&&(this.$tabIndexed&&(null!==a?this.$tabIndexed.attr({tabindex:this.isDisabled()?-1:a,"aria-disabled":this.isDisabled().toString()}):this.$tabIndexed.removeAttr("tabindex aria-disabled")),this.tabIndex=a),this},a.ui.TabIndexedElement.prototype.onDisable=function(a){this.$tabIndexed&&null!==this.tabIndex&&this.$tabIndexed.attr({tabindex:a?-1:this.tabIndex,"aria-disabled":a.toString()})},a.ui.TabIndexedElement.prototype.getTabIndex=function(){return this.tabIndex},a.ui.ButtonElement=function(a){a=a||{},this.$button=a.$button||$("<a>"),this.framed=null,this.accessKey=null,this.active=!1,this.onMouseUpHandler=this.onMouseUp.bind(this),this.onMouseDownHandler=this.onMouseDown.bind(this),this.onKeyDownHandler=this.onKeyDown.bind(this),this.onKeyUpHandler=this.onKeyUp.bind(this),this.onClickHandler=this.onClick.bind(this),this.onKeyPressHandler=this.onKeyPress.bind(this),this.$element.addClass("oo-ui-buttonElement"),this.toggleFramed(void 0===a.framed||a.framed),this.setAccessKey(a.accessKey),this.setButtonElement(this.$button)},a.initClass(a.ui.ButtonElement),a.ui.ButtonElement["static"].cancelButtonMouseDownEvents=!0,a.ui.ButtonElement.prototype.setButtonElement=function(a){this.$button&&this.$button.removeClass("oo-ui-buttonElement-button").removeAttr("role accesskey").off({mousedown:this.onMouseDownHandler,keydown:this.onKeyDownHandler,click:this.onClickHandler,keypress:this.onKeyPressHandler}),this.$button=a.addClass("oo-ui-buttonElement-button").attr({role:"button",accesskey:this.accessKey}).on({mousedown:this.onMouseDownHandler,keydown:this.onKeyDownHandler,click:this.onClickHandler,keypress:this.onKeyPressHandler})},a.ui.ButtonElement.prototype.onMouseDown=function(a){return this.isDisabled()||1!==a.which?void 0:(this.$element.addClass("oo-ui-buttonElement-pressed"),this.getElementDocument().addEventListener("mouseup",this.onMouseUpHandler,!0),this.constructor["static"].cancelButtonMouseDownEvents?!1:void 0)},a.ui.ButtonElement.prototype.onMouseUp=function(a){this.isDisabled()||1!==a.which||(this.$element.removeClass("oo-ui-buttonElement-pressed"),this.getElementDocument().removeEventListener("mouseup",this.onMouseUpHandler,!0))},a.ui.ButtonElement.prototype.onClick=function(a){return this.isDisabled()||1!==a.which||this.emit("click"),!1},a.ui.ButtonElement.prototype.onKeyDown=function(b){this.isDisabled()||b.which!==a.ui.Keys.SPACE&&b.which!==a.ui.Keys.ENTER||(this.$element.addClass("oo-ui-buttonElement-pressed"),this.getElementDocument().addEventListener("keyup",this.onKeyUpHandler,!0))},a.ui.ButtonElement.prototype.onKeyUp=function(b){this.isDisabled()||b.which!==a.ui.Keys.SPACE&&b.which!==a.ui.Keys.ENTER||(this.$element.removeClass("oo-ui-buttonElement-pressed"),this.getElementDocument().removeEventListener("keyup",this.onKeyUpHandler,!0))},a.ui.ButtonElement.prototype.onKeyPress=function(b){return this.isDisabled()||b.which!==a.ui.Keys.SPACE&&b.which!==a.ui.Keys.ENTER||this.emit("click"),!1},a.ui.ButtonElement.prototype.isFramed=function(){return this.framed},a.ui.ButtonElement.prototype.toggleFramed=function(a){return a=void 0===a?!this.framed:!!a,a!==this.framed&&(this.framed=a,this.$element.toggleClass("oo-ui-buttonElement-frameless",!a).toggleClass("oo-ui-buttonElement-framed",a),this.updateThemeClasses()),this},a.ui.ButtonElement.prototype.setAccessKey=function(a){return a="string"==typeof a&&a.length?a:null,this.accessKey!==a&&(this.$button&&(null!==a?this.$button.attr("accesskey",a):this.$button.removeAttr("accesskey")),this.accessKey=a),this},a.ui.ButtonElement.prototype.setActive=function(a){return this.$element.toggleClass("oo-ui-buttonElement-active",!!a),this},a.ui.GroupElement=function(a){a=a||{},this.$group=null,this.items=[],this.aggregateItemEvents={},this.setGroupElement(a.$group||$("<div>"))},a.ui.GroupElement.prototype.setGroupElement=function(a){var b,c;for(this.$group=a,b=0,c=this.items.length;c>b;b++)this.$group.append(this.items[b].$element)},a.ui.GroupElement.prototype.isEmpty=function(){return!this.items.length},a.ui.GroupElement.prototype.getItems=function(){return this.items.slice(0)},a.ui.GroupElement.prototype.getItemFromData=function(b){var c,d,e,f=a.getHash(b);for(c=0,d=this.items.length;d>c;c++)if(e=this.items[c],f===a.getHash(e.getData()))return e;return null},a.ui.GroupElement.prototype.getItemsFromData=function(b){var c,d,e,f=a.getHash(b),g=[];for(c=0,d=this.items.length;d>c;c++)e=this.items[c],f===a.getHash(e.getData())&&g.push(e);return g},a.ui.GroupElement.prototype.aggregate=function(a){var b,c,d,e,f,g,h;for(g in a){if(h=a[g],Object.prototype.hasOwnProperty.call(this.aggregateItemEvents,g)){if(h)throw new Error("Duplicate item event aggregation for "+g);for(b=0,c=this.items.length;c>b;b++)d=this.items[b],d.connect&&d.disconnect&&(f={},f[g]=["emit",h,d],d.disconnect(this,f));delete this.aggregateItemEvents[g]}if(h)for(this.aggregateItemEvents[g]=h,b=0,c=this.items.length;c>b;b++)d=this.items[b],d.connect&&d.disconnect&&(e={},e[g]=["emit",h,d],d.connect(this,e))}},a.ui.GroupElement.prototype.addItems=function(a,b){var c,d,e,f,g,h,i=[];for(c=0,d=a.length;d>c;c++){if(e=a[c],h=$.inArray(e,this.items),h>=0&&(this.removeItems([e]),b>h&&b--),e.connect&&e.disconnect&&!$.isEmptyObject(this.aggregateItemEvents)){g={};for(f in this.aggregateItemEvents)g[f]=["emit",this.aggregateItemEvents[f],e];e.connect(this,g)}e.setElementGroup(this),i.push(e.$element.get(0))}return void 0===b||0>b||b>=this.items.length?(this.$group.append(i),this.items.push.apply(this.items,a)):0===b?(this.$group.prepend(i),this.items.unshift.apply(this.items,a)):(this.items[b].$element.before(i),this.items.splice.apply(this.items,[b,0].concat(a))),this},a.ui.GroupElement.prototype.removeItems=function(a){var b,c,d,e,f,g;for(b=0,c=a.length;c>b;b++)d=a[b],e=$.inArray(d,this.items),-1!==e&&(d.connect&&d.disconnect&&!$.isEmptyObject(this.aggregateItemEvents)&&(f={},Object.prototype.hasOwnProperty.call(this.aggregateItemEvents,g)&&(f[g]=["emit",this.aggregateItemEvents[g],d]),d.disconnect(this,f)),d.setElementGroup(null),this.items.splice(e,1),d.$element.detach());return this},a.ui.GroupElement.prototype.clearItems=function(){var a,b,c,d,e;for(a=0,b=this.items.length;b>a;a++)c=this.items[a],c.connect&&c.disconnect&&!$.isEmptyObject(this.aggregateItemEvents)&&(d={},Object.prototype.hasOwnProperty.call(this.aggregateItemEvents,e)&&(d[e]=["emit",this.aggregateItemEvents[e],c]),c.disconnect(this,d)),c.setElementGroup(null),c.$element.detach();return this.items=[],this},a.ui.DraggableElement=function(){this.index=null,this.$element.attr("draggable",!0).addClass("oo-ui-draggableElement").on({dragstart:this.onDragStart.bind(this),dragover:this.onDragOver.bind(this),dragend:this.onDragEnd.bind(this),drop:this.onDrop.bind(this)})},a.initClass(a.ui.DraggableElement),a.ui.DraggableElement["static"].cancelButtonMouseDownEvents=!1,a.ui.DraggableElement.prototype.onDragStart=function(a){var b=a.originalEvent.dataTransfer;b.dropEffect="none",b.effectAllowed="move";try{b.setData("application-x/OOjs-UI-draggable",this.getIndex())}catch(c){}return this.$element.addClass("oo-ui-draggableElement-dragging"),this.emit("dragstart",this),!0},a.ui.DraggableElement.prototype.onDragEnd=function(){this.$element.removeClass("oo-ui-draggableElement-dragging"),this.emit("dragend")},a.ui.DraggableElement.prototype.onDrop=function(a){a.preventDefault(),this.emit("drop",a)},a.ui.DraggableElement.prototype.onDragOver=function(a){a.preventDefault()},a.ui.DraggableElement.prototype.setIndex=function(a){this.index!==a&&(this.index=a,this.$element.data("index",a))},a.ui.DraggableElement.prototype.getIndex=function(){return this.index},a.ui.DraggableGroupElement=function(b){b=b||{},a.ui.GroupElement.call(this,b),this.orientation=b.orientation||"vertical",this.dragItem=null,this.itemDragOver=null,this.itemKeys={},this.sideInsertion="",this.aggregate({dragstart:"itemDragStart",dragend:"itemDragEnd",drop:"itemDrop"}),this.connect(this,{itemDragStart:"onItemDragStart",itemDrop:"onItemDrop",itemDragEnd:"onItemDragEnd"}),this.$element.on({dragover:$.proxy(this.onDragOver,this),dragleave:$.proxy(this.onDragLeave,this)}),$.isArray(b.items)&&this.addItems(b.items),this.$placeholder=$("<div>").addClass("oo-ui-draggableGroupElement-placeholder"),this.$element.addClass("oo-ui-draggableGroupElement").append(this.$status).toggleClass("oo-ui-draggableGroupElement-horizontal","horizontal"===this.orientation).prepend(this.$placeholder)},a.mixinClass(a.ui.DraggableGroupElement,a.ui.GroupElement),a.ui.DraggableGroupElement.prototype.onItemDragStart=function(a){var b,c;for(b=0,c=this.items.length;c>b;b++)this.items[b].setIndex(b);this.$placeholder.css("horizontal"===this.orientation?{height:a.$element.outerHeight(),width:2}:{height:2,width:a.$element.outerWidth()}),this.setDragItem(a)},a.ui.DraggableGroupElement.prototype.onItemDragEnd=function(){return this.unsetDragItem(),!1},a.ui.DraggableGroupElement.prototype.onItemDrop=function(a){var b=a.getIndex();return this.getDragItem()&&("after"===this.sideInsertion&&b++,this.emit("reorder",this.getDragItem(),b)),this.unsetDragItem(),!1},a.ui.DraggableGroupElement.prototype.onDragLeave=function(){this.$placeholder.css("left",0).addClass("oo-ui-element-hidden")},a.ui.DraggableGroupElement.prototype.onDragOver=function(a){var b,c,d,e,f,g,h,i,j,k,l=a.originalEvent.clientX,m=a.originalEvent.clientY;b=this.getElementDocument().elementFromPoint(l,m),c=$(b).closest(".oo-ui-draggableElement"),c[0]&&(d=c.offset(),f=c[0].getBoundingClientRect(),k=c.position(),j=c.data("index")),d&&this.isDragging()&&j!==this.getDragItem().getIndex()?("horizontal"===this.orientation?(g=f.width,e=f.left+g/2,i=l,h={left:e>i?k.left:k.left+g,top:k.top}):(g=f.height,e=f.top+g/2,i=m,h={top:e>i?k.top:k.top+g,left:k.left}),this.sideInsertion="horizontal"===this.orientation&&"rtl"===this.$element.css("direction")?e>i?"after":"before":e>i?"before":"after",this.$placeholder.css(h).removeClass("oo-ui-element-hidden")):this.$placeholder.css("left",0).addClass("oo-ui-element-hidden"),a.preventDefault()},a.ui.DraggableGroupElement.prototype.setDragItem=function(a){this.dragItem=a},a.ui.DraggableGroupElement.prototype.unsetDragItem=function(){this.dragItem=null,this.itemDragOver=null,this.$placeholder.addClass("oo-ui-element-hidden"),this.sideInsertion=""},a.ui.DraggableGroupElement.prototype.getDragItem=function(){return this.dragItem},a.ui.DraggableGroupElement.prototype.isDragging=function(){return null!==this.getDragItem()},a.ui.IconElement=function(a){a=a||{},this.$icon=null,this.icon=null,this.iconTitle=null,this.setIcon(a.icon||this.constructor["static"].icon),this.setIconTitle(a.iconTitle||this.constructor["static"].iconTitle),this.setIconElement(a.$icon||$("<span>"))},a.initClass(a.ui.IconElement),a.ui.IconElement["static"].icon=null,a.ui.IconElement["static"].iconTitle=null,a.ui.IconElement.prototype.setIconElement=function(a){this.$icon&&this.$icon.removeClass("oo-ui-iconElement-icon oo-ui-icon-"+this.icon).removeAttr("title"),this.$icon=a.addClass("oo-ui-iconElement-icon").toggleClass("oo-ui-icon-"+this.icon,!!this.icon),null!==this.iconTitle&&this.$icon.attr("title",this.iconTitle)},a.ui.IconElement.prototype.setIcon=function(b){return b=a.isPlainObject(b)?a.ui.getLocalValue(b,null,"default"):b,b="string"==typeof b&&b.trim().length?b.trim():null,this.icon!==b&&(this.$icon&&(null!==this.icon&&this.$icon.removeClass("oo-ui-icon-"+this.icon),null!==b&&this.$icon.addClass("oo-ui-icon-"+b)),this.icon=b),this.$element.toggleClass("oo-ui-iconElement",!!this.icon),this.updateThemeClasses(),this},a.ui.IconElement.prototype.setIconTitle=function(b){return b="function"==typeof b||"string"==typeof b&&b.length?a.ui.resolveMsg(b):null,this.iconTitle!==b&&(this.iconTitle=b,this.$icon&&(null!==this.iconTitle?this.$icon.attr("title",b):this.$icon.removeAttr("title"))),this},a.ui.IconElement.prototype.getIcon=function(){return this.icon},a.ui.IconElement.prototype.getIconTitle=function(){return this.iconTitle},a.ui.IndicatorElement=function(a){a=a||{},this.$indicator=null,this.indicator=null,this.indicatorTitle=null,this.setIndicator(a.indicator||this.constructor["static"].indicator),this.setIndicatorTitle(a.indicatorTitle||this.constructor["static"].indicatorTitle),this.setIndicatorElement(a.$indicator||$("<span>"))},a.initClass(a.ui.IndicatorElement),a.ui.IndicatorElement["static"].indicator=null,a.ui.IndicatorElement["static"].indicatorTitle=null,a.ui.IndicatorElement.prototype.setIndicatorElement=function(a){this.$indicator&&this.$indicator.removeClass("oo-ui-indicatorElement-indicator oo-ui-indicator-"+this.indicator).removeAttr("title"),this.$indicator=a.addClass("oo-ui-indicatorElement-indicator").toggleClass("oo-ui-indicator-"+this.indicator,!!this.indicator),null!==this.indicatorTitle&&this.$indicator.attr("title",this.indicatorTitle)},a.ui.IndicatorElement.prototype.setIndicator=function(a){return a="string"==typeof a&&a.length?a.trim():null,this.indicator!==a&&(this.$indicator&&(null!==this.indicator&&this.$indicator.removeClass("oo-ui-indicator-"+this.indicator),null!==a&&this.$indicator.addClass("oo-ui-indicator-"+a)),this.indicator=a),this.$element.toggleClass("oo-ui-indicatorElement",!!this.indicator),this.updateThemeClasses(),this},a.ui.IndicatorElement.prototype.setIndicatorTitle=function(b){return b="function"==typeof b||"string"==typeof b&&b.length?a.ui.resolveMsg(b):null,this.indicatorTitle!==b&&(this.indicatorTitle=b,this.$indicator&&(null!==this.indicatorTitle?this.$indicator.attr("title",b):this.$indicator.removeAttr("title"))),this},a.ui.IndicatorElement.prototype.getIndicator=function(){return this.indicator},a.ui.IndicatorElement.prototype.getIndicatorTitle=function(){return this.indicatorTitle},a.ui.LabelElement=function(a){a=a||{},this.$label=null,this.label=null,this.autoFitLabel=void 0===a.autoFitLabel||!!a.autoFitLabel,this.setLabel(a.label||this.constructor["static"].label),this.setLabelElement(a.$label||$("<span>"))},a.initClass(a.ui.LabelElement),a.ui.LabelElement["static"].label=null,a.ui.LabelElement.prototype.setLabelElement=function(a){this.$label&&this.$label.removeClass("oo-ui-labelElement-label").empty(),this.$label=a.addClass("oo-ui-labelElement-label"),this.setLabelContent(this.label)},a.ui.LabelElement.prototype.setLabel=function(b){return b="function"==typeof b?a.ui.resolveMsg(b):b,b="string"==typeof b&&b.length||b instanceof jQuery?b:null,this.$element.toggleClass("oo-ui-labelElement",!!b),this.label!==b&&(this.$label&&this.setLabelContent(b),this.label=b,this.emit("labelChange")),this},a.ui.LabelElement.prototype.getLabel=function(){return this.label},a.ui.LabelElement.prototype.fitLabel=function(){return this.$label&&this.$label.autoEllipsis&&this.autoFitLabel&&this.$label.autoEllipsis({hasSpan:!1,tooltip:!0}),this},a.ui.LabelElement.prototype.setLabelContent=function(a){"string"==typeof a?a.match(/^\s*$/)?this.$label.html("&nbsp;"):this.$label.text(a):a instanceof jQuery?this.$label.empty().append(a):this.$label.empty()},a.ui.LookupElement=function(b){b=b||{},this.$overlay=b.$overlay||this.$element,this.lookupMenu=new a.ui.TextInputMenuSelectWidget(this,{$container:b.$container}),this.lookupCache={},this.lookupQuery=null,this.lookupRequest=null,this.lookupsDisabled=!1,this.lookupInputFocused=!1,this.$input.on({focus:this.onLookupInputFocus.bind(this),blur:this.onLookupInputBlur.bind(this),mousedown:this.onLookupInputMouseDown.bind(this)}),this.connect(this,{change:"onLookupInputChange"}),this.lookupMenu.connect(this,{toggle:"onLookupMenuToggle",choose:"onLookupMenuItemChoose"}),this.$element.addClass("oo-ui-lookupElement"),this.lookupMenu.$element.addClass("oo-ui-lookupElement-menu"),this.$overlay.append(this.lookupMenu.$element)},a.ui.LookupElement.prototype.onLookupInputFocus=function(){this.lookupInputFocused=!0,this.populateLookupMenu()},a.ui.LookupElement.prototype.onLookupInputBlur=function(){this.closeLookupMenu(),this.lookupInputFocused=!1},a.ui.LookupElement.prototype.onLookupInputMouseDown=function(){this.lookupInputFocused&&!this.lookupMenu.isVisible()&&this.populateLookupMenu()},a.ui.LookupElement.prototype.onLookupInputChange=function(){this.lookupInputFocused&&this.populateLookupMenu()},a.ui.LookupElement.prototype.onLookupMenuToggle=function(a){a||(this.abortLookupRequest(),this.lookupMenu.clearItems())},a.ui.LookupElement.prototype.onLookupMenuItemChoose=function(a){a&&this.setValue(a.getData())},a.ui.LookupElement.prototype.getLookupMenu=function(){return this.lookupMenu},a.ui.LookupElement.prototype.setLookupsDisabled=function(a){this.lookupsDisabled=!!a},a.ui.LookupElement.prototype.openLookupMenu=function(){return this.lookupMenu.isEmpty()||this.lookupMenu.toggle(!0),this},a.ui.LookupElement.prototype.closeLookupMenu=function(){return this.lookupMenu.toggle(!1),this.abortLookupRequest(),this.lookupMenu.clearItems(),this},a.ui.LookupElement.prototype.populateLookupMenu=function(){var a=this,b=this.getValue();if(!this.lookupsDisabled)return""===b?this.closeLookupMenu():b!==this.lookupQuery&&this.getLookupMenuItems().done(function(b){a.lookupMenu.clearItems(),b.length?(a.lookupMenu.addItems(b).toggle(!0),a.initializeLookupMenuSelection()):a.lookupMenu.toggle(!1)}).fail(function(){a.lookupMenu.clearItems()}),this},a.ui.LookupElement.prototype.initializeLookupMenuSelection=function(){this.lookupMenu.getSelectedItem()||this.lookupMenu.selectItem(this.lookupMenu.getFirstSelectableItem()),this.lookupMenu.highlightItem(this.lookupMenu.getSelectedItem())},a.ui.LookupElement.prototype.getLookupMenuItems=function(){var a,b=this,c=this.getValue(),d=$.Deferred();return this.abortLookupRequest(),Object.prototype.hasOwnProperty.call(this.lookupCache,c)?d.resolve(this.getLookupMenuOptionsFromData(this.lookupCache[c])):(this.pushPending(),this.lookupQuery=c,a=this.lookupRequest=this.getLookupRequest(),a.always(function(){b.popPending()}).done(function(e){a===b.lookupRequest&&(b.lookupQuery=null,b.lookupRequest=null,b.lookupCache[c]=b.getLookupCacheDataFromResponse(e),d.resolve(b.getLookupMenuOptionsFromData(b.lookupCache[c])))}).fail(function(){a===b.lookupRequest&&(b.lookupQuery=null,b.lookupRequest=null,d.reject())})),d.promise()},a.ui.LookupElement.prototype.abortLookupRequest=function(){var a=this.lookupRequest;a&&(this.lookupRequest=null,this.lookupQuery=null,a.abort())},a.ui.LookupElement.prototype.getLookupRequest=function(){return null},a.ui.LookupElement.prototype.getLookupCacheDataFromResponse=function(){return[]},a.ui.LookupElement.prototype.getLookupMenuOptionsFromData=function(){return[]},a.ui.PopupElement=function(b){b=b||{},this.popup=new a.ui.PopupWidget($.extend({autoClose:!0},b.popup,{$autoCloseIgnore:this.$element}))},a.ui.PopupElement.prototype.getPopup=function(){return this.popup},a.ui.FlaggedElement=function(a){a=a||{},this.flags={},this.$flagged=null,this.setFlags(a.flags),this.setFlaggedElement(a.$flagged||this.$element)},a.ui.FlaggedElement.prototype.setFlaggedElement=function(a){var b=Object.keys(this.flags).map(function(a){return"oo-ui-flaggedElement-"+a}).join(" ");this.$flagged&&this.$flagged.removeClass(b),this.$flagged=a.addClass(b)},a.ui.FlaggedElement.prototype.hasFlag=function(a){return a in this.flags},a.ui.FlaggedElement.prototype.getFlags=function(){return Object.keys(this.flags)},a.ui.FlaggedElement.prototype.clearFlags=function(){var a,b,c={},d=[],e="oo-ui-flaggedElement-";for(a in this.flags)b=e+a,c[a]=!1,delete this.flags[a],d.push(b);return this.$flagged&&this.$flagged.removeClass(d.join(" ")),this.updateThemeClasses(),this.emit("flag",c),this},a.ui.FlaggedElement.prototype.setFlags=function(b){var c,d,e,f,g={},h=[],i=[],j="oo-ui-flaggedElement-";if("string"==typeof b)f=j+b,this.flags[b]||(this.flags[b]=!0,h.push(f));else if($.isArray(b))for(c=0,d=b.length;d>c;c++)e=b[c],f=j+e,this.flags[e]||(g[e]=!0,this.flags[e]=!0,h.push(f));else if(a.isPlainObject(b))for(e in b)f=j+e,b[e]?this.flags[e]||(g[e]=!0,this.flags[e]=!0,h.push(f)):this.flags[e]&&(g[e]=!1,delete this.flags[e],i.push(f));return this.$flagged&&this.$flagged.addClass(h.join(" ")).removeClass(i.join(" ")),this.updateThemeClasses(),this.emit("flag",g),this},a.ui.TitledElement=function(a){a=a||{},this.$titled=null,this.title=null,this.setTitle(a.title||this.constructor["static"].title),this.setTitledElement(a.$titled||this.$element)},a.initClass(a.ui.TitledElement),a.ui.TitledElement["static"].title=null,a.ui.TitledElement.prototype.setTitledElement=function(a){this.$titled&&this.$titled.removeAttr("title"),this.$titled=a,this.title&&this.$titled.attr("title",this.title)},a.ui.TitledElement.prototype.setTitle=function(b){return b="string"==typeof b?a.ui.resolveMsg(b):null,this.title!==b&&(this.$titled&&(null!==b?this.$titled.attr("title",b):this.$titled.removeAttr("title")),this.title=b),this},a.ui.TitledElement.prototype.getTitle=function(){return this.title},a.ui.ClippableElement=function(a){a=a||{},this.$clippable=null,this.clipping=!1,this.clippedHorizontally=!1,this.clippedVertically=!1,this.$clippableContainer=null,this.$clippableScroller=null,this.$clippableWindow=null,this.idealWidth=null,this.idealHeight=null,this.onClippableContainerScrollHandler=this.clip.bind(this),this.onClippableWindowResizeHandler=this.clip.bind(this),this.setClippableElement(a.$clippable||this.$element)},a.ui.ClippableElement.prototype.setClippableElement=function(b){this.$clippable&&(this.$clippable.removeClass("oo-ui-clippableElement-clippable"),this.$clippable.css({width:"",height:"",overflowX:"",overflowY:""}),a.ui.Element["static"].reconsiderScrollbars(this.$clippable[0])),this.$clippable=b.addClass("oo-ui-clippableElement-clippable"),this.clip()},a.ui.ClippableElement.prototype.toggleClipping=function(b){return b=void 0===b?!this.clipping:!!b,this.clipping!==b&&(this.clipping=b,b?(this.$clippableContainer=$(this.getClosestScrollableElementContainer()),this.$clippableScroller=this.$clippableContainer.is("html, body")?$(a.ui.Element["static"].getWindow(this.$clippableContainer)):this.$clippableContainer,this.$clippableScroller.on("scroll",this.onClippableContainerScrollHandler),this.$clippableWindow=$(this.getElementWindow()).on("resize",this.onClippableWindowResizeHandler),this.clip()):(this.$clippable.css({width:"",height:"",overflowX:"",overflowY:""}),a.ui.Element["static"].reconsiderScrollbars(this.$clippable[0]),this.$clippableContainer=null,this.$clippableScroller.off("scroll",this.onClippableContainerScrollHandler),this.$clippableScroller=null,this.$clippableWindow.off("resize",this.onClippableWindowResizeHandler),this.$clippableWindow=null)),this
},a.ui.ClippableElement.prototype.isClipping=function(){return this.clipping},a.ui.ClippableElement.prototype.isClipped=function(){return this.clippedHorizontally||this.clippedVertically},a.ui.ClippableElement.prototype.isClippedHorizontally=function(){return this.clippedHorizontally},a.ui.ClippableElement.prototype.isClippedVertically=function(){return this.clippedVertically},a.ui.ClippableElement.prototype.setIdealSize=function(a,b){this.idealWidth=a,this.idealHeight=b,this.clipping||this.$clippable.css({width:a,height:b})},a.ui.ClippableElement.prototype.clip=function(){if(!this.clipping)return this;var b=7,c=this.$clippable.offset(),d=this.$clippableContainer.is("html, body")?this.$clippableWindow:this.$clippableContainer,e=d.offset()||{top:0,left:0},f=d.innerHeight()-b,g=d.innerWidth()-b,h=this.$clippable.outerHeight()+b,i=this.$clippable.outerWidth()+b,j=this.$clippableScroller.scrollTop(),k=this.$clippableScroller.scrollLeft(),l=c.left<0?i+c.left:e.left+k+g-c.left,m=c.top<0?h+c.top:e.top+j+f-c.top,n=this.$clippable.prop("scrollWidth"),o=this.$clippable.prop("scrollHeight"),p=n>l,q=o>m;return this.$clippable.css(p?{overflowX:"scroll",width:l}:{width:this.idealWidth||"",overflowX:""}),this.$clippable.css(q?{overflowY:"scroll",height:m}:{height:this.idealHeight||"",overflowY:""}),p&&q||a.ui.Element["static"].reconsiderScrollbars(this.$clippable[0]),this.clippedHorizontally=p,this.clippedVertically=q,this},a.ui.Tool=function(b,c){c=c||{},a.ui.Tool["super"].call(this,c),a.ui.IconElement.call(this,c),a.ui.FlaggedElement.call(this,c),this.toolGroup=b,this.toolbar=this.toolGroup.getToolbar(),this.active=!1,this.$title=$("<span>"),this.$accel=$("<span>"),this.$link=$("<a>"),this.title=null,this.toolbar.connect(this,{updateState:"onUpdateState"}),this.$title.addClass("oo-ui-tool-title"),this.$accel.addClass("oo-ui-tool-accel").prop({dir:"ltr",lang:"en"}),this.$link.addClass("oo-ui-tool-link").append(this.$icon,this.$title,this.$accel).prop("tabIndex",0).attr("role","button"),this.$element.data("oo-ui-tool",this).addClass("oo-ui-tool oo-ui-tool-name-"+this.constructor["static"].name.replace(/^([^\/]+)\/([^\/]+).*$/,"$1-$2")).append(this.$link),this.setTitle(c.title||this.constructor["static"].title)},a.inheritClass(a.ui.Tool,a.ui.Widget),a.mixinClass(a.ui.Tool,a.ui.IconElement),a.mixinClass(a.ui.Tool,a.ui.FlaggedElement),a.ui.Tool["static"].tagName="span",a.ui.Tool["static"].name="",a.ui.Tool["static"].group="",a.ui.Tool["static"].title="",a.ui.Tool["static"].autoAddToCatchall=!0,a.ui.Tool["static"].autoAddToGroup=!0,a.ui.Tool["static"].isCompatibleWith=function(){return!1},a.ui.Tool.prototype.onUpdateState=function(){throw new Error("OO.ui.Tool.onUpdateState not implemented in this subclass:"+this.constructor)},a.ui.Tool.prototype.onSelect=function(){throw new Error("OO.ui.Tool.onSelect not implemented in this subclass:"+this.constructor)},a.ui.Tool.prototype.isActive=function(){return this.active},a.ui.Tool.prototype.setActive=function(a){this.active=!!a,this.active?this.$element.addClass("oo-ui-tool-active"):this.$element.removeClass("oo-ui-tool-active")},a.ui.Tool.prototype.setTitle=function(b){return this.title=a.ui.resolveMsg(b),this.updateTitle(),this},a.ui.Tool.prototype.getTitle=function(){return this.title},a.ui.Tool.prototype.getName=function(){return this.constructor["static"].name},a.ui.Tool.prototype.updateTitle=function(){var a=this.toolGroup.constructor["static"].titleTooltips,b=this.toolGroup.constructor["static"].accelTooltips,c=this.toolbar.getToolAccelerator(this.constructor["static"].name),d=[];this.$title.text(this.title),this.$accel.text(c),a&&"string"==typeof this.title&&this.title.length&&d.push(this.title),b&&"string"==typeof c&&c.length&&d.push(c),d.length?this.$link.attr("title",d.join(" ")):this.$link.removeAttr("title")},a.ui.Tool.prototype.destroy=function(){this.toolbar.disconnect(this),this.$element.remove()},a.ui.Toolbar=function(b,c,d){d=d||{},a.ui.Toolbar["super"].call(this,d),a.EventEmitter.call(this),a.ui.GroupElement.call(this,d),this.toolFactory=b,this.toolGroupFactory=c,this.groups=[],this.tools={},this.$bar=$("<div>"),this.$actions=$("<div>"),this.initialized=!1,this.$element.add(this.$bar).add(this.$group).add(this.$actions).on("mousedown touchstart",this.onPointerDown.bind(this)),this.$group.addClass("oo-ui-toolbar-tools"),d.actions&&this.$bar.append(this.$actions.addClass("oo-ui-toolbar-actions")),this.$bar.addClass("oo-ui-toolbar-bar").append(this.$group,'<div style="clear:both"></div>'),d.shadow&&this.$bar.append('<div class="oo-ui-toolbar-shadow"></div>'),this.$element.addClass("oo-ui-toolbar").append(this.$bar)},a.inheritClass(a.ui.Toolbar,a.ui.Element),a.mixinClass(a.ui.Toolbar,a.EventEmitter),a.mixinClass(a.ui.Toolbar,a.ui.GroupElement),a.ui.Toolbar.prototype.getToolFactory=function(){return this.toolFactory},a.ui.Toolbar.prototype.getToolGroupFactory=function(){return this.toolGroupFactory},a.ui.Toolbar.prototype.onPointerDown=function(a){var b=$(a.target).closest(".oo-ui-widget"),c=this.$element.closest(".oo-ui-widget");return b.length&&b[0]!==c[0]?void 0:!1},a.ui.Toolbar.prototype.initialize=function(){this.initialized=!0},a.ui.Toolbar.prototype.setup=function(b){var c,d,e,f,g=[],h="bar";for(this.reset(),c=0,d=b.length;d>c;c++)f=b[c],"*"===f.include&&(void 0===f.type&&(f.type="list"),void 0===f.label&&(f.label=a.ui.msg("ooui-toolbar-more"))),e=this.getToolGroupFactory().lookup(f.type)?f.type:h,g.push(this.getToolGroupFactory().create(e,this,f));this.addItems(g)},a.ui.Toolbar.prototype.reset=function(){var a,b;for(this.groups=[],this.tools={},a=0,b=this.items.length;b>a;a++)this.items[a].destroy();this.clearItems()},a.ui.Toolbar.prototype.destroy=function(){this.reset(),this.$element.remove()},a.ui.Toolbar.prototype.isToolAvailable=function(a){return!this.tools[a]},a.ui.Toolbar.prototype.reserveTool=function(a){this.tools[a.getName()]=a},a.ui.Toolbar.prototype.releaseTool=function(a){delete this.tools[a.getName()]},a.ui.Toolbar.prototype.getToolAccelerator=function(){return void 0},a.ui.ToolGroup=function(b,c){c=c||{},a.ui.ToolGroup["super"].call(this,c),a.ui.GroupElement.call(this,c),this.toolbar=b,this.tools={},this.pressed=null,this.autoDisabled=!1,this.include=c.include||[],this.exclude=c.exclude||[],this.promote=c.promote||[],this.demote=c.demote||[],this.onCapturedMouseUpHandler=this.onCapturedMouseUp.bind(this),this.$element.on({"mousedown touchstart":this.onPointerDown.bind(this),"mouseup touchend":this.onPointerUp.bind(this),mouseover:this.onMouseOver.bind(this),mouseout:this.onMouseOut.bind(this)}),this.toolbar.getToolFactory().connect(this,{register:"onToolFactoryRegister"}),this.aggregate({disable:"itemDisable"}),this.connect(this,{itemDisable:"updateDisabled"}),this.$group.addClass("oo-ui-toolGroup-tools"),this.$element.addClass("oo-ui-toolGroup").append(this.$group),this.populate()},a.inheritClass(a.ui.ToolGroup,a.ui.Widget),a.mixinClass(a.ui.ToolGroup,a.ui.GroupElement),a.ui.ToolGroup["static"].titleTooltips=!1,a.ui.ToolGroup["static"].accelTooltips=!1,a.ui.ToolGroup["static"].autoDisable=!0,a.ui.ToolGroup.prototype.isDisabled=function(){return this.autoDisabled||a.ui.ToolGroup["super"].prototype.isDisabled.apply(this,arguments)},a.ui.ToolGroup.prototype.updateDisabled=function(){var b,c,d=!0;if(this.constructor["static"].autoDisable){for(b=this.items.length-1;b>=0;b--)if(c=this.items[b],!c.isDisabled()){d=!1;break}this.autoDisabled=d}a.ui.ToolGroup["super"].prototype.updateDisabled.apply(this,arguments)},a.ui.ToolGroup.prototype.onPointerDown=function(a){return!this.isDisabled()&&a.which<=1&&(this.pressed=this.getTargetTool(a),this.pressed&&(this.pressed.setActive(!0),this.getElementDocument().addEventListener("mouseup",this.onCapturedMouseUpHandler,!0))),!1},a.ui.ToolGroup.prototype.onCapturedMouseUp=function(a){this.getElementDocument().removeEventListener("mouseup",this.onCapturedMouseUpHandler,!0),this.onPointerUp(a)},a.ui.ToolGroup.prototype.onPointerUp=function(a){var b=this.getTargetTool(a);return!this.isDisabled()&&a.which<=1&&this.pressed&&this.pressed===b&&this.pressed.onSelect(),this.pressed=null,!1},a.ui.ToolGroup.prototype.onMouseOver=function(a){var b=this.getTargetTool(a);this.pressed&&this.pressed===b&&this.pressed.setActive(!0)},a.ui.ToolGroup.prototype.onMouseOut=function(a){var b=this.getTargetTool(a);this.pressed&&this.pressed===b&&this.pressed.setActive(!1)},a.ui.ToolGroup.prototype.getTargetTool=function(a){var b,c=$(a.target).closest(".oo-ui-tool-link");return c.length&&(b=c.parent().data("oo-ui-tool")),b&&!b.isDisabled()?b:null},a.ui.ToolGroup.prototype.onToolFactoryRegister=function(){this.populate()},a.ui.ToolGroup.prototype.getToolbar=function(){return this.toolbar},a.ui.ToolGroup.prototype.populate=function(){var a,b,c,d,e=this.toolbar.getToolFactory(),f={},g=[],h=[],i=this.toolbar.getToolFactory().getTools(this.include,this.exclude,this.promote,this.demote);for(a=0,b=i.length;b>a;a++)c=i[a],e.lookup(c)&&(this.toolbar.isToolAvailable(c)||this.tools[c])&&(d=this.tools[c],d||(this.tools[c]=d=e.create(c,this),d.updateTitle()),this.toolbar.reserveTool(d),g.push(d),f[c]=!0);for(c in this.tools)f[c]||(this.tools[c].destroy(),this.toolbar.releaseTool(this.tools[c]),h.push(this.tools[c]),delete this.tools[c]);h.length&&this.removeItems(h),g.length?this.$element.removeClass("oo-ui-toolGroup-empty"):this.$element.addClass("oo-ui-toolGroup-empty"),this.addItems(g),this.updateDisabled()},a.ui.ToolGroup.prototype.destroy=function(){var a;this.clearItems(),this.toolbar.getToolFactory().disconnect(this);for(a in this.tools)this.toolbar.releaseTool(this.tools[a]),this.tools[a].disconnect(this).destroy(),delete this.tools[a];this.$element.remove()},a.ui.MessageDialog=function(b){a.ui.MessageDialog["super"].call(this,b),this.verticalActionLayout=null,this.$element.addClass("oo-ui-messageDialog")},a.inheritClass(a.ui.MessageDialog,a.ui.Dialog),a.ui.MessageDialog["static"].name="message",a.ui.MessageDialog["static"].size="small",a.ui.MessageDialog["static"].verbose=!1,a.ui.MessageDialog["static"].title=null,a.ui.MessageDialog["static"].message=null,a.ui.MessageDialog["static"].actions=[{action:"accept",label:a.ui.deferMsg("ooui-dialog-message-accept"),flags:"primary"},{action:"reject",label:a.ui.deferMsg("ooui-dialog-message-reject"),flags:"safe"}],a.ui.MessageDialog.prototype.setManager=function(b){return a.ui.MessageDialog["super"].prototype.setManager.call(this,b),this.manager.connect(this,{resize:"onResize"}),this},a.ui.MessageDialog.prototype.onActionResize=function(b){return this.fitActions(),a.ui.MessageDialog["super"].prototype.onActionResize.call(this,b)},a.ui.MessageDialog.prototype.onResize=function(){var a=this;a.fitActions(),setTimeout(function(){a.fitActions()},300)},a.ui.MessageDialog.prototype.toggleVerticalActionLayout=function(a){return a=void 0===a?!this.verticalActionLayout:!!a,a!==this.verticalActionLayout&&(this.verticalActionLayout=a,this.$actions.toggleClass("oo-ui-messageDialog-actions-vertical",a).toggleClass("oo-ui-messageDialog-actions-horizontal",!a)),this},a.ui.MessageDialog.prototype.getActionProcess=function(b){return b?new a.ui.Process(function(){this.close({action:b})},this):a.ui.MessageDialog["super"].prototype.getActionProcess.call(this,b)},a.ui.MessageDialog.prototype.getSetupProcess=function(b){return b=b||{},a.ui.MessageDialog["super"].prototype.getSetupProcess.call(this,b).next(function(){this.title.setLabel(void 0!==b.title?b.title:this.constructor["static"].title),this.message.setLabel(void 0!==b.message?b.message:this.constructor["static"].message),this.message.$element.toggleClass("oo-ui-messageDialog-message-verbose",void 0!==b.verbose?b.verbose:this.constructor["static"].verbose)},this)},a.ui.MessageDialog.prototype.getBodyHeight=function(){var b,c,d=this.container.$element;return c=d[0].style.overflow,d[0].style.overflow="hidden",a.ui.Element["static"].reconsiderScrollbars(d[0]),b=this.text.$element.outerHeight(!0),d[0].style.overflow=c,b},a.ui.MessageDialog.prototype.setDimensions=function(b){var c=this.container.$element;return a.ui.MessageDialog["super"].prototype.setDimensions.call(this,b),setTimeout(function(){var b=c[0].style.overflow;c[0].style.overflow="hidden",a.ui.Element["static"].reconsiderScrollbars(c[0]),c[0].style.overflow=b},300),this},a.ui.MessageDialog.prototype.initialize=function(){a.ui.MessageDialog["super"].prototype.initialize.call(this),this.$actions=$("<div>"),this.container=new a.ui.PanelLayout({scrollable:!0,classes:["oo-ui-messageDialog-container"]}),this.text=new a.ui.PanelLayout({padded:!0,expanded:!1,classes:["oo-ui-messageDialog-text"]}),this.message=new a.ui.LabelWidget({classes:["oo-ui-messageDialog-message"]}),this.title.$element.addClass("oo-ui-messageDialog-title"),this.$content.addClass("oo-ui-messageDialog-content"),this.container.$element.append(this.text.$element),this.text.$element.append(this.title.$element,this.message.$element),this.$body.append(this.container.$element),this.$actions.addClass("oo-ui-messageDialog-actions"),this.$foot.append(this.$actions)},a.ui.MessageDialog.prototype.attachActions=function(){var b,c,d,e,f;if(a.ui.MessageDialog["super"].prototype.attachActions.call(this),e=this.actions.getSpecial(),f=this.actions.getOthers(),e.safe&&(this.$actions.append(e.safe.$element),e.safe.toggleFramed(!1)),f.length)for(b=0,c=f.length;c>b;b++)d=f[b],this.$actions.append(d.$element),d.toggleFramed(!1);e.primary&&(this.$actions.append(e.primary.$element),e.primary.toggleFramed(!1)),this.isOpening()||this.updateSize()},a.ui.MessageDialog.prototype.fitActions=function(){var a,b,c,d=this.verticalActionLayout,e=this.actions.get();for(this.toggleVerticalActionLayout(!1),a=0,b=e.length;b>a;a++)if(c=e[a],c.$element.innerWidth()<c.$label.outerWidth(!0)){this.toggleVerticalActionLayout(!0);break}this.$body.css("bottom",this.$foot.outerHeight(!0)),this.verticalActionLayout!==d&&this.updateSize()},a.ui.ProcessDialog=function(b){a.ui.ProcessDialog["super"].call(this,b),this.$element.addClass("oo-ui-processDialog")},a.inheritClass(a.ui.ProcessDialog,a.ui.Dialog),a.ui.ProcessDialog.prototype.onDismissErrorButtonClick=function(){this.hideErrors()},a.ui.ProcessDialog.prototype.onRetryButtonClick=function(){this.hideErrors(),this.executeAction(this.currentAction.getAction())},a.ui.ProcessDialog.prototype.onActionResize=function(b){return this.actions.isSpecial(b)&&this.fitLabel(),a.ui.ProcessDialog["super"].prototype.onActionResize.call(this,b)},a.ui.ProcessDialog.prototype.initialize=function(){a.ui.ProcessDialog["super"].prototype.initialize.call(this),this.$navigation=$("<div>"),this.$location=$("<div>"),this.$safeActions=$("<div>"),this.$primaryActions=$("<div>"),this.$otherActions=$("<div>"),this.dismissButton=new a.ui.ButtonWidget({label:a.ui.msg("ooui-dialog-process-dismiss")}),this.retryButton=new a.ui.ButtonWidget,this.$errors=$("<div>"),this.$errorsTitle=$("<div>"),this.dismissButton.connect(this,{click:"onDismissErrorButtonClick"}),this.retryButton.connect(this,{click:"onRetryButtonClick"}),this.title.$element.addClass("oo-ui-processDialog-title"),this.$location.append(this.title.$element).addClass("oo-ui-processDialog-location"),this.$safeActions.addClass("oo-ui-processDialog-actions-safe"),this.$primaryActions.addClass("oo-ui-processDialog-actions-primary"),this.$otherActions.addClass("oo-ui-processDialog-actions-other"),this.$errorsTitle.addClass("oo-ui-processDialog-errors-title").text(a.ui.msg("ooui-dialog-process-error")),this.$errors.addClass("oo-ui-processDialog-errors").append(this.$errorsTitle,this.dismissButton.$element,this.retryButton.$element),this.$content.addClass("oo-ui-processDialog-content").append(this.$errors),this.$navigation.addClass("oo-ui-processDialog-navigation").append(this.$safeActions,this.$location,this.$primaryActions),this.$head.append(this.$navigation),this.$foot.append(this.$otherActions)},a.ui.ProcessDialog.prototype.attachActions=function(){var b,c,d,e,f;if(a.ui.ProcessDialog["super"].prototype.attachActions.call(this),e=this.actions.getSpecial(),f=this.actions.getOthers(),e.primary&&(this.$primaryActions.append(e.primary.$element),e.primary.toggleFramed(!0)),f.length)for(b=0,c=f.length;c>b;b++)d=f[b],this.$otherActions.append(d.$element),d.toggleFramed(!0);e.safe&&(this.$safeActions.append(e.safe.$element),e.safe.toggleFramed(!0)),this.fitLabel(),this.$body.css("bottom",this.$foot.outerHeight(!0))},a.ui.ProcessDialog.prototype.executeAction=function(b){a.ui.ProcessDialog["super"].prototype.executeAction.call(this,b).fail(this.showErrors.bind(this))},a.ui.ProcessDialog.prototype.fitLabel=function(){var a=Math.max(this.$safeActions.is(":visible")?this.$safeActions.width():0,this.$primaryActions.is(":visible")?this.$primaryActions.width():0);return this.$location.css({paddingLeft:a,paddingRight:a}),this},a.ui.ProcessDialog.prototype.showErrors=function(b){var c,d,e,f=[],g=!0,h=!1;for(c=0,d=b.length;d>c;c++)b[c].isRecoverable()||(g=!1),b[c].isWarning()&&(h=!0),e=$("<div>").addClass("oo-ui-processDialog-error").append(b[c].getMessage()),f.push(e[0]);this.$errorItems=$(f),g?this.retryButton.clearFlags().setFlags(this.currentAction.getFlags()):this.currentAction.setDisabled(!0),this.retryButton.setLabel(h?a.ui.msg("ooui-dialog-process-continue"):a.ui.msg("ooui-dialog-process-retry")),this.retryButton.toggle(g),this.$errorsTitle.after(this.$errorItems),this.$errors.removeClass("oo-ui-widget-hidden").scrollTop(0)},a.ui.ProcessDialog.prototype.hideErrors=function(){this.$errors.addClass("oo-ui-widget-hidden"),this.$errorItems.remove(),this.$errorItems=null},a.ui.FieldLayout=function(b,c){var d=b instanceof a.ui.InputWidget;c=$.extend({align:"left"},c),this.fieldWidget=b,a.ui.FieldLayout["super"].call(this,c),a.ui.LabelElement.call(this,c),this.$field=$("<div>"),this.$body=$("<"+(d?"label":"div")+">"),this.align=null,c.help?(this.popupButtonWidget=new a.ui.PopupButtonWidget({classes:["oo-ui-fieldLayout-help"],framed:!1,icon:"info"}),this.popupButtonWidget.getPopup().$body.append($("<div>").text(c.help).addClass("oo-ui-fieldLayout-help-content")),this.$help=this.popupButtonWidget.$element):this.$help=$([]),d&&this.$label.on("click",this.onLabelClick.bind(this)),this.fieldWidget.connect(this,{disable:"onFieldDisable"}),this.$element.addClass("oo-ui-fieldLayout").append(this.$help,this.$body),this.$body.addClass("oo-ui-fieldLayout-body"),this.$field.addClass("oo-ui-fieldLayout-field").toggleClass("oo-ui-fieldLayout-disable",this.fieldWidget.isDisabled()).append(this.fieldWidget.$element),this.setAlignment(c.align)},a.inheritClass(a.ui.FieldLayout,a.ui.Layout),a.mixinClass(a.ui.FieldLayout,a.ui.LabelElement),a.ui.FieldLayout.prototype.onFieldDisable=function(a){this.$element.toggleClass("oo-ui-fieldLayout-disabled",a)},a.ui.FieldLayout.prototype.onLabelClick=function(){return this.fieldWidget.simulateLabelClick(),!1},a.ui.FieldLayout.prototype.getField=function(){return this.fieldWidget},a.ui.FieldLayout.prototype.setAlignment=function(a){return a!==this.align&&(-1===["left","right","top","inline"].indexOf(a)&&(a="left"),"inline"===a?this.$body.append(this.$field,this.$label):this.$body.append(this.$label,this.$field),this.align&&this.$element.removeClass("oo-ui-fieldLayout-align-"+this.align),this.$element.addClass("oo-ui-fieldLayout-align-"+a),this.align=a),this},a.ui.ActionFieldLayout=function(b,c,d){d=$.extend({align:"left"},d),this.fieldWidget=b,this.buttonWidget=c,a.ui.ActionFieldLayout["super"].call(this,b,d),a.ui.LabelElement.call(this,d),this.$button=$("<div>").addClass("oo-ui-actionFieldLayout-button").append(this.buttonWidget.$element),this.$input=$("<div>").addClass("oo-ui-actionFieldLayout-input").append(this.fieldWidget.$element),this.$field.addClass("oo-ui-actionFieldLayout").append(this.$input,this.$button)},a.inheritClass(a.ui.ActionFieldLayout,a.ui.FieldLayout),a.ui.FieldsetLayout=function(b){b=b||{},a.ui.FieldsetLayout["super"].call(this,b),a.ui.IconElement.call(this,b),a.ui.LabelElement.call(this,b),a.ui.GroupElement.call(this,b),b.help?(this.popupButtonWidget=new a.ui.PopupButtonWidget({classes:["oo-ui-fieldsetLayout-help"],framed:!1,icon:"info"}),this.popupButtonWidget.getPopup().$body.append($("<div>").text(b.help).addClass("oo-ui-fieldsetLayout-help-content")),this.$help=this.popupButtonWidget.$element):this.$help=$([]),this.$element.addClass("oo-ui-fieldsetLayout").prepend(this.$help,this.$icon,this.$label,this.$group),$.isArray(b.items)&&this.addItems(b.items)},a.inheritClass(a.ui.FieldsetLayout,a.ui.Layout),a.mixinClass(a.ui.FieldsetLayout,a.ui.IconElement),a.mixinClass(a.ui.FieldsetLayout,a.ui.LabelElement),a.mixinClass(a.ui.FieldsetLayout,a.ui.GroupElement),a.ui.FormLayout=function(b){b=b||{},a.ui.FormLayout["super"].call(this,b),this.$element.on("submit",this.onFormSubmit.bind(this)),this.$element.addClass("oo-ui-formLayout").attr({method:b.method,action:b.action,enctype:b.enctype})},a.inheritClass(a.ui.FormLayout,a.ui.Layout),a.ui.FormLayout["static"].tagName="form",a.ui.FormLayout.prototype.onFormSubmit=function(){return this.emit("submit"),!1},a.ui.GridLayout=function(b,c){var d,e,f;for(c=c||{},a.ui.GridLayout["super"].call(this,c),this.panels=[],this.widths=[],this.heights=[],this.$element.addClass("oo-ui-gridLayout"),d=0,e=b.length;e>d;d++)this.panels.push(b[d]),this.$element.append(b[d].$element);c.widths||c.heights?this.layout(c.widths||[1],c.heights||[1]):(f=this.panels.map(function(){return 1}),this.layout(f,[1]))},a.inheritClass(a.ui.GridLayout,a.ui.Layout),a.ui.GridLayout.prototype.layout=function(a,b){var c,d,e=0,f=0,g=a.length,h=b.length;if(g*h<this.panels.length)throw new Error("Grid is not large enough to fit "+this.panels.length+"panels");for(c=0;g>c;c++)e+=a[c];for(d=0;h>d;d++)f+=b[d];for(this.widths=[],this.heights=[],c=0;g>c;c++)this.widths[c]=a[c]/e;for(d=0;h>d;d++)this.heights[d]=b[d]/f;this.update(),this.emit("layout")},a.ui.GridLayout.prototype.update=function(){var b,c,d,e,f,g,h=0,i=0,j=0,k=this.widths.length,l=this.heights.length;for(c=0;l>c;c++){for(f=this.heights[c],b=0;k>b;b++)e=this.widths[b],d=this.panels[h],g={width:100*e+"%",height:100*f+"%",top:100*i+"%"},"rtl"===a.ui.Element["static"].getDir(document)?g.right=100*j+"%":g.left=100*j+"%",g.visibility=0===e||0===f?"hidden":"",d.$element.css(g),h++,j+=e;i+=f,j=0}this.emit("update")},a.ui.GridLayout.prototype.getPanel=function(a,b){return this.panels[a*this.widths.length+b]},a.ui.MenuLayout=function(b){var c=this.constructor["static"].menuPositions;b=b||{},a.ui.MenuLayout["super"].call(this,b),this.showMenu=b.showMenu!==!1,this.menuSize=b.menuSize||"18em",this.menuPosition=c[b.menuPosition]||c.before,this.$menu=$("<div>"),this.$content=$("<div>"),this.toggleMenu(this.showMenu),this.updateSizes(),this.$menu.addClass("oo-ui-menuLayout-menu").css(this.menuPosition.sizeProperty,this.menuSize),this.$content.addClass("oo-ui-menuLayout-content"),this.$element.addClass("oo-ui-menuLayout "+this.menuPosition.className).append(this.$content,this.$menu)},a.inheritClass(a.ui.MenuLayout,a.ui.Layout),a.ui.MenuLayout["static"].menuPositions={top:{sizeProperty:"height",className:"oo-ui-menuLayout-top"},after:{sizeProperty:"width",className:"oo-ui-menuLayout-after"},bottom:{sizeProperty:"height",className:"oo-ui-menuLayout-bottom"},before:{sizeProperty:"width",className:"oo-ui-menuLayout-before"}},a.ui.MenuLayout.prototype.toggleMenu=function(a){return a=void 0===a?!this.showMenu:!!a,this.showMenu!==a&&(this.showMenu=a,this.updateSizes()),this},a.ui.MenuLayout.prototype.isMenuVisible=function(){return this.showMenu},a.ui.MenuLayout.prototype.setMenuSize=function(a){return this.menuSize=a,this.updateSizes(),this},a.ui.MenuLayout.prototype.updateSizes=function(){this.showMenu?(this.$menu.css(this.menuPosition.sizeProperty,this.menuSize).css("overflow",""),this.$content.css({top:this.menuSize,right:this.menuSize,bottom:this.menuSize,left:this.menuSize})):(this.$menu.css(this.menuPosition.sizeProperty,0).css("overflow","hidden"),this.$content.css({top:0,right:0,bottom:0,left:0}))},a.ui.MenuLayout.prototype.getMenuSize=function(){return this.menuSize},a.ui.MenuLayout.prototype.setMenuPosition=function(a){var b=this.constructor["static"].menuPositions;if(!b[a])throw new Error("Cannot set position; unsupported position value: "+a);return this.$menu.css(this.menuPosition.sizeProperty,""),this.$element.removeClass(this.menuPosition.className),this.menuPosition=b[a],this.updateSizes(),this.$element.addClass(this.menuPosition.className),this},a.ui.MenuLayout.prototype.getMenuPosition=function(){return this.menuPosition},a.ui.BookletLayout=function(b){b=b||{},a.ui.BookletLayout["super"].call(this,b),this.currentPageName=null,this.pages={},this.ignoreFocus=!1,this.stackLayout=new a.ui.StackLayout({continuous:!!b.continuous}),this.$content.append(this.stackLayout.$element),this.autoFocus=void 0===b.autoFocus||!!b.autoFocus,this.outlineVisible=!1,this.outlined=!!b.outlined,this.outlined&&(this.editable=!!b.editable,this.outlineControlsWidget=null,this.outlineSelectWidget=new a.ui.OutlineSelectWidget,this.outlinePanel=new a.ui.PanelLayout({scrollable:!0}),this.$menu.append(this.outlinePanel.$element),this.outlineVisible=!0,this.editable&&(this.outlineControlsWidget=new a.ui.OutlineControlsWidget(this.outlineSelectWidget))),this.toggleMenu(this.outlined),this.stackLayout.connect(this,{set:"onStackLayoutSet"}),this.outlined&&this.outlineSelectWidget.connect(this,{select:"onOutlineSelectWidgetSelect"}),this.autoFocus&&this.stackLayout.$element.on("focusin",this.onStackLayoutFocus.bind(this)),this.$element.addClass("oo-ui-bookletLayout"),this.stackLayout.$element.addClass("oo-ui-bookletLayout-stackLayout"),this.outlined&&(this.outlinePanel.$element.addClass("oo-ui-bookletLayout-outlinePanel").append(this.outlineSelectWidget.$element),this.editable&&this.outlinePanel.$element.addClass("oo-ui-bookletLayout-outlinePanel-editable").append(this.outlineControlsWidget.$element))},a.inheritClass(a.ui.BookletLayout,a.ui.MenuLayout),a.ui.BookletLayout.prototype.onStackLayoutFocus=function(a){var b,c;c=$(a.target).closest(".oo-ui-pageLayout");for(b in this.pages)if(this.pages[b].$element[0]===c[0]&&b!==this.currentPageName){this.setPage(b);break}},a.ui.BookletLayout.prototype.onStackLayoutSet=function(a){var b=this;a&&a.scrollElementIntoView({complete:function(){b.autoFocus&&b.focus()}})},a.ui.BookletLayout.prototype.focus=function(){var a,b=this.stackLayout.getCurrentItem();!b&&this.outlined&&(this.selectFirstSelectablePage(),b=this.stackLayout.getCurrentItem()),b&&(b.$element.find(":focus").length||(a=b.$element.find(":input:first"),a.length&&a[0].focus()))},a.ui.BookletLayout.prototype.onOutlineSelectWidgetSelect=function(a){a&&this.setPage(a.getData())},a.ui.BookletLayout.prototype.isOutlined=function(){return this.outlined},a.ui.BookletLayout.prototype.isEditable=function(){return this.editable},a.ui.BookletLayout.prototype.isOutlineVisible=function(){return this.outlined&&this.outlineVisible},a.ui.BookletLayout.prototype.toggleOutline=function(a){return this.outlined&&(a=void 0===a?!this.outlineVisible:!!a,this.outlineVisible=a,this.toggleMenu(a)),this},a.ui.BookletLayout.prototype.getClosestPage=function(a){var b,c,d,e=this.stackLayout.getItems(),f=$.inArray(a,e);if(-1!==f&&(b=e[f+1],c=e[f-1],this.outlined)){if(d=this.outlineSelectWidget.getItemFromData(a.getName()).getLevel(),c&&d===this.outlineSelectWidget.getItemFromData(c.getName()).getLevel())return c;if(b&&d===this.outlineSelectWidget.getItemFromData(b.getName()).getLevel())return b}return c||b||null},a.ui.BookletLayout.prototype.getOutline=function(){return this.outlineSelectWidget},a.ui.BookletLayout.prototype.getOutlineControls=function(){return this.outlineControlsWidget},a.ui.BookletLayout.prototype.getPage=function(a){return this.pages[a]},a.ui.BookletLayout.prototype.getCurrentPage=function(){var a=this.getCurrentPageName();return a?this.getPage(a):void 0},a.ui.BookletLayout.prototype.getCurrentPageName=function(){return this.currentPageName},a.ui.BookletLayout.prototype.addPages=function(b,c){var d,e,f,g,h,i,j=this.stackLayout.getItems(),k=[],l=[];for(d=0,e=b.length;e>d;d++)g=b[d],f=g.getName(),Object.prototype.hasOwnProperty.call(this.pages,f)&&(i=$.inArray(this.pages[f],j),-1!==i&&c>i+1&&c--,k.push(this.pages[f]));for(k.length&&this.removePages(k),d=0,e=b.length;e>d;d++)g=b[d],f=g.getName(),this.pages[g.getName()]=g,this.outlined&&(h=new a.ui.OutlineOptionWidget({data:f}),g.setOutlineItem(h),l.push(h));return this.outlined&&l.length&&(this.outlineSelectWidget.addItems(l,c),this.selectFirstSelectablePage()),this.stackLayout.addItems(b,c),this.emit("add",b,c),this},a.ui.BookletLayout.prototype.removePages=function(a){var b,c,d,e,f=[];for(b=0,c=a.length;c>b;b++)e=a[b],d=e.getName(),delete this.pages[d],this.outlined&&(f.push(this.outlineSelectWidget.getItemFromData(d)),e.setOutlineItem(null));return this.outlined&&f.length&&(this.outlineSelectWidget.removeItems(f),this.selectFirstSelectablePage()),this.stackLayout.removeItems(a),this.emit("remove",a),this},a.ui.BookletLayout.prototype.clearPages=function(){var a,b,c=this.stackLayout.getItems();if(this.pages={},this.currentPageName=null,this.outlined)for(this.outlineSelectWidget.clearItems(),a=0,b=c.length;b>a;a++)c[a].setOutlineItem(null);return this.stackLayout.clearItems(),this.emit("remove",c),this},a.ui.BookletLayout.prototype.setPage=function(a){var b,c,d=this.pages[a];a!==this.currentPageName&&(this.outlined&&(b=this.outlineSelectWidget.getSelectedItem(),b&&b.getData()!==a&&this.outlineSelectWidget.selectItem(this.outlineSelectWidget.getItemFromData(a))),d&&(this.currentPageName&&this.pages[this.currentPageName]&&(this.pages[this.currentPageName].setActive(!1),this.autoFocus&&!d.$element.find(":input").length&&(c=this.pages[this.currentPageName].$element.find(":focus"),c.length&&c[0].blur())),this.currentPageName=a,this.stackLayout.setItem(d),d.setActive(!0),this.emit("set",d)))},a.ui.BookletLayout.prototype.selectFirstSelectablePage=function(){return this.outlineSelectWidget.getSelectedItem()||this.outlineSelectWidget.selectItem(this.outlineSelectWidget.getFirstSelectableItem()),this},a.ui.PanelLayout=function(b){b=$.extend({scrollable:!1,padded:!1,expanded:!0},b),a.ui.PanelLayout["super"].call(this,b),this.$element.addClass("oo-ui-panelLayout"),b.scrollable&&this.$element.addClass("oo-ui-panelLayout-scrollable"),b.padded&&this.$element.addClass("oo-ui-panelLayout-padded"),b.expanded&&this.$element.addClass("oo-ui-panelLayout-expanded")},a.inheritClass(a.ui.PanelLayout,a.ui.Layout),a.ui.PageLayout=function(b,c){c=$.extend({scrollable:!0},c),a.ui.PageLayout["super"].call(this,c),this.name=b,this.outlineItem=null,this.active=!1,this.$element.addClass("oo-ui-pageLayout")},a.inheritClass(a.ui.PageLayout,a.ui.PanelLayout),a.ui.PageLayout.prototype.getName=function(){return this.name},a.ui.PageLayout.prototype.isActive=function(){return this.active},a.ui.PageLayout.prototype.getOutlineItem=function(){return this.outlineItem},a.ui.PageLayout.prototype.setOutlineItem=function(a){return this.outlineItem=a||null,a&&this.setupOutlineItem(),this},a.ui.PageLayout.prototype.setupOutlineItem=function(){return this},a.ui.PageLayout.prototype.setActive=function(a){a=!!a,a!==this.active&&(this.active=a,this.$element.toggleClass("oo-ui-pageLayout-active",a),this.emit("active",this.active))},a.ui.StackLayout=function(b){b=$.extend({scrollable:!0},b),a.ui.StackLayout["super"].call(this,b),a.ui.GroupElement.call(this,$.extend({},b,{$group:this.$element})),this.currentItem=null,this.continuous=!!b.continuous,this.$element.addClass("oo-ui-stackLayout"),this.continuous&&this.$element.addClass("oo-ui-stackLayout-continuous"),$.isArray(b.items)&&this.addItems(b.items)},a.inheritClass(a.ui.StackLayout,a.ui.PanelLayout),a.mixinClass(a.ui.StackLayout,a.ui.GroupElement),a.ui.StackLayout.prototype.getCurrentItem=function(){return this.currentItem},a.ui.StackLayout.prototype.unsetCurrentItem=function(){var a=this.currentItem;null!==a&&(this.currentItem=null,this.emit("set",null))
},a.ui.StackLayout.prototype.addItems=function(b,c){return this.updateHiddenState(b,this.currentItem),a.ui.GroupElement.prototype.addItems.call(this,b,c),!this.currentItem&&b.length&&this.setItem(b[0]),this},a.ui.StackLayout.prototype.removeItems=function(b){return a.ui.GroupElement.prototype.removeItems.call(this,b),-1!==$.inArray(this.currentItem,b)&&(this.items.length?this.setItem(this.items[0]):this.unsetCurrentItem()),this},a.ui.StackLayout.prototype.clearItems=function(){return this.unsetCurrentItem(),a.ui.GroupElement.prototype.clearItems.call(this),this},a.ui.StackLayout.prototype.setItem=function(a){return a!==this.currentItem&&(this.updateHiddenState(this.items,a),-1!==$.inArray(a,this.items)?(this.currentItem=a,this.emit("set",a)):this.unsetCurrentItem()),this},a.ui.StackLayout.prototype.updateHiddenState=function(a,b){var c,d;if(!this.continuous){for(c=0,d=a.length;d>c;c++)b&&b===a[c]||a[c].$element.addClass("oo-ui-element-hidden");b&&b.$element.removeClass("oo-ui-element-hidden")}},a.ui.BarToolGroup=function(b,c){a.ui.BarToolGroup["super"].call(this,b,c),this.$element.addClass("oo-ui-barToolGroup")},a.inheritClass(a.ui.BarToolGroup,a.ui.ToolGroup),a.ui.BarToolGroup["static"].titleTooltips=!0,a.ui.BarToolGroup["static"].accelTooltips=!0,a.ui.BarToolGroup["static"].name="bar",a.ui.PopupToolGroup=function(b,c){c=c||{},a.ui.PopupToolGroup["super"].call(this,b,c),a.ui.IconElement.call(this,c),a.ui.IndicatorElement.call(this,c),a.ui.LabelElement.call(this,c),a.ui.TitledElement.call(this,c),a.ui.ClippableElement.call(this,$.extend({},c,{$clippable:this.$group})),this.active=!1,this.dragging=!1,this.onBlurHandler=this.onBlur.bind(this),this.$handle=$("<span>"),this.$handle.on({"mousedown touchstart":this.onHandlePointerDown.bind(this),"mouseup touchend":this.onHandlePointerUp.bind(this)}),this.$handle.addClass("oo-ui-popupToolGroup-handle").append(this.$icon,this.$label,this.$indicator),void 0!==c.header&&this.$group.prepend($("<span>").addClass("oo-ui-popupToolGroup-header").text(c.header)),this.$element.addClass("oo-ui-popupToolGroup").prepend(this.$handle)},a.inheritClass(a.ui.PopupToolGroup,a.ui.ToolGroup),a.mixinClass(a.ui.PopupToolGroup,a.ui.IconElement),a.mixinClass(a.ui.PopupToolGroup,a.ui.IndicatorElement),a.mixinClass(a.ui.PopupToolGroup,a.ui.LabelElement),a.mixinClass(a.ui.PopupToolGroup,a.ui.TitledElement),a.mixinClass(a.ui.PopupToolGroup,a.ui.ClippableElement),a.ui.PopupToolGroup.prototype.setDisabled=function(){a.ui.PopupToolGroup["super"].prototype.setDisabled.apply(this,arguments),this.isDisabled()&&this.isElementAttached()&&this.setActive(!1)},a.ui.PopupToolGroup.prototype.onBlur=function(a){$(a.target).closest(".oo-ui-popupToolGroup")[0]!==this.$element[0]&&this.setActive(!1)},a.ui.PopupToolGroup.prototype.onPointerUp=function(b){return!this.isDisabled()&&b.which<=1&&this.pressed&&this.pressed===this.getTargetTool(b)&&this.setActive(!1),a.ui.PopupToolGroup["super"].prototype.onPointerUp.call(this,b)},a.ui.PopupToolGroup.prototype.onHandlePointerUp=function(){return!1},a.ui.PopupToolGroup.prototype.onHandlePointerDown=function(a){return!this.isDisabled()&&a.which<=1&&this.setActive(!this.active),!1},a.ui.PopupToolGroup.prototype.setActive=function(a){a=!!a,this.active!==a&&(this.active=a,a?(this.getElementDocument().addEventListener("mouseup",this.onBlurHandler,!0),this.$element.addClass("oo-ui-popupToolGroup-active oo-ui-popupToolGroup-left"),this.toggleClipping(!0),this.isClippedHorizontally()&&(this.toggleClipping(!1),this.$element.removeClass("oo-ui-popupToolGroup-left").addClass("oo-ui-popupToolGroup-right"),this.toggleClipping(!0))):(this.getElementDocument().removeEventListener("mouseup",this.onBlurHandler,!0),this.$element.removeClass("oo-ui-popupToolGroup-active oo-ui-popupToolGroup-left  oo-ui-popupToolGroup-right"),this.toggleClipping(!1)))},a.ui.ListToolGroup=function(b,c){c=c||{},this.allowCollapse=c.allowCollapse,this.forceExpand=c.forceExpand,this.expanded=void 0!==c.expanded?c.expanded:!1,this.collapsibleTools=[],a.ui.ListToolGroup["super"].call(this,b,c),this.$element.addClass("oo-ui-listToolGroup")},a.inheritClass(a.ui.ListToolGroup,a.ui.PopupToolGroup),a.ui.ListToolGroup["static"].accelTooltips=!0,a.ui.ListToolGroup["static"].name="list",a.ui.ListToolGroup.prototype.populate=function(){var b,c,d=[];for(a.ui.ListToolGroup["super"].prototype.populate.call(this),void 0!==this.allowCollapse?d=this.allowCollapse:void 0!==this.forceExpand&&(d=a.simpleArrayDifference(Object.keys(this.tools),this.forceExpand)),this.collapsibleTools=[],b=0,c=d.length;c>b;b++)void 0!==this.tools[d[b]]&&this.collapsibleTools.push(this.tools[d[b]]);this.$group.append(this.getExpandCollapseTool().$element),this.getExpandCollapseTool().toggle(0!==this.collapsibleTools.length),this.updateCollapsibleState()},a.ui.ListToolGroup.prototype.getExpandCollapseTool=function(){if(void 0===this.expandCollapseTool){var b=function(){b["super"].apply(this,arguments)};a.inheritClass(b,a.ui.Tool),b.prototype.onSelect=function(){this.toolGroup.expanded=!this.toolGroup.expanded,this.toolGroup.updateCollapsibleState(),this.setActive(!1)},b.prototype.onUpdateState=function(){},b["static"].name="more-fewer",this.expandCollapseTool=new b(this)}return this.expandCollapseTool},a.ui.ListToolGroup.prototype.onPointerUp=function(b){var c=a.ui.ListToolGroup["super"].prototype.onPointerUp.call(this,b);return $(b.target).closest(".oo-ui-tool-name-more-fewer").length&&this.setActive(!0),c},a.ui.ListToolGroup.prototype.updateCollapsibleState=function(){var b,c;for(this.getExpandCollapseTool().setIcon(this.expanded?"collapse":"expand").setTitle(a.ui.msg(this.expanded?"ooui-toolgroup-collapse":"ooui-toolgroup-expand")),b=0,c=this.collapsibleTools.length;c>b;b++)this.collapsibleTools[b].toggle(this.expanded)},a.ui.MenuToolGroup=function(b,c){c=c||{},a.ui.MenuToolGroup["super"].call(this,b,c),this.toolbar.connect(this,{updateState:"onUpdateState"}),this.$element.addClass("oo-ui-menuToolGroup")},a.inheritClass(a.ui.MenuToolGroup,a.ui.PopupToolGroup),a.ui.MenuToolGroup["static"].accelTooltips=!0,a.ui.MenuToolGroup["static"].name="menu",a.ui.MenuToolGroup.prototype.onUpdateState=function(){var a,b=[];for(a in this.tools)this.tools[a].isActive()&&b.push(this.tools[a].getTitle());this.setLabel(b.join(", ")||" ")},a.ui.PopupTool=function(b,c){a.ui.PopupTool["super"].call(this,b,c),a.ui.PopupElement.call(this,c),this.$element.addClass("oo-ui-popupTool").append(this.popup.$element)},a.inheritClass(a.ui.PopupTool,a.ui.Tool),a.mixinClass(a.ui.PopupTool,a.ui.PopupElement),a.ui.PopupTool.prototype.onSelect=function(){return this.isDisabled()||this.popup.toggle(),this.setActive(!1),!1},a.ui.PopupTool.prototype.onUpdateState=function(){this.setActive(!1)},a.ui.GroupWidget=function(b){a.ui.GroupWidget["super"].call(this,b)},a.inheritClass(a.ui.GroupWidget,a.ui.GroupElement),a.ui.GroupWidget.prototype.setDisabled=function(b){var c,d;if(a.ui.Widget.prototype.setDisabled.call(this,b),this.items)for(c=0,d=this.items.length;d>c;c++)this.items[c].updateDisabled();return this},a.ui.ItemWidget=function(){},a.ui.ItemWidget.prototype.isDisabled=function(){return this.disabled||this.elementGroup instanceof a.ui.Widget&&this.elementGroup.isDisabled()},a.ui.ItemWidget.prototype.setElementGroup=function(b){return a.ui.Element.prototype.setElementGroup.call(this,b),this.updateDisabled(),this},a.ui.LookupInputWidget=function(b,c){c=c||{},this.lookupInput=b,this.$overlay=c.$overlay||this.$element,this.lookupMenu=new a.ui.TextInputMenuSelectWidget(this,{input:this.lookupInput,$container:c.$container}),this.lookupCache={},this.lookupQuery=null,this.lookupRequest=null,this.lookupsDisabled=!1,this.lookupInputFocused=!1,this.lookupInput.$input.on({focus:this.onLookupInputFocus.bind(this),blur:this.onLookupInputBlur.bind(this),mousedown:this.onLookupInputMouseDown.bind(this)}),this.lookupInput.connect(this,{change:"onLookupInputChange"}),this.lookupMenu.connect(this,{toggle:"onLookupMenuToggle"}),this.$element.addClass("oo-ui-lookupWidget"),this.lookupMenu.$element.addClass("oo-ui-lookupWidget-menu"),this.$overlay.append(this.lookupMenu.$element)},a.ui.LookupInputWidget.prototype.onLookupInputFocus=function(){this.lookupInputFocused=!0,this.populateLookupMenu()},a.ui.LookupInputWidget.prototype.onLookupInputBlur=function(){this.closeLookupMenu(),this.lookupInputFocused=!1},a.ui.LookupInputWidget.prototype.onLookupInputMouseDown=function(){this.lookupInputFocused&&!this.lookupMenu.isVisible()&&this.populateLookupMenu()},a.ui.LookupInputWidget.prototype.onLookupInputChange=function(){this.lookupInputFocused&&this.populateLookupMenu()},a.ui.LookupInputWidget.prototype.onLookupMenuToggle=function(a){a||(this.abortLookupRequest(),this.lookupMenu.clearItems())},a.ui.LookupInputWidget.prototype.getLookupMenu=function(){return this.lookupMenu},a.ui.LookupInputWidget.prototype.setLookupsDisabled=function(a){this.lookupsDisabled=!!a},a.ui.LookupInputWidget.prototype.openLookupMenu=function(){return this.lookupMenu.isEmpty()||this.lookupMenu.toggle(!0),this},a.ui.LookupInputWidget.prototype.closeLookupMenu=function(){return this.lookupMenu.toggle(!1),this.abortLookupRequest(),this.lookupMenu.clearItems(),this},a.ui.LookupInputWidget.prototype.populateLookupMenu=function(){var a=this,b=this.lookupInput.getValue();if(!this.lookupsDisabled)return""===b?this.closeLookupMenu():b!==this.lookupQuery&&this.getLookupMenuItems().done(function(b){a.lookupMenu.clearItems(),b.length?(a.lookupMenu.addItems(b).toggle(!0),a.initializeLookupMenuSelection()):a.lookupMenu.toggle(!1)}).fail(function(){a.lookupMenu.clearItems()}),this},a.ui.LookupInputWidget.prototype.initializeLookupMenuSelection=function(){this.lookupMenu.getSelectedItem()||this.lookupMenu.selectItem(this.lookupMenu.getFirstSelectableItem()),this.lookupMenu.highlightItem(this.lookupMenu.getSelectedItem())},a.ui.LookupInputWidget.prototype.getLookupMenuItems=function(){var a,b=this,c=this.lookupInput.getValue(),d=$.Deferred();return this.abortLookupRequest(),Object.prototype.hasOwnProperty.call(this.lookupCache,c)?d.resolve(this.getLookupMenuItemsFromData(this.lookupCache[c])):(this.lookupInput.pushPending(),this.lookupQuery=c,a=this.lookupRequest=this.getLookupRequest(),a.always(function(){b.lookupInput.popPending()}).done(function(e){a===b.lookupRequest&&(b.lookupQuery=null,b.lookupRequest=null,b.lookupCache[c]=b.getLookupCacheItemFromData(e),d.resolve(b.getLookupMenuItemsFromData(b.lookupCache[c])))}).fail(function(){a===b.lookupRequest&&(b.lookupQuery=null,b.lookupRequest=null,d.reject())})),d.promise()},a.ui.LookupInputWidget.prototype.abortLookupRequest=function(){var a=this.lookupRequest;a&&(this.lookupRequest=null,this.lookupQuery=null,a.abort())},a.ui.LookupInputWidget.prototype.getLookupRequest=function(){return null},a.ui.LookupInputWidget.prototype.getLookupMenuItemsFromData=function(){return[]},a.ui.LookupInputWidget.prototype.getLookupCacheItemFromData=function(){return[]},a.ui.OutlineControlsWidget=function(b,c){c=$.extend({icon:"add"},c),a.ui.OutlineControlsWidget["super"].call(this,c),a.ui.GroupElement.call(this,c),a.ui.IconElement.call(this,c),this.outline=b,this.$movers=$("<div>"),this.upButton=new a.ui.ButtonWidget({framed:!1,icon:"collapse",title:a.ui.msg("ooui-outline-control-move-up")}),this.downButton=new a.ui.ButtonWidget({framed:!1,icon:"expand",title:a.ui.msg("ooui-outline-control-move-down")}),this.removeButton=new a.ui.ButtonWidget({framed:!1,icon:"remove",title:a.ui.msg("ooui-outline-control-remove")}),b.connect(this,{select:"onOutlineChange",add:"onOutlineChange",remove:"onOutlineChange"}),this.upButton.connect(this,{click:["emit","move",-1]}),this.downButton.connect(this,{click:["emit","move",1]}),this.removeButton.connect(this,{click:["emit","remove"]}),this.$element.addClass("oo-ui-outlineControlsWidget"),this.$group.addClass("oo-ui-outlineControlsWidget-items"),this.$movers.addClass("oo-ui-outlineControlsWidget-movers").append(this.removeButton.$element,this.upButton.$element,this.downButton.$element),this.$element.append(this.$icon,this.$group,this.$movers)},a.inheritClass(a.ui.OutlineControlsWidget,a.ui.Widget),a.mixinClass(a.ui.OutlineControlsWidget,a.ui.GroupElement),a.mixinClass(a.ui.OutlineControlsWidget,a.ui.IconElement),a.ui.OutlineControlsWidget.prototype.onOutlineChange=function(){var a,b,c,d,e=this.outline.getItems(),f=this.outline.getSelectedItem(),g=f&&f.isMovable(),h=f&&f.isRemovable();if(g){for(a=-1,b=e.length;++a<b;)if(e[a].isMovable()){c=e[a];break}for(a=b;a--;)if(e[a].isMovable()){d=e[a];break}}this.upButton.setDisabled(!g||f===c),this.downButton.setDisabled(!g||f===d),this.removeButton.setDisabled(!h)},a.ui.ToggleWidget=function(a){a=a||{},this.value=null,this.$element.addClass("oo-ui-toggleWidget"),this.setValue(!!a.value)},a.ui.ToggleWidget.prototype.getValue=function(){return this.value},a.ui.ToggleWidget.prototype.setValue=function(a){return a=!!a,this.value!==a&&(this.value=a,this.emit("change",a),this.$element.toggleClass("oo-ui-toggleWidget-on",a),this.$element.toggleClass("oo-ui-toggleWidget-off",!a),this.$element.attr("aria-checked",a.toString())),this},a.ui.ButtonGroupWidget=function(b){b=b||{},a.ui.ButtonGroupWidget["super"].call(this,b),a.ui.GroupElement.call(this,$.extend({},b,{$group:this.$element})),this.$element.addClass("oo-ui-buttonGroupWidget"),$.isArray(b.items)&&this.addItems(b.items)},a.inheritClass(a.ui.ButtonGroupWidget,a.ui.Widget),a.mixinClass(a.ui.ButtonGroupWidget,a.ui.GroupElement),a.ui.ButtonWidget=function(b){b=b||{},a.ui.ButtonWidget["super"].call(this,b),a.ui.ButtonElement.call(this,b),a.ui.IconElement.call(this,b),a.ui.IndicatorElement.call(this,b),a.ui.LabelElement.call(this,b),a.ui.TitledElement.call(this,$.extend({},b,{$titled:this.$button})),a.ui.FlaggedElement.call(this,b),a.ui.TabIndexedElement.call(this,$.extend({},b,{$tabIndexed:this.$button})),this.href=null,this.target=null,this.nofollow=!1,this.isHyperlink=!1,this.$button.append(this.$icon,this.$label,this.$indicator),this.$element.addClass("oo-ui-buttonWidget").append(this.$button),this.setHref(b.href),this.setTarget(b.target),this.setNoFollow(b.nofollow)},a.inheritClass(a.ui.ButtonWidget,a.ui.Widget),a.mixinClass(a.ui.ButtonWidget,a.ui.ButtonElement),a.mixinClass(a.ui.ButtonWidget,a.ui.IconElement),a.mixinClass(a.ui.ButtonWidget,a.ui.IndicatorElement),a.mixinClass(a.ui.ButtonWidget,a.ui.LabelElement),a.mixinClass(a.ui.ButtonWidget,a.ui.TitledElement),a.mixinClass(a.ui.ButtonWidget,a.ui.FlaggedElement),a.mixinClass(a.ui.ButtonWidget,a.ui.TabIndexedElement),a.ui.ButtonWidget.prototype.onMouseDown=function(b){return this.isDisabled()||this.$button.removeAttr("tabindex"),a.ui.ButtonElement.prototype.onMouseDown.call(this,b)},a.ui.ButtonWidget.prototype.onMouseUp=function(b){return this.isDisabled()||this.$button.attr("tabindex",this.tabIndex),a.ui.ButtonElement.prototype.onMouseUp.call(this,b)},a.ui.ButtonWidget.prototype.onClick=function(b){var c=a.ui.ButtonElement.prototype.onClick.call(this,b);return this.isHyperlink?!0:c},a.ui.ButtonWidget.prototype.onKeyPress=function(b){var c=a.ui.ButtonElement.prototype.onKeyPress.call(this,b);return this.isHyperlink?!0:c},a.ui.ButtonWidget.prototype.getHref=function(){return this.href},a.ui.ButtonWidget.prototype.getTarget=function(){return this.target},a.ui.ButtonWidget.prototype.getNoFollow=function(){return this.nofollow},a.ui.ButtonWidget.prototype.setHref=function(a){return a="string"==typeof a?a:null,a!==this.href&&(this.href=a,null!==a?(this.$button.attr("href",a),this.isHyperlink=!0):(this.$button.removeAttr("href"),this.isHyperlink=!1)),this},a.ui.ButtonWidget.prototype.setTarget=function(a){return a="string"==typeof a?a:null,a!==this.target&&(this.target=a,null!==a?this.$button.attr("target",a):this.$button.removeAttr("target")),this},a.ui.ButtonWidget.prototype.setNoFollow=function(a){return a="boolean"==typeof a?a:!0,a!==this.nofollow&&(this.nofollow=a,a?this.$button.attr("rel","nofollow"):this.$button.removeAttr("rel")),this},a.ui.ActionWidget=function(b){b=$.extend({framed:!1},b),a.ui.ActionWidget["super"].call(this,b),a.ui.PendingElement.call(this,b),this.action=b.action||"",this.modes=b.modes||[],this.width=0,this.height=0,this.$element.addClass("oo-ui-actionWidget")},a.inheritClass(a.ui.ActionWidget,a.ui.ButtonWidget),a.mixinClass(a.ui.ActionWidget,a.ui.PendingElement),a.ui.ActionWidget.prototype.hasMode=function(a){return-1!==this.modes.indexOf(a)},a.ui.ActionWidget.prototype.getAction=function(){return this.action},a.ui.ActionWidget.prototype.getModes=function(){return this.modes.slice()},a.ui.ActionWidget.prototype.propagateResize=function(){var a,b;return this.isElementAttached()&&(a=this.$element.width(),b=this.$element.height(),(a!==this.width||b!==this.height)&&(this.width=a,this.height=b,this.emit("resize"))),this},a.ui.ActionWidget.prototype.setIcon=function(){return a.ui.IconElement.prototype.setIcon.apply(this,arguments),this.propagateResize(),this},a.ui.ActionWidget.prototype.setLabel=function(){return a.ui.LabelElement.prototype.setLabel.apply(this,arguments),this.propagateResize(),this},a.ui.ActionWidget.prototype.setFlags=function(){return a.ui.FlaggedElement.prototype.setFlags.apply(this,arguments),this.propagateResize(),this},a.ui.ActionWidget.prototype.clearFlags=function(){return a.ui.FlaggedElement.prototype.clearFlags.apply(this,arguments),this.propagateResize(),this},a.ui.ActionWidget.prototype.toggle=function(){return a.ui.ActionWidget["super"].prototype.toggle.apply(this,arguments),this.propagateResize(),this},a.ui.PopupButtonWidget=function(b){a.ui.PopupButtonWidget["super"].call(this,b),a.ui.PopupElement.call(this,b),this.connect(this,{click:"onAction"}),this.$element.addClass("oo-ui-popupButtonWidget").attr("aria-haspopup","true").append(this.popup.$element)},a.inheritClass(a.ui.PopupButtonWidget,a.ui.ButtonWidget),a.mixinClass(a.ui.PopupButtonWidget,a.ui.PopupElement),a.ui.PopupButtonWidget.prototype.onAction=function(){this.popup.toggle()},a.ui.ToggleButtonWidget=function(b){b=b||{},a.ui.ToggleButtonWidget["super"].call(this,b),a.ui.ToggleWidget.call(this,b),this.connect(this,{click:"onAction"}),this.$element.addClass("oo-ui-toggleButtonWidget")},a.inheritClass(a.ui.ToggleButtonWidget,a.ui.ButtonWidget),a.mixinClass(a.ui.ToggleButtonWidget,a.ui.ToggleWidget),a.ui.ToggleButtonWidget.prototype.onAction=function(){this.setValue(!this.value)},a.ui.ToggleButtonWidget.prototype.setValue=function(b){return b=!!b,b!==this.value&&(this.$button.attr("aria-pressed",b.toString()),this.setActive(b)),a.ui.ToggleWidget.prototype.setValue.call(this,b),this},a.ui.DropdownWidget=function(b){b=$.extend({indicator:"down"},b),a.ui.DropdownWidget["super"].call(this,b),this.$handle=this.$("<span>"),a.ui.IconElement.call(this,b),a.ui.IndicatorElement.call(this,b),a.ui.LabelElement.call(this,b),a.ui.TitledElement.call(this,$.extend({},b,{$titled:this.$label})),a.ui.TabIndexedElement.call(this,$.extend({},b,{$tabIndexed:this.$handle})),this.menu=new a.ui.MenuSelectWidget($.extend({widget:this},b.menu)),this.$handle.on({click:this.onClick.bind(this),keypress:this.onKeyPress.bind(this)}),this.menu.connect(this,{select:"onMenuSelect"}),this.$handle.addClass("oo-ui-dropdownWidget-handle").append(this.$icon,this.$label,this.$indicator),this.$element.addClass("oo-ui-dropdownWidget").append(this.$handle,this.menu.$element)},a.inheritClass(a.ui.DropdownWidget,a.ui.Widget),a.mixinClass(a.ui.DropdownWidget,a.ui.IconElement),a.mixinClass(a.ui.DropdownWidget,a.ui.IndicatorElement),a.mixinClass(a.ui.DropdownWidget,a.ui.LabelElement),a.mixinClass(a.ui.DropdownWidget,a.ui.TitledElement),a.mixinClass(a.ui.DropdownWidget,a.ui.TabIndexedElement),a.ui.DropdownWidget.prototype.getMenu=function(){return this.menu},a.ui.DropdownWidget.prototype.onMenuSelect=function(a){var b;a&&(b=a.getLabel(),b instanceof jQuery&&(b=b.clone()),this.setLabel(b))},a.ui.DropdownWidget.prototype.onClick=function(a){return this.isDisabled()||1!==a.which||this.menu.toggle(this.menu.isVisible()?!1:!0),!1},a.ui.DropdownWidget.prototype.onKeyPress=function(b){return this.isDisabled()||b.which!==a.ui.Keys.SPACE&&b.which!==a.ui.Keys.ENTER||this.menu.toggle(this.menu.isVisible()?!1:!0),!1},a.ui.IconWidget=function(b){b=b||{},a.ui.IconWidget["super"].call(this,b),a.ui.IconElement.call(this,$.extend({},b,{$icon:this.$element})),a.ui.TitledElement.call(this,$.extend({},b,{$titled:this.$element})),this.$element.addClass("oo-ui-iconWidget")},a.inheritClass(a.ui.IconWidget,a.ui.Widget),a.mixinClass(a.ui.IconWidget,a.ui.IconElement),a.mixinClass(a.ui.IconWidget,a.ui.TitledElement),a.ui.IconWidget["static"].tagName="span",a.ui.IndicatorWidget=function(b){b=b||{},a.ui.IndicatorWidget["super"].call(this,b),a.ui.IndicatorElement.call(this,$.extend({},b,{$indicator:this.$element})),a.ui.TitledElement.call(this,$.extend({},b,{$titled:this.$element})),this.$element.addClass("oo-ui-indicatorWidget")},a.inheritClass(a.ui.IndicatorWidget,a.ui.Widget),a.mixinClass(a.ui.IndicatorWidget,a.ui.IndicatorElement),a.mixinClass(a.ui.IndicatorWidget,a.ui.TitledElement),a.ui.IndicatorWidget["static"].tagName="span",a.ui.InputWidget=function(b){b=b||{},a.ui.InputWidget["super"].call(this,b),this.$input=this.getInputElement(b),this.value="",this.inputFilter=b.inputFilter,a.ui.FlaggedElement.call(this,b),a.ui.TabIndexedElement.call(this,$.extend({},b,{$tabIndexed:this.$input})),this.$input.on("keydown mouseup cut paste change input select",this.onEdit.bind(this)),this.$input.attr("name",b.name).prop("disabled",this.isDisabled()),this.$element.addClass("oo-ui-inputWidget").append(this.$input,$("<span>")),this.setValue(b.value)},a.inheritClass(a.ui.InputWidget,a.ui.Widget),a.mixinClass(a.ui.InputWidget,a.ui.FlaggedElement),a.mixinClass(a.ui.InputWidget,a.ui.TabIndexedElement),a.ui.InputWidget.prototype.getInputElement=function(){return $("<input>")},a.ui.InputWidget.prototype.onEdit=function(){var a=this;this.isDisabled()||setTimeout(function(){a.setValue(a.$input.val())})},a.ui.InputWidget.prototype.getValue=function(){var a=this.$input.val();return this.value!==a&&this.setValue(a),this.value},a.ui.InputWidget.prototype.setRTL=function(a){this.$input.prop("dir",a?"rtl":"ltr")},a.ui.InputWidget.prototype.setValue=function(a){return a=this.cleanUpValue(a),this.$input.val()!==a&&this.$input.val(a),this.value!==a&&(this.value=a,this.emit("change",this.value)),this},a.ui.InputWidget.prototype.cleanUpValue=function(a){return void 0===a||null===a?"":this.inputFilter?this.inputFilter(String(a)):String(a)},a.ui.InputWidget.prototype.simulateLabelClick=function(){this.isDisabled()||(this.$input.is(":checkbox,:radio")?this.$input.click():this.$input.is(":input")&&this.$input[0].focus())},a.ui.InputWidget.prototype.setDisabled=function(b){return a.ui.InputWidget["super"].prototype.setDisabled.call(this,b),this.$input&&this.$input.prop("disabled",this.isDisabled()),this},a.ui.InputWidget.prototype.focus=function(){return this.$input[0].focus(),this},a.ui.InputWidget.prototype.blur=function(){return this.$input[0].blur(),this},a.ui.ButtonInputWidget=function(b){b=$.extend({type:"button",useInputTag:!1},b),this.useInputTag=b.useInputTag,a.ui.ButtonInputWidget["super"].call(this,b),a.ui.ButtonElement.call(this,$.extend({},b,{$button:this.$input})),a.ui.IconElement.call(this,b),a.ui.IndicatorElement.call(this,b),a.ui.LabelElement.call(this,b),a.ui.TitledElement.call(this,$.extend({},b,{$titled:this.$input})),a.ui.FlaggedElement.call(this,b),b.useInputTag||this.$input.append(this.$icon,this.$label,this.$indicator),this.$element.addClass("oo-ui-buttonInputWidget")},a.inheritClass(a.ui.ButtonInputWidget,a.ui.InputWidget),a.mixinClass(a.ui.ButtonInputWidget,a.ui.ButtonElement),a.mixinClass(a.ui.ButtonInputWidget,a.ui.IconElement),a.mixinClass(a.ui.ButtonInputWidget,a.ui.IndicatorElement),a.mixinClass(a.ui.ButtonInputWidget,a.ui.LabelElement),a.mixinClass(a.ui.ButtonInputWidget,a.ui.TitledElement),a.mixinClass(a.ui.ButtonInputWidget,a.ui.FlaggedElement),a.ui.ButtonInputWidget.prototype.getInputElement=function(a){var b="<"+(a.useInputTag?"input":"button")+' type="'+a.type+'">';return $(b)},a.ui.ButtonInputWidget.prototype.setLabel=function(b){return a.ui.LabelElement.prototype.setLabel.call(this,b),this.useInputTag&&("function"==typeof b&&(b=a.ui.resolveMsg(b)),b instanceof jQuery&&(b=b.text()),b||(b=""),this.$input.val(b)),this},a.ui.ButtonInputWidget.prototype.setValue=function(b){return this.useInputTag||a.ui.ButtonInputWidget["super"].prototype.setValue.call(this,b),this},a.ui.CheckboxInputWidget=function(b){b=b||{},a.ui.CheckboxInputWidget["super"].call(this,b),this.$element.addClass("oo-ui-checkboxInputWidget"),this.setSelected(void 0!==b.selected?b.selected:!1)},a.inheritClass(a.ui.CheckboxInputWidget,a.ui.InputWidget),a.ui.CheckboxInputWidget.prototype.getInputElement=function(){return $('<input type="checkbox" />')},a.ui.CheckboxInputWidget.prototype.onEdit=function(){var a=this;this.isDisabled()||setTimeout(function(){a.setSelected(a.$input.prop("checked"))})},a.ui.CheckboxInputWidget.prototype.setSelected=function(a){return a=!!a,this.selected!==a&&(this.selected=a,this.$input.prop("checked",this.selected),this.emit("change",this.selected)),this},a.ui.CheckboxInputWidget.prototype.isSelected=function(){var a=this.$input.prop("checked");return this.selected!==a&&this.setSelected(a),this.selected},a.ui.DropdownInputWidget=function(b){b=b||{},this.dropdownWidget=new a.ui.DropdownWidget,a.ui.DropdownInputWidget["super"].call(this,b),this.dropdownWidget.getMenu().connect(this,{select:"onMenuSelect"}),this.setOptions(b.options||[]),this.$element.addClass("oo-ui-dropdownInputWidget").append(this.dropdownWidget.$element)},a.inheritClass(a.ui.DropdownInputWidget,a.ui.InputWidget),a.ui.DropdownInputWidget.prototype.getInputElement=function(){return $('<input type="hidden">')},a.ui.DropdownInputWidget.prototype.onMenuSelect=function(a){this.setValue(a.getData())},a.ui.DropdownInputWidget.prototype.setValue=function(b){var c=this.dropdownWidget.getMenu().getItemFromData(b);return c&&this.dropdownWidget.getMenu().selectItem(c),a.ui.DropdownInputWidget["super"].prototype.setValue.call(this,b),this},a.ui.DropdownInputWidget.prototype.setDisabled=function(b){return this.dropdownWidget.setDisabled(b),a.ui.DropdownInputWidget["super"].prototype.setDisabled.call(this,b),this},a.ui.DropdownInputWidget.prototype.setOptions=function(b){var c=this.getValue();return this.dropdownWidget.getMenu().clearItems().addItems(b.map(function(b){return new a.ui.MenuOptionWidget({data:b.data,label:void 0!==b.label?b.label:b.data})})),this.dropdownWidget.getMenu().getItemFromData(c)?this.setValue(c):b.length&&this.setValue(b[0].data),this},a.ui.DropdownInputWidget.prototype.focus=function(){return this.dropdownWidget.getMenu().toggle(!0),this},a.ui.DropdownInputWidget.prototype.blur=function(){return this.dropdownWidget.getMenu().toggle(!1),this},a.ui.RadioInputWidget=function(b){b=b||{},a.ui.RadioInputWidget["super"].call(this,b),this.$element.addClass("oo-ui-radioInputWidget"),this.setSelected(void 0!==b.selected?b.selected:!1)},a.inheritClass(a.ui.RadioInputWidget,a.ui.InputWidget),a.ui.RadioInputWidget.prototype.getInputElement=function(){return $('<input type="radio" />')},a.ui.RadioInputWidget.prototype.onEdit=function(){},a.ui.RadioInputWidget.prototype.setSelected=function(a){return this.$input.prop("checked",a),this},a.ui.RadioInputWidget.prototype.isSelected=function(){return this.$input.prop("checked")},a.ui.TextInputWidget=function(b){b=$.extend({type:"text",labelPosition:"after",maxRows:10},b),a.ui.TextInputWidget["super"].call(this,b),a.ui.IconElement.call(this,b),a.ui.IndicatorElement.call(this,b),a.ui.PendingElement.call(this,b),a.ui.LabelElement.call(this,b),this.readOnly=!1,this.multiline=!!b.multiline,this.autosize=!!b.autosize,this.maxRows=b.maxRows,this.validate=null,this.autosize&&(this.$clone=this.$input.clone().insertAfter(this.$input).attr("aria-hidden","true").addClass("oo-ui-element-hidden")),this.setValidation(b.validate),this.setPosition(b.labelPosition),this.$input.on({keypress:this.onKeyPress.bind(this),blur:this.setValidityFlag.bind(this)}),this.$element.on("DOMNodeInsertedIntoDocument",this.onElementAttach.bind(this)),this.$icon.on("mousedown",this.onIconMouseDown.bind(this)),this.$indicator.on("mousedown",this.onIndicatorMouseDown.bind(this)),this.on("labelChange",this.updatePosition.bind(this)),this.$element.addClass("oo-ui-textInputWidget").append(this.$icon,this.$indicator,this.$label),this.setReadOnly(!!b.readOnly),b.placeholder&&this.$input.attr("placeholder",b.placeholder),b.maxLength&&this.$input.attr("maxlength",b.maxLength),b.autofocus&&this.$input.attr("autofocus","autofocus"),b.required&&this.$input.attr("required","true")},a.inheritClass(a.ui.TextInputWidget,a.ui.InputWidget),a.mixinClass(a.ui.TextInputWidget,a.ui.IconElement),a.mixinClass(a.ui.TextInputWidget,a.ui.IndicatorElement),a.mixinClass(a.ui.TextInputWidget,a.ui.PendingElement),a.mixinClass(a.ui.TextInputWidget,a.ui.LabelElement),a.ui.TextInputWidget["static"].validationPatterns={"non-empty":/.+/,integer:/^\d+$/},a.ui.TextInputWidget.prototype.onIconMouseDown=function(a){return 1===a.which?(this.$input[0].focus(),this.emit("icon"),!1):void 0},a.ui.TextInputWidget.prototype.onIndicatorMouseDown=function(a){return 1===a.which?(this.$input[0].focus(),this.emit("indicator"),!1):void 0},a.ui.TextInputWidget.prototype.onKeyPress=function(b){b.which!==a.ui.Keys.ENTER||this.multiline||this.emit("enter",b)},a.ui.TextInputWidget.prototype.onElementAttach=function(){this.valCache=null,this.adjustSize(),this.positionLabel()},a.ui.TextInputWidget.prototype.onEdit=function(){return this.adjustSize(),a.ui.TextInputWidget["super"].prototype.onEdit.call(this)},a.ui.TextInputWidget.prototype.setValue=function(b){return a.ui.TextInputWidget["super"].prototype.setValue.call(this,b),this.setValidityFlag(),this.adjustSize(),this},a.ui.TextInputWidget.prototype.isReadOnly=function(){return this.readOnly},a.ui.TextInputWidget.prototype.setReadOnly=function(a){return this.readOnly=!!a,this.$input.prop("readOnly",this.readOnly),this},a.ui.TextInputWidget.prototype.adjustSize=function(){var a,b,c,d,e,f;return this.multiline&&this.autosize&&this.$input.val()!==this.valCache&&(this.$clone.val(this.$input.val()).attr("rows","").css("height",0),this.$clone.removeClass("oo-ui-element-hidden"),this.valCache=this.$input.val(),a=this.$clone[0].scrollHeight,this.$clone.css("height",""),b=this.$clone.innerHeight(),c=this.$clone.outerHeight(),this.$clone.attr("rows",this.maxRows).css("height","auto").val(""),d=this.$clone.innerHeight(),e=d-this.$clone[0].scrollHeight,f=Math.min(d,a+e),this.$clone.addClass("oo-ui-element-hidden"),f>b?this.$input.css("height",f+(c-b)):this.$input.css("height","")),this},a.ui.TextInputWidget.prototype.getInputElement=function(a){return $(a.multiline?"<textarea>":'<input type="'+a.type+'" />')},a.ui.TextInputWidget.prototype.isMultiline=function(){return!!this.multiline},a.ui.TextInputWidget.prototype.isAutosizing=function(){return!!this.autosize},a.ui.TextInputWidget.prototype.select=function(){return this.$input.select(),this},a.ui.TextInputWidget.prototype.setValidation=function(a){this.validate=a instanceof RegExp?a:this.constructor["static"].validationPatterns[a]||/.*/},a.ui.TextInputWidget.prototype.setValidityFlag=function(){var a=this;this.isValid().done(function(b){a.setFlags({invalid:!b})})},a.ui.TextInputWidget.prototype.isValid=function(){return $.Deferred().resolve(!!this.getValue().match(this.validate)).promise()},a.ui.TextInputWidget.prototype.setPosition=function(a){return this.labelPosition=a,this.updatePosition(),this},a.ui.TextInputWidget.prototype.updatePosition=function(){var a="after"===this.labelPosition;return this.$element.toggleClass("oo-ui-textInputWidget-labelPosition-after",this.label&&a).toggleClass("oo-ui-textInputWidget-labelPosition-before",this.label&&!a),this.label&&this.positionLabel(),this},a.ui.TextInputWidget.prototype.positionLabel=function(){if(this.$input.css({"padding-right":"","padding-left":""}),this.$label.text()){var a="after"===this.labelPosition,b="rtl"===this.$element.css("direction"),c=a===b?"padding-left":"padding-right";
return this.$input.css(c,this.$label.outerWidth()),this}},a.ui.ComboBoxWidget=function(b){b=b||{},a.ui.ComboBoxWidget["super"].call(this,b),this.$indicator=this.$("<span>"),a.ui.TabIndexedElement.call(this,$.extend({},b,{$tabIndexed:this.$indicator})),this.$overlay=b.$overlay||this.$element,this.input=new a.ui.TextInputWidget($.extend({indicator:"down",$indicator:this.$indicator,disabled:this.isDisabled()},b.input)),this.menu=new a.ui.TextInputMenuSelectWidget(this.input,$.extend({widget:this,input:this.input,disabled:this.isDisabled()},b.menu)),this.$indicator.on({click:this.onClick.bind(this),keypress:this.onKeyPress.bind(this)}),this.input.connect(this,{change:"onInputChange",enter:"onInputEnter"}),this.menu.connect(this,{choose:"onMenuChoose",add:"onMenuItemsChange",remove:"onMenuItemsChange"}),this.$element.addClass("oo-ui-comboBoxWidget").append(this.input.$element),this.$overlay.append(this.menu.$element),this.onMenuItemsChange()},a.inheritClass(a.ui.ComboBoxWidget,a.ui.Widget),a.mixinClass(a.ui.ComboBoxWidget,a.ui.TabIndexedElement),a.ui.ComboBoxWidget.prototype.getMenu=function(){return this.menu},a.ui.ComboBoxWidget.prototype.onInputChange=function(a){var b=this.menu.getItemFromData(a);this.menu.selectItem(b),this.isDisabled()||this.menu.toggle(!0)},a.ui.ComboBoxWidget.prototype.onClick=function(a){return this.isDisabled()||1!==a.which||(this.menu.toggle(),this.input.$input[0].focus()),!1},a.ui.ComboBoxWidget.prototype.onKeyPress=function(b){return this.isDisabled()||b.which!==a.ui.Keys.SPACE&&b.which!==a.ui.Keys.ENTER||(this.menu.toggle(),this.input.$input[0].focus()),!1},a.ui.ComboBoxWidget.prototype.onInputEnter=function(){this.isDisabled()||this.menu.toggle(!1)},a.ui.ComboBoxWidget.prototype.onMenuChoose=function(a){a&&this.input.setValue(a.getData())},a.ui.ComboBoxWidget.prototype.onMenuItemsChange=function(){var a=this.menu.getItemFromData(this.input.getValue());this.menu.selectItem(a),this.$element.toggleClass("oo-ui-comboBoxWidget-empty",this.menu.isEmpty())},a.ui.ComboBoxWidget.prototype.setDisabled=function(b){return a.ui.ComboBoxWidget["super"].prototype.setDisabled.call(this,b),this.input&&this.input.setDisabled(this.isDisabled()),this.menu&&this.menu.setDisabled(this.isDisabled()),this},a.ui.LabelWidget=function(b){b=b||{},a.ui.LabelWidget["super"].call(this,b),a.ui.LabelElement.call(this,$.extend({},b,{$label:this.$element})),a.ui.TitledElement.call(this,b),this.input=b.input,this.input instanceof a.ui.InputWidget&&this.$element.on("click",this.onClick.bind(this)),this.$element.addClass("oo-ui-labelWidget")},a.inheritClass(a.ui.LabelWidget,a.ui.Widget),a.mixinClass(a.ui.LabelWidget,a.ui.LabelElement),a.mixinClass(a.ui.LabelWidget,a.ui.TitledElement),a.ui.LabelWidget["static"].tagName="span",a.ui.LabelWidget.prototype.onClick=function(){return this.input.simulateLabelClick(),!1},a.ui.OptionWidget=function(b){b=b||{},a.ui.OptionWidget["super"].call(this,b),a.ui.ItemWidget.call(this),a.ui.LabelElement.call(this,b),a.ui.FlaggedElement.call(this,b),this.selected=!1,this.highlighted=!1,this.pressed=!1,this.$element.data("oo-ui-optionWidget",this).attr("role","option").addClass("oo-ui-optionWidget").append(this.$label)},a.inheritClass(a.ui.OptionWidget,a.ui.Widget),a.mixinClass(a.ui.OptionWidget,a.ui.ItemWidget),a.mixinClass(a.ui.OptionWidget,a.ui.LabelElement),a.mixinClass(a.ui.OptionWidget,a.ui.FlaggedElement),a.ui.OptionWidget["static"].selectable=!0,a.ui.OptionWidget["static"].highlightable=!0,a.ui.OptionWidget["static"].pressable=!0,a.ui.OptionWidget["static"].scrollIntoViewOnSelect=!1,a.ui.OptionWidget.prototype.isSelectable=function(){return this.constructor["static"].selectable&&!this.isDisabled()},a.ui.OptionWidget.prototype.isHighlightable=function(){return this.constructor["static"].highlightable&&!this.isDisabled()},a.ui.OptionWidget.prototype.isPressable=function(){return this.constructor["static"].pressable&&!this.isDisabled()},a.ui.OptionWidget.prototype.isSelected=function(){return this.selected},a.ui.OptionWidget.prototype.isHighlighted=function(){return this.highlighted},a.ui.OptionWidget.prototype.isPressed=function(){return this.pressed},a.ui.OptionWidget.prototype.setSelected=function(a){return this.constructor["static"].selectable&&(this.selected=!!a,this.$element.toggleClass("oo-ui-optionWidget-selected",a).attr("aria-selected",a.toString()),a&&this.constructor["static"].scrollIntoViewOnSelect&&this.scrollElementIntoView(),this.updateThemeClasses()),this},a.ui.OptionWidget.prototype.setHighlighted=function(a){return this.constructor["static"].highlightable&&(this.highlighted=!!a,this.$element.toggleClass("oo-ui-optionWidget-highlighted",a),this.updateThemeClasses()),this},a.ui.OptionWidget.prototype.setPressed=function(a){return this.constructor["static"].pressable&&(this.pressed=!!a,this.$element.toggleClass("oo-ui-optionWidget-pressed",a),this.updateThemeClasses()),this},a.ui.DecoratedOptionWidget=function(b){a.ui.DecoratedOptionWidget["super"].call(this,b),a.ui.IconElement.call(this,b),a.ui.IndicatorElement.call(this,b),this.$element.addClass("oo-ui-decoratedOptionWidget").prepend(this.$icon).append(this.$indicator)},a.inheritClass(a.ui.DecoratedOptionWidget,a.ui.OptionWidget),a.mixinClass(a.ui.OptionWidget,a.ui.IconElement),a.mixinClass(a.ui.OptionWidget,a.ui.IndicatorElement),a.ui.ButtonOptionWidget=function(b){a.ui.ButtonOptionWidget["super"].call(this,b),a.ui.ButtonElement.call(this,b),a.ui.TabIndexedElement.call(this,$.extend({},b,{$tabIndexed:this.$button})),this.$element.addClass("oo-ui-buttonOptionWidget"),this.$button.append(this.$element.contents()),this.$element.append(this.$button)},a.inheritClass(a.ui.ButtonOptionWidget,a.ui.DecoratedOptionWidget),a.mixinClass(a.ui.ButtonOptionWidget,a.ui.ButtonElement),a.mixinClass(a.ui.ButtonOptionWidget,a.ui.TabIndexedElement),a.ui.ButtonOptionWidget["static"].cancelButtonMouseDownEvents=!1,a.ui.ButtonOptionWidget.prototype.setSelected=function(b){return a.ui.ButtonOptionWidget["super"].prototype.setSelected.call(this,b),this.constructor["static"].selectable&&this.setActive(b),this},a.ui.RadioOptionWidget=function(b){a.ui.RadioOptionWidget["super"].call(this,b),this.radio=new a.ui.RadioInputWidget({value:b.data}),this.$element.addClass("oo-ui-radioOptionWidget").prepend(this.radio.$element)},a.inheritClass(a.ui.RadioOptionWidget,a.ui.OptionWidget),a.ui.RadioOptionWidget["static"].highlightable=!1,a.ui.RadioOptionWidget["static"].scrollIntoViewOnSelect=!0,a.ui.RadioOptionWidget["static"].pressable=!1,a.ui.RadioOptionWidget["static"].tagName="label",a.ui.RadioOptionWidget.prototype.setSelected=function(b){return a.ui.RadioOptionWidget["super"].prototype.setSelected.call(this,b),this.radio.setSelected(b),this},a.ui.MenuOptionWidget=function(b){b=$.extend({icon:"check"},b),a.ui.MenuOptionWidget["super"].call(this,b),this.$element.attr("role","menuitem").addClass("oo-ui-menuOptionWidget")},a.inheritClass(a.ui.MenuOptionWidget,a.ui.DecoratedOptionWidget),a.ui.MenuOptionWidget["static"].scrollIntoViewOnSelect=!0,a.ui.MenuSectionOptionWidget=function(b){a.ui.MenuSectionOptionWidget["super"].call(this,b),this.$element.addClass("oo-ui-menuSectionOptionWidget")},a.inheritClass(a.ui.MenuSectionOptionWidget,a.ui.DecoratedOptionWidget),a.ui.MenuSectionOptionWidget["static"].selectable=!1,a.ui.MenuSectionOptionWidget["static"].highlightable=!1,a.ui.OutlineOptionWidget=function(b){b=b||{},a.ui.OutlineOptionWidget["super"].call(this,b),this.level=0,this.movable=!!b.movable,this.removable=!!b.removable,this.$element.addClass("oo-ui-outlineOptionWidget"),this.setLevel(b.level)},a.inheritClass(a.ui.OutlineOptionWidget,a.ui.DecoratedOptionWidget),a.ui.OutlineOptionWidget["static"].highlightable=!1,a.ui.OutlineOptionWidget["static"].scrollIntoViewOnSelect=!0,a.ui.OutlineOptionWidget["static"].levelClass="oo-ui-outlineOptionWidget-level-",a.ui.OutlineOptionWidget["static"].levels=3,a.ui.OutlineOptionWidget.prototype.isMovable=function(){return this.movable},a.ui.OutlineOptionWidget.prototype.isRemovable=function(){return this.removable},a.ui.OutlineOptionWidget.prototype.getLevel=function(){return this.level},a.ui.OutlineOptionWidget.prototype.setMovable=function(a){return this.movable=!!a,this.updateThemeClasses(),this},a.ui.OutlineOptionWidget.prototype.setRemovable=function(a){return this.removable=!!a,this.updateThemeClasses(),this},a.ui.OutlineOptionWidget.prototype.setLevel=function(a){var b=this.constructor["static"].levels,c=this.constructor["static"].levelClass,d=b;for(this.level=a?Math.max(0,Math.min(b-1,a)):0;d--;)this.level===d?this.$element.addClass(c+d):this.$element.removeClass(c+d);return this.updateThemeClasses(),this},a.ui.PopupWidget=function(b){b=b||{},a.ui.PopupWidget["super"].call(this,b),this.$body=$("<div>"),a.ui.LabelElement.call(this,b),a.ui.ClippableElement.call(this,$.extend({},b,{$clippable:this.$body})),this.$popup=$("<div>"),this.$head=$("<div>"),this.$anchor=$("<div>"),this.$container=b.$container,this.containerPadding=void 0!==b.containerPadding?b.containerPadding:10,this.autoClose=!!b.autoClose,this.$autoCloseIgnore=b.$autoCloseIgnore,this.transitionTimeout=null,this.anchor=null,this.width=void 0!==b.width?b.width:320,this.height=void 0!==b.height?b.height:null,this.align=b.align||"center",this.closeButton=new a.ui.ButtonWidget({framed:!1,icon:"close"}),this.onMouseDownHandler=this.onMouseDown.bind(this),this.closeButton.connect(this,{click:"onCloseButtonClick"}),this.toggleAnchor(void 0===b.anchor||b.anchor),this.$body.addClass("oo-ui-popupWidget-body"),this.$anchor.addClass("oo-ui-popupWidget-anchor"),this.$head.addClass("oo-ui-popupWidget-head").append(this.$label,this.closeButton.$element),b.head||this.$head.addClass("oo-ui-element-hidden"),this.$popup.addClass("oo-ui-popupWidget-popup").append(this.$head,this.$body),this.$element.addClass("oo-ui-popupWidget").append(this.$popup,this.$anchor),b.$content instanceof jQuery&&this.$body.append(b.$content),b.padded&&this.$body.addClass("oo-ui-popupWidget-body-padded"),this.visible=!1,this.$element.addClass("oo-ui-element-hidden")},a.inheritClass(a.ui.PopupWidget,a.ui.Widget),a.mixinClass(a.ui.PopupWidget,a.ui.LabelElement),a.mixinClass(a.ui.PopupWidget,a.ui.ClippableElement),a.ui.PopupWidget.prototype.onMouseDown=function(a){!this.isVisible()||$.contains(this.$element[0],a.target)||this.$autoCloseIgnore&&this.$autoCloseIgnore.has(a.target).length||this.toggle(!1)},a.ui.PopupWidget.prototype.bindMouseDownListener=function(){this.getElementWindow().addEventListener("mousedown",this.onMouseDownHandler,!0)},a.ui.PopupWidget.prototype.onCloseButtonClick=function(){this.isVisible()&&this.toggle(!1)},a.ui.PopupWidget.prototype.unbindMouseDownListener=function(){this.getElementWindow().removeEventListener("mousedown",this.onMouseDownHandler,!0)},a.ui.PopupWidget.prototype.toggleAnchor=function(a){a=void 0===a?!this.anchored:!!a,this.anchored!==a&&(a?this.$element.addClass("oo-ui-popupWidget-anchored"):this.$element.removeClass("oo-ui-popupWidget-anchored"),this.anchored=a)},a.ui.PopupWidget.prototype.hasAnchor=function(){return this.anchor},a.ui.PopupWidget.prototype.toggle=function(b){b=void 0===b?!this.isVisible():!!b;var c=b!==this.isVisible();return a.ui.PopupWidget["super"].prototype.toggle.call(this,b),c&&(b?(this.autoClose&&this.bindMouseDownListener(),this.updateDimensions(),this.toggleClipping(!0)):(this.toggleClipping(!1),this.autoClose&&this.unbindMouseDownListener())),this},a.ui.PopupWidget.prototype.setSize=function(a,b,c){this.width=a,this.height=void 0!==b?b:null,this.isVisible()&&this.updateDimensions(c)},a.ui.PopupWidget.prototype.updateDimensions=function(a){var b,c,d,e,f,g,h,i,j,k,l=this;return this.$container||(this.$container=$(this.getClosestScrollableElementContainer())),this.$popup.css({width:this.width,height:null!==this.height?this.height:"auto"}),b=this.width*{left:0,center:-.5,right:-1}[this.align],c=this.$element.offset().left,d=this.$container.offset().left,e=this.$container.innerWidth(),f=d+e,g=b-this.containerPadding,h=b+this.containerPadding+this.width+this.containerPadding,i=c+g-d,j=f-(c+h),0>j?b+=j:0>i&&(b-=i),k=2*this.$anchor[0].scrollWidth,b+this.width<k?b=k-this.width:k>-b&&(b=-k),clearTimeout(this.transitionTimeout),a&&this.$element.addClass("oo-ui-popupWidget-transitioning"),this.$popup.css("margin-left",b),a?this.transitionTimeout=setTimeout(function(){l.$element.removeClass("oo-ui-popupWidget-transitioning")},200):this.$element.removeClass("oo-ui-popupWidget-transitioning"),this.clip(),this},a.ui.ProgressBarWidget=function(b){b=b||{},a.ui.ProgressBarWidget["super"].call(this,b),this.$bar=$("<div>"),this.progress=null,this.setProgress(void 0!==b.progress?b.progress:!1),this.$bar.addClass("oo-ui-progressBarWidget-bar"),this.$element.attr({role:"progressbar","aria-valuemin":0,"aria-valuemax":100}).addClass("oo-ui-progressBarWidget").append(this.$bar)},a.inheritClass(a.ui.ProgressBarWidget,a.ui.Widget),a.ui.ProgressBarWidget["static"].tagName="div",a.ui.ProgressBarWidget.prototype.getProgress=function(){return this.progress},a.ui.ProgressBarWidget.prototype.setProgress=function(a){this.progress=a,a!==!1?(this.$bar.css("width",this.progress+"%"),this.$element.attr("aria-valuenow",this.progress)):(this.$bar.css("width",""),this.$element.removeAttr("aria-valuenow")),this.$element.toggleClass("oo-ui-progressBarWidget-indeterminate",!a)},a.ui.SearchWidget=function(b){b=b||{},a.ui.SearchWidget["super"].call(this,b),this.query=new a.ui.TextInputWidget({icon:"search",placeholder:b.placeholder,value:b.value}),this.results=new a.ui.SelectWidget,this.$query=$("<div>"),this.$results=$("<div>"),this.query.connect(this,{change:"onQueryChange",enter:"onQueryEnter"}),this.results.connect(this,{highlight:"onResultsHighlight",select:"onResultsSelect"}),this.query.$input.on("keydown",this.onQueryKeydown.bind(this)),this.$query.addClass("oo-ui-searchWidget-query").append(this.query.$element),this.$results.addClass("oo-ui-searchWidget-results").append(this.results.$element),this.$element.addClass("oo-ui-searchWidget").append(this.$results,this.$query)},a.inheritClass(a.ui.SearchWidget,a.ui.Widget),a.ui.SearchWidget.prototype.onQueryKeydown=function(b){var c,d,e=b.which===a.ui.Keys.DOWN?1:b.which===a.ui.Keys.UP?-1:0;e&&(c=this.results.getHighlightedItem(),c||(c=this.results.getSelectedItem()),d=this.results.getRelativeSelectableItem(c,e),this.results.highlightItem(d),d.scrollElementIntoView())},a.ui.SearchWidget.prototype.onQueryChange=function(){this.results.clearItems()},a.ui.SearchWidget.prototype.onQueryEnter=function(){this.results.selectItem(this.results.getHighlightedItem())},a.ui.SearchWidget.prototype.onResultsHighlight=function(a){this.emit("highlight",a?a.getData():null)},a.ui.SearchWidget.prototype.onResultsSelect=function(a){this.emit("select",a?a.getData():null)},a.ui.SearchWidget.prototype.getQuery=function(){return this.query},a.ui.SearchWidget.prototype.getResults=function(){return this.results},a.ui.SelectWidget=function(b){b=b||{},a.ui.SelectWidget["super"].call(this,b),a.ui.GroupWidget.call(this,$.extend({},b,{$group:this.$element})),this.pressed=!1,this.selecting=null,this.onMouseUpHandler=this.onMouseUp.bind(this),this.onMouseMoveHandler=this.onMouseMove.bind(this),this.$element.on({mousedown:this.onMouseDown.bind(this),mouseover:this.onMouseOver.bind(this),mouseleave:this.onMouseLeave.bind(this)}),this.$element.addClass("oo-ui-selectWidget oo-ui-selectWidget-depressed").attr("role","listbox"),$.isArray(b.items)&&this.addItems(b.items)},a.inheritClass(a.ui.SelectWidget,a.ui.Widget),a.mixinClass(a.ui.SelectWidget,a.ui.GroupElement),a.mixinClass(a.ui.SelectWidget,a.ui.GroupWidget),a.ui.SelectWidget.prototype.onMouseDown=function(a){var b;return this.isDisabled()||1!==a.which||(this.togglePressed(!0),b=this.getTargetItem(a),b&&b.isSelectable()&&(this.pressItem(b),this.selecting=b,this.getElementDocument().addEventListener("mouseup",this.onMouseUpHandler,!0),this.getElementDocument().addEventListener("mousemove",this.onMouseMoveHandler,!0))),!1},a.ui.SelectWidget.prototype.onMouseUp=function(a){var b;return this.togglePressed(!1),this.selecting||(b=this.getTargetItem(a),b&&b.isSelectable()&&(this.selecting=b)),!this.isDisabled()&&1===a.which&&this.selecting&&(this.pressItem(null),this.chooseItem(this.selecting),this.selecting=null),this.getElementDocument().removeEventListener("mouseup",this.onMouseUpHandler,!0),this.getElementDocument().removeEventListener("mousemove",this.onMouseMoveHandler,!0),!1},a.ui.SelectWidget.prototype.onMouseMove=function(a){var b;return!this.isDisabled()&&this.pressed&&(b=this.getTargetItem(a),b&&b!==this.selecting&&b.isSelectable()&&(this.pressItem(b),this.selecting=b)),!1},a.ui.SelectWidget.prototype.onMouseOver=function(a){var b;return this.isDisabled()||(b=this.getTargetItem(a),this.highlightItem(b&&b.isHighlightable()?b:null)),!1},a.ui.SelectWidget.prototype.onMouseLeave=function(){return this.isDisabled()||this.highlightItem(null),!1},a.ui.SelectWidget.prototype.getTargetItem=function(a){var b=$(a.target).closest(".oo-ui-optionWidget");return b.length?b.data("oo-ui-optionWidget"):null},a.ui.SelectWidget.prototype.getSelectedItem=function(){var a,b;for(a=0,b=this.items.length;b>a;a++)if(this.items[a].isSelected())return this.items[a];return null},a.ui.SelectWidget.prototype.getHighlightedItem=function(){var a,b;for(a=0,b=this.items.length;b>a;a++)if(this.items[a].isHighlighted())return this.items[a];return null},a.ui.SelectWidget.prototype.togglePressed=function(a){void 0===a&&(a=!this.pressed),a!==this.pressed&&(this.$element.toggleClass("oo-ui-selectWidget-pressed",a).toggleClass("oo-ui-selectWidget-depressed",!a),this.pressed=a)},a.ui.SelectWidget.prototype.highlightItem=function(a){var b,c,d,e=!1;for(b=0,c=this.items.length;c>b;b++)d=this.items[b]===a,this.items[b].isHighlighted()!==d&&(this.items[b].setHighlighted(d),e=!0);return e&&this.emit("highlight",a),this},a.ui.SelectWidget.prototype.selectItem=function(a){var b,c,d,e=!1;for(b=0,c=this.items.length;c>b;b++)d=this.items[b]===a,this.items[b].isSelected()!==d&&(this.items[b].setSelected(d),e=!0);return e&&this.emit("select",a),this},a.ui.SelectWidget.prototype.pressItem=function(a){var b,c,d,e=!1;for(b=0,c=this.items.length;c>b;b++)d=this.items[b]===a,this.items[b].isPressed()!==d&&(this.items[b].setPressed(d),e=!0);return e&&this.emit("press",a),this},a.ui.SelectWidget.prototype.chooseItem=function(a){return this.selectItem(a),this.emit("choose",a),this},a.ui.SelectWidget.prototype.getRelativeSelectableItem=function(b,c){var d,e,f,g=c>0?1:-1,h=this.items.length;for(b instanceof a.ui.OptionWidget?(d=$.inArray(b,this.items),e=(d+g+h)%h):e=c>0?0:h-1,f=0;h>f;f++){if(b=this.items[e],b instanceof a.ui.OptionWidget&&b.isSelectable())return b;e=(e+g+h)%h}return null},a.ui.SelectWidget.prototype.getFirstSelectableItem=function(){var b,c,d;for(b=0,c=this.items.length;c>b;b++)if(d=this.items[b],d instanceof a.ui.OptionWidget&&d.isSelectable())return d;return null},a.ui.SelectWidget.prototype.addItems=function(b,c){return a.ui.GroupWidget.prototype.addItems.call(this,b,c),this.emit("add",b,void 0===c?this.items.length-b.length-1:c),this},a.ui.SelectWidget.prototype.removeItems=function(b){var c,d,e;for(c=0,d=b.length;d>c;c++)e=b[c],e.isSelected()&&this.selectItem(null);return a.ui.GroupWidget.prototype.removeItems.call(this,b),this.emit("remove",b),this},a.ui.SelectWidget.prototype.clearItems=function(){var b=this.items.slice();return a.ui.GroupWidget.prototype.clearItems.call(this),this.selectItem(null),this.emit("remove",b),this},a.ui.ButtonSelectWidget=function(b){a.ui.ButtonSelectWidget["super"].call(this,b),this.$element.addClass("oo-ui-buttonSelectWidget")},a.inheritClass(a.ui.ButtonSelectWidget,a.ui.SelectWidget),a.ui.RadioSelectWidget=function(b){a.ui.RadioSelectWidget["super"].call(this,b),this.$element.addClass("oo-ui-radioSelectWidget")},a.inheritClass(a.ui.RadioSelectWidget,a.ui.SelectWidget),a.ui.MenuSelectWidget=function(b){b=b||{},a.ui.MenuSelectWidget["super"].call(this,b),a.ui.ClippableElement.call(this,$.extend({},b,{$clippable:this.$group})),this.newItems=null,this.autoHide=void 0===b.autoHide||!!b.autoHide,this.$input=b.input?b.input.$input:null,this.$widget=b.widget?b.widget.$element:null,this.onKeyDownHandler=this.onKeyDown.bind(this),this.onDocumentMouseDownHandler=this.onDocumentMouseDown.bind(this),this.$element.addClass("oo-ui-menuSelectWidget").attr("role","menu"),this.visible=!1,this.$element.addClass("oo-ui-element-hidden")},a.inheritClass(a.ui.MenuSelectWidget,a.ui.SelectWidget),a.mixinClass(a.ui.MenuSelectWidget,a.ui.ClippableElement),a.ui.MenuSelectWidget.prototype.onDocumentMouseDown=function(b){a.ui.contains(this.$element[0],b.target,!0)||this.$widget&&a.ui.contains(this.$widget[0],b.target,!0)||this.toggle(!1)},a.ui.MenuSelectWidget.prototype.onKeyDown=function(b){var c,d=!1,e=this.getHighlightedItem();if(!this.isDisabled()&&this.isVisible()){switch(e||(e=this.getSelectedItem()),b.keyCode){case a.ui.Keys.ENTER:this.chooseItem(e),d=!0;break;case a.ui.Keys.UP:c=this.getRelativeSelectableItem(e,-1),d=!0;break;case a.ui.Keys.DOWN:c=this.getRelativeSelectableItem(e,1),d=!0;break;case a.ui.Keys.ESCAPE:case a.ui.Keys.TAB:e&&e.setHighlighted(!1),this.toggle(!1),d=b.keyCode===a.ui.Keys.ESCAPE}if(c&&(this.highlightItem(c),c.scrollElementIntoView()),d)return b.preventDefault(),b.stopPropagation(),!1}},a.ui.MenuSelectWidget.prototype.bindKeyDownListener=function(){this.$input?this.$input.on("keydown",this.onKeyDownHandler):this.getElementWindow().addEventListener("keydown",this.onKeyDownHandler,!0)},a.ui.MenuSelectWidget.prototype.unbindKeyDownListener=function(){this.$input?this.$input.off("keydown",this.onKeyDownHandler):this.getElementWindow().removeEventListener("keydown",this.onKeyDownHandler,!0)},a.ui.MenuSelectWidget.prototype.chooseItem=function(b){return a.ui.MenuSelectWidget["super"].prototype.chooseItem.call(this,b),this.toggle(!1),this},a.ui.MenuSelectWidget.prototype.addItems=function(b,c){var d,e,f;for(a.ui.MenuSelectWidget["super"].prototype.addItems.call(this,b,c),this.newItems||(this.newItems=[]),d=0,e=b.length;e>d;d++)f=b[d],this.isVisible()?f.fitLabel():this.newItems.push(f);return this.clip(),this},a.ui.MenuSelectWidget.prototype.removeItems=function(b){return a.ui.MenuSelectWidget["super"].prototype.removeItems.call(this,b),this.clip(),this},a.ui.MenuSelectWidget.prototype.clearItems=function(){return a.ui.MenuSelectWidget["super"].prototype.clearItems.call(this),this.clip(),this},a.ui.MenuSelectWidget.prototype.toggle=function(b){b=(void 0===b?!this.visible:!!b)&&!!this.items.length;var c,d,e=b!==this.isVisible();if(a.ui.MenuSelectWidget["super"].prototype.toggle.call(this,b),e)if(b){if(this.bindKeyDownListener(),this.newItems&&this.newItems.length){for(c=0,d=this.newItems.length;d>c;c++)this.newItems[c].fitLabel();this.newItems=null}this.toggleClipping(!0),this.autoHide&&this.getElementDocument().addEventListener("mousedown",this.onDocumentMouseDownHandler,!0)}else this.unbindKeyDownListener(),this.getElementDocument().removeEventListener("mousedown",this.onDocumentMouseDownHandler,!0),this.toggleClipping(!1);return this},a.ui.TextInputMenuSelectWidget=function(b,c){c=c||{},a.ui.TextInputMenuSelectWidget["super"].call(this,c),this.input=b,this.$container=c.$container||this.input.$element,this.onWindowResizeHandler=this.onWindowResize.bind(this),this.$element.addClass("oo-ui-textInputMenuSelectWidget")},a.inheritClass(a.ui.TextInputMenuSelectWidget,a.ui.MenuSelectWidget),a.ui.TextInputMenuSelectWidget.prototype.onWindowResize=function(){this.position()},a.ui.TextInputMenuSelectWidget.prototype.toggle=function(b){b=void 0===b?!this.isVisible():!!b;var c=b!==this.isVisible();return c&&b&&this.position(),a.ui.TextInputMenuSelectWidget["super"].prototype.toggle.call(this,b),c&&(this.isVisible()?(this.position(),$(this.getElementWindow()).on("resize",this.onWindowResizeHandler)):$(this.getElementWindow()).off("resize",this.onWindowResizeHandler)),this},a.ui.TextInputMenuSelectWidget.prototype.position=function(){var b=this.$container,c=a.ui.Element["static"].getRelativePosition(b,this.$element.offsetParent());return c.top+=b.height(),this.$element.css(c),this.setIdealSize(b.width()),this.clip(),this},a.ui.OutlineSelectWidget=function(b){b=b||{},a.ui.OutlineSelectWidget["super"].call(this,b),this.$element.addClass("oo-ui-outlineSelectWidget")},a.inheritClass(a.ui.OutlineSelectWidget,a.ui.SelectWidget),a.ui.ToggleSwitchWidget=function(b){a.ui.ToggleSwitchWidget["super"].call(this,b),a.ui.ToggleWidget.call(this,b),a.ui.TabIndexedElement.call(this,b),this.dragging=!1,this.dragStart=null,this.sliding=!1,this.$glow=$("<span>"),this.$grip=$("<span>"),this.$element.on({click:this.onClick.bind(this),keypress:this.onKeyPress.bind(this)}),this.$glow.addClass("oo-ui-toggleSwitchWidget-glow"),this.$grip.addClass("oo-ui-toggleSwitchWidget-grip"),this.$element.addClass("oo-ui-toggleSwitchWidget").attr("role","checkbox").append(this.$glow,this.$grip)},a.inheritClass(a.ui.ToggleSwitchWidget,a.ui.Widget),a.mixinClass(a.ui.ToggleSwitchWidget,a.ui.ToggleWidget),a.mixinClass(a.ui.ToggleSwitchWidget,a.ui.TabIndexedElement),a.ui.ToggleSwitchWidget.prototype.onClick=function(a){return this.isDisabled()||1!==a.which||this.setValue(!this.value),!1},a.ui.ToggleSwitchWidget.prototype.onKeyPress=function(b){return this.isDisabled()||b.which!==a.ui.Keys.SPACE&&b.which!==a.ui.Keys.ENTER||this.setValue(!this.value),!1}}(OO),OO.ui.ApexTheme=function(){OO.ui.ApexTheme["super"].call(this)},OO.inheritClass(OO.ui.ApexTheme,OO.ui.Theme),OO.ui.theme=new OO.ui.ApexTheme,function(){function a(a){return"\\u"+(a+65536).toString(16).slice(-4)}function b(b,c,d){var e;return b===c?a(b):(e=a(b)+"-"+a(c),d?"["+e+"]":e)}function c(a,b){var c,d,e,f,g,h,i,j,k;return c=56320,d=57343,e=55296+(a-65536>>10),g=56320+(a-65536&1023),f=55296+(b-65536>>10),h=56320+(b-65536&1023),e===f?[{hi:[e,f],lo:[g,h]}]:(i=[],j=55296+(a-65536+1023>>10),k=55296+(b-65536-1023>>10),j>e&&i.push({hi:[e,e],lo:[g,d]}),k>=j&&i.push({hi:[j,k],lo:[c,d]}),f>k&&i.push({hi:[f,f],lo:[c,h]}),i)}var d;d={},d.splitCharacters=function(a){return a.split(/(?![\uDC00-\uDFFF])/g)},d.charRangeArrayRegexp=function(d){var e,f,g,h,i,j,k,l,m=[],n=[],o=[];for(e=0;e<d.length;e++)if(k=d[e],"number"==typeof k&&65535>=k){if(k>=55296&&57343>=k)throw new Error("Surrogate: "+k.toString(16));if(k>1114111)throw new Error("Character code too high: "+k.toString(16));n.push(a(k))}else if("number"==typeof k&&k>65535)i=55296+(k-65536>>10),j=56320+(k-65536&1023),o.push(a(i)+a(j));else{if(g=k[0],h=k[1],g>h)throw new Error(g.toString(16)+" > "+h.toString(16));if(h>1114111)throw new Error("Character code too high: "+h.toString(16));if(h>=55296&&57343>=g)throw new Error("range includes surrogates: "+g.toString(16)+"-"+h.toString(16));for(65535>=h?n.push(b(g,h)):65535>=g&&h>65535?(n.push(b(g,65535)),m=c(65536,h)):g>65535&&(m=c(g,h)),f=0;f<m.length;f++)l=m[f],i=b(l.hi[0],l.hi[1],!0),j=b(l.lo[0],l.lo[1],!0),o.push(i+j)}return 1!==n.length||n[0].match(/-/)?n.length>0&&o.unshift("["+n.join("")+"]"):o.unshift(n[0]),o.join("|")},window.unicodeJS=d}(),unicodeJS.derivedcoreproperties={Alphabetic:[[65,90],[97,122],170,181,186,[192,214],[216,246],[248,705],[710,721],[736,740],748,750,837,[880,884],886,887,[890,893],895,902,[904,906],908,[910,929],[931,1013],[1015,1153],[1162,1327],[1329,1366],1369,[1377,1415],[1456,1469],1471,1473,1474,1476,1477,1479,[1488,1514],[1520,1522],[1552,1562],[1568,1623],[1625,1631],[1646,1747],[1749,1756],[1761,1768],[1773,1775],[1786,1788],1791,[1808,1855],[1869,1969],[1994,2026],2036,2037,2042,[2048,2071],[2074,2092],[2112,2136],[2208,2226],[2276,2281],[2288,2363],[2365,2380],[2382,2384],[2389,2403],[2417,2435],[2437,2444],2447,2448,[2451,2472],[2474,2480],2482,[2486,2489],[2493,2500],2503,2504,2507,2508,2510,2519,2524,2525,[2527,2531],2544,2545,[2561,2563],[2565,2570],2575,2576,[2579,2600],[2602,2608],2610,2611,2613,2614,2616,2617,[2622,2626],2631,2632,2635,2636,2641,[2649,2652],2654,[2672,2677],[2689,2691],[2693,2701],[2703,2705],[2707,2728],[2730,2736],2738,2739,[2741,2745],[2749,2757],[2759,2761],2763,2764,2768,[2784,2787],[2817,2819],[2821,2828],2831,2832,[2835,2856],[2858,2864],2866,2867,[2869,2873],[2877,2884],2887,2888,2891,2892,2902,2903,2908,2909,[2911,2915],2929,2946,2947,[2949,2954],[2958,2960],[2962,2965],2969,2970,2972,2974,2975,2979,2980,[2984,2986],[2990,3001],[3006,3010],[3014,3016],[3018,3020],3024,3031,[3072,3075],[3077,3084],[3086,3088],[3090,3112],[3114,3129],[3133,3140],[3142,3144],[3146,3148],3157,3158,3160,3161,[3168,3171],[3201,3203],[3205,3212],[3214,3216],[3218,3240],[3242,3251],[3253,3257],[3261,3268],[3270,3272],[3274,3276],3285,3286,3294,[3296,3299],3313,3314,[3329,3331],[3333,3340],[3342,3344],[3346,3386],[3389,3396],[3398,3400],[3402,3404],3406,3415,[3424,3427],[3450,3455],3458,3459,[3461,3478],[3482,3505],[3507,3515],3517,[3520,3526],[3535,3540],3542,[3544,3551],3570,3571,[3585,3642],[3648,3654],3661,3713,3714,3716,3719,3720,3722,3725,[3732,3735],[3737,3743],[3745,3747],3749,3751,3754,3755,[3757,3769],[3771,3773],[3776,3780],3782,3789,[3804,3807],3840,[3904,3911],[3913,3948],[3953,3969],[3976,3991],[3993,4028],[4096,4150],4152,[4155,4159],[4176,4194],[4197,4200],[4206,4230],4238,4252,4253,[4256,4293],4295,4301,[4304,4346],[4348,4680],[4682,4685],[4688,4694],4696,[4698,4701],[4704,4744],[4746,4749],[4752,4784],[4786,4789],[4792,4798],4800,[4802,4805],[4808,4822],[4824,4880],[4882,4885],[4888,4954],4959,[4992,5007],[5024,5108],[5121,5740],[5743,5759],[5761,5786],[5792,5866],[5870,5880],[5888,5900],[5902,5907],[5920,5939],[5952,5971],[5984,5996],[5998,6e3],6002,6003,[6016,6067],[6070,6088],6103,6108,[6176,6263],[6272,6314],[6320,6389],[6400,6430],[6432,6443],[6448,6456],[6480,6509],[6512,6516],[6528,6571],[6576,6601],[6656,6683],[6688,6750],[6753,6772],6823,[6912,6963],[6965,6979],[6981,6987],[7040,7081],[7084,7087],[7098,7141],[7143,7153],[7168,7221],[7245,7247],[7258,7293],[7401,7404],[7406,7411],7413,7414,[7424,7615],[7655,7668],[7680,7957],[7960,7965],[7968,8005],[8008,8013],[8016,8023],8025,8027,8029,[8031,8061],[8064,8116],[8118,8124],8126,[8130,8132],[8134,8140],[8144,8147],[8150,8155],[8160,8172],[8178,8180],[8182,8188],8305,8319,[8336,8348],8450,8455,[8458,8467],8469,[8473,8477],8484,8486,8488,[8490,8493],[8495,8505],[8508,8511],[8517,8521],8526,[8544,8584],[9398,9449],[11264,11310],[11312,11358],[11360,11492],[11499,11502],11506,11507,[11520,11557],11559,11565,[11568,11623],11631,[11648,11670],[11680,11686],[11688,11694],[11696,11702],[11704,11710],[11712,11718],[11720,11726],[11728,11734],[11736,11742],[11744,11775],11823,[12293,12295],[12321,12329],[12337,12341],[12344,12348],[12353,12438],[12445,12447],[12449,12538],[12540,12543],[12549,12589],[12593,12686],[12704,12730],[12784,12799],[13312,19893],[19968,40908],[40960,42124],[42192,42237],[42240,42508],[42512,42527],42538,42539,[42560,42606],[42612,42619],[42623,42653],[42655,42735],[42775,42783],[42786,42888],[42891,42894],[42896,42925],42928,42929,[42999,43009],[43011,43013],[43015,43018],[43020,43047],[43072,43123],[43136,43203],[43250,43255],43259,[43274,43306],[43312,43346],[43360,43388],[43392,43442],[43444,43455],43471,[43488,43492],[43494,43503],[43514,43518],[43520,43574],[43584,43597],[43616,43638],43642,[43646,43710],43712,43714,[43739,43741],[43744,43759],[43762,43765],[43777,43782],[43785,43790],[43793,43798],[43808,43814],[43816,43822],[43824,43866],[43868,43871],43876,43877,[43968,44010],[44032,55203],[55216,55238],[55243,55291],[63744,64109],[64112,64217],[64256,64262],[64275,64279],[64285,64296],[64298,64310],[64312,64316],64318,64320,64321,64323,64324,[64326,64433],[64467,64829],[64848,64911],[64914,64967],[65008,65019],[65136,65140],[65142,65276],[65313,65338],[65345,65370],[65382,65470],[65474,65479],[65482,65487],[65490,65495],[65498,65500],[65536,65547],[65549,65574],[65576,65594],65596,65597,[65599,65613],[65616,65629],[65664,65786],[65856,65908],[66176,66204],[66208,66256],[66304,66335],[66352,66378],[66384,66426],[66432,66461],[66464,66499],[66504,66511],[66513,66517],[66560,66717],[66816,66855],[66864,66915],[67072,67382],[67392,67413],[67424,67431],[67584,67589],67592,[67594,67637],67639,67640,67644,[67647,67669],[67680,67702],[67712,67742],[67840,67861],[67872,67897],[67968,68023],68030,68031,[68096,68099],68101,68102,[68108,68115],[68117,68119],[68121,68147],[68192,68220],[68224,68252],[68288,68295],[68297,68324],[68352,68405],[68416,68437],[68448,68466],[68480,68497],[68608,68680],[69632,69701],[69762,69816],[69840,69864],[69888,69938],[69968,70002],70006,[70016,70079],[70081,70084],70106,[70144,70161],[70163,70196],70199,[70320,70376],[70401,70403],[70405,70412],70415,70416,[70419,70440],[70442,70448],70450,70451,[70453,70457],[70461,70468],70471,70472,70475,70476,70487,[70493,70499],[70784,70849],70852,70853,70855,[71040,71093],[71096,71102],[71168,71230],71232,71236,[71296,71349],[71840,71903],71935,[72384,72440],[73728,74648],[74752,74862],[77824,78894],[92160,92728],[92736,92766],[92880,92909],[92928,92982],[92992,92995],[93027,93047],[93053,93071],[93952,94020],[94032,94078],[94099,94111],110592,110593,[113664,113770],[113776,113788],[113792,113800],[113808,113817],113822,[119808,119892],[119894,119964],119966,119967,119970,119973,119974,[119977,119980],[119982,119993],119995,[119997,120003],[120005,120069],[120071,120074],[120077,120084],[120086,120092],[120094,120121],[120123,120126],[120128,120132],120134,[120138,120144],[120146,120485],[120488,120512],[120514,120538],[120540,120570],[120572,120596],[120598,120628],[120630,120654],[120656,120686],[120688,120712],[120714,120744],[120746,120770],[120772,120779],[124928,125124],[126464,126467],[126469,126495],126497,126498,126500,126503,[126505,126514],[126516,126519],126521,126523,126530,126535,126537,126539,[126541,126543],126545,126546,126548,126551,126553,126555,126557,126559,126561,126562,126564,[126567,126570],[126572,126578],[126580,126583],[126585,126588],126590,[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[127280,127305],[127312,127337],[127344,127369],[131072,173782],[173824,177972],[177984,178205],[194560,195101]]},unicodeJS.derivedgeneralcategories={M:[[768,879],[1155,1161],[1425,1469],1471,1473,1474,1476,1477,1479,[1552,1562],[1611,1631],1648,[1750,1756],[1759,1764],1767,1768,[1770,1773],1809,[1840,1866],[1958,1968],[2027,2035],[2070,2073],[2075,2083],[2085,2087],[2089,2093],[2137,2139],[2276,2307],[2362,2364],[2366,2383],[2385,2391],2402,2403,[2433,2435],2492,[2494,2500],2503,2504,[2507,2509],2519,2530,2531,[2561,2563],2620,[2622,2626],2631,2632,[2635,2637],2641,2672,2673,2677,[2689,2691],2748,[2750,2757],[2759,2761],[2763,2765],2786,2787,[2817,2819],2876,[2878,2884],2887,2888,[2891,2893],2902,2903,2914,2915,2946,[3006,3010],[3014,3016],[3018,3021],3031,[3072,3075],[3134,3140],[3142,3144],[3146,3149],3157,3158,3170,3171,[3201,3203],3260,[3262,3268],[3270,3272],[3274,3277],3285,3286,3298,3299,[3329,3331],[3390,3396],[3398,3400],[3402,3405],3415,3426,3427,3458,3459,3530,[3535,3540],3542,[3544,3551],3570,3571,3633,[3636,3642],[3655,3662],3761,[3764,3769],3771,3772,[3784,3789],3864,3865,3893,3895,3897,3902,3903,[3953,3972],3974,3975,[3981,3991],[3993,4028],4038,[4139,4158],[4182,4185],[4190,4192],[4194,4196],[4199,4205],[4209,4212],[4226,4237],4239,[4250,4253],[4957,4959],[5906,5908],[5938,5940],5970,5971,6002,6003,[6068,6099],6109,[6155,6157],6313,[6432,6443],[6448,6459],[6576,6592],6600,6601,[6679,6683],[6741,6750],[6752,6780],6783,[6832,6846],[6912,6916],[6964,6980],[7019,7027],[7040,7042],[7073,7085],[7142,7155],[7204,7223],[7376,7378],[7380,7400],7405,[7410,7412],7416,7417,[7616,7669],[7676,7679],[8400,8432],[11503,11505],11647,[11744,11775],[12330,12335],12441,12442,[42607,42610],[42612,42621],42655,42736,42737,43010,43014,43019,[43043,43047],43136,43137,[43188,43204],[43232,43249],[43302,43309],[43335,43347],[43392,43395],[43443,43456],43493,[43561,43574],43587,43596,43597,[43643,43645],43696,[43698,43700],43703,43704,43710,43711,43713,[43755,43759],43765,43766,[44003,44010],44012,44013,64286,[65024,65039],[65056,65069],66045,66272,[66422,66426],[68097,68099],68101,68102,[68108,68111],[68152,68154],68159,68325,68326,[69632,69634],[69688,69702],[69759,69762],[69808,69818],[69888,69890],[69927,69940],70003,[70016,70018],[70067,70080],[70188,70199],[70367,70378],[70401,70403],70460,[70462,70468],70471,70472,[70475,70477],70487,70498,70499,[70502,70508],[70512,70516],[70832,70851],[71087,71093],[71096,71104],[71216,71232],[71339,71351],[92912,92916],[92976,92982],[94033,94078],[94095,94098],113821,113822,[119141,119145],[119149,119154],[119163,119170],[119173,119179],[119210,119213],[119362,119364],[125136,125142],[917760,917999]],Pc:[95,8255,8256,8276,65075,65076,[65101,65103],65343]},function(){var a=[48,57],b=[8204,8205],c=unicodeJS.characterclass={};
c.patterns={word:unicodeJS.charRangeArrayRegexp([].concat(unicodeJS.derivedcoreproperties.Alphabetic,unicodeJS.derivedgeneralcategories.M,[a],unicodeJS.derivedgeneralcategories.Pc,[b]))}}(),unicodeJS.TextString=function(a){this.clusters=unicodeJS.graphemebreak.splitClusters(a)},unicodeJS.TextString.prototype.read=function(a){var b=this.clusters[a];return void 0!==b?b:null},unicodeJS.TextString.prototype.getLength=function(){return this.clusters.length},unicodeJS.TextString.prototype.substring=function(a,b){var c=new unicodeJS.TextString("");return c.clusters=this.clusters.slice(a,b),c},unicodeJS.TextString.prototype.getString=function(){return this.clusters.join("")},unicodeJS.graphemebreakproperties={CR:[13],LF:[10],Control:[[0,9],11,12,[14,31],[127,159],173,[1536,1541],1564,1757,1807,6158,8203,8206,8207,[8232,8238],[8288,8303],65279,[65520,65531],69821,[113824,113827],[119155,119162],[917504,917759],[918e3,921599]],Extend:[[768,879],[1155,1161],[1425,1469],1471,1473,1474,1476,1477,1479,[1552,1562],[1611,1631],1648,[1750,1756],[1759,1764],1767,1768,[1770,1773],1809,[1840,1866],[1958,1968],[2027,2035],[2070,2073],[2075,2083],[2085,2087],[2089,2093],[2137,2139],[2276,2306],2362,2364,[2369,2376],2381,[2385,2391],2402,2403,2433,2492,2494,[2497,2500],2509,2519,2530,2531,2561,2562,2620,2625,2626,2631,2632,[2635,2637],2641,2672,2673,2677,2689,2690,2748,[2753,2757],2759,2760,2765,2786,2787,2817,2876,2878,2879,[2881,2884],2893,2902,2903,2914,2915,2946,3006,3008,3021,3031,3072,[3134,3136],[3142,3144],[3146,3149],3157,3158,3170,3171,3201,3260,3263,3266,3270,3276,3277,3285,3286,3298,3299,3329,3390,[3393,3396],3405,3415,3426,3427,3530,3535,[3538,3540],3542,3551,3633,[3636,3642],[3655,3662],3761,[3764,3769],3771,3772,[3784,3789],3864,3865,3893,3895,3897,[3953,3966],[3968,3972],3974,3975,[3981,3991],[3993,4028],4038,[4141,4144],[4146,4151],4153,4154,4157,4158,4184,4185,[4190,4192],[4209,4212],4226,4229,4230,4237,4253,[4957,4959],[5906,5908],[5938,5940],5970,5971,6002,6003,6068,6069,[6071,6077],6086,[6089,6099],6109,[6155,6157],6313,[6432,6434],6439,6440,6450,[6457,6459],6679,6680,6683,6742,[6744,6750],6752,6754,[6757,6764],[6771,6780],6783,[6832,6846],[6912,6915],6964,[6966,6970],6972,6978,[7019,7027],7040,7041,[7074,7077],7080,7081,[7083,7085],7142,7144,7145,7149,[7151,7153],[7212,7219],7222,7223,[7376,7378],[7380,7392],[7394,7400],7405,7412,7416,7417,[7616,7669],[7676,7679],8204,8205,[8400,8432],[11503,11505],11647,[11744,11775],[12330,12335],12441,12442,[42607,42610],[42612,42621],42655,42736,42737,43010,43014,43019,43045,43046,43204,[43232,43249],[43302,43309],[43335,43345],[43392,43394],43443,[43446,43449],43452,43493,[43561,43566],43569,43570,43573,43574,43587,43596,43644,43696,[43698,43700],43703,43704,43710,43711,43713,43756,43757,43766,44005,44008,44013,64286,[65024,65039],[65056,65069],65438,65439,66045,66272,[66422,66426],[68097,68099],68101,68102,[68108,68111],[68152,68154],68159,68325,68326,69633,[69688,69702],[69759,69761],[69811,69814],69817,69818,[69888,69890],[69927,69931],[69933,69940],70003,70016,70017,[70070,70078],[70191,70193],70196,70198,70199,70367,[70371,70378],70401,70460,70462,70464,70487,[70502,70508],[70512,70516],70832,[70835,70840],70842,70845,70847,70848,70850,70851,71087,[71090,71093],71100,71101,71103,71104,[71219,71226],71229,71231,71232,71339,71341,[71344,71349],71351,[92912,92916],[92976,92982],[94095,94098],113821,113822,119141,[119143,119145],[119150,119154],[119163,119170],[119173,119179],[119210,119213],[119362,119364],[125136,125142],[917760,917999]],RegionalIndicator:[[127462,127487]],SpacingMark:[2307,2363,[2366,2368],[2377,2380],2382,2383,2434,2435,2495,2496,2503,2504,2507,2508,2563,[2622,2624],2691,[2750,2752],2761,2763,2764,2818,2819,2880,2887,2888,2891,2892,3007,3009,3010,[3014,3016],[3018,3020],[3073,3075],[3137,3140],3202,3203,3262,3264,3265,3267,3268,3271,3272,3274,3275,3330,3331,3391,3392,[3398,3400],[3402,3404],3458,3459,3536,3537,[3544,3550],3570,3571,3635,3763,3902,3903,3967,4145,4155,4156,4182,4183,4228,6070,[6078,6085],6087,6088,[6435,6438],[6441,6443],6448,6449,[6451,6456],[6581,6583],6586,6681,6682,6741,6743,[6765,6770],6916,6965,6971,[6973,6977],6979,6980,7042,7073,7078,7079,7082,7143,[7146,7148],7150,7154,7155,[7204,7211],7220,7221,7393,7410,7411,43043,43044,43047,43136,43137,[43188,43203],43346,43347,43395,43444,43445,43450,43451,[43453,43456],43567,43568,43571,43572,43597,43755,43758,43759,43765,44003,44004,44006,44007,44009,44010,44012,69632,69634,69762,[69808,69810],69815,69816,69932,70018,[70067,70069],70079,70080,[70188,70190],70194,70195,70197,[70368,70370],70402,70403,70463,[70465,70468],70471,70472,[70475,70477],70498,70499,70833,70834,70841,70843,70844,70846,70849,71088,71089,[71096,71099],71102,[71216,71218],71227,71228,71230,71340,71342,71343,71350,[94033,94078],119142,119149],L:[[4352,4447],[43360,43388]],V:[[4448,4519],[55216,55238]],T:[[4520,4607],[55243,55291]],LV:[44032,44060,44088,44116,44144,44172,44200,44228,44256,44284,44312,44340,44368,44396,44424,44452,44480,44508,44536,44564,44592,44620,44648,44676,44704,44732,44760,44788,44816,44844,44872,44900,44928,44956,44984,45012,45040,45068,45096,45124,45152,45180,45208,45236,45264,45292,45320,45348,45376,45404,45432,45460,45488,45516,45544,45572,45600,45628,45656,45684,45712,45740,45768,45796,45824,45852,45880,45908,45936,45964,45992,46020,46048,46076,46104,46132,46160,46188,46216,46244,46272,46300,46328,46356,46384,46412,46440,46468,46496,46524,46552,46580,46608,46636,46664,46692,46720,46748,46776,46804,46832,46860,46888,46916,46944,46972,47e3,47028,47056,47084,47112,47140,47168,47196,47224,47252,47280,47308,47336,47364,47392,47420,47448,47476,47504,47532,47560,47588,47616,47644,47672,47700,47728,47756,47784,47812,47840,47868,47896,47924,47952,47980,48008,48036,48064,48092,48120,48148,48176,48204,48232,48260,48288,48316,48344,48372,48400,48428,48456,48484,48512,48540,48568,48596,48624,48652,48680,48708,48736,48764,48792,48820,48848,48876,48904,48932,48960,48988,49016,49044,49072,49100,49128,49156,49184,49212,49240,49268,49296,49324,49352,49380,49408,49436,49464,49492,49520,49548,49576,49604,49632,49660,49688,49716,49744,49772,49800,49828,49856,49884,49912,49940,49968,49996,50024,50052,50080,50108,50136,50164,50192,50220,50248,50276,50304,50332,50360,50388,50416,50444,50472,50500,50528,50556,50584,50612,50640,50668,50696,50724,50752,50780,50808,50836,50864,50892,50920,50948,50976,51004,51032,51060,51088,51116,51144,51172,51200,51228,51256,51284,51312,51340,51368,51396,51424,51452,51480,51508,51536,51564,51592,51620,51648,51676,51704,51732,51760,51788,51816,51844,51872,51900,51928,51956,51984,52012,52040,52068,52096,52124,52152,52180,52208,52236,52264,52292,52320,52348,52376,52404,52432,52460,52488,52516,52544,52572,52600,52628,52656,52684,52712,52740,52768,52796,52824,52852,52880,52908,52936,52964,52992,53020,53048,53076,53104,53132,53160,53188,53216,53244,53272,53300,53328,53356,53384,53412,53440,53468,53496,53524,53552,53580,53608,53636,53664,53692,53720,53748,53776,53804,53832,53860,53888,53916,53944,53972,54e3,54028,54056,54084,54112,54140,54168,54196,54224,54252,54280,54308,54336,54364,54392,54420,54448,54476,54504,54532,54560,54588,54616,54644,54672,54700,54728,54756,54784,54812,54840,54868,54896,54924,54952,54980,55008,55036,55064,55092,55120,55148,55176],LVT:[[44033,44059],[44061,44087],[44089,44115],[44117,44143],[44145,44171],[44173,44199],[44201,44227],[44229,44255],[44257,44283],[44285,44311],[44313,44339],[44341,44367],[44369,44395],[44397,44423],[44425,44451],[44453,44479],[44481,44507],[44509,44535],[44537,44563],[44565,44591],[44593,44619],[44621,44647],[44649,44675],[44677,44703],[44705,44731],[44733,44759],[44761,44787],[44789,44815],[44817,44843],[44845,44871],[44873,44899],[44901,44927],[44929,44955],[44957,44983],[44985,45011],[45013,45039],[45041,45067],[45069,45095],[45097,45123],[45125,45151],[45153,45179],[45181,45207],[45209,45235],[45237,45263],[45265,45291],[45293,45319],[45321,45347],[45349,45375],[45377,45403],[45405,45431],[45433,45459],[45461,45487],[45489,45515],[45517,45543],[45545,45571],[45573,45599],[45601,45627],[45629,45655],[45657,45683],[45685,45711],[45713,45739],[45741,45767],[45769,45795],[45797,45823],[45825,45851],[45853,45879],[45881,45907],[45909,45935],[45937,45963],[45965,45991],[45993,46019],[46021,46047],[46049,46075],[46077,46103],[46105,46131],[46133,46159],[46161,46187],[46189,46215],[46217,46243],[46245,46271],[46273,46299],[46301,46327],[46329,46355],[46357,46383],[46385,46411],[46413,46439],[46441,46467],[46469,46495],[46497,46523],[46525,46551],[46553,46579],[46581,46607],[46609,46635],[46637,46663],[46665,46691],[46693,46719],[46721,46747],[46749,46775],[46777,46803],[46805,46831],[46833,46859],[46861,46887],[46889,46915],[46917,46943],[46945,46971],[46973,46999],[47001,47027],[47029,47055],[47057,47083],[47085,47111],[47113,47139],[47141,47167],[47169,47195],[47197,47223],[47225,47251],[47253,47279],[47281,47307],[47309,47335],[47337,47363],[47365,47391],[47393,47419],[47421,47447],[47449,47475],[47477,47503],[47505,47531],[47533,47559],[47561,47587],[47589,47615],[47617,47643],[47645,47671],[47673,47699],[47701,47727],[47729,47755],[47757,47783],[47785,47811],[47813,47839],[47841,47867],[47869,47895],[47897,47923],[47925,47951],[47953,47979],[47981,48007],[48009,48035],[48037,48063],[48065,48091],[48093,48119],[48121,48147],[48149,48175],[48177,48203],[48205,48231],[48233,48259],[48261,48287],[48289,48315],[48317,48343],[48345,48371],[48373,48399],[48401,48427],[48429,48455],[48457,48483],[48485,48511],[48513,48539],[48541,48567],[48569,48595],[48597,48623],[48625,48651],[48653,48679],[48681,48707],[48709,48735],[48737,48763],[48765,48791],[48793,48819],[48821,48847],[48849,48875],[48877,48903],[48905,48931],[48933,48959],[48961,48987],[48989,49015],[49017,49043],[49045,49071],[49073,49099],[49101,49127],[49129,49155],[49157,49183],[49185,49211],[49213,49239],[49241,49267],[49269,49295],[49297,49323],[49325,49351],[49353,49379],[49381,49407],[49409,49435],[49437,49463],[49465,49491],[49493,49519],[49521,49547],[49549,49575],[49577,49603],[49605,49631],[49633,49659],[49661,49687],[49689,49715],[49717,49743],[49745,49771],[49773,49799],[49801,49827],[49829,49855],[49857,49883],[49885,49911],[49913,49939],[49941,49967],[49969,49995],[49997,50023],[50025,50051],[50053,50079],[50081,50107],[50109,50135],[50137,50163],[50165,50191],[50193,50219],[50221,50247],[50249,50275],[50277,50303],[50305,50331],[50333,50359],[50361,50387],[50389,50415],[50417,50443],[50445,50471],[50473,50499],[50501,50527],[50529,50555],[50557,50583],[50585,50611],[50613,50639],[50641,50667],[50669,50695],[50697,50723],[50725,50751],[50753,50779],[50781,50807],[50809,50835],[50837,50863],[50865,50891],[50893,50919],[50921,50947],[50949,50975],[50977,51003],[51005,51031],[51033,51059],[51061,51087],[51089,51115],[51117,51143],[51145,51171],[51173,51199],[51201,51227],[51229,51255],[51257,51283],[51285,51311],[51313,51339],[51341,51367],[51369,51395],[51397,51423],[51425,51451],[51453,51479],[51481,51507],[51509,51535],[51537,51563],[51565,51591],[51593,51619],[51621,51647],[51649,51675],[51677,51703],[51705,51731],[51733,51759],[51761,51787],[51789,51815],[51817,51843],[51845,51871],[51873,51899],[51901,51927],[51929,51955],[51957,51983],[51985,52011],[52013,52039],[52041,52067],[52069,52095],[52097,52123],[52125,52151],[52153,52179],[52181,52207],[52209,52235],[52237,52263],[52265,52291],[52293,52319],[52321,52347],[52349,52375],[52377,52403],[52405,52431],[52433,52459],[52461,52487],[52489,52515],[52517,52543],[52545,52571],[52573,52599],[52601,52627],[52629,52655],[52657,52683],[52685,52711],[52713,52739],[52741,52767],[52769,52795],[52797,52823],[52825,52851],[52853,52879],[52881,52907],[52909,52935],[52937,52963],[52965,52991],[52993,53019],[53021,53047],[53049,53075],[53077,53103],[53105,53131],[53133,53159],[53161,53187],[53189,53215],[53217,53243],[53245,53271],[53273,53299],[53301,53327],[53329,53355],[53357,53383],[53385,53411],[53413,53439],[53441,53467],[53469,53495],[53497,53523],[53525,53551],[53553,53579],[53581,53607],[53609,53635],[53637,53663],[53665,53691],[53693,53719],[53721,53747],[53749,53775],[53777,53803],[53805,53831],[53833,53859],[53861,53887],[53889,53915],[53917,53943],[53945,53971],[53973,53999],[54001,54027],[54029,54055],[54057,54083],[54085,54111],[54113,54139],[54141,54167],[54169,54195],[54197,54223],[54225,54251],[54253,54279],[54281,54307],[54309,54335],[54337,54363],[54365,54391],[54393,54419],[54421,54447],[54449,54475],[54477,54503],[54505,54531],[54533,54559],[54561,54587],[54589,54615],[54617,54643],[54645,54671],[54673,54699],[54701,54727],[54729,54755],[54757,54783],[54785,54811],[54813,54839],[54841,54867],[54869,54895],[54897,54923],[54925,54951],[54953,54979],[54981,55007],[55009,55035],[55037,55063],[55065,55091],[55093,55119],[55121,55147],[55149,55175],[55177,55203]]},function(){var a,b,c,d=unicodeJS.graphemebreakproperties,e="[^\\ud800-\\udfff]|[\\ud800-\\udbff][\\udc00-\\udfff]",f=unicodeJS.graphemebreak={},g={};for(a in d)g[a]=unicodeJS.charRangeArrayRegexp(d[a]);b=["\\r\\n",g.Control,"(?:"+g.L+")*(?:"+g.V+")+(?:"+g.T+")*","(?:"+g.L+")*(?:"+g.LV+")(?:"+g.V+")*(?:"+g.T+")*","(?:"+g.L+")*(?:"+g.LVT+")(?:"+g.T+")*","(?:"+g.L+")+","(?:"+g.T+")+","(?:"+g.RegionalIndicator+")+","(?:"+e+")(?:"+g.Extend+"|"+g.SpacingMark+")+",e],c=new RegExp("("+b.join("|")+")"),f.splitClusters=function(a){var b,d,e,f=[];for(d=a.split(c),b=0,e=d.length;e>b;b++)""!==d[b]&&f.push(d[b]);return f}}(),unicodeJS.wordbreakproperties={DoubleQuote:[34],SingleQuote:[39],HebrewLetter:[[1488,1514],[1520,1522],64285,[64287,64296],[64298,64310],[64312,64316],64318,64320,64321,64323,64324,[64326,64335]],CR:[13],LF:[10],Newline:[11,12,133,8232,8233],Extend:[[768,879],[1155,1161],[1425,1469],1471,1473,1474,1476,1477,1479,[1552,1562],[1611,1631],1648,[1750,1756],[1759,1764],1767,1768,[1770,1773],1809,[1840,1866],[1958,1968],[2027,2035],[2070,2073],[2075,2083],[2085,2087],[2089,2093],[2137,2139],[2276,2307],[2362,2364],[2366,2383],[2385,2391],2402,2403,[2433,2435],2492,[2494,2500],2503,2504,[2507,2509],2519,2530,2531,[2561,2563],2620,[2622,2626],2631,2632,[2635,2637],2641,2672,2673,2677,[2689,2691],2748,[2750,2757],[2759,2761],[2763,2765],2786,2787,[2817,2819],2876,[2878,2884],2887,2888,[2891,2893],2902,2903,2914,2915,2946,[3006,3010],[3014,3016],[3018,3021],3031,[3072,3075],[3134,3140],[3142,3144],[3146,3149],3157,3158,3170,3171,[3201,3203],3260,[3262,3268],[3270,3272],[3274,3277],3285,3286,3298,3299,[3329,3331],[3390,3396],[3398,3400],[3402,3405],3415,3426,3427,3458,3459,3530,[3535,3540],3542,[3544,3551],3570,3571,3633,[3636,3642],[3655,3662],3761,[3764,3769],3771,3772,[3784,3789],3864,3865,3893,3895,3897,3902,3903,[3953,3972],3974,3975,[3981,3991],[3993,4028],4038,[4139,4158],[4182,4185],[4190,4192],[4194,4196],[4199,4205],[4209,4212],[4226,4237],4239,[4250,4253],[4957,4959],[5906,5908],[5938,5940],5970,5971,6002,6003,[6068,6099],6109,[6155,6157],6313,[6432,6443],[6448,6459],[6576,6592],6600,6601,[6679,6683],[6741,6750],[6752,6780],6783,[6832,6846],[6912,6916],[6964,6980],[7019,7027],[7040,7042],[7073,7085],[7142,7155],[7204,7223],[7376,7378],[7380,7400],7405,[7410,7412],7416,7417,[7616,7669],[7676,7679],8204,8205,[8400,8432],[11503,11505],11647,[11744,11775],[12330,12335],12441,12442,[42607,42610],[42612,42621],42655,42736,42737,43010,43014,43019,[43043,43047],43136,43137,[43188,43204],[43232,43249],[43302,43309],[43335,43347],[43392,43395],[43443,43456],43493,[43561,43574],43587,43596,43597,[43643,43645],43696,[43698,43700],43703,43704,43710,43711,43713,[43755,43759],43765,43766,[44003,44010],44012,44013,64286,[65024,65039],[65056,65069],65438,65439,66045,66272,[66422,66426],[68097,68099],68101,68102,[68108,68111],[68152,68154],68159,68325,68326,[69632,69634],[69688,69702],[69759,69762],[69808,69818],[69888,69890],[69927,69940],70003,[70016,70018],[70067,70080],[70188,70199],[70367,70378],[70401,70403],70460,[70462,70468],70471,70472,[70475,70477],70487,70498,70499,[70502,70508],[70512,70516],[70832,70851],[71087,71093],[71096,71104],[71216,71232],[71339,71351],[92912,92916],[92976,92982],[94033,94078],[94095,94098],113821,113822,[119141,119145],[119149,119154],[119163,119170],[119173,119179],[119210,119213],[119362,119364],[125136,125142],[917760,917999]],RegionalIndicator:[[127462,127487]],Format:[173,[1536,1541],1564,1757,1807,6158,8206,8207,[8234,8238],[8288,8292],[8294,8303],65279,[65529,65531],69821,[113824,113827],[119155,119162],917505,[917536,917631]],Katakana:[[12337,12341],12443,12444,[12448,12538],[12540,12543],[12784,12799],[13008,13054],[13056,13143],[65382,65437],110592],ALetter:[[65,90],[97,122],170,181,186,[192,214],[216,246],[248,705],[710,721],[736,740],748,750,[880,884],886,887,[890,893],895,902,[904,906],908,[910,929],[931,1013],[1015,1153],[1162,1327],[1329,1366],1369,[1377,1415],1523,[1568,1610],1646,1647,[1649,1747],1749,1765,1766,1774,1775,[1786,1788],1791,1808,[1810,1839],[1869,1957],1969,[1994,2026],2036,2037,2042,[2048,2069],2074,2084,2088,[2112,2136],[2208,2226],[2308,2361],2365,2384,[2392,2401],[2417,2432],[2437,2444],2447,2448,[2451,2472],[2474,2480],2482,[2486,2489],2493,2510,2524,2525,[2527,2529],2544,2545,[2565,2570],2575,2576,[2579,2600],[2602,2608],2610,2611,2613,2614,2616,2617,[2649,2652],2654,[2674,2676],[2693,2701],[2703,2705],[2707,2728],[2730,2736],2738,2739,[2741,2745],2749,2768,2784,2785,[2821,2828],2831,2832,[2835,2856],[2858,2864],2866,2867,[2869,2873],2877,2908,2909,[2911,2913],2929,2947,[2949,2954],[2958,2960],[2962,2965],2969,2970,2972,2974,2975,2979,2980,[2984,2986],[2990,3001],3024,[3077,3084],[3086,3088],[3090,3112],[3114,3129],3133,3160,3161,3168,3169,[3205,3212],[3214,3216],[3218,3240],[3242,3251],[3253,3257],3261,3294,3296,3297,3313,3314,[3333,3340],[3342,3344],[3346,3386],3389,3406,3424,3425,[3450,3455],[3461,3478],[3482,3505],[3507,3515],3517,[3520,3526],3840,[3904,3911],[3913,3948],[3976,3980],[4256,4293],4295,4301,[4304,4346],[4348,4680],[4682,4685],[4688,4694],4696,[4698,4701],[4704,4744],[4746,4749],[4752,4784],[4786,4789],[4792,4798],4800,[4802,4805],[4808,4822],[4824,4880],[4882,4885],[4888,4954],[4992,5007],[5024,5108],[5121,5740],[5743,5759],[5761,5786],[5792,5866],[5870,5880],[5888,5900],[5902,5905],[5920,5937],[5952,5969],[5984,5996],[5998,6e3],[6176,6263],[6272,6312],6314,[6320,6389],[6400,6430],[6656,6678],[6917,6963],[6981,6987],[7043,7072],7086,7087,[7098,7141],[7168,7203],[7245,7247],[7258,7293],[7401,7404],[7406,7409],7413,7414,[7424,7615],[7680,7957],[7960,7965],[7968,8005],[8008,8013],[8016,8023],8025,8027,8029,[8031,8061],[8064,8116],[8118,8124],8126,[8130,8132],[8134,8140],[8144,8147],[8150,8155],[8160,8172],[8178,8180],[8182,8188],8305,8319,[8336,8348],8450,8455,[8458,8467],8469,[8473,8477],8484,8486,8488,[8490,8493],[8495,8505],[8508,8511],[8517,8521],8526,[8544,8584],[9398,9449],[11264,11310],[11312,11358],[11360,11492],[11499,11502],11506,11507,[11520,11557],11559,11565,[11568,11623],11631,[11648,11670],[11680,11686],[11688,11694],[11696,11702],[11704,11710],[11712,11718],[11720,11726],[11728,11734],[11736,11742],11823,12293,12347,12348,[12549,12589],[12593,12686],[12704,12730],[40960,42124],[42192,42237],[42240,42508],[42512,42527],42538,42539,[42560,42606],[42623,42653],[42656,42735],[42775,42783],[42786,42888],[42891,42894],[42896,42925],42928,42929,[42999,43009],[43011,43013],[43015,43018],[43020,43042],[43072,43123],[43138,43187],[43250,43255],43259,[43274,43301],[43312,43334],[43360,43388],[43396,43442],43471,[43520,43560],[43584,43586],[43588,43595],[43744,43754],[43762,43764],[43777,43782],[43785,43790],[43793,43798],[43808,43814],[43816,43822],[43824,43866],[43868,43871],43876,43877,[43968,44002],[44032,55203],[55216,55238],[55243,55291],[64256,64262],[64275,64279],[64336,64433],[64467,64829],[64848,64911],[64914,64967],[65008,65019],[65136,65140],[65142,65276],[65313,65338],[65345,65370],[65440,65470],[65474,65479],[65482,65487],[65490,65495],[65498,65500],[65536,65547],[65549,65574],[65576,65594],65596,65597,[65599,65613],[65616,65629],[65664,65786],[65856,65908],[66176,66204],[66208,66256],[66304,66335],[66352,66378],[66384,66421],[66432,66461],[66464,66499],[66504,66511],[66513,66517],[66560,66717],[66816,66855],[66864,66915],[67072,67382],[67392,67413],[67424,67431],[67584,67589],67592,[67594,67637],67639,67640,67644,[67647,67669],[67680,67702],[67712,67742],[67840,67861],[67872,67897],[67968,68023],68030,68031,68096,[68112,68115],[68117,68119],[68121,68147],[68192,68220],[68224,68252],[68288,68295],[68297,68324],[68352,68405],[68416,68437],[68448,68466],[68480,68497],[68608,68680],[69635,69687],[69763,69807],[69840,69864],[69891,69926],[69968,70002],70006,[70019,70066],[70081,70084],70106,[70144,70161],[70163,70187],[70320,70366],[70405,70412],70415,70416,[70419,70440],[70442,70448],70450,70451,[70453,70457],70461,[70493,70497],[70784,70831],70852,70853,70855,[71040,71086],[71168,71215],71236,[71296,71338],[71840,71903],71935,[72384,72440],[73728,74648],[74752,74862],[77824,78894],[92160,92728],[92736,92766],[92880,92909],[92928,92975],[92992,92995],[93027,93047],[93053,93071],[93952,94020],94032,[94099,94111],[113664,113770],[113776,113788],[113792,113800],[113808,113817],[119808,119892],[119894,119964],119966,119967,119970,119973,119974,[119977,119980],[119982,119993],119995,[119997,120003],[120005,120069],[120071,120074],[120077,120084],[120086,120092],[120094,120121],[120123,120126],[120128,120132],120134,[120138,120144],[120146,120485],[120488,120512],[120514,120538],[120540,120570],[120572,120596],[120598,120628],[120630,120654],[120656,120686],[120688,120712],[120714,120744],[120746,120770],[120772,120779],[124928,125124],[126464,126467],[126469,126495],126497,126498,126500,126503,[126505,126514],[126516,126519],126521,126523,126530,126535,126537,126539,[126541,126543],126545,126546,126548,126551,126553,126555,126557,126559,126561,126562,126564,[126567,126570],[126572,126578],[126580,126583],[126585,126588],126590,[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[127280,127305],[127312,127337],[127344,127369]],MidLetter:[58,183,727,903,1524,8231,65043,65109,65306],MidNum:[44,59,894,1417,1548,1549,1644,2040,8260,65040,65044,65104,65108,65292,65307],MidNumLet:[46,8216,8217,8228,65106,65287,65294],Numeric:[[48,57],[1632,1641],1643,[1776,1785],[1984,1993],[2406,2415],[2534,2543],[2662,2671],[2790,2799],[2918,2927],[3046,3055],[3174,3183],[3302,3311],[3430,3439],[3558,3567],[3664,3673],[3792,3801],[3872,3881],[4160,4169],[4240,4249],[6112,6121],[6160,6169],[6470,6479],[6608,6617],[6784,6793],[6800,6809],[6992,7001],[7088,7097],[7232,7241],[7248,7257],[42528,42537],[43216,43225],[43264,43273],[43472,43481],[43504,43513],[43600,43609],[44016,44025],[66720,66729],[69734,69743],[69872,69881],[69942,69951],[70096,70105],[70384,70393],[70864,70873],[71248,71257],[71360,71369],[71904,71913],[92768,92777],[93008,93017],[120782,120831]],ExtendNumLet:[95,8255,8256,8276,65075,65076,[65101,65103],65343]},function(){function a(a){var b,c;if("string"!=typeof a)return null;b=unicodeJS.splitCharacters(a)[0];for(c in e)if(e[c].test(b))return c;return null}var b,c=unicodeJS.wordbreakproperties,d=unicodeJS.wordbreak={},e={};for(b in c)e[b]=new RegExp(unicodeJS.charRangeArrayRegexp(c[b]));d.nextBreakOffset=function(a,b,c){return d.moveBreakOffset(1,a,b,c)},d.prevBreakOffset=function(a,b,c){return d.moveBreakOffset(-1,a,b,c)},d.moveBreakOffset=function(b,c,d,e){for(var f,g=d,h=b>0?0:-1;null!==c.read(g+h);)if(g+=b,unicodeJS.wordbreak.isBreak(c,g)){if(e&&(f=a(c.read(g-b+h)),"ALetter"!==f&&"Numeric"!==f&&"Katakana"!==f&&"HebrewLetter"!==f))continue;break}return g},d.isBreak=function(b,c){if(null===b.read(c-1)||null===b.read(c))return!0;var d=[],e=[],f=0,g=0;switch(e.push(a(b.read(c+g))),d.push(a(b.read(c-f-1))),!0){case"CR"===d[0]&&"LF"===e[0]:return!1;case"Newline"===d[0]||"CR"===d[0]||"LF"===d[0]:case"Newline"===e[0]||"CR"===e[0]||"LF"===e[0]:return!0}if("Extend"===e[0]||"Format"===e[0])return!1;for(;"Extend"===d[0]||"Format"===d[0];){if(f++,0>=c-f-1)return!0;d[d.length-1]=a(b.read(c-f-1))}if(!("ALetter"!==d[0]&&"HebrewLetter"!==d[0]||"ALetter"!==e[0]&&"HebrewLetter"!==e[0]))return!1;switch(f++,g++,e.push(a(b.read(c+g))),d.push(a(b.read(c-f-1))),!0){case!("ALetter"!==d[0]&&"HebrewLetter"!==d[0]||"ALetter"!==e[1]&&"HebrewLetter"!==e[1]||"MidLetter"!==e[0]&&"MidNumLet"!==e[0]&&"SingleQuote"!==e[0]):case!("ALetter"!==e[0]&&"HebrewLetter"!==e[0]||"ALetter"!==d[1]&&"HebrewLetter"!==d[1]||"MidLetter"!==d[0]&&"MidNumLet"!==d[0]&&"SingleQuote"!==d[0]):case"HebrewLetter"===d[0]&&"SingleQuote"===e[0]:case"HebrewLetter"===d[0]&&"DoubleQuote"===e[0]&&"HebrewLetter"===e[1]:case"HebrewLetter"===d[1]&&"DoubleQuote"===d[0]&&"HebrewLetter"===e[0]:case"Numeric"===d[0]&&"Numeric"===e[0]:case("ALetter"===d[0]||"HebrewLetter"===d[0])&&"Numeric"===e[0]:case"Numeric"===d[0]&&("ALetter"===e[0]||"HebrewLetter"===e[0]):return!1;case"Numeric"===e[0]&&"Numeric"===d[1]&&("MidNum"===d[0]||"MidNumLet"===d[0]||"SingleQuote"===d[0]):case"Numeric"===d[0]&&"Numeric"===e[1]&&("MidNum"===e[0]||"MidNumLet"===e[0]||"SingleQuote"===e[0]):return!1;case"Katakana"===d[0]&&"Katakana"===e[0]:return!1;case"ExtendNumLet"===e[0]&&("ALetter"===d[0]||"HebrewLetter"===d[0]||"Numeric"===d[0]||"Katakana"===d[0]||"ExtendNumLet"===d[0]):case"ExtendNumLet"===d[0]&&("ALetter"===e[0]||"HebrewLetter"===e[0]||"Numeric"===e[0]||"Katakana"===e[0]):return!1;case"RegionalIndicator"===d[0]&&"RegionalIndicator"===e[0]:return!1}return!0}}(),function(){function a(){if(void 0===b){var a,c=document.createElement("p"),d=document.createElement("p"),e=document.createTextNode("aa"),f=document.createTextNode("aa"),g=document.createRange();b={},c.appendChild(e),d.appendChild(f),document.body.appendChild(c),document.body.appendChild(d),g.setStart(e,1),g.setEnd(f,1),b.getClientRects=b.getBoundingClientRect=g.getClientRects().length>2,b.getBoundingClientRect||(g.setEnd(e,1),a=g.getBoundingClientRect(),b.getBoundingClientRect=0===a.top&&0===a.left),document.body.removeChild(c),document.body.removeChild(d)}return b}var b,c={};c.getClientRects=function(b){if(!a().getClientRects)return b.getClientRects();for(var c=[],d=b.endContainer,e=b.endOffset,f=document.createRange();d!==b.commonAncestorContainer;)f.setStart(d,0),f.setEnd(d,e),Array.prototype.push.apply(c,f.getClientRects()),e=Array.prototype.indexOf.call(d.parentNode.childNodes,d),d=d.parentNode;return f=b.cloneRange(),f.setEnd(d,e),Array.prototype.push.apply(c,f.getClientRects()),c},c.getBoundingClientRect=function(b){var c,d,e,f=this.getClientRects(b),g=b.getBoundingClientRect();if(0===f.length)return null;if(!a().getBoundingClientRect)return g;if(0===g.width&&0===g.height)return f[0];for(c=0,d=f.length;d>c;c++)e?(e.left=Math.min(e.left,f[c].left),e.top=Math.min(e.top,f[c].top),e.right=Math.max(e.right,f[c].right),e.bottom=Math.max(e.bottom,f[c].bottom)):e={left:f[c].left,top:f[c].top,right:f[c].right,bottom:f[c].bottom};return e&&(e.width=e.right-e.left,e.height=e.bottom-e.top),e},window.RangeFix=c}(),window.ve={},ve.now=function(){var a=window.performance,b=a&&a.timing&&a.timing.navigationStart;return b&&"function"==typeof a.now?function(){return b+a.now()}:Date.now}(),ve.isInstanceOfAny=function(a,b){for(var c=b.length;b[--c];)if(a instanceof b[c])return!0;return!1},ve.getProp=OO.getProp,ve.setProp=OO.setProp,ve.cloneObject=OO.cloneObject,ve.getObjectValues=OO.getObjectValues,ve.getObjectKeys=Object.keys,ve.compare=OO.compare,ve.copy=OO.copy,ve.copyDomElements=function(a,b){return a.map(function(a){return b?b.importNode(a,!0):a.cloneNode(!0)})},ve.isPlainObject=$.isPlainObject,ve.isEmptyObject=$.isEmptyObject,ve.indexOf=$.inArray,ve.extendObject=$.extend,ve.batchSplice=function(){function a(){var a=256,b=[];return b[a]="a",b.splice(a+1,0,"b"),"a"===b[a]}var b;return b=a()?Array.prototype.splice:function(a,b){var c,d,e,f;return c=Array.prototype.slice.call(arguments,2),d=this.slice(0,a),e=this.slice(a,b),f=this.slice(a+b),this.length=0,this.push.apply(this,d),this.push.apply(this,c),this.push.apply(this,f),e},function(a,c,d,e){var f,g,h=0,i=1024,j=d,k=[];if(f=Array.isArray(a)?b:a.splice,0===e.length)return f.call(a,c,d);for(;h<e.length;)g=f.apply(a,[h+c,j].concat(e.slice(h,h+i))),j>0&&(k=g),h+=i,j=0;return k}}(),ve.insertIntoArray=function(a,b,c){ve.batchSplice(a,b,0,c)},ve.batchPush=function(a,b){for(var c,d=0,e=1024;d<b.length;)c=a.push.apply(a,b.slice(d,d+e)),d+=e;return c},ve.log=ve.log||function(){},ve.error=ve.error||function(){},ve.dir=ve.dir||function(){},ve.debounce=function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)};c&&!d&&a.apply(e,f),clearTimeout(d),d=setTimeout(g,b)}},ve.selectElement=function(a){var b=OO.ui.Element["static"].getDocument(a).createRange(),c=OO.ui.Element["static"].getWindow(a).getSelection();b.setStart(a,0),b.setEnd(a,a.childNodes.length),c.removeAllRanges(),c.addRange(b)},ve.selectEnd=function(a){if(a.focus(),void 0!==a.selectionStart)a.selectionStart=a.selectionEnd=a.value.length;else if(a.createTextRange){var b=a.createTextRange();b.collapse(!1),b.select()}},ve.msg=function(){return ve.init.platform.getMessage.apply(ve.init.platform,arguments)},ve.config=function(){return ve.init.platform.getConfig.apply(ve.init.platform,arguments)},ve.isUnattachedCombiningMark=function(a){return/^[\u0300-\u036F]+$/.test(a)},ve.getByteOffset=function(a,b){return unicodeJS.graphemebreak.splitClusters(a).slice(0,b).join("").length},ve.getClusterOffset=function(a,b){return unicodeJS.graphemebreak.splitClusters(a.slice(0,b)).length},ve.graphemeSafeSubstring=function(a,b,c,d){var e=ve.getByteOffset(a,ve.getClusterOffset(a,b)),f=ve.getByteOffset(a,ve.getClusterOffset(a,c));return e!==f||d?(e>b&&d&&(e=ve.getByteOffset(a,ve.getClusterOffset(a,b)-1)),f>c&&!d&&(f=ve.getByteOffset(a,ve.getClusterOffset(a,c)-1)),a.slice(e,f)):""},ve.escapeHtml=function(){function a(a){switch(a){case"'":return"&#039;";case'"':return"&quot;";case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;"}}return function(b){return b.replace(/['"<>&]/g,a)}}(),ve.getHtmlAttributes=function(a){var b,c,d=[];if(!ve.isPlainObject(a)||ve.isEmptyObject(a))return"";for(b in a){if(c=a[b],c===!0)c=b;else if(c===!1)continue;d.push(b+'="'+ve.escapeHtml(String(c))+'"')}return d.join(" ")},ve.getOpeningHtmlTag=function(a,b){var c=ve.getHtmlAttributes(b);return"<"+a+(c?" "+c:"")+">"},ve.getDomAttributes=function(a){var b,c={};for(b=0;b<a.attributes.length;b++)c[a.attributes[b].name]=a.attributes[b].value;return c},ve.setDomAttributes=function(a,b,c){var d;if(a.setAttribute&&a.removeAttribute)for(d in b)c&&-1===c.indexOf(d.toLowerCase())||(void 0===b[d]||null===b[d]?a.removeAttribute(d):a.setAttribute(d,b[d]))},ve.getDomElementSummary=function(a,b){var c,d={type:a.nodeName.toLowerCase(),text:a.textContent,attributes:{},children:[]};if(b&&a.nodeType===Node.ELEMENT_NODE&&(d.html=a.outerHTML),a.attributes)for(c=0;c<a.attributes.length;c++)d.attributes[a.attributes[c].name]=a.attributes[c].value;if(a.childNodes)for(c=0;c<a.childNodes.length;c++)d.children.push(ve.getDomElementSummary(a.childNodes[c],b));return d},ve.convertDomElements=function(a){return a&&a.nodeType?ve.getDomElementSummary(a):a},ve.isBlockElement=function(a){var b="string"==typeof a?a:a.nodeName;return-1!==ve.indexOf(b.toLowerCase(),ve.elementTypes.block)},ve.isVoidElement=function(a){var b="string"==typeof a?a:a.nodeName;return-1!==ve.indexOf(b.toLowerCase(),ve.elementTypes["void"])},ve.elementTypes={block:["div","p","table","tbody","thead","tfoot","caption","th","tr","td","ul","ol","li","dl","dt","dd","h1","h2","h3","h4","h5","h6","hgroup","article","aside","body","nav","section","footer","header","figure","figcaption","fieldset","details","blockquote","hr","button","canvas","center","col","colgroup","embed","map","object","pre","progress","video"],"void":["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]},ve.createDocumentFromHtml=function(a){var b,c,d;
try{if(""===a&&(a="<body></body>"),b=(new DOMParser).parseFromString(a,"text/html"))return b}catch(e){}return c=$('<iframe frameborder="0" width="0" height="0" />'),d=c.get(0),document.documentElement.appendChild(d),b=d.contentWindow&&d.contentWindow.document||d.contentDocument,b.open(),b.write(a),b.close(),d.parentNode.removeChild(d),b.documentElement&&void 0!==b.documentElement.cloneNode(!1)||(b=document.implementation.createHTMLDocument(""),a=a.replace(/^\s*(?:<!doctype[^>]*>)?\s*<html[^>]*>/i,""),a=a.replace(/<\/html>\s*$/i,""),b.documentElement.innerHTML=a),b},ve.resolveUrl=function(a,b){var c,d;return"string"==typeof b?(c=ve.createDocumentFromHtml(""),d=c.createElement("base"),d.setAttribute("href",b),c.head.appendChild(d)):c=b,d=c.createElement("a"),d.setAttribute("href",a),d.href||a},ve.properInnerHtml=function(a){return ve.fixupPreBug(a).innerHTML},ve.properOuterHtml=function(a){return ve.fixupPreBug(a).outerHTML},ve.fixupPreBug=function(a){var b,c;return void 0===ve.isPreInnerHtmlBroken&&(b=document.createElement("div"),b.innerHTML="<pre>\n\n</pre>",ve.isPreInnerHtmlBroken="<pre>\n</pre>"===b.innerHTML),ve.isPreInnerHtmlBroken?(c=$(a).clone(),c.find("pre, textarea, listing").each(function(){var a;this.firstChild&&this.firstChild.nodeType===Node.TEXT_NODE&&(a=this.firstChild.data.match(/^(\r\n|\r|\n)/),a&&a[1]&&this.firstChild.insertData(0,a[1]))}),c.get(0)):a},ve.normalizeAttributeValue=function(a,b,c){var d=document.createElement(c||"div");return d.setAttribute(a,b),d.getAttribute(a)||""},ve.transformStyleAttributes=function(a,b){var c,d,e,f,g,h=["style","bgcolor","color"];for(c=(new DOMParser).parseFromString(a,"text/xml"),f=0,g=h.length;g>f;f++)d=b?"data-ve-"+h[f]:h[f],e=b?h[f]:"data-ve-"+h[f],$(c).find("["+d+"]").each(function(){var a,c,f=this.getAttribute(d);b&&(this.removeAttribute(d),c=ve.normalizeAttributeValue(e,f,this.nodeName),a=this.getAttribute(e)||"",a!==c)||this.setAttribute(e,f)});return $(c).find(":empty:not("+ve.elementTypes["void"].join(",")+")").each(function(){this.appendChild(c.createTextNode(""))}),(new XMLSerializer).serializeToString(c)},ve.parseXhtml=function(a){return void 0===ve.isStyleAttributeBroken&&(ve.isStyleAttributeBroken="color:#ffd"!==ve.normalizeAttributeValue("style","color:#ffd")),ve.isStyleAttributeBroken&&(a=ve.transformStyleAttributes(a,!1)),ve.createDocumentFromHtml(a)},ve.serializeXhtml=function(a){var b;return void 0===ve.isStyleAttributeBroken&&(ve.isStyleAttributeBroken="color:#ffd"!==ve.normalizeAttributeValue("style","color:#ffd")),ve.isStyleAttributeBroken?(b=(new XMLSerializer).serializeToString(ve.fixupPreBug(a.documentElement)),b=b.replace('<html xmlns="http://www.w3.org/1999/xhtml"',"<html"),ve.transformStyleAttributes(b,!0)):ve.properOuterHtml(a.documentElement)},ve.normalizeNode=function(a){var b,c,d;if(void 0===ve.isNormalizeBroken&&(b=document.createElement("p"),b.appendChild(document.createTextNode("Foo")),b.appendChild(document.createTextNode("Bar")),b.appendChild(document.createTextNode("")),b.normalize(),ve.isNormalizeBroken=1!==b.childNodes.length),ve.isNormalizeBroken)for(c=a.ownerDocument.createNodeIterator(a,NodeFilter.SHOW_TEXT,function(){return NodeFilter.FILTER_ACCEPT},!1);d=c.nextNode();)if(""!==d.data)for(;d.nextSibling&&d.nextSibling.nodeType===Node.TEXT_NODE;)d.appendData(d.nextSibling.data),d.parentNode.removeChild(d.nextSibling);else d.parentNode.removeChild(d);else a.normalize()},ve.translateRect=function(a,b,c){var d={};return void 0!==a.top&&(d.top=a.top+c),void 0!==a.bottom&&(d.bottom=a.bottom+c),void 0!==a.left&&(d.left=a.left+b),void 0!==a.right&&(d.right=a.right+b),void 0!==a.width&&(d.width=a.width),void 0!==a.height&&(d.height=a.height),d},ve.getStartAndEndRects=function(a){var b,c,d,e;if(!a||!a.length)return null;for(b=0,c=a.length;c>b;b++)!d||a[b].top<d.top?d=ve.extendObject({},a[b]):a[b].top===d.top&&(d.left=Math.min(d.left,a[b].left),d.right=Math.max(d.right,a[b].right),d.width=d.right-d.left),!e||a[b].bottom>e.bottom?e=ve.extendObject({},a[b]):a[b].bottom===e.bottom&&(e.left=Math.min(e.left,a[b].left),e.right=Math.max(e.right,a[b].right),e.width=d.right-d.left);return{start:d,end:e}},ve.getCommonAncestor=function(){var a,b,c,d,e,f=null,g=[],h=Array.prototype.slice.call(arguments);if(c=h.length,0===c)throw new Error("Need at least one node");for(a=0;c>a;a++){for(d=[],e=h[a];null!==e;)d.unshift(e),e=e.parentNode;if(0===d.length)return null;if(a>0&&d[0]!==g[g.length-1][0])return null;(null===f||f>d.length)&&(f=d.length),g.push(d)}for(a=1;f>a;a++)for(e=g[0][a],b=1;c>b;b++)if(e!==g[b][a])return g[0][a-1];return g[0][f-1]},ve.getOffsetPath=function(a,b,c){for(var d=[c];b!==a;){if(null===b.parentNode)throw ve.log(b,"is not a descendant of",a),new Error("Not a descendant");d.unshift(Array.prototype.indexOf.call(b.parentNode.childNodes,b)),b=b.parentNode}return d},ve.compareOffsetPaths=function(a,b){var c,d;for(c=0,d=Math.min(a.length,b.length);d>c;c++)if(a[c]!==b[c])return a[c]-b[c];return a.length-b.length},ve.compareDocumentOrder=function(a,b,c,d){var e=ve.getCommonAncestor(a,c);if(null===e)throw new Error("No common ancestor");return ve.compareOffsetPaths(ve.getOffsetPath(e,a,b),ve.getOffsetPath(e,c,d))},ve.getSystemPlatform=function(){return(ve.init.platform&&ve.init.platform.constructor||ve.init.Platform)["static"].getSystemPlatform()},ve.TriggerListener=function(a){this.commands=[],this.commandsByTrigger={},this.triggers={},this.setupCommands(a)},OO.initClass(ve.TriggerListener),ve.TriggerListener.prototype.setupCommands=function(a){var b,c,d,e;if(this.commands=a,a.length)for(b=this.commands.length-1;b>=0;b--)if(d=this.commands[b],e=ve.ui.triggerRegistry.lookup(d)){for(c=e.length-1;c>=0;c--)this.commandsByTrigger[e[c].toString()]=ve.ui.commandRegistry.lookup(d);this.triggers[d]=e}},ve.TriggerListener.prototype.getCommands=function(){return this.commands},ve.TriggerListener.prototype.getCommandByTrigger=function(a){return this.commandsByTrigger[a]},ve.TriggerListener.prototype.getTriggers=function(a){return this.triggers[a]},function(){var a=$.Callbacks("memory"),b=[];ve.track=function(c,d){b.push({topic:c,timeStamp:ve.now(),data:d}),a.fire(b)},ve.trackSubscribe=function(b,c){var d=0;a.add(function(a){for(var e;d<a.length;d++)e=a[d],0===e.topic.indexOf(b)&&c.call(e,e.topic,e.data)})},ve.trackSubscribeAll=function(a){ve.trackSubscribe("",a)}}(),ve.init={},ve.init.Platform=function(){OO.EventEmitter.call(this)},OO.mixinClass(ve.init.Platform,OO.EventEmitter),ve.init.Platform["static"].getSystemPlatform=function(){var a=["win","mac","linux","sunos","solaris","iphone"],b=new RegExp("("+a.join("|")+")").exec(window.navigator.platform.toLowerCase());return b?b[1]:void 0},ve.init.Platform["static"].isInternetExplorer=function(){return-1!==navigator.userAgent.indexOf("Trident")||-1!==navigator.userAgent.indexOf("Edge")},ve.init.Platform.prototype.getExternalLinkUrlProtocolsRegExp=function(){throw new Error("ve.init.Platform.getExternalLinkUrlProtocolsRegExp must be overridden in subclass")},ve.init.Platform.prototype.getConfig=function(){throw new Error("ve.init.Platform.getConfig must be overridden in subclass")},ve.init.Platform.prototype.addMessages=function(){throw new Error("ve.init.Platform.addMessages must be overridden in subclass")},ve.init.Platform.prototype.getMessage=function(){throw new Error("ve.init.Platform.getMessage must be overridden in subclass")},ve.init.Platform.prototype.addParsedMessages=function(){throw new Error("ve.init.Platform.addParsedMessages must be overridden in subclass")},ve.init.Platform.prototype.getParsedMessage=function(){throw new Error("ve.init.Platform.getParsedMessage must be overridden in subclass")},ve.init.Platform.prototype.getUserLanguages=function(){throw new Error("ve.init.Platform.getUserLanguages must be overridden in subclass")},ve.init.Platform.prototype.getMediaSources=function(){throw new Error("ve.init.Platform.getMediaSources must be overridden in subclass")},ve.init.Platform.prototype.getLanguageCodes=function(){throw new Error("ve.init.Platform.getLanguageCodes must be overridden in subclass")},ve.init.Platform.prototype.getLanguageName=function(){throw new Error("ve.init.Platform.getLanguageName must be overridden in subclass")},ve.init.Platform.prototype.getLanguageAutonym=function(){throw new Error("ve.init.Platform.getLanguageAutonym must be overridden in subclass")},ve.init.Platform.prototype.getLanguageDirection=function(){throw new Error("ve.init.Platform.getLanguageDirection must be overridden in subclass")},ve.init.Platform.prototype.initialize=function(){return $.Deferred().resolve().promise()},ve.init.Platform.prototype.getInitializedPromise=function(){return this.initialized||(this.initialized=this.initialize()),this.initialized},ve.init.Target=function(a){OO.ui.Element.call(this),OO.EventEmitter.call(this),this.surfaces=[],this.surface=null,this.toolbar=null,this.toolbarConfig=a,this.documentTriggerListener=new ve.TriggerListener(this.constructor["static"].documentCommands),this.targetTriggerListener=new ve.TriggerListener(this.constructor["static"].targetCommands),this.$element.addClass("ve-init-target"),ve.init.platform.constructor["static"].isInternetExplorer()&&this.$element.addClass("ve-init-target-ie"),this.onDocumentKeyDownHandler=this.onDocumentKeyDown.bind(this),this.onTargetKeyDownHandler=this.onTargetKeyDown.bind(this),this.bindHandlers(),ve.init.target=this},OO.inheritClass(ve.init.Target,OO.ui.Element),OO.mixinClass(ve.init.Target,OO.EventEmitter),ve.init.Target["static"].toolbarGroups=[{header:OO.ui.deferMsg("visualeditor-toolbar-history"),include:["undo","redo"]},{header:OO.ui.deferMsg("visualeditor-toolbar-paragraph-format"),type:"menu",indicator:"down",title:OO.ui.deferMsg("visualeditor-toolbar-format-tooltip"),include:[{group:"format"}],promote:["paragraph"],demote:["preformatted","blockquote"]},{header:OO.ui.deferMsg("visualeditor-toolbar-text-style"),title:OO.ui.deferMsg("visualeditor-toolbar-style-tooltip"),include:["bold","italic"]},{header:OO.ui.deferMsg("visualeditor-toolbar-text-style"),type:"list",indicator:"down",icon:"text-style",title:OO.ui.deferMsg("visualeditor-toolbar-style-tooltip"),include:[{group:"textStyle"},"language","clear"],demote:["strikethrough","code","underline","language","clear"]},{header:OO.ui.deferMsg("visualeditor-linkinspector-title"),include:["link"]},{header:OO.ui.deferMsg("visualeditor-toolbar-structure"),type:"list",icon:"bullet-list",indicator:"down",include:[{group:"structure"}],demote:["outdent","indent"]},{header:OO.ui.deferMsg("visualeditor-toolbar-insert"),type:"list",icon:"insert",label:"",title:OO.ui.deferMsg("visualeditor-toolbar-insert"),indicator:"down",include:"*",demote:["specialcharacter"]},{header:OO.ui.deferMsg("visualeditor-toolbar-table"),type:"list",icon:"table-insert",indicator:"down",include:[{group:"table"}],demote:["deleteTable"]}],ve.init.Target["static"].documentCommands=["commandHelp"],ve.init.Target["static"].targetCommands=["findAndReplace","findNext","findPrevious"],ve.init.Target["static"].excludeCommands=[],ve.init.Target["static"].importRules={external:{blacklist:["textStyle/span","alienInline","alienBlock","comment"]},all:null},ve.init.Target.prototype.bindHandlers=function(){$(this.getElementDocument()).on("keydown",this.onDocumentKeyDownHandler),this.$element.on("keydown",this.onTargetKeyDownHandler)},ve.init.Target.prototype.unbindHandlers=function(){$(this.getElementDocument()).off("keydown",this.onDocumentKeyDownHandler),this.$element.off("keydown",this.onTargetKeyDownHandler)},ve.init.Target.prototype.destroy=function(){this.clearSurfaces(),this.toolbar&&(this.toolbar.destroy(),this.toolbar=null),this.$element.remove(),this.unbindHandlers(),ve.init.target=null},ve.init.Target.prototype.onDocumentKeyDown=function(a){var b,c=new ve.ui.Trigger(a);c.isComplete()&&(b=this.documentTriggerListener.getCommandByTrigger(c.toString()),b&&b.execute(this.getSurface())&&a.preventDefault())},ve.init.Target.prototype.onTargetKeyDown=function(a){var b,c=new ve.ui.Trigger(a);c.isComplete()&&(b=this.targetTriggerListener.getCommandByTrigger(c.toString()),b&&b.execute(this.getSurface())&&a.preventDefault())},ve.init.Target.prototype.createSurface=function(a,b){return b=ve.extendObject({excludeCommands:OO.simpleArrayUnion(this.constructor["static"].excludeCommands,this.constructor["static"].documentCommands,this.constructor["static"].targetCommands),importRules:this.constructor["static"].importRules},b),new ve.ui.DesktopSurface(a,b)},ve.init.Target.prototype.addSurface=function(a,b){var c=this.createSurface(a,b);return this.surfaces.push(c),c.getView().connect(this,{focus:this.onSurfaceViewFocus.bind(this,c)}),c},ve.init.Target.prototype.clearSurfaces=function(){for(;this.surfaces.length;)this.surfaces.pop().destroy()},ve.init.Target.prototype.onSurfaceViewFocus=function(a){this.setSurface(a)},ve.init.Target.prototype.setSurface=function(a){a!==this.surface&&(this.surface=a,this.setupToolbar(a))},ve.init.Target.prototype.getSurface=function(){return this.surface},ve.init.Target.prototype.getToolbar=function(){return this.toolbar||(this.toolbar=new ve.ui.TargetToolbar(this,this.toolbarConfig)),this.toolbar},ve.init.Target.prototype.setupToolbar=function(a){this.getToolbar().setup(this.constructor["static"].toolbarGroups,a),this.getToolbar().$element.insertBefore(a.$element),this.getToolbar().$bar.append(a.getToolbarDialogs().$element)},ve.init.sa={},ve.init.sa.Platform=function(){ve.init.Platform.call(this),this.externalLinkUrlProtocolsRegExp=/^https?\:\/\//,this.messagePaths=[],this.parsedMessages={},this.userLanguages=["en"]},OO.inheritClass(ve.init.sa.Platform,ve.init.Platform),ve.init.sa.Platform.prototype.getExternalLinkUrlProtocolsRegExp=function(){return this.externalLinkUrlProtocolsRegExp},ve.init.sa.Platform.prototype.addMessagePath=function(a){this.messagePaths.push(a)},ve.init.sa.Platform.prototype.getMessagePaths=function(){return this.messagePaths},ve.init.sa.Platform.prototype.addMessages=function(a){$.i18n().load(a,$.i18n().locale)},ve.init.sa.Platform.prototype.getMessage=$.i18n,ve.init.sa.Platform.prototype.addParsedMessages=function(a){for(var b in a)this.parsedMessages[b]=a[b]},ve.init.sa.Platform.prototype.getParsedMessage=function(a){return Object.prototype.hasOwnProperty.call(this.parsedMessages,a)?this.parsedMessages[a]:this.getMessage(a).replace(/['"<>&]/g,function(a){switch(a){case"'":return"&#039;";case'"':return"&quot;";case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;"}})},ve.init.sa.Platform.prototype.getLanguageCodes=function(){return Object.keys($.uls.data.getAutonyms())},ve.init.sa.Platform.prototype.getLanguageName=$.uls.data.getAutonym,ve.init.sa.Platform.prototype.getLanguageAutonym=$.uls.data.getAutonym,ve.init.sa.Platform.prototype.getLanguageDirection=$.uls.data.getDir,ve.init.sa.Platform.prototype.getUserLanguages=function(){return this.userLanguages},ve.init.sa.Platform.prototype.initialize=function(){var a,b,c,d,e,f,g,h,i=this.getMessagePaths(),j=$.i18n().locale,k=[j,"en"],l={},m=[],n=$.i18n.fallbacks[j];if(!n)for(f=j.split("-"),f.pop();f.length&&!n;)e=f.join("-"),k.push(e),n=$.i18n.fallbacks[e],f.pop();for(n&&(k=k.concat(n)),this.userLanguages=k,a=0,b=k.length;b>a;a++)if(!l[k[a]])for(l[k[a]]=!0,g=k[a].toLowerCase()+".json",c=0,d=i.length;d>c;c++)h=$.Deferred(),$.i18n().load(i[c]+g,k[a]).always(h.resolve),m.push(h.promise());return $.when.apply($,m)},ve.init.platform=new ve.init.sa.Platform,OO.ui.getUserLanguages=ve.init.platform.getUserLanguages.bind(ve.init.platform),OO.ui.msg=ve.init.platform.getMessage.bind(ve.init.platform),ve.init.sa.Target=function(a){switch(ve.init.Target.call(this,{shadow:!0,actions:!0,floatable:!0}),this.surfaceType=a||this.constructor["static"].defaultSurfaceType,this.actions=null,this.surfaceType){case"desktop":this.surfaceClass=ve.ui.DesktopSurface;break;case"mobile":this.surfaceClass=ve.ui.MobileSurface;break;default:throw new Error("Unknown surfaceType: "+this.surfaceType)}this.$element.addClass("ve-init-sa-target ve-init-sa-target-"+this.surfaceType)},OO.inheritClass(ve.init.sa.Target,ve.init.Target),ve.init.sa.Target["static"].defaultSurfaceType="desktop",ve.init.sa.Target.prototype.addSurface=function(){var a=ve.init.sa.Target["super"].prototype.addSurface.apply(this,arguments);return this.$element.append($("<div>").append(a.$element)),this.getSurface()||this.setSurface(a),a.initialize(),a},ve.init.sa.Target.prototype.createSurface=function(a,b){return b=ve.extendObject({excludeCommands:OO.simpleArrayUnion(this.constructor["static"].excludeCommands,this.constructor["static"].documentCommands,this.constructor["static"].targetCommands),importRules:this.constructor["static"].importRules},b),new this.surfaceClass(a,b)},ve.init.sa.Target.prototype.setupToolbar=function(a){ve.init.sa.Target["super"].prototype.setupToolbar.call(this,a),this.getToolbar().initialized||(this.getToolbar().$element.addClass("ve-init-sa-target-toolbar"),this.actions=new ve.ui.TargetToolbar(this),this.getToolbar().$actions.append(this.actions.$element)),this.getToolbar().initialize(),this.actions.setup([{type:"list",icon:"menu",title:ve.msg("visualeditor-pagemenu-tooltip"),include:["findAndReplace","commandHelp"]}],this.getSurface()),"mobile"===this.surfaceType&&this.getToolbar().$bar.append(a.context.$element)},ve.Range=function(a,b){this.from=a||0,this.to=void 0===b?this.from:b,this.start=this.from<this.to?this.from:this.to,this.end=this.from<this.to?this.to:this.from},OO.initClass(ve.Range),ve.Range["static"].newFromJSON=function(a){return this.newFromHash(JSON.parse(a))},ve.Range["static"].newFromHash=function(a){return new ve.Range(a.from,a.to)},ve.Range["static"].newCoveringRange=function(a,b){var c,d,e,f;if(!a||0===a.length)throw new Error("newCoveringRange() requires at least one range");for(c=a[0].start,d=a[0].end,e=1;e<a.length;e++)a[e].start<c&&(c=a[e].start),a[e].end>d&&(d=a[e].end);return f=b?new ve.Range(d,c):new ve.Range(c,d)},ve.Range.prototype.clone=function(){return new this.constructor(this.from,this.to)},ve.Range.prototype.containsOffset=function(a){return a>=this.start&&a<this.end},ve.Range.prototype.containsRange=function(a){return a.start>=this.start&&a.end<=this.end},ve.Range.prototype.getLength=function(){return this.end-this.start},ve.Range.prototype.flip=function(){return new ve.Range(this.to,this.from)},ve.Range.prototype.translate=function(a){return new ve.Range(this.from+a,this.to+a)},ve.Range.prototype.equals=function(a){return a&&this.from===a.from&&this.to===a.to},ve.Range.prototype.equalsSelection=function(a){return a&&this.end===a.end&&this.start===a.start},ve.Range.prototype.truncate=function(a){return a>=0?new ve.Range(this.start,Math.min(this.start+a,this.end)):new ve.Range(Math.max(this.end+a,this.start),this.end)},ve.Range.prototype.expand=function(a){return ve.Range["static"].newCoveringRange([this,a],this.isBackwards())},ve.Range.prototype.isCollapsed=function(){return this.from===this.to},ve.Range.prototype.isBackwards=function(){return this.from>this.to},ve.Range.prototype.toJSON=function(){return{type:"range",from:this.from,to:this.to}},ve.Node=function(){this.type=this.constructor["static"].name,this.parent=null,this.root=null,this.doc=null},ve.Node.prototype.getChildNodeTypes=function(){throw new Error("ve.Node.getChildNodeTypes must be overridden in subclass")},ve.Node.prototype.getParentNodeTypes=function(){throw new Error("ve.Node.getParentNodeTypes must be overridden in subclass")},ve.Node.prototype.isAllowedChildNodeType=function(a){var b=this.getChildNodeTypes();return null===b||-1!==ve.indexOf(a,b)},ve.Node.prototype.isAllowedParentNodeType=function(a){var b=this.getParentNodeTypes();return null===b||-1!==ve.indexOf(a,b)},ve.Node.prototype.getSuggestedParentNodeTypes=function(){throw new Error("ve.Node.getSuggestedParentNodeTypes must be overridden in subclass")},ve.Node.prototype.canHaveChildren=function(){throw new Error("ve.Node.canHaveChildren must be overridden in subclass")},ve.Node.prototype.canHaveChildrenNotContent=function(){throw new Error("ve.Node.canHaveChildrenNotContent must be overridden in subclass")},ve.Node.prototype.canContainContent=function(){throw new Error("ve.Node.canContainContent must be overridden in subclass")},ve.Node.prototype.isContent=function(){throw new Error("ve.Node.isContent must be overridden in subclass")},ve.Node.prototype.isWrapped=function(){throw new Error("ve.Node.isWrapped must be overridden in subclass")},ve.Node.prototype.isFocusable=function(){throw new Error("ve.Node.isFocusable must be overridden in subclass")},ve.Node.prototype.hasSignificantWhitespace=function(){throw new Error("ve.Node.hasSignificantWhitespace must be overridden in subclass")},ve.Node.prototype.handlesOwnChildren=function(){throw new Error("ve.Node.handlesOwnChildren must be overridden in subclass")},ve.Node.prototype.getLength=function(){throw new Error("ve.Node.getLength must be overridden in subclass")},ve.Node.prototype.getOffset=function(){throw new Error("ve.Node.getOffset must be overridden in subclass")},ve.Node.prototype.getRange=function(a){var b=this.getOffset()+(this.isWrapped()?1:0),c=new ve.Range(b,b+this.getLength());return a?c.flip():c},ve.Node.prototype.getOuterRange=function(a){var b=new ve.Range(this.getOffset(),this.getOffset()+this.getOuterLength());return a?b.flip():b},ve.Node.prototype.getOuterLength=function(){return this.getLength()+(this.isWrapped()?2:0)},ve.Node.prototype.getType=function(){return this.type},ve.Node.prototype.getParent=function(){return this.parent},ve.Node.prototype.getRoot=function(){return this.root},ve.Node.prototype.setRoot=function(a){a!==this.root&&(this.root=a,this.emit(this.getRoot()?"root":"unroot"))},ve.Node.prototype.getDocument=function(){return this.doc},ve.Node.prototype.setDocument=function(a){this.doc=a},ve.Node.prototype.attach=function(a){this.parent=a,this.setRoot(a.getRoot()),this.setDocument(a.getDocument()),this.emit("attach",a)},ve.Node.prototype.detach=function(){var a=this.parent;this.parent=null,this.setRoot(null),this.setDocument(null),this.emit("detach",a)},ve.Node.prototype.traverseUpstream=function(a){for(var b=this;b&&a(b)!==!1;)b=b.getParent()},ve.BranchNode=function(a){this.children=Array.isArray(a)?a:[]},ve.BranchNode.prototype.hasChildren=function(){return!0},ve.BranchNode.prototype.getChildren=function(){return this.children},ve.BranchNode.prototype.indexOf=function(a){return ve.indexOf(a,this.children)},ve.BranchNode.prototype.setRoot=function(a){if(a!==this.root){this.root=a;for(var b=0;b<this.children.length;b++)this.children[b].setRoot(a)}},ve.BranchNode.prototype.setDocument=function(a){if(a!==this.doc){this.doc=a;for(var b=0;b<this.children.length;b++)this.children[b].setDocument(a)}},ve.BranchNode.prototype.getNodeFromOffset=function(a,b){if(0===a)return this;if(this.children.length){var c,d,e,f,g=0;for(c=0,d=this.children.length;d>c;c++){if(f=this.children[c],a===g)return this;if(e=f.getOuterLength(),a>=g&&g+e>a)return!b&&f.hasChildren()&&f.getChildren().length?this.getNodeFromOffset.call(f,a-g-1):f;g+=e}if(a===g)return this}return null},ve.LeafNode=function(){},ve.LeafNode.prototype.hasChildren=function(){return!1},ve.Document=function(a){OO.EventEmitter.call(this),this.documentNode=a},OO.mixinClass(ve.Document,OO.EventEmitter),ve.Document.prototype.getDocumentNode=function(){return this.documentNode},ve.Document.prototype.getBranchNodeFromOffset=function(a){var b=this.getDocumentNode().getNodeFromOffset(a);return b&&!b.hasChildren()&&(b=b.getParent()),b},ve.Document.prototype.selectNodes=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=this.getDocumentNode(),t=[],u=a.start,v=a.end,w=[{node:s,index:0,startOffset:0}],x=w[0],y=!1;if(b=b||"leaves","leaves"!==b&&"branches"!==b&&"covered"!==b&&"siblings"!==b)throw new Error("Invalid mode: "+b);if(0>u||u>s.getLength())throw new Error("Invalid start offset: "+u);if(0>v||v>s.getLength())throw new Error("Invalid end offset: "+v);if(!s.children||0===s.children.length)return m=new ve.Range(0,s.getLength()),[{node:s,range:new ve.Range(u,v),index:0,nodeRange:m,nodeOuterRange:m}];f=s.children[0].isWrapped()?1:0;do{if(c=x.node.children[x.index],d=x.node.children[x.index-1],e=x.node.children[x.index+1],g=f+c.getLength(),i=u>=f&&g>=u,j=v>=f&&g>=v,o=c.isWrapped(),p=d?!d.isWrapped():!1,q=e?!e.isWrapped():!1,r=(0===c.getLength()||c.handlesOwnChildren())&&!c.isContent()&&!c.canContainContent(),k=(o?u===f-1:u===f)&&!p,l=(o?v===g+1:v===g)&&!q,n=new ve.Range(x.startOffset,x.startOffset+x.node.getLength()),o&&v===f-1&&0===x.index)return o=x.node.isWrapped(),t.push({node:x.node,indexInNode:0,range:new ve.Range(v,v),nodeRange:n,nodeOuterRange:new ve.Range(n.start-o,n.end+o)}),h=w[w.length-2],h&&(t[t.length-1].index=h.index),t;if(u===v&&(k||l)&&o)return o=x.node.isWrapped(),t=[{node:x.node,indexInNode:x.index+(l?1:0),range:new ve.Range(u,v),nodeRange:n,nodeOuterRange:new ve.Range(n.start-o,n.end+o)}],h=w[w.length-2],h&&(t[0].index=h.index),t;if(k){if(("leaves"===b||"covered"===b&&j||"branches"===b&&c.canHaveChildrenNotContent())&&c.children&&c.children.length&&!c.handlesOwnChildren()){x={node:c,index:0,startOffset:f},w.push(x),y=!0,c.children[0].isWrapped()&&f++;continue}if(j)return[{node:c,range:new ve.Range(u,v),index:x.index,nodeRange:new ve.Range(f,g),nodeOuterRange:new ve.Range(f-o,g+o),parentOuterRange:new ve.Range(n.start-x.node.isWrapped(),n.end+x.node.isWrapped())}];t.push({node:c,index:x.index,nodeRange:new ve.Range(f,g),nodeOuterRange:new ve.Range(f-o,g+o),parentOuterRange:new ve.Range(n.start-x.node.isWrapped(),n.end+x.node.isWrapped())}),y=!0}else{if(i&&j){if(c.children&&c.children.length&&("branches"!==b||c.canHaveChildrenNotContent())){x={node:c,index:0,startOffset:f},w.push(x),c.children[0].isWrapped()&&f++;continue}return t=[{node:c,range:new ve.Range(u,v),index:x.index,nodeRange:new ve.Range(f,g),nodeOuterRange:new ve.Range(f-o,g+o),parentOuterRange:new ve.Range(n.start-x.node.isWrapped(),n.end+x.node.isWrapped())}],r&&(t[0].indexInNode=0),t}if(i){if(("leaves"===b||"covered"===b||"branches"===b&&c.canHaveChildrenNotContent())&&c.children&&c.children.length){x={node:c,index:0,startOffset:f},w.push(x),c.children[0].isWrapped()&&f++;continue}t.push({node:c,range:new ve.Range(u,g),index:x.index,nodeRange:new ve.Range(f,g),nodeOuterRange:new ve.Range(f-o,g+o),parentOuterRange:new ve.Range(n.start-x.node.isWrapped(),n.end+x.node.isWrapped())}),y=!0}else{if(l){if(("leaves"===b||"branches"===b&&c.canHaveChildrenNotContent())&&c.children&&c.children.length){x={node:c,index:0,startOffset:f},w.push(x),c.children[0].isWrapped()&&f++;continue}return t.push({node:c,index:x.index,nodeRange:new ve.Range(f,g),nodeOuterRange:new ve.Range(f-o,g+o),parentOuterRange:new ve.Range(n.start-x.node.isWrapped(),n.end+x.node.isWrapped())}),t}if(j){if(("leaves"===b||"covered"===b||"branches"===b&&c.canHaveChildrenNotContent())&&c.children&&c.children.length){x={node:c,index:0,startOffset:f},w.push(x),c.children[0].isWrapped()&&f++;continue}return t.push({node:c,range:new ve.Range(f,v),index:x.index,nodeRange:new ve.Range(f,g),nodeOuterRange:new ve.Range(f-o,g+o),parentOuterRange:new ve.Range(n.start-x.node.isWrapped(),n.end+x.node.isWrapped())}),t}if(y&&v>g){if(("leaves"===b||"branches"===b&&c.canHaveChildrenNotContent())&&c.children&&c.children.length){x={node:c,index:0,startOffset:f},w.push(x),c.children[0].isWrapped()&&f++;continue}t.push({node:c,index:x.index,nodeRange:new ve.Range(f,g),nodeOuterRange:new ve.Range(f-o,g+o),parentOuterRange:new ve.Range(n.start-x.node.isWrapped(),n.end+x.node.isWrapped())})}}}if(e)x.index++,f=g+(c.isWrapped()?1:0)+(e.isWrapped()?1:0);else{for(f=g+(c.isWrapped()?1:0);!e;){if(c.isWrapped()&&u===f&&(n=new ve.Range(x.startOffset,x.startOffset+x.node.getLength()),o=x.node.isWrapped(),t=[{node:x.node,indexInNode:x.index+1,range:new ve.Range(f,f),nodeRange:n,nodeOuterRange:new ve.Range(n.start-o,n.end+o)}],h=w[w.length-2],h&&(t[0].index=h.index)),w.pop(),0===w.length)return t;x=w[w.length-1],x.index++,e=x.node.children[x.index],f++}e.isWrapped()&&f++}}while(v>=f-1);if(0===t.length)throw new Error("Failed to select any nodes");return t},ve.Document.prototype.getCoveredSiblingGroups=function(a){var b,c,d,e,f,g,h=this.selectNodes(a,"leaves"),i=[],j=0;for(b=0;b<h.length;b++)if(!(h[b].nodeOuterRange.end<=j)){if(e=h[b].node,e.isContent()&&(e=e.getParent()),f=e.getParent(),!f)break;i.push({parent:f,grandparent:f.getParent(),nodes:[]}),c=e,g=c;do{if(i[i.length-1].nodes.push(g),d=g,b++,void 0===h[b])break;g=h[b].node,g.isContent()&&(g=g.getParent())}while(g.getParent()===f);b--,j=f.getOuterRange().end}return i},ve.Document.prototype.rangeInsideOneLeafNode=function(a){var b=this.selectNodes(a,"leaves");return 1===b.length&&b[0].nodeRange.containsRange(a)&&void 0===b[0].indexInNode},ve.EventSequencer=function(a){function b(a){return function(b){return f.onEvent(a,b)}}var c,d,e,f=this;for(this.$node=null,this.eventNames=a,this.eventHandlers={},this.pendingCalls=[],this.onListenersForEvent={},this.afterListenersForEvent={},this.afterOneListenersForEvent={},c=0,d=a.length;d>c;c++)e=a[c],this.onListenersForEvent[e]=[],this.afterListenersForEvent[e]=[],this.afterOneListenersForEvent[e]=[],this.eventHandlers[e]=b(e);this.onLoopListeners=[],this.afterLoopListeners=[],this.afterLoopOneListeners=[],this.doneOnLoop=!1,this.afterLoopTimeoutId=null},ve.EventSequencer.prototype.attach=function(a){return this.detach(),this.$node=a.on(this.eventHandlers),this},ve.EventSequencer.prototype.detach=function(){return null!==this.$node?(this.runPendingCalls(),this.$node.off(this.eventHandlers),this.$node=null,this):void 0},ve.EventSequencer.prototype.onLoop=function(a){return ve.batchPush(this.onLoopListeners,a),this},ve.EventSequencer.prototype.on=function(a){var b;for(b in a)this.onListenersForEvent[b].push(a[b]);return this},ve.EventSequencer.prototype.after=function(a){var b;for(b in a)this.afterListenersForEvent[b].push(a[b]);return this},ve.EventSequencer.prototype.afterOne=function(a){var b;for(b in a)this.afterOneListenersForEvent[b].push(a[b]);return this},ve.EventSequencer.prototype.afterLoop=function(a){return Array.isArray(a)||(a=[a]),ve.batchPush(this.afterLoopListeners,a),this},ve.EventSequencer.prototype.afterLoopOne=function(a){return Array.isArray(a)||(a=[a]),ve.batchPush(this.afterLoopOneListeners,a),this},ve.EventSequencer.prototype.onEvent=function(a,b){var c,d,e,f,g,h,i;for(this.runPendingCalls(a),this.doneOnLoop||(this.doneOnLoop=!0,this.doOnLoop()),f=this.onListenersForEvent[a]||[],c=0,d=f.length;d>c;c++)e=f[c],this.callListener("on",a,c,e,b);g={id:null,ev:b,eventName:a},h=this,i=this.postpone(function(){null!==g.id&&(h.resetAfterLoopTimeout(),g.id=null,h.afterEvent(a,b))}),g.id=i,this.pendingCalls.push(g)},ve.EventSequencer.prototype.afterEvent=function(a,b){var c,d,e,f;for(e=(this.afterListenersForEvent[a]||[]).slice(),f=(this.afterOneListenersForEvent[a]||[]).slice(),(this.afterOneListenersForEvent[a]||[]).length=0,c=0,d=e.length;d>c;c++)this.callListener("after",a,c,e[c],b);for(c=0,d=f.length;d>c;c++)this.callListener("afterOne",a,c,f[c],b)},ve.EventSequencer.prototype.doOnLoop=function(){var a,b;for(a=0,b=this.onLoopListeners.length;b>a;a++)this.callListener("onLoop",null,a,this.onLoopListeners[a],null)},ve.EventSequencer.prototype.doAfterLoop=function(a){var b,c,d,e;if(this.afterLoopTimeoutId===a){for(this.afterLoopTimeoutId=null,d=this.afterLoopListeners.slice(),e=this.afterLoopOneListeners.slice(),this.afterLoopOneListeners.length=0,b=0,c=this.afterLoopListeners.length;c>b;b++)this.callListener("afterLoop",null,b,this.afterLoopListeners[b],null);for(b=0,c=this.afterLoopOneListeners.length;c>b;b++)this.callListener("afterLoopOne",null,b,this.afterLoopOneListeners[b],null)}},ve.EventSequencer.prototype.resetAfterLoopTimeout=function(){var a,b=this;null!==this.afterLoopTimeoutId&&this.cancelPostponed(this.afterLoopTimeoutId),a=this.postpone(function(){b.doAfterLoop(a)}),this.afterLoopTimeoutId=a
},ve.EventSequencer.prototype.runPendingCalls=function(a){var b,c,d=[];for(b=0;b<this.pendingCalls.length;b++)c=this.pendingCalls[b],null!==c.id&&("keypress"!==a||"keydown"!==c.eventName?(this.cancelPostponed(c.id),c.id=null,this.afterEvent(c.eventName,c.ev)):d.push(c));this.pendingCalls.length=0,this.pendingCalls.push.apply(this.pendingCalls,d)},ve.EventSequencer.prototype.postpone=function(a){return setTimeout(a)},ve.EventSequencer.prototype.cancelPostponed=function(a){clearTimeout(a)},ve.EventSequencer.prototype.callListener=function(a,b,c,d,e){d(e)},ve.dm={},ve.dm.Model=function(a){this.element=a||{type:this.constructor["static"].name}},ve.dm.Model["static"]={},ve.dm.Model["static"].name=null,ve.dm.Model["static"].matchTagNames=null,ve.dm.Model["static"].matchRdfaTypes=null,ve.dm.Model["static"].matchFunction=null,ve.dm.Model["static"].toDataElement=function(){return{type:this.name}},ve.dm.Model["static"].toDomElements=function(a,b){if(this.matchTagNames&&1===this.matchTagNames.length)return[b.createElement(this.matchTagNames[0])];throw new Error("ve.dm.Model subclass must match a single tag name or implement toDomElements")},ve.dm.Model["static"].enableAboutGrouping=!1,ve.dm.Model["static"].storeHtmlAttributes=!0,ve.dm.Model.matchesAttributeSpec=function(a,b){function c(b){return b instanceof RegExp?!!b.exec(a):"boolean"==typeof b?b:a===b}function d(a){var b,d;for(Array.isArray(a)||(a=[a]),b=0,d=a.length;d>b;b++)if(c(a[b]))return!0;return!1}return void 0===b.whitelist&&void 0===b.blacklist?d(b):d(b.whitelist||!0)&&!d(b.blacklist||!1)},ve.dm.Model["static"].getHashObject=function(a){return{type:a.type,attributes:a.attributes,htmlAttributes:a.htmlAttributes}},ve.dm.Model["static"].getMatchRdfaTypes=function(){return this.matchRdfaTypes},ve.dm.Model["static"].removeHtmlAttribute=function(a,b){function c(a){var d;for(d=0;d<a.length;d++)a[d].values&&(delete a[d].values[b],ve.isEmptyObject(a[d].values)&&delete a[d].values),a[d].children&&(c(a[d].children),a[d].children.length||delete a[d].children),ve.isEmptyObject(a[d])&&(a.splice(d,1),d--)}a.htmlAttributes&&(c(a.htmlAttributes),a.htmlAttributes.length||delete a.htmlAttributes)},ve.dm.Model.prototype.isInspectable=function(){return!0},ve.dm.Model.prototype.getElement=function(){return this.element},ve.dm.Model.prototype.getType=function(){return this.constructor["static"].name},ve.dm.Model.prototype.getAttribute=function(a){return this.element&&this.element.attributes?this.element.attributes[a]:void 0},ve.dm.Model.prototype.getAttributes=function(a){var b,c,d=this.element&&this.element.attributes?this.element.attributes:{};if(a){c={};for(b in d)0===b.indexOf(a)&&(c[b.slice(a.length)]=d[b]);return c}return ve.extendObject({},d)},ve.dm.Model.prototype.getHtmlAttributes=function(){return this.element&&this.element.htmlAttributes||[]},ve.dm.Model.prototype.hasAttributes=function(a,b){var c,d,e,f=this.getAttributes()||{};if(ve.isPlainObject(a)){for(c in a)if(!(c in f)||(b?a[c]!==f[c]:String(a[c])!==String(f[c])))return!1}else if(Array.isArray(a))for(d=0,e=a.length;e>d;d++)if(!(a[d]in f))return!1;return!0},ve.dm.Model.prototype.getClonedElement=function(){return ve.copy(this.element)},ve.dm.Model.prototype.getHashObject=function(){return this.constructor["static"].getHashObject(this.element)},function(a){function b(a){var b,c,d=a;for(b=1,c=arguments.length-2;c>b;b++)void 0===d[arguments[b]]&&(d[arguments[b]]={}),d=d[arguments[b]];void 0===d[arguments[b]]&&(d[arguments[b]]=[]),d[arguments[b]].unshift(arguments[b+1])}a.dm.ModelRegistry=function(){OO.Registry.call(this),this.modelsByTag=[{},{}],this.modelsByTypeAndTag=[],this.modelsWithTypeRegExps=[[],[]],this.registrationOrder={},this.nextNumber=0,this.extSpecificTypes=[]},OO.inheritClass(a.dm.ModelRegistry,OO.Registry),a.dm.ModelRegistry.prototype.register=function(c){var d,e,f,g,h=c["static"]&&c["static"].name;if("string"!=typeof h||""===h)throw new Error("Model names must be strings and must not be empty");if(!(c.prototype instanceof a.dm.Model))throw new Error("Models must be subclasses of ve.dm.Model");if(c.prototype instanceof a.dm.Annotation)a.dm.annotationFactory.register(c);else if(c.prototype instanceof a.dm.Node)a.dm.nodeFactory.register(c);else{if(!(c.prototype instanceof a.dm.MetaItem))throw new Error("No factory associated with this ve.dm.Model subclass");a.dm.metaItemFactory.register(c)}for(OO.Registry.prototype.register.call(this,h,c),f=null===c["static"].matchTagNames?[""]:c["static"].matchTagNames,g=null===c["static"].getMatchRdfaTypes()?[""]:c["static"].getMatchRdfaTypes(),d=0;d<f.length;d++)b(this.modelsByTag,+!!c["static"].matchFunction,f[d],h);for(d=0;d<g.length;d++)if(g[d]instanceof RegExp)b(this.modelsWithTypeRegExps,+!!c["static"].matchFunction,h);else for(e=0;e<f.length;e++)b(this.modelsByTypeAndTag,+!!c["static"].matchFunction,g[d],f[e],h);this.registrationOrder[h]=this.nextNumber++},a.dm.ModelRegistry.prototype.registerExtensionSpecificType=function(a){this.extSpecificTypes.push(a)},a.dm.ModelRegistry.prototype.isExtensionSpecificType=function(a){var b,c,d;for(b=0,c=this.extSpecificTypes.length;c>b;b++)if(d=this.extSpecificTypes[b],d===a||d instanceof RegExp&&a.match(d))return!0;return!1},a.dm.ModelRegistry.prototype.matchElement=function(b,c,d){function e(a,b){return t.registrationOrder[b]-t.registrationOrder[a]}function f(b,c,e){var f,g,h,i=[],j=t.modelsWithTypeRegExps[+e];for(f=0;f<j.length;f++)if(!d||-1===a.indexOf(j[f],d))for(h=t.registry[j[f]]["static"].getMatchRdfaTypes(),g=0;g<h.length;g++)h[g]instanceof RegExp&&b.match(h[g])&&(""===c&&null===t.registry[j[f]]["static"].matchTagNames||-1!==a.indexOf(c,t.registry[j[f]]["static"].matchTagNames))&&i.push(j[f]);return i}function g(a,b){var c,d,e,f=t.registry[b]["static"].getMatchRdfaTypes();for(c=0;c<a.length;c++){for(e=!1,d=0;d<f.length;d++)if(f[d]instanceof RegExp){if(a[c].match(f[d])){e=!0;break}}else if(a[c]===f[d]){e=!0;break}if(!e)return!1}return!0}function h(h,i,j){var k,l=[],m=[];for(k=0;k<h.length;k++)l=l.concat(a.getProp(t.modelsByTypeAndTag,1,h[k],i)||[]),d&&(l=OO.simpleArrayDifference(l,d)),m=m.concat(f(h[k],i,!0));for(j&&(l=l.filter(function(a){return g(h,a)}),m=m.filter(function(a){return g(h,a)})),c&&(l=l.filter(function(a){return t.registry[a]["static"].enableAboutGrouping}),m=m.filter(function(a){return t.registry[a]["static"].enableAboutGrouping})),l.sort(e),m.sort(e),l=l.concat(m),k=0;k<l.length;k++)if(t.registry[l[k]]["static"].matchFunction(b))return l[k];return null}function i(b,e,h){var i,j=[],k=[],l=null;for(i=0;i<b.length;i++)j=j.concat(a.getProp(t.modelsByTypeAndTag,0,b[i],e)||[]),d&&(j=OO.simpleArrayDifference(j,d)),k=k.concat(f(b[i],e,!1));for(h&&(j=j.filter(function(a){return g(b,a)}),k=k.filter(function(a){return g(b,a)})),c&&(j=j.filter(function(a){return t.registry[a]["static"].enableAboutGrouping}),k=k.filter(function(a){return t.registry[a]["static"].enableAboutGrouping})),j=j.length>0?j:k,i=0;i<j.length;i++)(null===l||t.registrationOrder[l]<t.registrationOrder[j[i]])&&(l=j[i]);return l}var j,k,l,m,n,o,p,q,r,s=b.nodeName.toLowerCase(),t=this;if(o=[],b.getAttribute&&(b.getAttribute("rel")&&(o=o.concat(b.getAttribute("rel").split(" "))),b.getAttribute("typeof")&&(o=o.concat(b.getAttribute("typeof").split(" "))),b.getAttribute("property")&&(o=o.concat(b.getAttribute("property").split(" ")))),p=o.filter(this.isExtensionSpecificType.bind(this)),r=0!==p.length,q=r?p:o,o.length){if(n=h(q,s,r),null!==n)return n;if(n=h(q,"",r),null!==n)return n}if(!r){for(m=a.getProp(this.modelsByTag,1,s)||[],j=0;j<m.length;j++)if(k=m[j],l=this.registry[k],null===l["static"].getMatchRdfaTypes()&&l["static"].matchFunction(b))return m[j];for(m=a.getProp(this.modelsByTypeAndTag,1,"","")||[],j=0;j<m.length;j++)if(this.registry[m[j]]["static"].matchFunction(b))return m[j]}if(n=i(q,s,r),null!==n)return n;if(n=i(q,"",r),null!==n)return n;if(p.length>0)return null;for(m=a.getProp(this.modelsByTag,0,s)||[],j=0;j<m.length;j++)if(k=m[j],l=this.registry[k],null===l["static"].getMatchRdfaTypes())return m[j];return m=a.getProp(this.modelsByTypeAndTag,0,"","")||[],m.length>0?m[0]:null},a.dm.modelRegistry=new a.dm.ModelRegistry}(ve),ve.dm.NodeFactory=function(){OO.Factory.call(this)},OO.inheritClass(ve.dm.NodeFactory,OO.Factory),ve.dm.NodeFactory.prototype.getDataElement=function(a,b){var c={type:a};if(Object.prototype.hasOwnProperty.call(this.registry,a))return b=ve.extendObject({},this.registry[a]["static"].defaultAttributes,b),ve.isEmptyObject(b)||(c.attributes=ve.copy(b)),c;throw new Error("Unknown node type: "+a)},ve.dm.NodeFactory.prototype.getChildNodeTypes=function(a){if(Object.prototype.hasOwnProperty.call(this.registry,a))return this.registry[a]["static"].childNodeTypes;throw new Error("Unknown node type: "+a)},ve.dm.NodeFactory.prototype.getParentNodeTypes=function(a){if(Object.prototype.hasOwnProperty.call(this.registry,a))return this.registry[a]["static"].parentNodeTypes;throw new Error("Unknown node type: "+a)},ve.dm.NodeFactory.prototype.getSuggestedParentNodeTypes=function(a){if(Object.prototype.hasOwnProperty.call(this.registry,a))return this.registry[a]["static"].suggestedParentNodeTypes;throw new Error("Unknown node type: "+a)},ve.dm.NodeFactory.prototype.canNodeHaveChildren=function(a){if(Object.prototype.hasOwnProperty.call(this.registry,a)){var b=this.registry[a]["static"].childNodeTypes;return null===b||Array.isArray(b)&&b.length>0}throw new Error("Unknown node type: "+a)},ve.dm.NodeFactory.prototype.canNodeHaveChildrenNotContent=function(a){if(Object.prototype.hasOwnProperty.call(this.registry,a))return this.canNodeHaveChildren(a)&&!this.registry[a]["static"].canContainContent&&!this.registry[a]["static"].isContent;throw new Error("Unknown node type: "+a)},ve.dm.NodeFactory.prototype.isNodeWrapped=function(a){if(Object.prototype.hasOwnProperty.call(this.registry,a))return this.registry[a]["static"].isWrapped;throw new Error("Unknown node type: "+a)},ve.dm.NodeFactory.prototype.canNodeContainContent=function(a){if(Object.prototype.hasOwnProperty.call(this.registry,a))return this.registry[a]["static"].canContainContent;throw new Error("Unknown node type: "+a)},ve.dm.NodeFactory.prototype.canNodeTakeAnnotationType=function(a,b){if(!Object.prototype.hasOwnProperty.call(this.registry,a))throw new Error("Unknown node type: "+a);var c,d,e=this.registry[a]["static"].blacklistedAnnotationTypes;for(c=0,d=e.length;d>c;c++)if(b instanceof ve.dm.annotationFactory.lookup(e[c]))return!1;return!0},ve.dm.NodeFactory.prototype.isNodeContent=function(a){if(Object.prototype.hasOwnProperty.call(this.registry,a))return this.registry[a]["static"].isContent;throw new Error("Unknown node type: "+a)},ve.dm.NodeFactory.prototype.isNodeFocusable=function(a){if(Object.prototype.hasOwnProperty.call(this.registry,a))return this.registry[a]["static"].isFocusable;throw new Error("Unknown node type: "+a)},ve.dm.NodeFactory.prototype.doesNodeHaveSignificantWhitespace=function(a){if(Object.prototype.hasOwnProperty.call(this.registry,a))return this.registry[a]["static"].hasSignificantWhitespace;throw new Error("Unknown node type: "+a)},ve.dm.NodeFactory.prototype.doesNodeHandleOwnChildren=function(a){if(Object.prototype.hasOwnProperty.call(this.registry,a))return this.registry[a]["static"].handlesOwnChildren;throw new Error("Unknown node type: "+a)},ve.dm.NodeFactory.prototype.isNodeInternal=function(a){if(Object.prototype.hasOwnProperty.call(this.registry,a))return this.registry[a]["static"].isInternal;throw new Error("Unknown node type: "+a)},ve.dm.nodeFactory=new ve.dm.NodeFactory,ve.dm.AnnotationFactory=function(){OO.Factory.call(this)},OO.inheritClass(ve.dm.AnnotationFactory,OO.Factory),ve.dm.annotationFactory=new ve.dm.AnnotationFactory,ve.dm.AnnotationSet=function(a,b){this.store=a,this.storeIndexes=b||[]},ve.dm.AnnotationSet.prototype.getStore=function(){return this.store},ve.dm.AnnotationSet.prototype.clone=function(){return new ve.dm.AnnotationSet(this.getStore(),this.storeIndexes.slice(0))},ve.dm.AnnotationSet.prototype.getAnnotationsByName=function(a){return this.filter(function(b){return b.name===a})},ve.dm.AnnotationSet.prototype.getComparableAnnotations=function(a){return this.filter(function(b){return ve.compare(a.getComparableObject(),b.getComparableObject())})},ve.dm.AnnotationSet.prototype.getComparableAnnotationsFromSet=function(a){return this.filter(function(b){return a.containsComparable(b)})},ve.dm.AnnotationSet.prototype.hasAnnotationWithName=function(a){return this.containsMatching(function(b){return b.name===a})},ve.dm.AnnotationSet.prototype.get=function(a){return void 0!==a?this.getStore().value(this.getIndex(a)):this.getStore().values(this.getIndexes())},ve.dm.AnnotationSet.prototype.getIndex=function(a){return this.storeIndexes[a]},ve.dm.AnnotationSet.prototype.getIndexes=function(){return this.storeIndexes},ve.dm.AnnotationSet.prototype.getLength=function(){return this.storeIndexes.length},ve.dm.AnnotationSet.prototype.isEmpty=function(){return 0===this.getLength()},ve.dm.AnnotationSet.prototype.contains=function(a){return-1!==this.offsetOf(a)},ve.dm.AnnotationSet.prototype.containsIndex=function(a){return-1!==ve.indexOf(a,this.getIndexes())},ve.dm.AnnotationSet.prototype.containsAnyOf=function(a){var b,c,d=a.getIndexes(),e=this.getIndexes();for(b=0,c=d.length;c>b;b++)if(-1!==ve.indexOf(d[b],e))return!0;return!1},ve.dm.AnnotationSet.prototype.containsAllOf=function(a){var b,c,d=a.getIndexes(),e=this.getIndexes();for(b=0,c=d.length;c>b;b++)if(-1===ve.indexOf(d[b],e))return!1;return!0},ve.dm.AnnotationSet.prototype.offsetOf=function(a){return this.offsetOfIndex(this.store.indexOfHash(OO.getHash(a)))},ve.dm.AnnotationSet.prototype.offsetOfIndex=function(a){return ve.indexOf(a,this.getIndexes())},ve.dm.AnnotationSet.prototype.filter=function(a,b){var c,d,e,f,g;for(b||(e=this.clone(),e.removeAll()),c=0,d=this.getLength();d>c;c++)if(f=this.getIndex(c),g=this.getStore().value(f),a(g)){if(b)return!0;e.storeIndexes.push(f)}return b?!1:e},ve.dm.AnnotationSet.prototype.containsComparable=function(a){return this.filter(function(b){return a.compareTo(b)},!0)},ve.dm.AnnotationSet.prototype.containsComparableForSerialization=function(a){return this.filter(function(b){return a.compareToForSerialization(b)},!0)},ve.dm.AnnotationSet.prototype.containsMatching=function(a){return this.filter(a,!0)},ve.dm.AnnotationSet.prototype.compareTo=function(a){var b,c=this.getIndexes().length;if(c!==a.getLength())return!1;for(b=0;c>b;b++)if(!a.containsComparable(this.get(b)))return!1;return!0},ve.dm.AnnotationSet.prototype.equalsInOrder=function(a){var b,c,d=this.getIndexes(),e=a.getIndexes();if(d.length!==e.length)return!1;for(b=0,c=d.length;c>b;b++)if(d[b]!==e[b])return!1;return!0},ve.dm.AnnotationSet.prototype.add=function(a,b){var c=this.getStore().index(a);return 0>b&&(b=this.getLength()+b),b>=this.getLength()?void this.push(a):void(this.containsIndex(c)||this.storeIndexes.splice(b,0,c))},ve.dm.AnnotationSet.prototype.addSet=function(a){this.storeIndexes=OO.simpleArrayUnion(this.getIndexes(),a.getIndexes())},ve.dm.AnnotationSet.prototype.push=function(a){this.pushIndex(this.getStore().index(a))},ve.dm.AnnotationSet.prototype.pushIndex=function(a){this.storeIndexes.push(a)},ve.dm.AnnotationSet.prototype.removeAt=function(a){if(0>a&&(a=this.getLength()+a),a>=this.getLength())throw new Error("Offset out of bounds");this.storeIndexes.splice(a,1)},ve.dm.AnnotationSet.prototype.removeIndex=function(a){var b=this.offsetOfIndex(a);-1!==b&&this.storeIndexes.splice(b,1)},ve.dm.AnnotationSet.prototype.remove=function(a){var b=this.offsetOf(a);-1!==b&&this.storeIndexes.splice(b,1)},ve.dm.AnnotationSet.prototype.removeAll=function(){this.storeIndexes=[]},ve.dm.AnnotationSet.prototype.removeSet=function(a){this.storeIndexes=OO.simpleArrayDifference(this.getIndexes(),a.getIndexes())},ve.dm.AnnotationSet.prototype.removeNotInSet=function(a){this.storeIndexes=OO.simpleArrayIntersection(this.getIndexes(),a.getIndexes())},ve.dm.AnnotationSet.prototype.reversed=function(){var a=this.clone();return a.storeIndexes.reverse(),a},ve.dm.AnnotationSet.prototype.mergeWith=function(a){var b=this.clone();return b.addSet(a),b},ve.dm.AnnotationSet.prototype.diffWith=function(a){var b=this.clone();return b.removeSet(a),b},ve.dm.AnnotationSet.prototype.intersectWith=function(a){var b=this.clone();return b.removeNotInSet(a),b},ve.dm.MetaItemFactory=function(){OO.Factory.call(this)},OO.inheritClass(ve.dm.MetaItemFactory,OO.Factory),ve.dm.MetaItemFactory.prototype.getGroup=function(a){if(Object.prototype.hasOwnProperty.call(this.registry,a))return this.registry[a]["static"].group;throw new Error("Unknown item type: "+a)},ve.dm.MetaItemFactory.prototype.createFromElement=function(a){if(a&&a.type)return this.create(a.type,a);throw new Error("Element must have a .type property")},ve.dm.metaItemFactory=new ve.dm.MetaItemFactory,ve.dm.ClassAttributeNode=function(){},OO.initClass(ve.dm.ClassAttributeNode),ve.dm.ClassAttributeNode["static"].classAttributes={},ve.dm.ClassAttributeNode["static"].setClassAttributes=function(a,b){var c,d,e,f=[],g=b?b.trim().split(/\s+/):[];if(g.length){for(d=0,e=g.length;e>d;d++)c=g[d],Object.prototype.hasOwnProperty.call(this.classAttributes,c)?a=ve.extendObject(a,this.classAttributes[c]):f.push(c);a.originalClasses=b,a.unrecognizedClasses=f}},ve.dm.ClassAttributeNode["static"].getClassAttrFromAttributes=function(a){var b,c,d,e,f=[];for(b in this.classAttributes){d=this.classAttributes[b],e=!0;for(c in d)if(a[c]!==d[c]){e=!1;break}e&&f.push(b)}return a.unrecognizedClasses&&(f=OO.simpleArrayUnion(f,a.unrecognizedClasses)),a.originalClasses&&ve.compare(a.originalClasses.trim().split(/\s+/).sort(),f.sort())?a.originalClasses:f.length>0?f.join(" "):null},ve.dm.AlignableNode=function(){},OO.initClass(ve.dm.AlignableNode),ve.dm.AlignableNode["static"].cssClasses={left:"ve-align-left",right:"ve-align-right",center:"ve-align-center"},ve.dm.AlignableNode["static"].toDataElementAttributes=function(a){var b,c,d=a[0].classList,e=this.cssClasses;for(b in e)if(d.contains(e[b])){c=b;break}return c?{align:c,originalAlign:c}:{}},ve.dm.AlignableNode["static"].modifyDomElement=function(a,b){b.attributes.align!==b.attributes.originalAlign&&(b.attributes.originalAlign&&$(a).removeClass("ve-align-"+b.attributes.originalAlign),b.attributes.align&&$(a).addClass("ve-align-"+b.attributes.align))},ve.dm.FocusableNode=function(){},OO.initClass(ve.dm.FocusableNode),ve.dm.FocusableNode["static"].isFocusable=!0,ve.dm.Scalable=function(a){a=ve.extendObject({fixedRatio:!0,enforceMin:!0,enforceMax:!0},a),OO.EventEmitter.call(this),this.ratio=null,this.valid=null,this.defaultSize=!1,this.currentDimensions=null,this.defaultDimensions=null,this.originalDimensions=null,this.minDimensions=null,this.maxDimensions=null,this.fixedRatio=a.fixedRatio,a.currentDimensions&&this.setCurrentDimensions(a.currentDimensions),a.originalDimensions&&this.setOriginalDimensions(a.originalDimensions),a.defaultDimensions&&this.setDefaultDimensions(a.defaultDimensions),a.isDefault&&this.toggleDefault(!!a.isDefault),a.minDimensions&&this.setMinDimensions(a.minDimensions),a.maxDimensions&&this.setMaxDimensions(a.maxDimensions),this.setEnforcedMin(a.enforceMin),this.setEnforcedMax(a.enforceMax)},OO.mixinClass(ve.dm.Scalable,OO.EventEmitter),ve.dm.Scalable["static"].getDimensionsFromValue=function(a,b){return a=ve.copy(a),""===a.width&&(a.width=0),""===a.height&&(a.height=0),!a.height&&null!==b&&$.isNumeric(a.width)&&(a.height=Math.round(a.width/b)),!a.width&&null!==b&&$.isNumeric(a.height)&&(a.width=Math.round(a.height*b)),a},ve.dm.Scalable.prototype.clone=function(){var a=this.getCurrentDimensions(),b=this.getOriginalDimensions(),c=this.getDefaultDimensions(),d=this.getMinDimensions(),e=this.getMaxDimensions(),f={isDefault:!!this.isDefault(),enforceMin:!!this.isEnforcedMin(),enforceMax:!!this.isEnforcedMax()};return a&&(f.currentDimensions=ve.copy(a)),b&&(f.originalDimensions=ve.copy(b)),c&&(f.defaultDimensions=ve.copy(c)),d&&(f.minDimensions=ve.copy(d)),e&&(f.maxDimensions=ve.copy(e)),new this.constructor(f)},ve.dm.Scalable.prototype.setRatioFromDimensions=function(a){a&&a.width&&a.height&&(this.ratio=a.width/a.height),this.valid=null},ve.dm.Scalable.prototype.setCurrentDimensions=function(a){this.isDimensionsObjectValid(a)&&!ve.compare(a,this.getCurrentDimensions())&&(this.currentDimensions=ve.copy(a),this.fixedRatio&&!this.ratio&&this.setRatioFromDimensions(this.getCurrentDimensions()),this.valid=null,this.emit("currentSizeChange",this.getCurrentDimensions()))},ve.dm.Scalable.prototype.setOriginalDimensions=function(a){this.isDimensionsObjectValid(a)&&!ve.compare(a,this.getOriginalDimensions())&&(this.originalDimensions=ve.copy(a),this.fixedRatio&&this.setRatioFromDimensions(this.getOriginalDimensions()),this.valid=null,this.emit("originalSizeChange",this.getOriginalDimensions()))},ve.dm.Scalable.prototype.setDefaultDimensions=function(a){this.isDimensionsObjectValid(a)&&!ve.compare(a,this.getDefaultDimensions())&&(this.defaultDimensions=ve.copy(a),this.valid=null,this.emit("defaultSizeChange",this.isDefault()))},ve.dm.Scalable.prototype.clearDefaultDimensions=function(){this.defaultDimensions=null,this.valid=null,this.emit("defaultSizeChange",this.isDefault())},ve.dm.Scalable.prototype.clearOriginalDimensions=function(){this.originalDimensions=null,this.valid=null,this.emit("originalSizeChange",this.isDefault())},ve.dm.Scalable.prototype.toggleDefault=function(a){void 0===a&&(a=!this.isDefault()),this.isDefault()!==a&&(this.defaultSize=a,a&&this.setCurrentDimensions(this.getDefaultDimensions()),this.emit("defaultSizeChange",this.isDefault()))},ve.dm.Scalable.prototype.setMinDimensions=function(a){this.isDimensionsObjectValid(a)&&!ve.compare(a,this.getMinDimensions())&&(this.minDimensions=ve.copy(a),this.valid=null,this.emit("minSizeChange",a))},ve.dm.Scalable.prototype.setMaxDimensions=function(a){this.isDimensionsObjectValid(a)&&!ve.compare(a,this.getMaxDimensions())&&(this.maxDimensions=ve.copy(a),this.emit("maxSizeChange",a),this.valid=null)},ve.dm.Scalable.prototype.clearMinDimensions=function(){null!==this.minDimensions&&(this.minDimensions=null,this.valid=null,this.emit("minSizeChange",this.minDimensions))},ve.dm.Scalable.prototype.clearMaxDimensions=function(){null!==this.maxDimensions&&(this.maxDimensions=null,this.valid=null,this.emit("maxSizeChange",this.maxDimensions))},ve.dm.Scalable.prototype.getCurrentDimensions=function(){return this.currentDimensions},ve.dm.Scalable.prototype.getOriginalDimensions=function(){return this.originalDimensions},ve.dm.Scalable.prototype.getDefaultDimensions=function(){return this.defaultDimensions},ve.dm.Scalable.prototype.isDefault=function(){return this.defaultSize},ve.dm.Scalable.prototype.getMinDimensions=function(){return this.minDimensions},ve.dm.Scalable.prototype.getMaxDimensions=function(){return this.maxDimensions},ve.dm.Scalable.prototype.isEnforcedMin=function(){return this.enforceMin},ve.dm.Scalable.prototype.isEnforcedMax=function(){return this.enforceMax},ve.dm.Scalable.prototype.setEnforcedMin=function(a){this.valid=null,this.enforceMin=!!a},ve.dm.Scalable.prototype.setEnforcedMax=function(a){this.valid=null,this.enforceMax=!!a},ve.dm.Scalable.prototype.getRatio=function(){return this.ratio},ve.dm.Scalable.prototype.isFixedRatio=function(){return this.fixedRatio},ve.dm.Scalable.prototype.getCurrentScale=function(){return this.isFixedRatio()&&this.getCurrentDimensions()&&this.getOriginalDimensions()?this.getCurrentDimensions().width/this.getOriginalDimensions().width:null},ve.dm.Scalable.prototype.isTooSmall=function(){return!!(this.getCurrentDimensions()&&this.getMinDimensions()&&(this.getCurrentDimensions().width<this.getMinDimensions().width||this.getCurrentDimensions().height<this.getMinDimensions().height))},ve.dm.Scalable.prototype.isTooLarge=function(){return!!(this.getCurrentDimensions()&&this.getMaxDimensions()&&(this.getCurrentDimensions().width>this.getMaxDimensions().width||this.getCurrentDimensions().height>this.getMaxDimensions().height))},ve.dm.Scalable.prototype.getBoundedDimensions=function(a,b){var c,d,e,f,g=this.isEnforcedMin()&&this.getMinDimensions(),h=this.isEnforcedMax()&&this.getMaxDimensions();return a=ve.copy(a),g&&(a.width=Math.max(a.width,this.minDimensions.width),a.height=Math.max(a.height,this.minDimensions.height)),h&&(a.width=Math.min(a.width,this.maxDimensions.width),a.height=Math.min(a.height,this.maxDimensions.height)),this.isFixedRatio()&&(c=a.width/a.height,c<this.getRatio()?a.height=Math.round(a.width/this.getRatio()):a.width=Math.round(a.height*this.getRatio())),b&&(e=g?Math.ceil(g.width/b):-1/0,f=h?Math.floor(h.width/b):1/0,d=Math.round(a.width/b),a.width=Math.max(Math.min(d,f),e)*b,this.isFixedRatio()?a.height=Math.round(a.width/this.getRatio()):(e=g?Math.ceil(g.height/b):-1/0,f=h?Math.floor(h.height/b):1/0,d=Math.round(a.height/b),a.height=Math.max(Math.min(d,f),e)*b)),a},ve.dm.Scalable.prototype.isCurrentDimensionsValid=function(){var a=this.getCurrentDimensions(),b=this.isEnforcedMin()&&!$.isEmptyObject(this.getMinDimensions())&&this.getMinDimensions(),c=this.isEnforcedMax()&&!$.isEmptyObject(this.getMaxDimensions())&&this.getMaxDimensions();return this.valid=$.isNumeric(a.width)&&$.isNumeric(a.height)&&(!b||a.width>=b.width&&a.height>=b.height)&&(!c||a.width<=c.width&&a.height<=c.height),this.valid},ve.dm.Scalable.prototype.isDimensionsObjectValid=function(a){return!a||$.isEmptyObject(a)||void 0===a.width&&void 0===a.height?!1:!0},ve.dm.APIResultsProvider=function(a,b){b=b||{},this.setAPIurl(a),this.fetchLimit=b.fetchLimit||30,this.lang=b.lang,this.offset=b.offset||0,this.ajaxSettings=b.ajaxSettings||{},this.staticParams=b.staticParams||{},this.userParams=b.userParams||{},this.toggleDepleted(!1),OO.EventEmitter.call(this)},OO.mixinClass(ve.dm.APIResultsProvider,OO.EventEmitter),ve.dm.APIResultsProvider.prototype.getResults=function(){var a,b=$.Deferred(),c=$.extend({},this.getStaticParams(),this.getUserParams());return a=$.getJSON(this.getAPIurl(),c).done(function(a){"array"!==$.type(a)||"array"===$.type(a)&&0===a.length?b.resolve():b.resolve(a)}),b.promise({abort:a.abort})},ve.dm.APIResultsProvider.prototype.setAPIurl=function(a){this.apiurl=a},ve.dm.APIResultsProvider.prototype.getAPIurl=function(){return this.apiurl},ve.dm.APIResultsProvider.prototype.getStaticParams=function(){return this.staticParams},ve.dm.APIResultsProvider.prototype.getUserParams=function(){return this.userParams},ve.dm.APIResultsProvider.prototype.setUserParams=function(a){ve.compare(a,this.userParams,!0)||(this.userParams=$.extend({},this.userParams,a),this.setOffset(0),this.toggleDepleted(!1))},ve.dm.APIResultsProvider.prototype.getDefaultFetchLimit=function(){return this.limit},ve.dm.APIResultsProvider.prototype.setDefaultFetchLimit=function(a){this.limit=a},ve.dm.APIResultsProvider.prototype.getLang=function(){return this.lang},ve.dm.APIResultsProvider.prototype.setLang=function(a){this.lang=a},ve.dm.APIResultsProvider.prototype.getOffset=function(){return this.offset},ve.dm.APIResultsProvider.prototype.setOffset=function(a){this.offset=a},ve.dm.APIResultsProvider.prototype.isDepleted=function(){return this.depleted},ve.dm.APIResultsProvider.prototype.toggleDepleted=function(a){this.depleted=void 0!==a?a:!this.depleted},ve.dm.APIResultsProvider.prototype.getAjaxSettings=function(){return this.ajaxSettings},ve.dm.APIResultsProvider.prototype.setAjaxSettings=function(a){this.ajaxSettings=a},ve.dm.APIResultsQueue=function(a){a=a||{},this.fileRepoPromise=null,this.providers=[],this.providerPromises=[],this.queue=[],this.params={},this.limit=a.limit||20,this.setThreshold(a.threshold||10),OO.EventEmitter.call(this)},OO.mixinClass(ve.dm.APIResultsQueue,OO.EventEmitter),ve.dm.APIResultsQueue.prototype.setup=function(){return $.Deferred().resolve().promise({abort:$.noop})},ve.dm.APIResultsQueue.prototype.get=function(a){var b=null,c=this;return a=a||this.limit,this.queue.length<a+this.threshold&&(b=this.queryProviders(a+this.threshold).then(function(a){c.queue=c.queue.concat.apply(c.queue,a)})),$.when(b).then(function(){return c.queue.splice(0,a)})},ve.dm.APIResultsQueue.prototype.queryProviders=function(a){var b,c,d=this;return this.setup().then(function(){for(b=0,c=d.providerPromises.length;c>b;b++)d.providerPromises[b].abort();for(d.providerPromises=[],b=0,c=d.providers.length;c>b;b++)d.providers[b].isDepleted()||d.providerPromises.push(d.providers[b].getResults(a));return $.when.apply($,d.providerPromises).then(Array.prototype.concat.bind([]))})},ve.dm.APIResultsQueue.prototype.setParams=function(a){var b,c;if(!ve.compare(a,this.params,!0)){for(this.params=ve.extendObject(this.params,a),this.queue=[],b=0,c=this.providerPromises.length;c>b;b++)this.providerPromises[b].abort();for(b=0,c=this.providers.length;c>b;b++)this.providers[b].setUserParams(this.params)}},ve.dm.APIResultsQueue.prototype.getParams=function(){return this.params},ve.dm.APIResultsQueue.prototype.setProviders=function(a){this.providers=a},ve.dm.APIResultsQueue.prototype.addProvider=function(a){this.providers.push(a)},ve.dm.APIResultsQueue.prototype.getProviders=function(){return this.providers},ve.dm.APIResultsQueue.prototype.getQueueSize=function(){return this.queue.length},ve.dm.APIResultsQueue.prototype.setThreshold=function(a){this.threshold=a},ve.dm.APIResultsQueue.prototype.getThreshold=function(){return this.threshold},ve.dm.ResizableNode=function(){this.scalable=null,this.connect(this,{attributeChange:"onResizableAttributeChange"})},OO.initClass(ve.dm.ResizableNode),ve.dm.ResizableNode.prototype.getScalable=function(){return this.scalable||(this.scalable=this.createScalable()),this.scalable},ve.dm.ResizableNode.prototype.createScalable=function(){throw new Error("ve.dm.ResizableNode subclass must implement createScalable")},ve.dm.ResizableNode.prototype.onResizableAttributeChange=function(a){("width"===a||"height"===a)&&this.getScalable().setCurrentDimensions({width:this.getAttribute("width"),height:this.getAttribute("height")})},ve.dm.Node=function(a){ve.dm.Model.call(this,a),ve.Node.call(this),OO.EventEmitter.call(this),this.length=0,this.element=a,this.doc=void 0},OO.inheritClass(ve.dm.Node,ve.dm.Model),OO.mixinClass(ve.dm.Node,ve.Node),OO.mixinClass(ve.dm.Node,OO.EventEmitter),ve.dm.Node["static"].handlesOwnChildren=!1,ve.dm.Node["static"].isInternal=!1,ve.dm.Node["static"].isWrapped=!0,ve.dm.Node["static"].isContent=!1,ve.dm.Node["static"].isFocusable=!1,ve.dm.Node["static"].canContainContent=!1,ve.dm.Node["static"].hasSignificantWhitespace=!1,ve.dm.Node["static"].childNodeTypes=null,ve.dm.Node["static"].parentNodeTypes=null,ve.dm.Node["static"].suggestedParentNodeTypes=null,ve.dm.Node["static"].blacklistedAnnotationTypes=[],ve.dm.Node["static"].defaultAttributes={},ve.dm.Node["static"].remapStoreIndexes=function(){},ve.dm.Node["static"].remapInternalListIndexes=function(){},ve.dm.Node["static"].remapInternalListKeys=function(){},ve.dm.Node["static"].isHybridInline=function(a,b){var c,d,e=!0;for(c=0,d=a.length;d>c;c++)if(ve.isBlockElement(a[c])){e=!1;break}return b.isExpectingContent()&&!b.isInWrapper()||b.isInWrapper()&&!b.canCloseWrapper()||e},ve.dm.Node["static"].cloneElement=function(a,b){var c=ve.copy(a);return!b&&c.internal&&(delete c.internal.generated,ve.isEmptyObject(c.internal)&&delete c.internal),c},ve.dm.Node.prototype.getClonedElement=function(a){return this.constructor["static"].cloneElement(this.element,a)},ve.dm.Node.prototype.getChildNodeTypes=function(){return this.constructor["static"].childNodeTypes},ve.dm.Node.prototype.getParentNodeTypes=function(){return this.constructor["static"].parentNodeTypes},ve.dm.Node.prototype.getSuggestedParentNodeTypes=function(){return this.constructor["static"].suggestedParentNodeTypes},ve.dm.Node.prototype.canHaveChildren=function(){return ve.dm.nodeFactory.canNodeHaveChildren(this.type)},ve.dm.Node.prototype.canHaveChildrenNotContent=function(){return ve.dm.nodeFactory.canNodeHaveChildrenNotContent(this.type)
},ve.dm.Node.prototype.isInternal=function(){return this.constructor["static"].isInternal},ve.dm.Node.prototype.isWrapped=function(){return this.constructor["static"].isWrapped},ve.dm.Node.prototype.canContainContent=function(){return this.constructor["static"].canContainContent},ve.dm.Node.prototype.isContent=function(){return this.constructor["static"].isContent},ve.dm.Node.prototype.isFocusable=function(){return this.constructor["static"].isFocusable},ve.dm.Node.prototype.canHaveSlugBefore=function(){return!this.canContainContent()&&null===this.getParentNodeTypes()},ve.dm.Node.prototype.canHaveSlugAfter=ve.dm.Node.prototype.canHaveSlugBefore,ve.dm.Node.prototype.hasSignificantWhitespace=function(){return this.constructor["static"].hasSignificantWhitespace},ve.dm.Node.prototype.handlesOwnChildren=function(){return this.constructor["static"].handlesOwnChildren},ve.dm.Node.prototype.hasMatchingAncestor=function(a,b){for(var c=this;c&&!c.matches(a,b);)if(c=c.getParent(),null===c)return!1;return!0},ve.dm.Node.prototype.matches=function(a,b){var c;if(this.getType()!==a)return!1;if(b)for(c in b)if(this.getAttribute(c)!==b[c])return!1;return!0},ve.dm.Node.prototype.getLength=function(){return this.length},ve.dm.Node.prototype.setLength=function(a){if(0>a)throw new Error("Length cannot be negative");var b=a-this.length;this.length=a,this.parent&&this.parent.adjustLength(b),this.emit("lengthChange",b),this.emit("update")},ve.dm.Node.prototype.adjustLength=function(a){this.setLength(this.length+a)},ve.dm.Node.prototype.getOffset=function(){var a,b,c,d;if(!this.parent)return 0;for(c=this.parent.children,d=this.parent.getOffset()+(this.parent===this.root?0:1),a=0,b=c.length;b>a&&c[a]!==this;a++)d+=c[a].getOuterLength();if(a===b)throw new Error("Node not found in parent's children array");return d},ve.dm.Node.prototype.canBeMergedWith=function(a){var b=this,c=a;for(b.canContainContent()&&c.isContent()?c=c.getParent():c.canContainContent()&&b.isContent()&&(b=b.getParent());b!==c;){if(null===b||null===c||b.getType()!==c.getType())return!1;b=b.getParent(),c=c.getParent()}return!0},ve.dm.BranchNode=function(a,b){ve.BranchNode.call(this),ve.dm.Node.call(this,a),this.slugPositions={},Array.isArray(b)&&b.length&&this.splice.apply(this,[0,0].concat(b))},OO.inheritClass(ve.dm.BranchNode,ve.dm.Node),OO.mixinClass(ve.dm.BranchNode,ve.BranchNode),ve.dm.BranchNode.prototype.push=function(a){return this.splice(this.children.length,0,a),this.children.length},ve.dm.BranchNode.prototype.pop=function(){if(this.children.length){var a=this.children[this.children.length-1];return this.splice(this.children.length-1,1),a}},ve.dm.BranchNode.prototype.unshift=function(a){return this.splice(0,0,a),this.children.length},ve.dm.BranchNode.prototype.shift=function(){if(this.children.length){var a=this.children[0];return this.splice(0,1),a}},ve.dm.BranchNode.prototype.splice=function(){var a,b,c,d=Array.prototype.slice.call(arguments),e=0;for(c=this.children.splice.apply(this.children,d),a=0,b=c.length;b>a;a++)c[a].detach(),e-=c[a].getOuterLength();if(d.length>=3)for(b=d.length,a=2;b>a;a++)d[a].attach(this),e+=d[a].getOuterLength();return this.adjustLength(e,!0),this.setupSlugs(),this.emit.apply(this,["splice"].concat(d)),c},ve.dm.BranchNode.prototype.setupSlugs=function(){var a,b,c=this.canHaveChildrenNotContent();if(this.slugPositions={},!c||this.isAllowedChildNodeType("paragraph"))if(0===this.getLength()||1===this.children.length&&this.children[0].isInternal())this.slugPositions[0]=!0;else for(a=0,b=this.children.length;b>a;a++)this.children[a].isInternal()||(0===a&&this.children[a].canHaveSlugBefore()&&(this.slugPositions[a]=!0),this.children[a].canHaveSlugAfter()&&(a===this.children.length-1||this.children[a+1]&&this.children[a+1].canHaveSlugBefore())&&(this.slugPositions[a+1]=!0))},ve.dm.BranchNode.prototype.hasSlugAtOffset=function(a){var b,c=this.getOffset()+(this.isWrapped()?1:0);if(a===c)return!!this.slugPositions[0];for(b=0;b<this.children.length;b++)if(c+=this.children[b].getOuterLength(),a===c)return!!this.slugPositions[b+1];return!1},ve.dm.LeafNode=function(a){ve.LeafNode.call(this),ve.dm.Node.call(this,a)},OO.inheritClass(ve.dm.LeafNode,ve.dm.Node),OO.mixinClass(ve.dm.LeafNode,ve.LeafNode),ve.dm.LeafNode["static"].childNodeTypes=[],ve.dm.LeafNode.prototype.getAnnotations=function(){return this.element.annotations||[]},ve.dm.Annotation=function(a){ve.dm.Model.call(this,a),this.name=this.constructor["static"].name},OO.inheritClass(ve.dm.Annotation,ve.dm.Model),ve.dm.Annotation["static"].enableAboutGrouping=!1,ve.dm.Annotation["static"].applyToAppendedContent=!0,ve.dm.Annotation["static"].splitOnWordbreak=!1,ve.dm.Annotation["static"].removes=[],ve.dm.Annotation["static"].toDomElements=function(){throw new Error("ve.dm.Annotation subclass must implement toDomElements")},ve.dm.Annotation.prototype.getDomElements=function(a){return this.constructor["static"].toDomElements(this.element,a||document)},ve.dm.Annotation.prototype.getComparableObject=function(){var a=this.getHashObject();return delete a.htmlAttributes,a},ve.dm.Annotation.prototype.getComparableHtmlAttributes=function(){var a,b=this.getHtmlAttributes();return b[0]?(a=ve.copy(b[0].values),delete a["data-parsoid"],a):{}},ve.dm.Annotation.prototype.getComparableObjectForSerialization=function(){var a=this.getComparableObject(),b=this.getComparableHtmlAttributes();return ve.isEmptyObject(b)||(a.htmlAttributes=b),a},ve.dm.Annotation.prototype.isGenerated=function(){return this.getHtmlAttributes().length>0},ve.dm.Annotation.prototype.compareTo=function(a){return ve.compare(this.getComparableObject(),a.getComparableObject())},ve.dm.Annotation.prototype.compareToForSerialization=function(a){return this.isGenerated()&&a.isGenerated()?ve.compare(this.getHashObject(),a.getHashObject()):ve.compare(this.getComparableObjectForSerialization(),a.getComparableObjectForSerialization())},ve.dm.InternalList=function(a){OO.EventEmitter.call(this),this.document=a,this.itemHtmlQueue=[],this.listNode=null,this.nodes={},this.groupsChanged=[],this.keyIndexes={},this.keys=[],this.nextUniqueNumber=0,a&&a.connect(this,{transact:"onTransact"})},OO.mixinClass(ve.dm.InternalList,OO.EventEmitter),ve.dm.InternalList.prototype.queueItemHtml=function(a,b,c){var d=!1,e=this.getKeyIndex(a,b);return void 0===e?(e=this.itemHtmlQueue.length,this.keyIndexes[a+"/"+b]=e,this.itemHtmlQueue.push(c),d=!0):""===this.itemHtmlQueue[e]&&(this.itemHtmlQueue[e]=c,d=!0),{index:e,isNew:d}},ve.dm.InternalList.prototype.getItemHtmlQueue=function(){return this.itemHtmlQueue},ve.dm.InternalList.prototype.getDocument=function(){return this.document},ve.dm.InternalList.prototype.getListNode=function(){var a,b;if(!this.listNode||!this.listNode.doc)for(b=this.getDocument().getDocumentNode().children,a=b.length;a>=0;a--)if(b[a]instanceof ve.dm.InternalListNode){this.listNode=b[a];break}return this.listNode},ve.dm.InternalList.prototype.getItemNodeCount=function(){return this.getListNode().children.length},ve.dm.InternalList.prototype.getItemNode=function(a){return this.getListNode().children[a]},ve.dm.InternalList.prototype.getNodeGroups=function(){return this.nodes},ve.dm.InternalList.prototype.getNodeGroup=function(a){return this.nodes[a]},ve.dm.InternalList.prototype.getUniqueListKey=function(a,b,c){var d=this.getNodeGroup(a),e=0;if(void 0!==d.uniqueListKeys[b])return d.uniqueListKeys[b];for(;d.keyedNodes[c+e]||d.uniqueListKeysInUse[c+e];)e++;return d.uniqueListKeys[b]=c+e,d.uniqueListKeysInUse[c+e]=!0,c+e},ve.dm.InternalList.prototype.getNextUniqueNumber=function(){return this.nextUniqueNumber++},ve.dm.InternalList.prototype.convertToData=function(a,b){var c,d,e,f,g=this.getItemHtmlQueue(),h=[];for(h.push({type:"internalList"}),c=0,d=g.length;d>c;c++)""!==g[c]?(f=b.createElement("div"),f.innerHTML=g[c],e=a.getDataFromDomSubtree(f),h=h.concat([{type:"internalItem",attributes:{originalHtml:g[c]}}],e,[{type:"/internalItem"}])):h=h.concat([{type:"internalItem"},{type:"/internalItem"}]);return h.push({type:"/internalList"}),this.itemHtmlQueue=[],h},ve.dm.InternalList.prototype.getItemInsertion=function(a,b,c){var d,e,f=this.getKeyIndex(a,b);return void 0===f?(f=this.getItemNodeCount(),this.keyIndexes[a+"/"+b]=f,e=[{type:"internalItem"}].concat(c,[{type:"/internalItem"}]),d=ve.dm.Transaction.newFromInsertion(this.getDocument(),this.getListNode().getRange().end,e)):d=null,{transaction:d,index:f}},ve.dm.InternalList.prototype.getIndexPosition=function(a,b){return ve.indexOf(b,this.nodes[a].indexOrder)},ve.dm.InternalList.prototype.getKeyIndex=function(a,b){return this.keyIndexes[a+"/"+b]},ve.dm.InternalList.prototype.addNode=function(a,b,c,d){var e,f,g,h,i=this.nodes[a];if(void 0===i&&(i=this.nodes[a]={keyedNodes:{},firstNodes:[],indexOrder:[],uniqueListKeys:{},uniqueListKeysInUse:{}}),h=i.keyedNodes[b],this.keys[c]=b,void 0===h&&(h=i.keyedNodes[b]=[]),d.getDocument().buildingNodeTree)h.push(d),1===h.length&&(i.firstNodes[c]=d);else{for(g=d.getRange().start,e=0,f=h.length;f>e&&!(g<h[e].getRange().start);e++);h.splice(e,0,d),0===e&&(i.firstNodes[c]=d)}-1===ve.indexOf(c,i.indexOrder)&&i.indexOrder.push(c),this.markGroupAsChanged(a)},ve.dm.InternalList.prototype.markGroupAsChanged=function(a){-1===ve.indexOf(a,this.groupsChanged)&&this.groupsChanged.push(a)},ve.dm.InternalList.prototype.onTransact=function(){var a;if(this.groupsChanged.length>0){for(a=0;a<this.groupsChanged.length;a++)this.sortGroupIndexes(this.nodes[this.groupsChanged[a]]);this.emit("update",this.groupsChanged),this.groupsChanged=[]}},ve.dm.InternalList.prototype.removeNode=function(a,b,c,d){var e,f,g,h,i=this.nodes[a];for(h=i.keyedNodes[b],e=0,f=h.length;f>e;e++)if(h[e]===d){h.splice(e,1),0===e&&(i.firstNodes[c]=h[0]);break}0===h.length&&(delete i.keyedNodes[b],delete i.firstNodes[c],g=ve.indexOf(c,i.indexOrder),i.indexOrder.splice(g,1)),this.markGroupAsChanged(a)},ve.dm.InternalList.prototype.sortGroupIndexes=function(a){a.indexOrder.sort(function(b,c){return a.firstNodes[b].getRange().start-a.firstNodes[c].getRange().start})},ve.dm.InternalList.prototype.clone=function(a){var b=new this.constructor(a||this.getDocument());return b.nextUniqueNumber=this.nextUniqueNumber,b.itemHtmlQueue=ve.copy(this.itemHtmlQueue),b},ve.dm.InternalList.prototype.merge=function(a,b){var c,d,e,f=a.getItemNodeCount(),g=this.getItemNodeCount(),h=[],i={};for(c=0;b>c;c++)i[c]=c;for(c=b;f>c;c++){e=void 0;for(d in a.keyIndexes)if(a.keyIndexes[d]===c){e=d;break}void 0!==this.keyIndexes[e]?i[c]=this.keyIndexes[e]:(i[c]=g,void 0!==e&&(this.keyIndexes[e]=g),g++,h.push(a.getItemNode(c).getOuterRange()))}return{mapping:i,newItemRanges:h}},ve.dm.MetaItem=function(a){ve.dm.Model.call(this,a),OO.EventEmitter.call(this),this.list=null,this.offset=null,this.index=null,this.move=null},OO.inheritClass(ve.dm.MetaItem,ve.dm.Model),OO.mixinClass(ve.dm.MetaItem,OO.EventEmitter),ve.dm.MetaItem["static"].group="misc",ve.dm.MetaItem.prototype.remove=function(){if(!this.list)throw new Error("Cannot remove detached item");this.list.removeMeta(this)},ve.dm.MetaItem.prototype.replaceWith=function(a){var b=this.getOffset(),c=this.getIndex(),d=this.list;d.removeMeta(this),d.insertMeta(a,b,c)},ve.dm.MetaItem.prototype.getGroup=function(){return this.constructor["static"].group},ve.dm.MetaItem.prototype.getParentList=function(){return this.list},ve.dm.MetaItem.prototype.getOffset=function(){return this.offset},ve.dm.MetaItem.prototype.getIndex=function(){return this.index},ve.dm.MetaItem.prototype.setOffset=function(a){this.offset=a},ve.dm.MetaItem.prototype.setIndex=function(a){this.index=a},ve.dm.MetaItem.prototype.attach=function(a,b,c){this.list=a,this.offset=b,this.index=c},ve.dm.MetaItem.prototype.detach=function(a){this.list===a&&(this.list=null,this.offset=null,this.index=null)},ve.dm.MetaItem.prototype.isAttached=function(){return null!==this.list},ve.dm.MetaList=function(a){var b,c,d,e,f,g;OO.EventEmitter.call(this),this.surface=a,this.document=a.getDocument(),this.groups={},this.items=[],this.document.connect(this,{transact:"onTransact"}),e=this.document.getMetadata();for(b in e)if(Object.prototype.hasOwnProperty.call(e,b)&&Array.isArray(e[b]))for(c=0,d=e[b].length;d>c;c++)f=ve.dm.metaItemFactory.createFromElement(e[b][c]),g=this.groups[f.getGroup()],g||(g=this.groups[f.getGroup()]=[]),f.attach(this,Number(b),c),g.push(f),this.items.push(f)},OO.mixinClass(ve.dm.MetaList,OO.EventEmitter),ve.dm.MetaList.prototype.onTransact=function(a){var b,c,d,e,f,g,h,i,j,k,l,m=this.items.length,n=0,o=0,p=0,q=0,r=0,s=[],t=[],u=[],v=a.getOperations();for(b=0,c=v.length;c>b;b++)switch(v[b].type){case"retain":for(;m>n&&this.items[n].offset<o+v[b].length;n++)s.push({item:this.items[n],offset:this.items[n].offset+p-o,index:this.items[n].offset===o?r-q+this.items[n].index:this.items[n].index});o+=v[b].length,p+=v[b].length,q=0,r=0;break;case"retainMetadata":for(;m>n&&this.items[n].offset===o&&this.items[n].index<q+v[b].length;n++)s.push({item:this.items[n],offset:p,index:this.items[n].index+r-q});q+=v[b].length,r+=v[b].length;break;case"replace":if(i=v[b].insert,j=v[b].remove,void 0!==v[b].removeMetadata){for(k=v[b].insertMetadata,l=v[b].removeMetadata;m>n&&this.items[n].offset<o+l.length;n++)t.push(this.items[n]);for(d=0,e=k.length;e>d;d++)if(k[d])for(f=0,g=k[d].length;g>f;f++)h=ve.dm.metaItemFactory.createFromElement(k[d][f]),s.push({item:h,offset:p+d,index:f})}else for(;m>n&&this.items[n].offset<o+j.length;n++)s.push({item:this.items[n],offset:this.items[n].offset+p-o,index:this.items[n].index});o+=j.length,p+=i.length;break;case"replaceMetadata":for(k=v[b].insert,l=v[b].remove;m>n&&this.items[n].offset===o&&this.items[n].index<q+l.length;n++)t.push(this.items[n]);for(d=0,e=k.length;e>d;d++)h=ve.dm.metaItemFactory.createFromElement(k[d]),s.push({item:h,offset:p,index:r+d});q+=l.length,r+=k.length}for(;m>n;n++)s.push({item:this.items[n],offset:this.items[n].offset+p-o,index:this.items[n].offset===o?r-q+this.items[n].index:this.items[n].index});for(b=0,c=t.length;c>b;b++)this.deleteRemovedItem(t[b].offset,t[b].index),u.push(["remove",t[b],t[b].offset,t[b].index]);for(b=0,c=s.length;c>b;b++)s[b].item.isAttached()&&(s[b].offset!==s[b].item.offset||s[b].index!==s[b].item.index)&&(this.deleteRemovedItem(s[b].item.offset,s[b].item.index),s[b].preExisting=!0);for(b=0,c=s.length;c>b;b++)s[b].item.isAttached()||(this.addInsertedItem(s[b].offset,s[b].index,s[b].item),s[b].preExisting||u.push(["insert",s[b].item]));for(b=0,c=u.length;c>b;b++)this.emit.apply(this,u[b])},ve.dm.MetaList.prototype.findItem=function(a,b,c,d){for(var e,f="string"==typeof c?this.groups[c]||[]:this.items,g=0,h=f.length;h>g;){if(e=g+h>>1,f[e].getOffset()===a&&f[e].getIndex()===b)return e;f[e].getOffset()<a||f[e].getOffset()===a&&f[e].getIndex()<b?g=e+1:h=e}return d?g:null},ve.dm.MetaList.prototype.getItemAt=function(a,b){var c=this.findItem(a,b);return null===c?null:this.items[c]},ve.dm.MetaList.prototype.getItemsInGroup=function(a){return(this.groups[a]||[]).slice(0)},ve.dm.MetaList.prototype.getAllItems=function(){return this.items.slice(0)},ve.dm.MetaList.prototype.insertMeta=function(a,b,c){var d;a instanceof ve.dm.MetaItem&&(a=a.getElement()),void 0===b&&(b=this.document.data.getLength()),void 0===c&&(c=(this.document.metadata.getData(b)||[]).length),d=ve.dm.Transaction.newFromMetadataInsertion(this.document,b,c,[a]),this.surface.change(d)},ve.dm.MetaList.prototype.removeMeta=function(a){var b;b=ve.dm.Transaction.newFromMetadataRemoval(this.document,a.getOffset(),new ve.Range(a.getIndex(),a.getIndex()+1)),this.surface.change(b)},ve.dm.MetaList.prototype.addInsertedItem=function(a,b,c){var d=c.getGroup(),e=this.findItem(a,b,null,!0);this.items.splice(e,0,c),this.groups[d]?(e=this.findItem(a,b,d,!0),this.groups[d].splice(e,0,c)):this.groups[d]=[c],c.attach(this,a,b)},ve.dm.MetaList.prototype.deleteRemovedItem=function(a,b){var c,d,e=this.findItem(a,b);if(null!==e)return c=this.items[e],d=c.getGroup(),this.items.splice(e,1),e=this.findItem(a,b,d),null!==e&&this.groups[d].splice(e,1),c.detach(this),c},ve.dm.TableMatrix=function(a){this.tableNode=a,this.matrix=null,this.rowNodes=null},ve.dm.TableMatrix.prototype.invalidate=function(){this.matrix=null,this.rowNodes=null},ve.dm.TableMatrix.prototype.update=function(){var a,b,c,d,e,f,g,h,i=[],j=[],k=this.tableNode.getIterator(),l=-1,m=-1;for(k.on("newRow",function(a){l++,m=-1,i[l]=i[l]||[],j.push(a)});void 0!==(a=k.next());){for(m++;i[l][m];)m++;if(a){if(b=new ve.dm.TableMatrixCell(a,l,m),i[l][m]=b,c=a.getRowspan(),d=a.getColspan(),1!==c||1!==d)for(e=0;c>e;e++)for(f=0;d>f;f++)(0!==e||0!==f)&&(g=l+e,h=m+f,i[g]=i[g]||[],i[g][h]=new ve.dm.TableMatrixCell(a,g,h,b))}else i[l][m]=null}this.matrix=i,this.rowNodes=j},ve.dm.TableMatrix.prototype.getCell=function(a,b){var c=this.getMatrix();return c[a]?c[a][b]:void 0},ve.dm.TableMatrix.prototype.getColumn=function(a){var b,c,d=this.getMatrix();for(b=[],c=0;c<d.length;c++)b.push(d[c][a]);return b},ve.dm.TableMatrix.prototype.getRow=function(a){var b=this.getMatrix();return b[a]},ve.dm.TableMatrix.prototype.getRowNode=function(a){var b=this.getRowNodes();return b[a]},ve.dm.TableMatrix.prototype.getMatrix=function(){return this.matrix||this.update(),this.matrix},ve.dm.TableMatrix.prototype.getRowNodes=function(){return this.rowNodes||this.update(),this.rowNodes},ve.dm.TableMatrix.prototype.getRowCount=function(){return this.getMatrix().length},ve.dm.TableMatrix.prototype.getColCount=function(a){var b=this.getMatrix();return b.length?b[a||0].length:0},ve.dm.TableMatrix.prototype.lookupCell=function(a){var b,c,d,e,f=this.getMatrix(),g=this.getRowNodes();if(b=ve.indexOf(a.getParent(),g),0>b)return null;for(e=f[b],c=0,d=e.length;d>c;c++)if(e[c]&&e[c].node===a)return e[c];return null},ve.dm.TableMatrix.prototype.findClosestCell=function(a){var b,c,d,e=this.getMatrix();for(d=e[a.row],b=a.col;b>=0;b--)if(!d[b].isPlaceholder())return d[b];for(b=a.col+1,c=d.length;c>b;b++)if(!d[b].isPlaceholder())return d[b];return null},ve.dm.TableMatrixCell=function(a,b,c,d){this.node=a,this.row=b,this.col=c,this.key=b+"_"+c,this.owner=d||this},OO.initClass(ve.dm.TableMatrixCell),ve.dm.TableMatrixCell["static"].sortDescending=function(a,b){return a.row!==b.row?b.row-a.row:b.col-a.col},ve.dm.TableMatrixCell.prototype.isPlaceholder=function(){return this.owner!==this},ve.dm.TableMatrixCell.prototype.getOwner=function(){return this.owner},ve.dm.TableMatrixCell.prototype.equals=function(a){return this.getOwner().key===a.getOwner().key},ve.dm.TransactionProcessor=function(a,b){this.document=a,this.transaction=b,this.operations=b.getOperations(),this.synchronizer=new ve.dm.DocumentSynchronizer(a,b),this.cursor=0,this.metadataCursor=0,this.adjustment=0,this.set=new ve.dm.AnnotationSet(this.document.getStore()),this.clear=new ve.dm.AnnotationSet(this.document.getStore())},ve.dm.TransactionProcessor.processors={},ve.dm.TransactionProcessor.prototype.nextOperation=function(){return this.operations[this.operationIndex++]||!1},ve.dm.TransactionProcessor.prototype.executeOperation=function(a){if(!Object.prototype.hasOwnProperty.call(ve.dm.TransactionProcessor.processors,a.type))throw new Error("Invalid operation error. Operation type is not supported: "+a.type);ve.dm.TransactionProcessor.processors[a.type].call(this,a)},ve.dm.TransactionProcessor.prototype.advanceCursor=function(a){this.cursor+=a,this.metadataCursor=0},ve.dm.TransactionProcessor.prototype.process=function(a){var b;for(this.operationIndex=0;b=this.nextOperation();)this.executeOperation(b);a&&a(),this.synchronizer.synchronize(this.transaction),this.transaction.markAsApplied()},ve.dm.TransactionProcessor.prototype.applyAnnotations=function(a){function b(a,b,c){if(a.containsAnyOf(b))throw new Error("Invalid transaction, annotation to be set is already set");if(a.addSet(b),!a.containsAllOf(c))throw new Error("Invalid transaction, annotation to be cleared is not set");a.removeSet(c)}var c,d,e,f,g,h,i,j,k=[],l=[];if(!this.set.isEmpty()||!this.clear.isEmpty()){for(e=this.cursor;a>e;e++){if(c=this.document.data.isElementData(e)){if(!ve.dm.nodeFactory.isNodeContent(this.document.data.getType(e)))throw new Error("Invalid transaction, cannot annotate a non-content element");if(this.document.data.isCloseElementData(e))continue}d=this.document.data.getAnnotationsFromOffset(e),b(d,this.set,this.clear),k.push({offset:e,annotations:d})}for(e=this.cursor+1;a>e;e++)for(g=0,h=this.document.metadata.getDataLength(e);h>g;g++)d=this.document.metadata.getAnnotationsFromOffsetAndIndex(e,g),b(d,this.set,this.clear),l.push({offset:e,index:g,annotations:d});for(this.cursor<a&&(i=new ve.Range(this.cursor,a),j=this.document.selectNodes(new ve.Range(this.cursor-this.adjustment,a-this.adjustment),"leaves"),this.synchronizer.pushAnnotation(new ve.Range(this.cursor,a))),e=0,f=k.length;f>e;e++)this.document.data.setAnnotationsAtOffset(k[e].offset,k[e].annotations);for(e=0,f=l.length;f>e;e++)this.document.metadata.setAnnotationsAtOffsetAndIndex(l[e].offset,l[e].index,l[e].annotations)}},ve.dm.TransactionProcessor.processors.retain=function(a){this.applyAnnotations(this.cursor+a.length),this.advanceCursor(a.length)},ve.dm.TransactionProcessor.processors.retainMetadata=function(a){this.metadataCursor+=a.length},ve.dm.TransactionProcessor.processors.annotate=function(a){var b;if("set"===a.method)b=this.set;else{if("clear"!==a.method)throw new Error("Invalid annotation method "+a.method);b=this.clear}"start"===a.bias?b.push(a.annotation):b.remove(a.annotation)},ve.dm.TransactionProcessor.processors.attribute=function(a){var b=this.document.data.getData(this.cursor),c=a.to,d=a.from;if(void 0===b.type)throw new Error("Invalid element error, cannot set attributes on non-element data");void 0===c?b.attributes&&delete b.attributes[a.key]:(b.attributes||(b.attributes={}),b.attributes[a.key]=c),this.synchronizer.pushAttributeChange(this.document.getDocumentNode().getNodeFromOffset(this.cursor+1),a.key,d,c)},ve.dm.TransactionProcessor.processors.replace=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=a.remove,q=a.insert,r=a.removeMetadata,s=a.insertMetadata,t=new ve.dm.ElementLinearData(this.document.getStore(),p),u=new ve.dm.ElementLinearData(this.document.getStore(),q),v=t.isContentData(),w=u.isContentData(),x=t.containsElementData(),y=u.containsElementData(),z=a,A=0,B=0,C=[],D=0,E=0;if(v&&w)this.document.data.batchSplice(this.cursor,p.length,q),void 0!==r?this.document.metadata.batchSplice(this.cursor,r.length,s):this.document.metadata.batchSplice(this.cursor,p.length,new Array(q.length)),this.applyAnnotations(this.cursor+q.length),c=this.document.selectNodes(new ve.Range(this.cursor-this.adjustment,this.cursor-this.adjustment+p.length),"leaves"),b=c[0].node,x||y||1!==c.length||!b||"text"!==b.getType()?!x&&!y&&0===p.length&&q.length>0&&1===c.length&&b&&b.canContainContent()&&(void 0!==c[0].indexInNode||0===b.getLength())?this.synchronizer.pushInsertTextNode(b,c[0].indexInNode||0,q.length-p.length):(d=new ve.Range(c[0].nodeOuterRange.start,c[c.length-1].nodeOuterRange.end),this.synchronizer.pushRebuild(d,new ve.Range(d.start+this.adjustment,d.end+this.adjustment+q.length-p.length))):this.synchronizer.pushResize(b,q.length-p.length),this.advanceCursor(q.length),this.adjustment+=q.length-p.length;else{for(;;){if("replace"===z.type){if(l=z.remove,m=z.insert,n=z.removeMetadata,o=z.insertMetadata,this.document.data.batchSplice(this.cursor,l.length,m),void 0!==n?this.document.metadata.batchSplice(this.cursor,n.length,o):this.document.metadata.batchSplice(this.cursor,l.length,new Array(m.length)),C.push(new ve.Range(this.cursor-this.adjustment,this.cursor-this.adjustment+l.length)),g=this.cursor,this.advanceCursor(m.length),l.length>0)for(c=this.document.selectNodes(new ve.Range(g-this.adjustment,g+l.length-this.adjustment),"siblings"),e=0;e<c.length;e++)C.push(c[e].nodeOuterRange);for(e=0;e<l.length;e++)f=l[e].type,void 0!==f&&("/"===f.charAt(0)?A--:A++);for(e=0;e<m.length;e++)f=m[e].type,void 0!==f&&("/"===f.charAt(0)?(B--,D>B&&(h=h||this.document.getBranchNodeFromOffset(g),j=h.getOffset(),k=j+h.getOuterLength(),C.push(new ve.Range(j,k)),h=h.getParent()||h,D--)):B++);this.adjustment+=m.length-l.length,E+=m.length-l.length}else this.executeOperation(z);if(0===A&&0===B)break;if(z=this.nextOperation(),!z)throw new Error("Unbalanced set of replace operations found")}i=ve.Range["static"].newCoveringRange(C),this.synchronizer.pushRebuild(i,new ve.Range(i.start+this.adjustment-E,i.end+this.adjustment))}},ve.dm.TransactionProcessor.processors.replaceMetadata=function(a){var b=a.remove,c=a.insert;this.document.spliceMetadata(this.cursor,this.metadataCursor,b.length,c),this.metadataCursor+=c.length},ve.dm.Transaction=function(){this.operations=[],this.lengthDifference=0,this.applied=!1},ve.dm.Transaction.newFromReplacement=function(a,b,c,d){var e,f=new ve.dm.Transaction;return e=f.pushRemoval(a,0,b,d),e=f.pushInsertion(a,e,e,c),f.pushFinalRetain(a,e),f},ve.dm.Transaction.newFromInsertion=function(a,b,c){var d=new ve.dm.Transaction,e=d.pushInsertion(a,0,b,c);return d.pushFinalRetain(a,e),d},ve.dm.Transaction.newFromRemoval=function(a,b,c){var d=new ve.dm.Transaction,e=d.pushRemoval(a,0,b,c);return d.pushFinalRetain(a,e),d},ve.dm.Transaction.newFromDocumentInsertion=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r=a.internalList.getListNode(),s=r.getRange(),t=c.internalList.getListNode(),u=t.getRange(),v=t.getOuterRange();for(d?(h=new ve.dm.ElementLinearData(a.getStore(),c.getData(d,!0)),i=new ve.dm.MetaLinearData(a.getStore(),c.getMetadata(d,!0))):(h=new ve.dm.ElementLinearData(a.getStore(),c.getData(new ve.Range(0,v.start),!0).concat(c.getData(new ve.Range(v.end,c.data.getLength()),!0))),i=new ve.dm.MetaLinearData(a.getStore(),c.getMetadata(new ve.Range(0,v.start),!0).concat(v.end<c.data.getLength()?c.getMetadata(new ve.Range(v.end+1,c.data.getLength()),!0):[]))),g=a.getStore().merge(c.getStore()),h.remapStoreIndexes(g),g=a.internalList.merge(c.internalList,c.origInternalListLength||0),h.remapInternalListIndexes(g.mapping,a.internalList),c.origDoc===a?(c.origInternalListLength>0?(l=a.internalList.getItemNode(c.origInternalListLength-1).getOuterRange().end,m=c.internalList.getItemNode(c.origInternalListLength-1).getOuterRange().end):(l=s.start,m=u.start),j=c.getData(new ve.Range(u.start,m),!0).concat(a.getData(new ve.Range(l,s.end),!0)),k=c.getMetadata(new ve.Range(u.start,m),!0).concat(a.getMetadata(new ve.Range(l,s.end),!0))):(j=a.getData(s,!0),k=a.getMetadata(s,!0)),e=0,f=g.newItemRanges.length;f>e;e++)j=j.concat(c.getData(g.newItemRanges[e],!0)),k=k.concat(c.getMetadata(g.newItemRanges[e],!0));if(n=new ve.dm.Transaction,b<=s.start)o=a.fixupInsertion(h.data,b),n.pushRetain(o.offset),n.pushReplace(a,o.offset,o.remove,o.data,i.data),n.pushRetain(s.start-(o.offset+o.remove)),n.pushReplace(a,s.start,s.end-s.start,j,k),n.pushFinalRetain(a,s.end);else if(b>=s.end)o=a.fixupInsertion(h.data,b),n.pushRetain(s.start),n.pushReplace(a,s.start,s.end-s.start,j,k),n.pushRetain(o.offset-s.end),n.pushReplace(a,o.offset,o.remove,o.data,i.data),n.pushFinalRetain(a,o.offset+o.remove);else if(b>=s.start&&b<=s.end){for(e=0;(p=a.internalList.getItemNode(e).getRange())&&b>p.end;)e++;c.origDoc===a?(p=c.internalList.getItemNode(e).getRange(),q=u):q=s,ve.batchSplice(j,p.start-q.start,p.end-p.start,h.data),ve.batchSplice(k,p.start-q.start,p.end-p.start,i.data),n.pushRetain(s.start),n.pushReplace(a,s.start,s.end-s.start,j,k),n.pushFinalRetain(a,s.end)}return n},ve.dm.Transaction.newFromAttributeChanges=function(a,b,c){var d,e,f=new ve.dm.Transaction,g=a.getData();if(void 0===g[b].type)throw new Error("Cannot set attributes to non-element data");if("/"===g[b].type.charAt(0))throw new Error("Cannot set attributes on closing element");f.pushRetain(b);for(d in c)e="attributes"in g[b]?g[b].attributes[d]:void 0,e!==c[d]&&f.pushReplaceElementAttribute(d,e,c[d]);return f.pushFinalRetain(a,b),f},ve.dm.Transaction.newFromAnnotation=function(a,b,c,d){for(var e,f,g,h=new ve.dm.Transaction,i=a.data,j=b.start,k=j,l=!1,m=!1,n=0;j<b.end;)i.isElementData(j)?(f=i.getType(j),ve.dm.nodeFactory.doesNodeHandleOwnChildren(f)&&(n+=i.isOpenElementData(j)?1:-1),g=ve.dm.nodeFactory.isNodeContent(f)&&("set"!==c||ve.dm.nodeFactory.canNodeTakeAnnotationType(f,d))?!0:!1):g=!0,g=g&&!n,!g||m&&!i.isCloseElementData(j)?l&&(h.pushRetain(k),h.pushStopAnnotating(c,d),k=0,l=!1):i.isElementData(j)&&i.isCloseElementData(j)||m?i.isCloseElementData(j)&&(m=!1):(i.isElementData(j)&&(m=!0),e="set"===c?i.getAnnotationsFromOffset(j).containsComparable(d):i.getAnnotationsFromOffset(j).contains(d),e&&"set"===c||!e&&"clear"===c?l&&(h.pushRetain(k),h.pushStopAnnotating(c,d),k=0,l=!1):l||(h.pushRetain(k),h.pushStartAnnotating(c,d),k=0,l=!0)),k++,j++;return h.pushRetain(k),l&&h.pushStopAnnotating(c,d),h.pushFinalRetain(a,b.end),h},ve.dm.Transaction.newFromMetadataInsertion=function(a,b,c,d){var e=new ve.dm.Transaction,f=a.metadata,g=f.getData(b)||[];return 0===d.length?e:(e.pushRetain(b),e.pushRetainMetadata(c),e.pushReplaceMetadata([],d),e.pushRetainMetadata(g.length-c),e.pushFinalRetain(a,b,g.length),e)},ve.dm.Transaction.newFromMetadataRemoval=function(a,b,c){var d,e=new ve.dm.Transaction,f=a.metadata,g=f.getData(b)||[];if(!g.length)throw new Error("Cannot remove metadata from empty list");if(c.start<0||c.end>g.length)throw new Error("Range out of bounds");return d=g.slice(c.start,c.end),0===d.length?e:(e.pushRetain(b),e.pushRetainMetadata(c.start),e.pushReplaceMetadata(d,[]),e.pushRetainMetadata(g.length-c.end),e.pushFinalRetain(a,b,g.length),e)},ve.dm.Transaction.newFromMetadataElementReplacement=function(a,b,c,d){var e,f=new ve.dm.Transaction,g=a.getMetadata(),h=g[b]||[];if(c>=h.length)throw new Error("Metadata index out of bounds");return e=h[c],f.pushRetain(b),f.pushRetainMetadata(c),f.pushReplaceMetadata([e],[d]),f.pushRetainMetadata(h.length-c-1),f.pushFinalRetain(a,b,h.length),f},ve.dm.Transaction.newFromContentBranchConversion=function(a,b,c,d){var e,f,g,h,i,j,k=new ve.dm.Transaction,l=a.selectNodes(b,"leaves"),m={type:c},n={type:"/"+c};for(ve.isPlainObject(d)?m.attributes=d:d={},e=0;e<l.length;e++)if(f=l[e],g=f.node.isContent()?f.node.getParent():f.node,g.canContainContent()){if(g.getType()===c&&ve.compare(g.getAttributes(),d))continue;if(h=g.getOuterRange(),g===i)continue;k.pushRetain(h.start-(i?j.end:0)),k.pushReplace(a,h.start,1,[ve.copy(m)]),k.pushRetain(g.getLength()),k.pushReplace(a,h.end-1,1,[ve.copy(n)]),i=g,j=h}return k.pushFinalRetain(a,i?j.end:0),k},ve.dm.Transaction.newFromWrap=function(a,b,c,d,e,f){function g(a){var b,c=[],d=a.length;for(b=0;d>b;b++)c[c.length]={type:"/"+a[d-b-1].type};return c}var h,i,j,k,l,m,n,o=new ve.dm.Transaction,p=0;if(m=g(e),n=g(f),b.start>c.length)o.pushRetain(b.start-c.length);else if(b.start<c.length)throw new Error("unwrapOuter is longer than the data preceding the range");if(d.length>0||c.length>0){for(j=a.data.slice(b.start-c.length,b.start),h=0;h<j.length;h++)if(j[h].type!==c[h].type)throw new Error("Element in unwrapOuter does not match: expected "+c[h].type+" but found "+j[h].type);o.pushReplace(a,b.start-c.length,c.length,ve.copy(d))}if(f.length>0||e.length>0){for(h=b.start;h<b.end;h++)if(a.data.isElementData(h))if(a.data.isCloseElementData(h))p--,0===p&&(i=h+1-e.length,o.pushRetain(i-k),o.pushReplace(a,i,e.length,ve.copy(n)));else{if(0===p){for(l=a.data.slice(h,h+e.length),i=0;i<l.length;i++)if(l[i].type!==e[i].type)throw new Error("Element in unwrapEach does not match: expected "+e[i].type+" but found "+l[i].type);o.pushReplace(a,h,e.length,ve.copy(f)),k=h+e.length}p++}}else o.pushRetain(b.end-b.start);return o.pushReplace(a,b.end,c.length,g(d)),o.pushFinalRetain(a,b.end+c.length),o},ve.dm.Transaction.reversers={annotate:{method:{set:"clear",clear:"set"}},attribute:{from:"to",to:"from"},replace:{insert:"remove",remove:"insert",insertMetadata:"removeMetadata",removeMetadata:"insertMetadata"},replaceMetadata:{insert:"remove",remove:"insert"}},ve.dm.Transaction.prototype.clone=function(){var a=new this.constructor;return a.operations=ve.copy(this.operations),a.lengthDifference=this.lengthDifference,a
},ve.dm.Transaction.prototype.reversed=function(){var a,b,c,d,e,f,g=new this.constructor;for(a=0,b=this.operations.length;b>a;a++){c=this.operations[a],d=ve.copy(c),e=this.constructor.reversers[c.type]||{};for(f in e)d[f]="string"==typeof e[f]?c[e[f]]:e[f][c[f]];g.operations.push(d)}return g.lengthDifference=-this.lengthDifference,g},ve.dm.Transaction.prototype.isNoOp=function(){return 0===this.operations.length?!0:1===this.operations.length?"retain"===this.operations[0].type:2===this.operations.length?"retain"===this.operations[0].type&&"retainMetadata"===this.operations[1].type:!1},ve.dm.Transaction.prototype.getOperations=function(){return this.operations},ve.dm.Transaction.prototype.hasOperationWithType=function(a){var b,c;for(b=0,c=this.operations.length;c>b;b++)if(this.operations[b].type===a)return!0;return!1},ve.dm.Transaction.prototype.hasContentDataOperations=function(){return this.hasOperationWithType("replace")},ve.dm.Transaction.prototype.hasElementAttributeOperations=function(){return this.hasOperationWithType("attribute")},ve.dm.Transaction.prototype.hasAnnotationOperations=function(){return this.hasOperationWithType("annotate")},ve.dm.Transaction.prototype.getLengthDifference=function(){return this.lengthDifference},ve.dm.Transaction.prototype.hasBeenApplied=function(){return this.applied},ve.dm.Transaction.prototype.markAsApplied=function(){this.applied=!0},ve.dm.Transaction.prototype.translateOffset=function(a,b){var c,d,e,f,g,h=0,i=0;for(c=0;c<this.operations.length;c++)if(d=this.operations[c],"replace"===d.type){if(e=d.insert.length,f=d.remove.length,g=i,i+=e-f,a===h+f)return b&&e>f?a+i-e+f:a+i;if(a===h)return 0===e?h+f+i:h+g;if(a>h&&h+f>a)return h+f+i;h+=f}else if("retain"===d.type){if(a>=h&&a<h+d.length)return a+i;h+=d.length}return a+i},ve.dm.Transaction.prototype.translateRange=function(a,b){var c=this.translateOffset(a.start,!b),d=this.translateOffset(a.end,b);return a.isBackwards()?new ve.Range(d,c):new ve.Range(c,d)},ve.dm.Transaction.prototype.getModifiedRange=function(){var a,b,c,d,e,f=0;for(a=0,b=this.operations.length;b>a;a++)switch(c=this.operations[a],c.type){case"retainMetadata":continue;case"retain":f+=c.length;break;default:void 0===d&&(d=f+(c.insertedDataOffset||0)),"replace"===c.type&&(f+=c.insert.length),e=c.insertedDataLength?d+c.insertedDataLength:f}return void 0===d||void 0===e?null:new ve.Range(d,e)},ve.dm.Transaction.prototype.pushFinalRetain=function(a,b,c){var d=a.data,e=a.metadata,f=e.getData(d.getLength());b<a.data.getLength()&&(this.pushRetain(a.data.getLength()-b),c=0),void 0!==f&&f.length>0&&this.pushRetainMetadata(f.length-(c||0))},ve.dm.Transaction.prototype.pushRetain=function(a){if(0>a)throw new Error("Invalid retain length, cannot retain backwards:"+a);if(a){var b=this.operations.length-1;this.operations.length&&"retain"===this.operations[b].type?this.operations[b].length+=a:this.operations.push({type:"retain",length:a})}},ve.dm.Transaction.prototype.pushRetainMetadata=function(a){if(0>a)throw new Error("Invalid retain length, cannot retain backwards:"+a);if(a){var b=this.operations.length-1;this.operations.length&&"retainMetadata"===this.operations[b].type?this.operations[b].length+=a:this.operations.push({type:"retainMetadata",length:a})}},ve.dm.Transaction.prototype.addSafeRemoveOps=function(a,b,c,d){var e,f,g=0;for(e=b;c>e;e++)a.data.isElementData(e)&&ve.dm.nodeFactory.isNodeInternal(a.data.getType(e))&&(a.data.isCloseElementData(e)?(g--,0===g&&(this.pushRetain(e+1-f),b=e+1)):(0===g&&(this.pushReplace(a,b,e-b,[],d?[]:void 0),f=e),g++));this.pushReplace(a,b,c-b,[],d?[]:void 0)},ve.dm.Transaction.prototype.pushReplaceInternal=function(a,b,c,d,e,f){if(0!==a.length||0!==b.length){var g={type:"replace",remove:a,insert:b};void 0!==c&&void 0!==d&&(g.removeMetadata=c,g.insertMetadata=d),void 0!==e&&void 0!==f&&(g.insertedDataOffset=e,g.insertedDataLength=f),this.operations.push(g),this.lengthDifference+=b.length-a.length}},ve.dm.Transaction.prototype.pushReplace=function(a,b,c,d,e,f,g){if(0!==c||0!==d.length){var h,i=this.operations.length-1,j=i>=0?this.operations[i]:null,k=i>=1?this.operations[i-1]:null,l=new ve.Range(b,b+c),m=a.getData(l),n=a.getMetadata(l),o=ve.compare(n,[]),p=e&&ve.compare(e,[]),q=[];if(e||o?p&&o&&(e=void 0):(e=ve.dm.MetaLinearData["static"].merge(n),0===d.length?(h=e[0],e=[]):ve.batchSplice(e,1,0,new Array(d.length-1)),p=ve.compare(e,new Array(e.length))),j&&"replaceMetadata"===j.type&&j.insert.length>0&&0===j.remove.length&&k&&"replace"===k.type&&0===k.insert.length&&(q=[j.insert],this.operations.pop(),j=k),!(!j||"replace"!==j.type||j.insert.length>0&&void 0!==e||void 0!==j.insertedDataOffset||h||q.length>0&&void 0!==e&&!p))return j=this.operations.pop(),this.lengthDifference-=j.insert.length-j.remove.length,void this.pushReplace(a,b-j.remove.length,j.remove.length+c,j.insert.concat(d),(j.insertMetadata||new Array(j.insert.length)).concat(q).concat(void 0===e||p?new Array(d.length-q.length):e),f,g);if(j&&"replace"===j.type&&0===j.insert.length&&0===d.length&&(void 0===j.removeMetadata||q.length>0)&&(void 0===e||h))return j=this.operations.pop(),this.lengthDifference-=j.insert.length-j.remove.length,void this.pushReplace(a,b-j.remove.length,j.remove.length+c,[]);if(j&&"replaceMetadata"===j.type)throw new Error("replace after replaceMetadata not allowed");this.pushReplaceInternal(m,d,n,e,f,g),void 0!==h&&this.pushReplaceMetadata([],h)}},ve.dm.Transaction.prototype.pushReplaceMetadata=function(a,b){(0!==a.length||0!==b.length)&&this.operations.push({type:"replaceMetadata",remove:a,insert:b})},ve.dm.Transaction.prototype.pushReplaceElementAttribute=function(a,b,c){this.operations.push({type:"attribute",key:a,from:b,to:c})},ve.dm.Transaction.prototype.pushStartAnnotating=function(a,b){this.operations.push({type:"annotate",method:a,bias:"start",annotation:b})},ve.dm.Transaction.prototype.pushStopAnnotating=function(a,b){this.operations.push({type:"annotate",method:a,bias:"stop",annotation:b})},ve.dm.Transaction.prototype.pushInsertion=function(a,b,c,d){var e=a.fixupInsertion(d,c);return this.pushRetain(e.offset-b),this.pushReplace(a,e.offset,e.remove,e.data,void 0,e.insertedDataOffset,e.insertedDataLength),e.offset+e.remove},ve.dm.Transaction.prototype.pushRemoval=function(a,b,c,d){var e,f,g,h,i,j,k=b,l=null,m=null;if(c.isCollapsed())return this.pushRetain(c.start-b),c.start;if(f=a.selectNodes(c,"covered"),0===f.length)throw new Error("Invalid range, cannot remove from "+c.start+" to "+c.end);if(g=f[0],h=f[f.length-1],g.node.canBeMergedWith(h.node))return g.range||h.range?(l=(g.range||g.nodeRange).start,m=(h.range||h.nodeRange).end):(l=g.nodeOuterRange.start,m=h.nodeOuterRange.end),this.pushRetain(l-b),this.addSafeRemoveOps(a,l,m,d),m;for(e=0;e<f.length;e++)f[e].range?(i=f[e].range.start,j=f[e].range.end):(i=f[e].nodeOuterRange.start,j=f[e].nodeOuterRange.end),null===m?(l=i,m=j):m===i?m=j:(this.pushRetain(l-k),this.addSafeRemoveOps(a,l,m,d),k=m,l=i,m=j);return null!==m&&(this.pushRetain(l-k),this.addSafeRemoveOps(a,l,m,d),k=m),k},ve.dm.Selection=function(a){this.documentModel=a},OO.initClass(ve.dm.Selection),ve.dm.Selection["static"].type=null,ve.dm.Selection["static"].newFromJSON=function(a,b){var c=JSON.parse(b),d=ve.dm.selectionFactory.lookup(c.type);if(!d)throw new Error("Unknown selection type "+c.name);return d["static"].newFromHash(a,c)},ve.dm.Selection["static"].newFromHash=function(){throw new Error("ve.dm.Selection subclass must implement newFromHash")},ve.dm.Selection.prototype.toJSON=function(){throw new Error("ve.dm.Selection subclass must implement toJSON")},ve.dm.Selection.prototype.getDescription=function(){throw new Error("ve.dm.Selection subclass must implement getDescription")},ve.dm.Selection.prototype.clone=function(){throw new Error("ve.dm.Selection subclass must implement clone")},ve.dm.Selection.prototype.collapseToStart=function(){throw new Error("ve.dm.Selection subclass must implement collapseToStart")},ve.dm.Selection.prototype.collapseToEnd=function(){throw new Error("ve.dm.Selection subclass must implement collapseToEnd")},ve.dm.Selection.prototype.collapseToFrom=function(){throw new Error("ve.dm.Selection subclass must implement collapseToFrom")},ve.dm.Selection.prototype.collapseToTo=function(){throw new Error("ve.dm.Selection subclass must implement collapseToTo")},ve.dm.Selection.prototype.isCollapsed=function(){throw new Error("ve.dm.Selection subclass must implement isCollapsed")},ve.dm.Selection.prototype.translateByTransaction=function(){throw new Error("ve.dm.Selection subclass must implement translateByTransaction")},ve.dm.Selection.prototype.translateByTransactions=function(a,b){var c,d,e=this;for(c=0,d=a.length;d>c;c++)e=e.translateByTransaction(a[c],b);return e},ve.dm.Selection.prototype.isNull=function(){return!1},ve.dm.Selection.prototype.getRanges=function(){throw new Error("ve.dm.Selection subclass must implement getRanges")},ve.dm.Selection.prototype.getDocument=function(){return this.documentModel},ve.dm.Selection.prototype.equals=function(){throw new Error("ve.dm.Selection subclass must implement equals")},ve.dm.selectionFactory=new OO.Factory,ve.dm.LinearSelection=function(a,b){ve.dm.LinearSelection["super"].call(this,a),this.range=b},OO.inheritClass(ve.dm.LinearSelection,ve.dm.Selection),ve.dm.LinearSelection["static"].name="linear",ve.dm.LinearSelection["static"].newFromHash=function(a,b){return new ve.dm.LinearSelection(a,ve.Range["static"].newFromHash(b.range))},ve.dm.LinearSelection.prototype.toJSON=function(){return{type:this.constructor["static"].name,range:this.range}},ve.dm.LinearSelection.prototype.getDescription=function(){return"Linear: "+this.range.from+" - "+this.range.to},ve.dm.LinearSelection.prototype.clone=function(){return new this.constructor(this.getDocument(),this.getRange())},ve.dm.LinearSelection.prototype.collapseToStart=function(){return new this.constructor(this.getDocument(),new ve.Range(this.getRange().start))},ve.dm.LinearSelection.prototype.collapseToEnd=function(){return new this.constructor(this.getDocument(),new ve.Range(this.getRange().end))},ve.dm.LinearSelection.prototype.collapseToFrom=function(){return new this.constructor(this.getDocument(),new ve.Range(this.getRange().from))},ve.dm.LinearSelection.prototype.collapseToTo=function(){return new this.constructor(this.getDocument(),new ve.Range(this.getRange().to))},ve.dm.LinearSelection.prototype.isCollapsed=function(){return this.getRange().isCollapsed()},ve.dm.Selection.prototype.translateByTransaction=function(a,b){return new this.constructor(this.getDocument(),a.translateRange(this.getRange(),b))},ve.dm.LinearSelection.prototype.getRanges=function(){return[this.range]},ve.dm.LinearSelection.prototype.getRange=function(){return this.range},ve.dm.LinearSelection.prototype.equals=function(a){return a instanceof ve.dm.LinearSelection&&this.getDocument()===a.getDocument()&&this.getRange().equals(a.getRange())},ve.dm.selectionFactory.register(ve.dm.LinearSelection),ve.dm.NullSelection=function(a){ve.dm.NullSelection["super"].call(this,a)},OO.inheritClass(ve.dm.NullSelection,ve.dm.Selection),ve.dm.NullSelection["static"].name="null",ve.dm.NullSelection["static"].newFromHash=function(a){return new ve.dm.NullSelection(a)},ve.dm.NullSelection.prototype.toJSON=function(){return{type:this.constructor["static"].name}},ve.dm.NullSelection.prototype.getDescription=function(){return"Null"},ve.dm.NullSelection.prototype.clone=function(){return new this.constructor(this.getDocument())},ve.dm.NullSelection.prototype.collapseToStart=ve.dm.NullSelection.prototype.clone,ve.dm.NullSelection.prototype.collapseToEnd=ve.dm.NullSelection.prototype.clone,ve.dm.NullSelection.prototype.collapseToFrom=ve.dm.NullSelection.prototype.clone,ve.dm.NullSelection.prototype.collapseToTo=ve.dm.NullSelection.prototype.clone,ve.dm.NullSelection.prototype.isCollapsed=function(){return!0},ve.dm.NullSelection.prototype.translateByTransaction=ve.dm.NullSelection.prototype.clone,ve.dm.NullSelection.prototype.getRanges=function(){return[]},ve.dm.NullSelection.prototype.equals=function(a){return a instanceof ve.dm.NullSelection&&this.getDocument()===a.getDocument()},ve.dm.NullSelection.prototype.isNull=function(){return!0},ve.dm.selectionFactory.register(ve.dm.NullSelection),ve.dm.TableSelection=function(a,b,c,d,e,f,g){ve.dm.TableSelection["super"].call(this,a),this.tableRange=b,this.tableNode=null,this.fromCol=c,this.fromRow=d,this.toCol=void 0===e?this.fromCol:e,this.toRow=void 0===f?this.fromRow:f,this.startCol=e>c?c:e,this.startRow=f>d?d:f,this.endCol=e>c?e:c,this.endRow=f>d?f:d,this.intendedFromCol=this.fromCol,this.intendedFromRow=this.fromRow,this.intendedToCol=this.toCol,this.intendedToRow=this.toRow,g&&this.expand()},OO.inheritClass(ve.dm.TableSelection,ve.dm.Selection),ve.dm.TableSelection["static"].name="table",ve.dm.TableSelection["static"].newFromHash=function(a,b){return new ve.dm.TableSelection(a,ve.Range["static"].newFromHash(b.tableRange),b.fromCol,b.fromRow,b.toCol,b.toRow)},ve.dm.TableSelection.prototype.expand=function(){for(var a,b,c=0,d=1/0,e=1/0,f=-1/0,g=-1/0,h=this.fromCol>this.toCol,i=this.fromRow>this.toRow,j=this.getMatrixCells();j.length>c;){for(b=0;b<j.length;b++)a=j[b],d=Math.min(d,a.col),e=Math.min(e,a.row),f=Math.max(f,a.col+a.node.getColspan()-1),g=Math.max(g,a.row+a.node.getRowspan()-1);this.startCol=d,this.startRow=e,this.endCol=f,this.endRow=g,this.fromCol=h?f:d,this.fromRow=i?g:e,this.toCol=h?d:f,this.toRow=i?e:g,c=j.length,j=this.getMatrixCells()}},ve.dm.TableSelection.prototype.clone=function(){return new this.constructor(this.getDocument(),this.tableRange,this.fromCol,this.fromRow,this.toCol,this.toRow)},ve.dm.TableSelection.prototype.toJSON=function(){return{type:this.constructor["static"].name,tableRange:this.tableRange,fromCol:this.fromCol,fromRow:this.fromRow,toCol:this.toCol,toRow:this.toRow}},ve.dm.TableSelection.prototype.getDescription=function(){return"Table: "+this.tableRange.from+" - "+this.tableRange.to+", c"+this.fromCol+" r"+this.fromRow+" - c"+this.toCol+" r"+this.toRow},ve.dm.TableSelection.prototype.collapseToStart=function(){return new this.constructor(this.getDocument(),this.tableRange,this.startCol,this.startRow,this.startCol,this.startRow)},ve.dm.TableSelection.prototype.collapseToEnd=function(){return new this.constructor(this.getDocument(),this.tableRange,this.endCol,this.endRow,this.endCol,this.endRow)},ve.dm.TableSelection.prototype.collapseToFrom=function(){return new this.constructor(this.getDocument(),this.tableRange,this.fromCol,this.fromRow,this.fromCol,this.fromRow)},ve.dm.TableSelection.prototype.collapseToTo=function(){return new this.constructor(this.getDocument(),this.tableRange,this.toCol,this.toRow,this.toCol,this.toRow)},ve.dm.TableSelection.prototype.getRanges=function(){var a,b,c=[],d=this.getMatrixCells();for(a=0,b=d.length;b>a;a++)c.push(d[a].node.getRange());return c},ve.dm.TableSelection.prototype.getOuterRanges=function(){var a,b,c=[],d=this.getMatrixCells();for(a=0,b=d.length;b>a;a++)c.push(d[a].node.getOuterRange());return c},ve.dm.TableSelection.prototype.getMatrixCells=function(a){var b,c,d,e=this.getTableNode().getMatrix(),f=[],g={};for(b=this.startRow;b<=this.endRow;b++)for(c=this.startCol;c<=this.endCol;c++)d=e.getCell(b,c),d&&(!a&&d.isPlaceholder()&&(d=d.owner),g[d.key]||(f.push(d),g[d.key]=!0));return f},ve.dm.TableSelection.prototype.isCollapsed=function(){return!1},ve.dm.TableSelection.prototype.translateByTransaction=function(a,b){var c=a.translateRange(this.tableRange,b);return c.isCollapsed()?new ve.dm.NullSelection(this.getDocument()):new this.constructor(this.getDocument(),c,this.fromCol,this.fromRow,this.toCol,this.toRow)},ve.dm.TableSelection.prototype.isSingleCell=function(){return this.fromRow===this.toRow&&this.fromCol===this.toCol||1===this.getMatrixCells().length?!0:void 0},ve.dm.TableSelection.prototype.getTableNode=function(){return this.tableNode||(this.tableNode=this.getDocument().getBranchNodeFromOffset(this.tableRange.start+1)),this.tableNode},ve.dm.TableSelection.prototype.newFromAdjustment=function(a,b,c,d){function e(a,b,c){for(var d,e=b.col,f=b.row,g=c>0?1:-1;0!==c;){if("col"===a){if(e+=g,e>=h.getColCount(f)||0>e)break}else if(f+=g,f>=h.getRowCount()||0>f)break;d=h.getCell(f,e),d&&!d.equals(b)&&(c-=g,b=d)}return b}var f,g,h=this.getTableNode().getMatrix();return void 0===c&&(c=a),void 0===d&&(d=b),f=h.getCell(this.intendedFromRow,this.intendedFromCol),a&&(f=e("col",f,a)),b&&(f=e("row",f,b)),g=h.getCell(this.intendedToRow,this.intendedToCol),c&&(g=e("col",g,c)),d&&(g=e("row",g,d)),new this.constructor(this.getDocument(),this.tableRange,f.col,f.row,g.col,g.row,!0)},ve.dm.TableSelection.prototype.equals=function(a){return a instanceof ve.dm.TableSelection&&this.getDocument()===a.getDocument()&&this.tableRange.equals(a.tableRange)&&this.fromCol===a.fromCol&&this.fromRow===a.fromRow&&this.toCol===a.toCol&&this.toRow===a.toRow},ve.dm.TableSelection.prototype.isFullRow=function(){var a=this.getTableNode().getMatrix();return this.endCol-this.startCol===a.getColCount()-1},ve.dm.TableSelection.prototype.isFullCol=function(){var a=this.getTableNode().getMatrix();return this.endRow-this.startRow===a.getRowCount()-1},ve.dm.selectionFactory.register(ve.dm.TableSelection),ve.dm.Surface=function(a){OO.EventEmitter.call(this),this.documentModel=a,this.metaList=new ve.dm.MetaList(this),this.selection=new ve.dm.NullSelection(this.getDocument()),this.selectionBefore=new ve.dm.NullSelection(this.getDocument()),this.translatedSelection=null,this.branchNodes={},this.selectedNode=null,this.newTransactions=[],this.stagingStack=[],this.undoStack=[],this.undoIndex=0,this.historyTrackingInterval=null,this.insertionAnnotations=new ve.dm.AnnotationSet(this.getDocument().getStore()),this.coveredAnnotations=new ve.dm.AnnotationSet(this.getDocument().getStore()),this.enabled=!0,this.transacting=!1,this.queueingContextChanges=!1,this.contextChangeQueued=!1,this.getDocument().connect(this,{transact:"onDocumentTransact",precommit:"onDocumentPreCommit",presynchronize:"onDocumentPreSynchronize"})},OO.mixinClass(ve.dm.Surface,OO.EventEmitter),ve.dm.Surface.prototype.disable=function(){this.stopHistoryTracking(),this.enabled=!1,this.emit("history")},ve.dm.Surface.prototype.enable=function(){this.enabled=!0,this.startHistoryTracking(),this.emit("history")},ve.dm.Surface.prototype.startHistoryTracking=function(){this.enabled&&null===this.historyTrackingInterval&&(this.historyTrackingInterval=setInterval(this.breakpoint.bind(this),750))},ve.dm.Surface.prototype.stopHistoryTracking=function(){this.enabled&&null!==this.historyTrackingInterval&&(clearInterval(this.historyTrackingInterval),this.historyTrackingInterval=null)},ve.dm.Surface.prototype.getHistory=function(){return this.newTransactions.length>0?this.undoStack.slice(0).concat([{transactions:this.newTransactions.slice(0)}]):this.undoStack.slice(0)},ve.dm.Surface.prototype.isStaging=function(){return this.stagingStack.length>0},ve.dm.Surface.prototype.getStaging=function(){return this.stagingStack[this.stagingStack.length-1]},ve.dm.Surface.prototype.doesStagingAllowUndo=function(){var a=this.getStaging();return a&&a.allowUndo},ve.dm.Surface.prototype.getStagingTransactions=function(){var a=this.getStaging();return a&&a.transactions},ve.dm.Surface.prototype.pushStaging=function(a){this.isStaging()||(this.breakpoint(),this.stopHistoryTracking(),this.emit("history")),this.stagingStack.push({transactions:[],selectionBefore:new ve.dm.NullSelection(this.getDocument()),allowUndo:!!a})},ve.dm.Surface.prototype.popStaging=function(){if(this.isStaging()){var a,b,c=[],d=this.stagingStack.pop(),e=d.transactions;for(a=e.length-1;a>=0;a--)b=e[a].reversed(),c.push(b);return this.changeInternal(c,void 0,!0),this.isStaging()||(this.startHistoryTracking(),this.emit("history")),e}},ve.dm.Surface.prototype.applyStaging=function(){if(this.isStaging()){var a=this.stagingStack.pop();this.isStaging()?(ve.batchPush(this.getStagingTransactions(),a.transactions),this.getStaging().selectionBefore.isNull()&&(this.getStaging().selectionBefore=a.selectionBefore)):(this.truncateUndoStack(),this.newTransactions=a.transactions,this.selectionBefore=a.selectionBefore,this.breakpoint()),this.isStaging()||(this.startHistoryTracking(),this.emit("history"))}},ve.dm.Surface.prototype.popAllStaging=function(){if(this.isStaging()){for(var a=[];this.isStaging();)ve.batchSplice(a,0,0,this.popStaging());return a}},ve.dm.Surface.prototype.applyAllStaging=function(){for(;this.isStaging();)this.applyStaging()},ve.dm.Surface.prototype.getInsertionAnnotations=function(){return this.insertionAnnotations.clone()},ve.dm.Surface.prototype.setInsertionAnnotations=function(a){this.enabled&&(this.insertionAnnotations=null!==a?a.clone():new ve.dm.AnnotationSet(this.getDocument().getStore()),this.emit("insertionAnnotationsChange",this.insertionAnnotations),this.emit("contextChange"))},ve.dm.Surface.prototype.addInsertionAnnotations=function(a){if(this.enabled){if(a instanceof ve.dm.Annotation)this.insertionAnnotations.push(a);else{if(!(a instanceof ve.dm.AnnotationSet))throw new Error("Invalid annotations");this.insertionAnnotations.addSet(a)}this.emit("insertionAnnotationsChange",this.insertionAnnotations),this.emit("contextChange")}},ve.dm.Surface.prototype.removeInsertionAnnotations=function(a){if(this.enabled){if(a instanceof ve.dm.Annotation)this.insertionAnnotations.remove(a);else{if(!(a instanceof ve.dm.AnnotationSet))throw new Error("Invalid annotations");this.insertionAnnotations.removeSet(a)}this.emit("insertionAnnotationsChange",this.insertionAnnotations),this.emit("contextChange")}},ve.dm.Surface.prototype.canRedo=function(){return this.undoIndex>0&&this.enabled},ve.dm.Surface.prototype.canUndo=function(){return this.hasBeenModified()&&this.enabled&&(!this.isStaging()||this.doesStagingAllowUndo())},ve.dm.Surface.prototype.hasBeenModified=function(){return this.undoStack.length-this.undoIndex>0||!!this.newTransactions.length},ve.dm.Surface.prototype.getDocument=function(){return this.documentModel},ve.dm.Surface.prototype.getMetaList=function(){return this.metaList},ve.dm.Surface.prototype.getSelection=function(){return this.selection},ve.dm.Surface.prototype.getTranslatedSelection=function(){return this.translatedSelection||this.selection},ve.dm.Surface.prototype.getFragment=function(a,b,c){return new ve.dm.SurfaceFragment(this,a||this.selection,b,c)},ve.dm.Surface.prototype.getLinearFragment=function(a,b,c){return new ve.dm.SurfaceFragment(this,new ve.dm.LinearSelection(this.getDocument(),a),b,c)},ve.dm.Surface.prototype.truncateUndoStack=function(){this.undoIndex&&(this.undoStack=this.undoStack.slice(0,this.undoStack.length-this.undoIndex),this.undoIndex=0,this.emit("history"))},ve.dm.Surface.prototype.startQueueingContextChanges=function(){this.queueingContextChanges||(this.queueingContextChanges=!0,this.contextChangeQueued=!1)},ve.dm.Surface.prototype.emitContextChange=function(){this.queueingContextChanges?this.contextChangeQueued=!0:this.emit("contextChange")},ve.dm.Surface.prototype.stopQueueingContextChanges=function(){this.queueingContextChanges&&(this.queueingContextChanges=!1,this.contextChangeQueued&&(this.contextChangeQueued=!1,this.emit("contextChange")))},ve.dm.Surface.prototype.setLinearSelection=function(a){this.setSelection(new ve.dm.LinearSelection(this.getDocument(),a))},ve.dm.Surface.prototype.setNullSelection=function(){this.setSelection(new ve.dm.NullSelection(this.getDocument()))},ve.dm.Surface.prototype.setSelection=function(a){var b,c,d,e,f,g,h,i,j,k={},l=!1,m=!1,n=this.getDocument().data;if(this.enabled){if(this.translatedSelection=null,this.transacting)return void(this.selection=a);this.selection.equals(a)||(l=!0,this.selection=a),a instanceof ve.dm.LinearSelection&&(i=a.getRange(),k.start=this.getDocument().getBranchNodeFromOffset(i.start),k.end=i.isCollapsed()?k.start:this.getDocument().getBranchNodeFromOffset(i.end),i.isCollapsed()||(g=this.getDocument().documentNode.getNodeFromOffset(i.start+1),g&&g.getOuterRange().equalsSelection(i)&&(h=g)),i.isCollapsed()?(b=Math.max(0,i.start-1),n.isContentOffset(b)||(b=-1),c=Math.max(0,i.start),n.isContentOffset(c)||(c=-1),j=n.getAnnotationsFromOffset(i.start)):(b=n.getNearestContentOffset(i.start),c=n.getNearestContentOffset(i.end),j=n.getAnnotationsFromRange(i)),-1===b?f=new ve.dm.AnnotationSet(this.getDocument().getStore()):(d=n.getAnnotationsFromOffset(b),-1!==c?(e=n.getAnnotationsFromOffset(c),f=d.filter(function(a){return a.constructor["static"].applyToAppendedContent||e.containsComparable(a)})):f=d),f.equalsInOrder(this.insertionAnnotations)||this.setInsertionAnnotations(f)),(a instanceof ve.dm.TableSelection||a instanceof ve.dm.NullSelection)&&(m=!0),j&&!j.compareTo(this.coveredAnnotations)&&(this.coveredAnnotations=j,m=!0),(h!==this.selectedNode||k.start!==this.branchNodes.start||k.end!==this.branchNodes.end)&&(this.branchNodes=k,this.selectedNode=h,m=!0),l&&this.emit("select",this.selection.clone()),m&&this.emitContextChange()}},ve.dm.Surface.prototype.selectFirstContentOffset=function(){var a=this.getDocument().data.getNearestContentOffset(0,1);-1!==a?this.setLinearSelection(new ve.Range(a)):this.getDocument().hasSlugAtOffset(0)?this.setLinearSelection(new ve.Range(0)):this.setNullSelection()},ve.dm.Surface.prototype.change=function(a,b){this.changeInternal(a,b,!1)},ve.dm.Surface.prototype.changeInternal=function(a,b,c){var d,e,f,g=this.selection.clone(),h=!1;if(this.enabled){if(this.startQueueingContextChanges(),a){for(a instanceof ve.dm.Transaction&&(a=[a]),this.transacting=!0,d=0,e=a.length;e>d;d++)a[d].isNoOp()||(c||(this.isStaging()?(this.getStagingTransactions().length||(this.getStaging().selectionBefore=g),this.getStagingTransactions().push(a[d])):(this.truncateUndoStack(),this.newTransactions.length||(this.selectionBefore=g),this.newTransactions.push(a[d]))),this.getDocument().commit(a[d]),a[d].hasElementAttributeOperations()&&(h=!0));this.transacting=!1}f=this.selection,b?this.setSelection(b):a&&this.setSelection(this.selection),!g.equals(f)&&f.equals(this.selection)&&this.emit("select",this.selection.clone()),h&&this.emitContextChange(),this.stopQueueingContextChanges()}},ve.dm.Surface.prototype.breakpoint=function(){return this.enabled?this.newTransactions.length>0?(this.undoStack.push({transactions:this.newTransactions,selection:this.selection.clone(),selectionBefore:this.selectionBefore.clone()}),this.newTransactions=[],this.emit("history"),!0):(this.selectionBefore.isNull()&&!this.selection.isNull()&&(this.selectionBefore=this.selection.clone()),!1):!1},ve.dm.Surface.prototype.undo=function(){var a,b,c,d=[];if(this.canUndo()&&(this.isStaging()&&this.popAllStaging(),this.breakpoint(),this.undoIndex++,b=this.undoStack[this.undoStack.length-this.undoIndex])){for(a=b.transactions.length-1;a>=0;a--)c=b.transactions[a].reversed(),d.push(c);this.changeInternal(d,b.selectionBefore,!0),this.emit("history")}},ve.dm.Surface.prototype.redo=function(){var a;this.canRedo()&&(this.breakpoint(),a=this.undoStack[this.undoStack.length-this.undoIndex],a&&(this.changeInternal(ve.copy(a.transactions),a.selection,!0),this.undoIndex--,this.emit("history")))},ve.dm.Surface.prototype.onDocumentTransact=function(a){this.setSelection(this.getSelection().translateByTransaction(a)),this.emit("documentUpdate",a)},ve.dm.Surface.prototype.getSelectedNode=function(){return this.selectedNode},ve.dm.Surface.prototype.onDocumentPreCommit=function(){this.translatedSelection=this.selection.clone()},ve.dm.Surface.prototype.onDocumentPreSynchronize=function(a){this.translatedSelection&&(this.translatedSelection=this.translatedSelection.translateByTransaction(a))},ve.dm.SurfaceFragment=function(a,b,c,d){return a?(this.document=a.getDocument(),this.noAutoSelect=!!c,this.excludeInsertions=!!d,this.surface=a,this.selection=b||a.getSelection(),this.leafNodes=null,void(this.historyPointer=this.document.getCompleteHistoryLength())):this},ve.dm.SurfaceFragment["static"]={},ve.dm.SurfaceFragment.prototype.getSelectedModels=function(a){if(this.isNull())return[];var b,c,d,e,f=this.getAnnotations(a);if(a)for(d=this.getCoveredNodes(),b=0,c=d.length;c>b;b++)d[b].range&&d[b].range.isCollapsed()?(d.splice(b,1),c--,b--):d[b]=d[b].node;else d=[],e=this.getSelectedNode(),e&&d.push(e);return d.concat(f.isEmpty()?[]:f.get())},ve.dm.SurfaceFragment.prototype.update=function(a){if(!this.isNull()){var b;a?(this.selection=a,this.historyPointer=this.document.getCompleteHistoryLength()):this.historyPointer<this.document.getCompleteHistoryLength()&&(b=this.document.getCompleteHistorySince(this.historyPointer),this.selection=this.selection.translateByTransactions(b,this.excludeInsertions),this.historyPointer+=b.length),this.leafNodes=null}},ve.dm.SurfaceFragment.prototype.change=function(a,b){if(!b&&this.isNull())throw new Error("Cannot change null fragment without selection");Array.isArray(a)||(a=[a]),this.surface.change(a,!this.noAutoSelect&&(b||this.getSelection(!0).translateByTransactions(a,this.excludeInsertions))),b&&this.update(b)},ve.dm.SurfaceFragment.prototype.getSurface=function(){return this.surface},ve.dm.SurfaceFragment.prototype.getDocument=function(){return this.document},ve.dm.SurfaceFragment.prototype.getSelection=function(a){return this.update(),a?this.selection:this.selection.clone()},ve.dm.SurfaceFragment.prototype.isNull=function(){return this.selection.isNull()},ve.dm.SurfaceFragment.prototype.willAutoSelect=function(){return!this.noAutoSelect},ve.dm.SurfaceFragment.prototype.setAutoSelect=function(a){return this.noAutoSelect=!a,this},ve.dm.SurfaceFragment.prototype.clone=function(a){return new this.constructor(this.surface,a||this.getSelection(),this.noAutoSelect,this.excludeInsertions)},ve.dm.SurfaceFragment.prototype.willExcludeInsertions=function(){return this.excludeInsertions},ve.dm.SurfaceFragment.prototype.setExcludeInsertions=function(a){a=!!a,this.excludeInsertions!==a&&(this.update(),this.excludeInsertions=a)},ve.dm.SurfaceFragment.prototype.adjustLinearSelection=function(a,b){if(!(this.selection instanceof ve.dm.LinearSelection))return this.clone();var c,d=this.getSelection(!0).getRange();return c=d&&new ve.Range(d.start+(a||0),d.end+(b||0)),this.clone(new ve.dm.LinearSelection(this.getDocument(),c))},ve.dm.SurfaceFragment.prototype.truncateLinearSelection=function(a){if(!(this.selection instanceof ve.dm.LinearSelection))return this.clone();var b=this.getSelection(!0).getRange();return this.clone(new ve.dm.LinearSelection(this.getDocument(),b.truncate(a)))},ve.dm.SurfaceFragment.prototype.collapseToStart=function(){return this.clone(this.getSelection(!0).collapseToStart())},ve.dm.SurfaceFragment.prototype.collapseToEnd=function(){return this.clone(this.getSelection(!0).collapseToEnd())},ve.dm.SurfaceFragment.prototype.trimLinearSelection=function(){if(!(this.selection instanceof ve.dm.LinearSelection))return this.clone();var a=this.getSelection(!0).getRange(),b=a;return b=0===this.getText().trim().length?new ve.Range(a.start):this.document.data.trimOuterSpaceFromRange(a),this.clone(new ve.dm.LinearSelection(this.getDocument(),b))},ve.dm.SurfaceFragment.prototype.expandLinearSelection=function(a,b){if(!(this.selection instanceof ve.dm.LinearSelection))return this.clone();var c,d,e,f,g=this.getSelection(!0).getRange();switch(a||"parent"){case"word":f=g.isCollapsed()?this.document.data.getNearestWordRange(g.start):ve.Range["static"].newCoveringRange([this.document.data.getNearestWordRange(g.start),this.document.data.getNearestWordRange(g.end)],g.isBackwards());break;case"annotation":f=this.document.data.getAnnotatedRangeFromSelection(g,b),g.start>f.start||g.end<f.end?g.from>g.to&&(f=f.flip()):f=g;break;case"root":f=new ve.Range(0,this.getDocument().getInternalList().getListNode().getOuterRange().start);break;case"siblings":d=this.document.selectNodes(g,"siblings"),f=1===d.length?d[0].node.getOuterRange():new ve.Range(d[0].node.getOuterRange().start,d[d.length-1].node.getOuterRange().end);
break;case"closest":for(c=this.document.selectNodes(g,"siblings")[0].node,e=c.getParent();e&&!(e instanceof b);)c=e,e=e.getParent();e&&(f=e.getOuterRange());break;case"parent":c=this.document.selectNodes(g,"siblings")[0].node,e=c.getParent(),e&&(f=e.getOuterRange());break;default:throw new Error("Invalid scope argument: "+a)}return this.clone(f?new ve.dm.LinearSelection(this.getDocument(),f):new ve.dm.NullSelection(this.getDocument()))},ve.dm.SurfaceFragment.prototype.getData=function(a){return this.selection instanceof ve.dm.LinearSelection?this.document.getData(this.getSelection(!0).getRange(),a):[]},ve.dm.SurfaceFragment.prototype.getText=function(){return this.selection instanceof ve.dm.LinearSelection?this.document.data.getText(!1,this.getSelection(!0).getRange()):""},ve.dm.SurfaceFragment.prototype.getAnnotations=function(a){var b,c,d,e,f=this.getSelection(!0),g=new ve.dm.AnnotationSet(this.getDocument().getStore());if(f.isCollapsed())return this.surface.getInsertionAnnotations();for(d=f.getRanges(),b=0,c=d.length;c>b;b++)e=this.getDocument().data.getAnnotationsFromRange(d[b],a),a?g.addSet(e):g=b?g.intersectWith(e):e;return g},ve.dm.SurfaceFragment.prototype.hasAnnotations=function(){var a,b,c=this.getSelection().getRanges();for(a=0,b=c.length;b>a;a++)if(this.getDocument().data.hasAnnotationsInRange(c[a]))return!0;return!1},ve.dm.SurfaceFragment.prototype.getLeafNodes=function(){return this.selection instanceof ve.dm.LinearSelection?(this.update(),this.leafNodes||(this.leafNodes=this.document.selectNodes(this.getSelection().getRange(),"leaves")),this.leafNodes):[]},ve.dm.SurfaceFragment.prototype.getSelectedLeafNodes=function(){var a,b,c=[],d=this.getLeafNodes();for(a=0,b=d.length;b>a;a++)(1===b||!d[a].range||d[a].range.getLength())&&c.push(d[a].node);return c},ve.dm.SurfaceFragment.prototype.getSelectedNode=function(){if(!(this.selection instanceof ve.dm.LinearSelection))return null;var a,b,c=this.getSelection().getRange(),d=this.document.selectNodes(c,"covered");for(a=0,b=d.length;b>a;a++)if(d[a].nodeOuterRange.equalsSelection(c))return d[a].node;return null},ve.dm.SurfaceFragment.prototype.getCoveredNodes=function(){return this.selection instanceof ve.dm.LinearSelection?this.document.selectNodes(this.getSelection().getRange(),"covered"):[]},ve.dm.SurfaceFragment.prototype.getSiblingNodes=function(){return this.selection instanceof ve.dm.LinearSelection?this.document.selectNodes(this.getSelection().getRange(),"siblings"):[]},ve.dm.SurfaceFragment.prototype.select=function(){return this.surface.setSelection(this.getSelection()),this},ve.dm.SurfaceFragment.prototype.changeAttributes=function(a,b){var c,d,e,f=[],g=this.getCoveredNodes();for(c=0,d=g.length;d>c;c++)e=g[c],!e.node.isWrapped()||b&&e.node.getType()!==b||e.range&&e.range.isCollapsed()||f.push(ve.dm.Transaction.newFromAttributeChanges(this.document,e.nodeOuterRange.start,a));return f.length&&this.change(f),this},ve.dm.SurfaceFragment.prototype.annotateContent=function(a,b,c){var d,e,f,g,h,i,j,k,l=this.getSelection(!0).getRanges(),m=[];if(b instanceof ve.dm.Annotation)e=[b];else if(d=ve.dm.annotationFactory.create(b,c),"set"===a)e=[d];else for(e=[],f=0,g=l.length;g>f&&(e=this.document.data.getAnnotationsFromRange(l[f],!0).getAnnotationsByName(d.name).get(),!e.length);f++);for(f=0,g=l.length;g>f;f++)if(k=l[f],k.isCollapsed()){if("set"===a)for(f=0,g=e.length;g>f;f++)this.surface.addInsertionAnnotations(e[f]);else if("clear"===a)for(f=0,g=e.length;g>f;f++)this.surface.removeInsertionAnnotations(e[f])}else for(h=0,i=e.length;i>h;h++)j=ve.dm.Transaction.newFromAnnotation(this.document,k,a,e[h]),m.push(j);return this.change(m),this},ve.dm.SurfaceFragment.prototype.insertContent=function(a,b){if(!(this.selection instanceof ve.dm.LinearSelection))return this;var c,d,e,f;return this.getSelection(!0).isCollapsed()||(c=this.getAnnotations(),this.removeContent()),e=this.getSelection(!0).getRange().start,"string"==typeof a&&(a=a.split("")),a.length&&(b&&!c&&(c=this.document.data.getAnnotationsFromOffset(0===e?0:e-1)),c&&c.getLength()>0&&ve.dm.Document["static"].addAnnotationsToData(a,c),d=ve.dm.Transaction.newFromInsertion(this.document,e,a),f=d.getModifiedRange(),this.change(d,new ve.dm.LinearSelection(this.getDocument(),f))),this},ve.dm.SurfaceFragment.prototype.insertHtml=function(a,b){return this.insertDocument(this.getDocument().newFromHtml(a,b)),this},ve.dm.SurfaceFragment.prototype.insertDocument=function(a){return this.selection instanceof ve.dm.LinearSelection?(this.getSelection(!0).isCollapsed()||this.removeContent(),this.change(new ve.dm.Transaction.newFromDocumentInsertion(this.getDocument(),this.getSelection().getRange().start,a)),this):this},ve.dm.SurfaceFragment.prototype.removeContent=function(){return this.selection instanceof ve.dm.LinearSelection?(this.getSelection(!0).isCollapsed()||this.change(ve.dm.Transaction.newFromRemoval(this.document,this.getSelection(!0).getRange())),this):this},ve.dm.SurfaceFragment.prototype["delete"]=function(a){if(!(this.selection instanceof ve.dm.LinearSelection))return this;var b,c,d,e,f,g,h,i=this.getSelection(!0).getRange();return i.isCollapsed()?this:(c=this.document.getInternalList().getListNode().getOuterRange(),0===i.start&&i.end>=c.start?(d=ve.dm.Transaction.newFromReplacement(this.document,new ve.Range(0,c.start),[{type:"paragraph"},{type:"/paragraph"}]),this.change(d),b=new ve.Range(1)):(d=ve.dm.Transaction.newFromRemoval(this.document,i),this.change(d),b=d.translateRange(i)),b.isCollapsed()||(f=this.document.getBranchNodeFromOffset(b.end,!1),f.getRange().start>=b.end&&(e=this.document.getBranchNodeFromOffset(b.start,!1),e.getRange().isCollapsed()?this.change([ve.dm.Transaction.newFromRemoval(this.document,e.getOuterRange())]):(g=this.document.getData(f.getRange()),h=f,h.traverseUpstream(function(a){var b=a.getParent();return 1===b.children.length?(h=b,!0):!1}),this.change([ve.dm.Transaction.newFromRemoval(this.document,h.getOuterRange()),ve.dm.Transaction.newFromInsertion(this.document,b.start,g)]))),b=new ve.Range(b.start)),this.document.data.isContentOffset(b.start)||(b=this.document.getRelativeRange(b,a||-1)),this.change([],new ve.dm.LinearSelection(this.getDocument(),b)),this)},ve.dm.SurfaceFragment.prototype.convertNodes=function(a,b){return this.selection instanceof ve.dm.LinearSelection?(this.change(ve.dm.Transaction.newFromContentBranchConversion(this.document,this.getSelection().getRange(),a,b)),this):this},ve.dm.SurfaceFragment.prototype.wrapNodes=function(a){return this.selection instanceof ve.dm.LinearSelection?(Array.isArray(a)||(a=[a]),this.change(ve.dm.Transaction.newFromWrap(this.document,this.getSelection().getRange(),[],[],[],a)),this):this},ve.dm.SurfaceFragment.prototype.unwrapNodes=function(a,b){if(!(this.selection instanceof ve.dm.LinearSelection))return this;var c,d=this.getSelection().getRange(),e=[],f=[];if(d.getLength()<2*b)throw new Error("cannot unwrap by greater depth than maximum theoretical depth of selection");for(c=0;b>c;c++)e.push(this.surface.getDocument().data.getData(d.start+c));for(c=a;c>0;c--)f.push(this.surface.getDocument().data.getData(d.start-c));return this.change(ve.dm.Transaction.newFromWrap(this.document,d,f,[],e,[])),this},ve.dm.SurfaceFragment.prototype.rewrapNodes=function(a,b){if(!(this.selection instanceof ve.dm.LinearSelection))return this;var c,d=this.getSelection().getRange(),e=[];if(Array.isArray(b)||(b=[b]),d.getLength()<2*a)throw new Error("cannot unwrap by greater depth than maximum theoretical depth of selection");for(c=0;a>c;c++)e.push(this.surface.getDocument().data.getData(d.start+c));return this.change(ve.dm.Transaction.newFromWrap(this.document,d,[],[],e,b)),this},ve.dm.SurfaceFragment.prototype.wrapAllNodes=function(a){return this.selection instanceof ve.dm.LinearSelection?(Array.isArray(a)||(a=[a]),this.change(ve.dm.Transaction.newFromWrap(this.document,this.getSelection().getRange(),[],a,[],[])),this):this},ve.dm.SurfaceFragment.prototype.rewrapAllNodes=function(a,b){if(!(this.selection instanceof ve.dm.LinearSelection))return this;var c,d=[],e=this.getSelection().getRange(),f=new ve.Range(e.start+a,e.end-a);if(Array.isArray(b)||(b=[b]),e.getLength()<2*a)throw new Error("cannot unwrap by greater depth than maximum theoretical depth of selection");for(c=0;a>c;c++)d.push(this.surface.getDocument().data.getData(e.start+c));return this.change(ve.dm.Transaction.newFromWrap(this.document,f,d,b,[],[])),this},ve.dm.SurfaceFragment.prototype.isolateAndUnwrap=function(a){function b(a,b){var c,d,e,h=0,i=[];for(c=0,d=a.length;d>c;c++)i.unshift({type:"/"+a[c].type}),i.push(a[c].getClonedElement()),b&&(h+=2);e=ve.dm.Transaction.newFromInsertion(p.getDocument(),b?f:g,i),p.change(e),f+=h,g+=h}if(!(this.selection instanceof ve.dm.LinearSelection))return this;var c,d,e,f,g,h,i=0,j=ve.dm.nodeFactory,k=j.getSuggestedParentNodeTypes(a),l=!1,m=!1,n=[],o=[],p=this;for(c=this.getSiblingNodes(),d=c[0].node,f=d.getOuterRange().start;null!==k&&-1===ve.indexOf(d.getParent().type,k);)d.getParent().indexOf(d)>0&&(l=!0),d=d.getParent(),l?n.unshift(d):f=d.getOuterRange().start,i++;for(e=c[c.length-1].node,g=e.getOuterRange().end;null!==k&&-1===ve.indexOf(e.getParent().type,k);)e.getParent().indexOf(e)<e.getParent().getChildren().length-1&&(m=!0),e=e.getParent(),m?o.unshift(e):g=e.getOuterRange().end;return h=this.willExcludeInsertions(),this.setExcludeInsertions(!0),l&&b(n,!0),m&&b(o,!1),this.setExcludeInsertions(h),this.unwrapNodes(i,0),this},ve.dm.DataString=function(a){this.data=a},OO.inheritClass(ve.dm.DataString,unicodeJS.TextString),ve.dm.DataString.prototype.read=function(a){var b=this.data[a];return void 0!==b&&void 0===b.type?"string"==typeof b?b:b[0]:null},ve.dm.Document=function(a,b,c,d,e,f,g){ve.Document.call(this,new ve.dm.DocumentNode);var h,i,j=!0,k=c||this,l=this.documentNode;this.lang=f||"en",this.dir=g||"ltr",this.documentNode.setRoot(l),this.documentNode.setDocument(k),this.internalList=d?d.clone(this):new ve.dm.InternalList(this),this.innerWhitespace=e?ve.copy(e):new Array(2),this.parentDocument=c,this.completeHistory=[],a instanceof ve.dm.ElementLinearData?(j=!1,h=a):h=a instanceof ve.dm.FlatLinearData?a:new ve.dm.FlatLinearData(new ve.dm.IndexValueStore,Array.isArray(a)?a:[]),this.store=h.getStore(),this.htmlDocument=b||ve.createDocumentFromHtml(""),j?(i=this.constructor["static"].splitData(h),this.data=i.elementData,this.metadata=i.metaData):(this.data=h,this.metadata=new ve.dm.MetaLinearData(this.data.getStore(),new Array(1+this.data.getLength())))},OO.inheritClass(ve.dm.Document,ve.Document),ve.dm.Document["static"].splitData=function(a){var b,c,d,e,f,g;for(f=new ve.dm.ElementLinearData(a.getStore()),g=new ve.dm.MetaLinearData(a.getStore()),b=0,c=a.getLength();c>b;b++)if(a.isElementData(b)){if(a.isOpenElementData(b)&&ve.dm.metaItemFactory.lookup(a.getType(b))){e=a.getData(b),d=f.getLength(),g.getData(d)||g.setData(d,[]),g.getData(d).push(e),b++;continue}f.push(a.getData(b))}else f.push(a.getData(b));return g.getLength()<f.getLength()+1&&(g.data=g.data.concat(new Array(1+f.getLength()-g.getLength()))),{elementData:f,metaData:g}},ve.dm.Document["static"].addAnnotationsToData=function(a,b){var c,d,e,f=b.getStore();if(!b.isEmpty())for(c=0,d=a.length;d>c;c++)a[c].type||(Array.isArray(a[c])?(e=new ve.dm.AnnotationSet(f,a[c][1]),e.addSet(b.clone())):(a[c]=[a[c]],e=b.clone()),a[c][1]=e.getIndexes())},ve.dm.Document.prototype.getDocumentNode=function(){return this.documentNode.length||this.documentNode.getDocument().buildingNodeTree||this.buildNodeTree(),this.documentNode},ve.dm.Document.prototype.buildNodeTree=function(){var a,b,c,d,e,f,g,h,i,j=0,k=!1;for(e=[],f=[this.documentNode],g=[f,e],h=this.documentNode,i=this.documentNode.getDocument(),a=0,b=this.data.getLength();b>a;a++)if(this.data.isElementData(a))if(k&&(h.setLength(j),h=f[f.length-1],k=!1,j=0),this.data.isOpenElementData(a))c=ve.dm.nodeFactory.create(this.data.getType(a),this.data.getData(a)),c.setDocument(i),e.push(c),ve.dm.nodeFactory.canNodeHaveChildren(c.getType())&&(f=e,e=[],g.push(e)),h=c;else{if(ve.dm.nodeFactory.canNodeHaveChildren(h.getType())){if(d=g.pop(),e=f,f=g[g.length-2],!f)throw new Error("Unbalanced input passed to document");ve.batchSplice(h,0,0,d)}h=f[f.length-1]}else k||(c=new ve.dm.TextNode,c.setDocument(i),e.push(c),h=c,k=!0),j++;k&&h.setLength(j),i.buildingNodeTree=!0,ve.batchSplice(this.documentNode,0,0,e),i.buildingNodeTree=!1},ve.dm.Document.prototype.commit=function(a){var b=this;if(a.hasBeenApplied())throw new Error("Cannot commit a transaction that has already been committed");this.emit("precommit"),new ve.dm.TransactionProcessor(this,a).process(function(){b.emit("presynchronize",a)}),this.completeHistory.push(a),this.emit("transact",a)},ve.dm.Document.prototype.getData=function(a,b){return this.data.getDataSlice(a,b)},ve.dm.Document.prototype.getMetadata=function(a,b){return this.metadata.getDataSlice(a,b)},ve.dm.Document.prototype.getHtmlDocument=function(){return this.htmlDocument},ve.dm.Document.prototype.getStore=function(){return this.store},ve.dm.Document.prototype.getInternalList=function(){return this.internalList},ve.dm.Document.prototype.getInnerWhitespace=function(){return this.innerWhitespace},ve.dm.Document.prototype.cloneSliceFromRange=function(a){for(var b,c,d,e,f,g,h,i,j,k,l,m=this.getBranchNodeFromOffset(a.start),n=this.getBranchNodeFromOffset(a.end),o=this.selectNodes(a,"siblings"),p=[],q=[],r=[],s=[];o[0]&&o[0].range&&o[0].range.isCollapsed()&&!o[0].node.isWrapped();)o.shift();for(b=o.length-1;o[b]&&o[b].range&&o[b].range.isCollapsed()&&!o[b].node.isWrapped();)o.pop(),b--;if(0===o.length)g=new ve.dm.ElementLinearData(this.getStore(),[]),i=j=new ve.Range(0);else if(m===n)k=o;else{for(c=o[0],d=o[o.length-1],e=c.node,f=d.node;!e.isWrapped();)e=e.getParent();for(;!f.isWrapped();)f=f.getParent();if(c.range)for(;;){for(;!m.isWrapped();)m=m.getParent();if(p.push(m.getClonedElement()),m===e)break;m=m.getParent()}if(d!==c&&d.range)for(;;){for(;!n.isWrapped();)n=n.getParent();if(q.push({type:"/"+n.getType()}),n===f)break;n=n.getParent()}k=this.selectNodes(new ve.Range(e.getOuterRange().start,f.getOuterRange().end),"covered")}if(!j){for(l=!1,b=k.length-1;b>=0;b--)if(null!==k[b].node.getParentNodeTypes()){l=!0;break}if(l)for(m=k[0].node;m.getParent()&&null!==m.getParentNodeTypes();)m=m.getParent(),r.push(m.getClonedElement()),s.push({type:"/"+m.getType()});g=new ve.dm.ElementLinearData(this.getStore(),r.reverse().concat(p.reverse()).concat(this.data.slice(a.start,a.end)).concat(q).concat(s)),i=new ve.Range(r.length+p.length,r.length+p.length+a.getLength()),j=new ve.Range(r.length,r.length+p.length+a.getLength()+q.length)}return ve.batchSplice(g.data,g.getLength(),0,this.getData(this.getInternalList().getListNode().getOuterRange(),!0)),h=new ve.dm.DocumentSlice(g,void 0,void 0,this.getInternalList().clone(),i,j)},ve.dm.Document.prototype.cloneFromRange=function(a){var b,c,d=this.getStore().clone(),e=this.getInternalList().getListNode().getOuterRange();return b=ve.copy(this.getFullData(a,!0)),(a.start>e.start||a.end<e.end)&&(b=b.concat(this.getFullData(e))),c=new this.constructor(new ve.dm.FlatLinearData(d,b),this.getHtmlDocument(),void 0,this.getInternalList(),void 0,this.getLang(),this.getDir()),c.origDoc=this,c.origInternalListLength=this.internalList.getItemNodeCount(),c},ve.dm.Document.prototype.spliceMetadata=function(a,b,c,d){var e=this.metadata.getData(a);return e||(e=[],this.metadata.setData(a,e)),d=d||[],ve.batchSplice(e,b,c,d)},ve.dm.Document.prototype.getFullData=function(a,b){var c,d,e=a?a.start:0,f=a?a.end:this.data.getLength(),g=[];for(void 0===b&&(b=!a);f>=e;){if(this.metadata.getData(e)&&(b||e!==a.start&&e!==a.end))for(c=0,d=this.metadata.getData(e).length;d>c;c++)g.push(this.metadata.getData(e)[c]),g.push({type:"/"+this.metadata.getData(e)[c].type});f>e&&g.push(this.data.getData(e)),e++}return g},ve.dm.Document.prototype.getSiblingWordBoundary=function(a,b){var c=new ve.dm.DataString(this.getData());return unicodeJS.wordbreak.moveBreakOffset(b,c,a,!0)},ve.dm.Document.prototype.getRelativeOffset=function(a,b,c){var d,e,f,g,h,i=this.data;return"word"===c?(f=this.getSiblingWordBoundary(a,b),a===f&&(f=this.getRelativeOffset(a,b,"character")),f):(g=a+(b>0?0:-1),i.isElementData(g)&&ve.dm.nodeFactory.isNodeFocusable(i.getType(g))?a+b:(d=i.getRelativeContentOffset(a,b),e=i.getRelativeStructuralOffset(a,b,!0),(0>e-a?-1:1)!==b?e=a:h=(0>e-a?-1:1)===b&&i.isElementData(e+b)&&ve.dm.nodeFactory.isNodeFocusable(i.getType(e+b)),h||this.hasSlugAtOffset(e)?(h&&(e+=b),d===a||(0>d-a?-1:1)!==b?e:b>0?Math.min(d,e):Math.max(d,e)):b>0?Math.max(d,a):Math.min(d,a)))},ve.dm.Document.prototype.getRelativeRange=function(a,b,c,d,e){var f,g,h,i,j=a.to;if(!a.isCollapsed()&&!d){if(h=b>0?a.end:a.start,this.data.isContentOffset(h)||this.hasSlugAtOffset(h))return new ve.Range(h);j=h}return f=this.getRelativeOffset(j,b,c),g=this.getNearestFocusableNode(j,b,f),i=g?g.getOuterRange(-1===b):new ve.Range(f),e&&!e.containsRange(i)?a:d?new ve.Range(a.from,i.to):i},ve.dm.Document.prototype.getNearestFocusableNode=function(a,b,c){var d;return this.data.getRelativeOffset(a,1===b?0:-1,function(b,c){return b>=Math.max(a,c)||b<Math.min(a,c)?!0:this.isOpenElementData(b)&&ve.dm.nodeFactory.isNodeFocusable(this.getType(b))?(d=b+1,!0):this.isCloseElementData(b)&&ve.dm.nodeFactory.isNodeFocusable(this.getType(b))?(d=b,!0):void 0},c),d?this.getDocumentNode().getNodeFromOffset(d):null},ve.dm.Document.prototype.getBranchNodeFromOffset=function(a){if(0>a||a>this.data.getLength())throw new Error("ve.dm.Document.getBranchNodeFromOffset(): offset "+a+" is out of bounds");return ve.Document.prototype.getBranchNodeFromOffset.call(this,a)},ve.dm.Document.prototype.hasSlugAtOffset=function(a){var b=this.getBranchNodeFromOffset(a);return b?b.hasSlugAtOffset(a):!1},ve.dm.Document.prototype.getDataFromNode=function(a){var b=a.getLength(),c=a.getOffset();return c>=0?(a.isWrapped()&&c++,this.data.slice(c,c+b)):null},ve.dm.Document.prototype.rebuildNodes=function(a,b,c,d,e){var f=this.data.sliceObject(d,d+e),g=new this.constructor(f,this.htmlDocument,this),h=g.getDocumentNode().getChildren();return ve.batchSplice(a,b,c,h),h},ve.dm.Document.prototype.fixupInsertion=function(a,b){function c(a,b){var c;if(void 0!==a.type)if("/"!==a.type.charAt(0))0===w.length&&x.length>0&&x[x.length-1].getType()===a.type?f=x.pop():w.push(a),g=a.type;else if(w.length>0)c=w.pop().type;else{if(c=f.getType(),x.push(f),f=f.getParent(),!f)throw new Error("Inserted data is trying to close the root node (at index "+b+")");if(g=c,!(a.type==="/"+c||ve.dm.nodeFactory.canNodeContainContent(a.type.slice(1))&&ve.dm.nodeFactory.canNodeContainContent(c)))throw new Error("Cannot adopt content from "+a.type+" nodes into "+c+" nodes (at index "+b+")")}u.push(a)}var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=[],v=0,w=[],x=[],y=0,z=a.length,A=this;for(f=this.getBranchNodeFromOffset(b),g=f.getType(),h=!1,i=A.data.isOpenElementData(b-1),s=0;s<a.length;s++)if(h&&void 0!==a[s].type&&(g=w.length>0?w[w.length-1].type:f.getType()),void 0===a[s].type||"/"!==a[s].type.charAt(0)){j=a[s].type||"text",o=[],p=[],q=[],ve.dm.nodeFactory.isNodeContent(j)&&!ve.dm.nodeFactory.canNodeContainContent(g)&&(j="paragraph",o.unshift(ve.dm.nodeFactory.getDataElement(j)));do if(k=ve.dm.nodeFactory.getParentNodeTypes(j),m=null===k||-1!==ve.indexOf(g,k),!m){if(0===k.length)throw new Error("Cannot insert "+j+" because it  cannot have a parent (at index "+s+")");j=k[0],o.unshift(ve.dm.nodeFactory.getDataElement(j))}while(!m);do if(l=ve.dm.nodeFactory.getChildNodeTypes(g),n=null===l||-1!==ve.indexOf(j,l),n=n&&!(!ve.dm.nodeFactory.isNodeContent(j)&&ve.dm.nodeFactory.canNodeContainContent(g)),!n){if(i)return this.fixupInsertion(a,b-1);if(p.push({type:"/"+g}),w.length>0)r=w.pop(),g=r.type,q.push(ve.copy(r));else{if(x.push(f),q.push(f.getClonedElement()),f=f.getParent(),!f)throw new Error("Cannot insert "+j+" even  after closing all containing nodes (at index "+s+")");g=f.getType()}}while(!n);if(0===s&&"text"===j&&ve.isUnattachedCombiningMark(a[s])){if(A.data.isElementData(b-1))continue;b--,v++,d=A.data.getCharacterData(b)+a[s],e=A.data.getAnnotationIndexesFromOffset(b),e.length&&(d=[d,e]),a[s]=d}for(t=0;t<p.length;t++)0===s?y++:z++,u.push(p[t]);for(t=0;t<o.length;t++)0===s?y++:z++,c(o[t],s);c(a[s],s),void 0===a[s].type?(h=!0,o.length>0&&(g=j)):g=a[s].type}else c(a[s],s),g=w.length>0?w[w.length-1].type:f.getType();if(x.length>0&&A.data.isCloseElementData(b))return this.fixupInsertion(a,b+1);for(h&&(g=w.length>0?w[w.length-1].type:f.getType());w.length>0;)r=w[w.length-1],c({type:"/"+r.type},s);for(;x.length>0;)r=x[x.length-1],c(r.getClonedElement(),s);return{offset:b,data:u,remove:v,insertedDataOffset:y,insertedDataLength:z}},ve.dm.Document.prototype.newFromHtml=function(a,b){var c=ve.createDocumentFromHtml(a),d=ve.dm.converter.getModelFromDom(c,this.getHtmlDocument()),e=d.data;return d.metadata=new ve.dm.MetaLinearData(d.getStore(),new Array(1+e.getLength())),b&&(e.sanitize(b.external),b.all&&e.sanitize(b.all)),e.remapInternalListKeys(this.getInternalList()),d.buildNodeTree(),d},ve.dm.Document.prototype.findText=function(a,b,c){var d,e,f,g=[],h=this.data.getText(!0,new ve.Range(0,this.getInternalList().getListNode().getOuterRange().start));if(a instanceof RegExp)for(b||(a=new RegExp(a.source,"i")),f=0;null!==(e=a.exec(h.substr(f)));)f+=e.index,d=e[0].length,-1===e[0].indexOf("\n")&&g.push(new ve.Range(f,f+d)),f+=c?d:1;else for(b||(h=h.toLowerCase(),a=a.toLowerCase()),d=a.length,f=-1;-1!==(f=h.indexOf(a,f));)g.push(new ve.Range(f,f+d)),f+=c?d:1;return g},ve.dm.Document.prototype.getCompleteHistoryLength=function(){return this.completeHistory.length},ve.dm.Document.prototype.getCompleteHistorySince=function(a){return this.completeHistory.slice(a)},ve.dm.Document.prototype.getLang=function(){return this.lang},ve.dm.Document.prototype.getDir=function(){return this.dir},ve.dm.DocumentSlice=function(a,b,c,d,e,f){ve.dm.Document.call(this,a,b,c,d),this.originalRange=e,this.balancedRange=f},OO.inheritClass(ve.dm.DocumentSlice,ve.dm.Document),ve.dm.DocumentSlice.prototype.getOriginalData=function(){return this.getData(this.originalRange)},ve.dm.DocumentSlice.prototype.getBalancedData=function(){return this.getData(this.balancedRange)},ve.dm.LinearData=function(a,b){this.store=a,this.data=b||[]},ve.dm.LinearData["static"]={},ve.dm.LinearData["static"].getType=function(a){return this.isCloseElementData(a)?a.type.slice(1):a.type},ve.dm.LinearData["static"].isElementData=function(a){return void 0!==a&&"string"==typeof a.type},ve.dm.LinearData["static"].isOpenElementData=function(a){return this.isElementData(a)&&"/"!==a.type.charAt(0)},ve.dm.LinearData["static"].isCloseElementData=function(a){return this.isElementData(a)&&"/"===a.type.charAt(0)},ve.dm.LinearData.prototype.getData=function(a){return void 0===a?this.data:this.data[a]},ve.dm.LinearData.prototype.setData=function(a,b){this.data[a]=b},ve.dm.LinearData.prototype.push=function(){return Array.prototype.push.apply(this.data,arguments)},ve.dm.LinearData.prototype.getLength=function(){return this.getData().length},ve.dm.LinearData.prototype.getStore=function(){return this.store},ve.dm.LinearData.prototype.slice=function(){return Array.prototype.slice.apply(this.data,arguments)},ve.dm.LinearData.prototype.sliceObject=function(){return new this.constructor(this.getStore(),this.slice.apply(this,arguments))},ve.dm.LinearData.prototype.splice=function(){return Array.prototype.splice.apply(this.data,arguments)},ve.dm.LinearData.prototype.spliceObject=function(){return new this.constructor(this.getStore(),this.splice.apply(this,arguments))},ve.dm.LinearData.prototype.batchSplice=function(a,b,c){return ve.batchSplice(this.getData(),a,b,c)},ve.dm.LinearData.prototype.batchSpliceObject=function(a,b,c){return new this.constructor(this.getStore(),this.batchSplice.call(this,a,b,c))},ve.dm.LinearData.prototype.getDataSlice=function(a,b){var c,d,e=0,f=this.getLength();return void 0!==a&&(e=Math.max(0,Math.min(f,a.start)),c=Math.max(0,Math.min(f,a.end))),d=void 0===c?this.slice(e):this.slice(e,c),b?ve.copy(d):d},ve.dm.LinearData.prototype.clone=function(){return new this.constructor(this.getStore(),ve.copy(this.data))},ve.dm.DocumentSynchronizer=function(a,b){this.document=a,this.actionQueue=[],this.eventQueue=[],this.adjustment=0,this.transaction=b},ve.dm.DocumentSynchronizer.synchronizers={},ve.dm.DocumentSynchronizer.synchronizers.annotation=function(a){var b,c=a.range.translate(this.adjustment),d=this.document.selectNodes(c,"leaves");for(b=0;b<d.length;b++)this.queueEvent(d[b].node,"annotation"),this.queueEvent(d[b].node,"update")},ve.dm.DocumentSynchronizer.synchronizers.attributeChange=function(a){this.queueEvent(a.node,"attributeChange",a.key,a.from,a.to),this.queueEvent(a.node,"update")},ve.dm.DocumentSynchronizer.synchronizers.resize=function(a){var b=a.node,c=b.getParent();c&&"text"===b.getType()&&b.getLength()+a.adjustment===0?c.splice(c.indexOf(b),1):b.adjustLength(a.adjustment),this.adjustment+=a.adjustment},ve.dm.DocumentSynchronizer.synchronizers.insertTextNode=function(a){var b=new ve.dm.TextNode;b.setLength(a.length),a.parentNode.splice(a.index,0,b),this.adjustment+=a.length},ve.dm.DocumentSynchronizer.synchronizers.rebuild=function(a){var b,c,d,e,f=a.oldRange.translate(this.adjustment),g=this.document.selectNodes(f,"siblings");"indexInNode"in g[0]||!g[0].node.getParent()?(c=g[0].node,d=g[0].indexInNode||0,e=0):(b=g[0].node,c=b.getParent(),d=g[0].index,e=g.length),this.document.rebuildNodes(c,d,e,f.from,a.newRange.getLength()),this.adjustment+=a.newRange.getLength()-f.getLength()},ve.dm.DocumentSynchronizer.prototype.getDocument=function(){return this.document},ve.dm.DocumentSynchronizer.prototype.pushAnnotation=function(a){this.actionQueue.push({type:"annotation",range:a})},ve.dm.DocumentSynchronizer.prototype.pushAttributeChange=function(a,b,c,d){this.actionQueue.push({type:"attributeChange",node:a,key:b,from:c,to:d})},ve.dm.DocumentSynchronizer.prototype.pushResize=function(a,b){this.actionQueue.push({type:"resize",node:a,adjustment:b})},ve.dm.DocumentSynchronizer.prototype.pushInsertTextNode=function(a,b,c){this.actionQueue.push({type:"insertTextNode",parentNode:a,index:b,length:c})},ve.dm.DocumentSynchronizer.prototype.pushRebuild=function(a,b){this.actionQueue.push({type:"rebuild",oldRange:a,newRange:b})},ve.dm.DocumentSynchronizer.prototype.queueEvent=function(a){var b=Array.prototype.slice.call(arguments,1),c=OO.getHash(b);a.queuedEventHashes||(a.queuedEventHashes={}),a.queuedEventHashes[c]||(a.queuedEventHashes[c]=!0,this.eventQueue.push({node:a,args:b.concat(this.transaction)}))},ve.dm.DocumentSynchronizer.prototype.synchronize=function(){var a,b,c;for(c=0;c<this.actionQueue.length;c++){if(a=this.actionQueue[c],!Object.prototype.hasOwnProperty.call(ve.dm.DocumentSynchronizer.synchronizers,a.type))throw new Error("Invalid action type "+a.type);ve.dm.DocumentSynchronizer.synchronizers[a.type].call(this,a)}for(c=0;c<this.eventQueue.length;c++)b=this.eventQueue[c],b.node.emit.apply(b.node,b.args),delete b.node.queuedEventHashes;this.actionQueue=[],this.eventQueue=[]},ve.dm.IndexValueStore=function(){this.hashStore={},this.valueStore=[]},ve.dm.IndexValueStore.prototype.index=function(a,b,c){var d;return"string"!=typeof b&&(b=OO.getHash(a)),d=this.indexOfHash(b),(null===d||c)&&(null===d&&(d=this.valueStore.length),this.valueStore[d]=Array.isArray(a)?ve.copy(a):"object"==typeof a?ve.cloneObject(a):a,this.hashStore[b]=d),d},ve.dm.IndexValueStore.prototype.indexOfHash=function(a){return a in this.hashStore?this.hashStore[a]:null},ve.dm.IndexValueStore.prototype.indexes=function(a){var b,c,d=[];for(b=0,c=a.length;c>b;b++)d.push(this.index(a[b]));return d},ve.dm.IndexValueStore.prototype.value=function(a){return this.valueStore[a]},ve.dm.IndexValueStore.prototype.values=function(a){var b,c,d=[];for(b=0,c=a.length;c>b;b++)d.push(this.value(a[b]));return d},ve.dm.IndexValueStore.prototype.clone=function(){var a,b=new this.constructor;b.valueStore=this.valueStore.slice();for(a in this.hashStore)b.hashStore[a]=this.hashStore[a];return b},ve.dm.IndexValueStore.prototype.merge=function(a){var b,c,d={};for(b in a.hashStore)Object.prototype.hasOwnProperty.call(this.hashStore,b)||(c=this.valueStore.push(a.valueStore[a.hashStore[b]])-1,this.hashStore[b]=c),d[a.hashStore[b]]=this.hashStore[b];return d},ve.dm.Converter=function(a,b,c,d){this.modelRegistry=a,this.nodeFactory=b,this.annotationFactory=c,this.metaItemFactory=d,this.doc=null,this.documentData=null,this.store=null,this.internalList=null,this.forClipboard=null,this.contextStack=null},ve.dm.Converter.computedAttributes=["href","src"],ve.dm.Converter.getDataContentFromText=function(a,b){var c,d,e=a.split("");if(!b||b.isEmpty())return e;for(c=0,d=e.length;d>c;c++)e[c]=[e[c],b.getIndexes().slice()];return e},ve.dm.Converter.openAndCloseAnnotations=function(a,b,c,d){var e,f,g,h,i,j;for(j=b.clone(),e=0,f=a.getLength();f>e;e++){if(g=a.getIndex(e),!j.containsIndex(g)&&!j.containsComparableForSerialization(a.get(e))){h=e;break}j.removeIndex(g)}if(void 0!==h)for(e=a.getLength()-1;e>=h;e--)d(a.get(e)),a.removeAt(e);for(i=a.clone(),e=0,f=b.getLength();f>e;e++)g=b.getIndex(e),i.containsIndex(g)||i.containsComparableForSerialization(b.get(e))?i.removeIndex(g):(c(b.get(e)),a.pushIndex(g))},ve.dm.Converter.buildHtmlAttributeList=function(a,b,c,d){var e,f,g,h,i,j,k,l=!0;for(d=d||[],e=0,f=a.length;f>e;e++){for(i=a[e].attributes||[],d[e]={values:{}},g=0,h=i.length;h>g;g++)k=i[g].name,ve.dm.Model.matchesAttributeSpec(k,b)&&(d[e].values[k]=i[g].value,-1!==ve.indexOf(k,this.computedAttributes)&&(d[e].computed||(d[e].computed={}),d[e].computed[k]=a[e][k]),l=!1);c&&(d[e].children=[],j=ve.dm.Converter.buildHtmlAttributeList(a[e].children||[],b,c,d[e].children),j?l=!1:delete d[e].children)}return l?void 0:d},ve.dm.Converter.renderHtmlAttributeList=function(a,b,c,d,e){var f,g,h,i,j;if(void 0===c&&(c=!0),c!==!1)for(f=0,g=a.length;g>f;f++)if(b[f]){i=a[f].values;for(h in i)ve.dm.Model.matchesAttributeSpec(h,c)&&(j=d&&a[f].computed&&a[f].computed[h]||i[h],void 0===j?b[f].removeAttribute(h):(e||!b[f].hasAttribute(h))&&b[f].setAttribute(h,j));a[f].children&&ve.dm.Converter.renderHtmlAttributeList(a[f].children,b[f].children,c,d,e)}},ve.dm.Converter.prototype.isConverting=function(){return null!==this.contextStack},ve.dm.Converter.prototype.getStore=function(){return this.store},ve.dm.Converter.prototype.getHtmlDocument=function(){return this.doc},ve.dm.Converter.prototype.getTargetHtmlDocument=function(){return this.targetDoc},ve.dm.Converter.prototype.isForClipboard=function(){return this.forClipboard},ve.dm.Converter.prototype.getCurrentContext=function(){return null===this.contextStack?null:this.contextStack[this.contextStack.length-1]},ve.dm.Converter.prototype.getActiveAnnotations=function(){var a=this.getCurrentContext();return a?a.annotations:null},ve.dm.Converter.prototype.isExpectingContent=function(){var a=this.getCurrentContext();return a?a.expectingContent:null},ve.dm.Converter.prototype.isInWrapper=function(){var a=this.getCurrentContext();return a?a.inWrapper:null},ve.dm.Converter.prototype.canCloseWrapper=function(){var a=this.getCurrentContext();return a?a.canCloseWrapper:null},ve.dm.Converter.prototype.getDomElementsFromDataElement=function(a,b,c){var d,e=Array.isArray(a)?a[0]:a,f=this.modelRegistry.lookup(e.type);if(!f)throw new Error("Attempting to convert unknown data element type "+e.type);if(f["static"].isInternal)return!1;if(d=f["static"].toDomElements(a,b,this,c),!(Array.isArray(d)||f.prototype instanceof ve.dm.Annotation))throw new Error("toDomElements() failed to return an array when converting element of type "+e.type);return e.htmlAttributes&&ve.dm.Converter.renderHtmlAttributeList(e.htmlAttributes,d),d},ve.dm.Converter.prototype.createDataElements=function(a,b){var c=a["static"].toDataElement(b,this);return c?(Array.isArray(c)||(c=[c]),c):null},ve.dm.Converter.prototype.getDomElementFromDataAnnotation=function(a,b){var c=a.toHtml(),d=b.createElement(c.tag);
return ve.setDomAttributes(d,c.attributes),d},ve.dm.Converter.prototype.getModelFromDom=function(a,b,c,d){var e,f,g,h=new ve.dm.IndexValueStore,i=new ve.dm.InternalList;return b=b||a,this.doc=a,this.targetDoc=b,this.store=h,this.internalList=i,this.contextStack=[],e=new ve.dm.FlatLinearData(h,this.getDataFromDomSubtree(a.body)),f=this.internalList.convertToData(this,a),e.batchSplice(e.getLength(),0,f),g=this.getInnerWhitespace(e),this.doc=null,this.targetDoc=null,this.store=null,this.internalList=null,this.contextStack=null,new ve.dm.Document(e,a,void 0,i,g,c,d)},ve.dm.Converter.prototype.getDataFromDomClean=function(a,b,c){var d,e=this.contextStack;return this.contextStack=[],d=this.getDataFromDomSubtree(a,b,c),this.contextStack=e,d},ve.dm.Converter.prototype.getDataFromDomSubtree=function(a,b,c){function d(a,b,c){c&&(a.internal||(a.internal={}),a.internal.whitespace||(a.internal.whitespace=[]),a.internal.whitespace[b]=c)}function e(a){""!==E&&(d(a,0,E),E="")}function f(a){var b,c,e=[],f=r;for(b=0,c=G.length;c>b;b++)G[b].type&&"/"!==G[b].type.charAt(0)&&(G[b].internal&&G[b].internal.whitespace&&("restore"===a?(e=e.concat(ve.dm.Converter.getDataContentFromText(G[b].internal.whitespace[0],H.annotations)),delete G[b].internal):"fixup"===a&&d(f,3,G[b].internal.whitespace[0])),f=G[b]),e.push(G[b]);""!==F&&"restore"===a?ve.batchSplice(D,B,0,e):D=D.concat(e),G=[]}function g(){r={type:"paragraph",internal:{generated:"wrapper"}},D.push(r),H.inWrapper=!0,H.canCloseWrapper=!0,H.expectingContent=!0,e(r)}function h(){""!==F&&(D.splice(B,F.length),d(G.length>0?G[G.length-2]:r,3,F),E=F),D.push({type:"/paragraph"}),f("fixup"),r=void 0,H.inWrapper=!1,H.canCloseWrapper=!1,H.expectingContent=H.originallyExpectingContent}function i(a){var b,c,d=[],e=[a];if(!a.getAttribute||null===a.getAttribute("about"))return e;for(b=a.getAttribute("about"),c=a.nextSibling;c;c=c.nextSibling)if(c.getAttribute){if(c.getAttribute("about")!==b)break;e=e.concat(d),d=[],e.push(c)}else d.push(c);return e}function j(a,b){var c,d,e;for(c=a.length-1;c>=0;c--){if(d=ve.dm.LinearData["static"].getType(a[c]),!d)return!1;if(e=C.lookup(d)||ve.dm.AlienNode,!(e.prototype===b.prototype||e.prototype instanceof b))return!1}return!0}var k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C=this.modelRegistry,D=[],E="",F="",G=[],H={},I=this.contextStack.length?this.contextStack[this.contextStack.length-1]:null;for(H.annotations=c||(I?I.annotations.clone():new ve.dm.AnnotationSet(this.store)),H.branchType=b?b.type:I?I.branchType:"document",H.branchHasContent=this.nodeFactory.canNodeContainContent(H.branchType),H.originallyExpectingContent=H.branchHasContent||!H.annotations.isEmpty(),H.expectingContent=H.originallyExpectingContent,H.inWrapper=I?I.inWrapper:!1,H.canCloseWrapper=!1,this.contextStack.push(H),b&&D.push(b),k=0;k<a.childNodes.length;k++)switch(l=a.childNodes[k],l.nodeType){case Node.ELEMENT_NODE:case Node.COMMENT_NODE:if(l.getAttribute&&l.getAttribute("data-ve-ignore"))continue;if(y=i(l),u=this.modelRegistry.matchElement(l,y.length>1),v=this.modelRegistry.lookup(u)||ve.dm.AlienNode,m=v.prototype instanceof ve.dm.Annotation?[l]:v["static"].enableAboutGrouping?y:[l],n=this.createDataElements(v,m),n?v=this.modelRegistry.lookup(n[0].type):(v=ve.dm.AlienNode,m=v["static"].enableAboutGrouping?y:[l],n=this.createDataElements(v,m)),v.prototype instanceof ve.dm.Annotation)z=ve.dm.Converter.buildHtmlAttributeList(m,v["static"].storeHtmlAttributes),z&&(n[0].htmlAttributes=z),w=this.annotationFactory.create(u,n[0]),H.inWrapper||H.expectingContent||(g(),s=r),t=H.annotations.clone(),t.push(w),n=this.getDataFromDomSubtree(l,void 0,t),(!n.length||j(n,ve.dm.AlienMetaItem))&&(n=this.createDataElements(ve.dm.AlienMetaItem,m),n.push({type:"/"+n[0].type}),H.annotations.isEmpty()||(n[0].annotations=H.annotations.getIndexes().slice())),f("restore"),D=D.concat(n),F="";else{if(v.prototype instanceof ve.dm.MetaItem){z=ve.dm.Converter.buildHtmlAttributeList(m,v["static"].storeHtmlAttributes,!0),z&&(n[0].htmlAttributes=z),1===n.length&&n.push({type:"/"+n[0].type}),H.annotations.isEmpty()||(n[0].annotations=H.annotations.getIndexes().slice()),H.inWrapper&&H.canCloseWrapper?(G=G.concat(n),""!==F&&(D.splice(B,F.length),d(n[0],0,F),E=F,F="")):(f("restore"),D=D.concat(n),e(n[0]),s=n[0]),k+=m.length-1;break}x=this.nodeFactory.isNodeContent(n[0].type),!H.expectingContent&&x?(g(),s=r):H.expectingContent&&!x&&(H.inWrapper&&H.canCloseWrapper?h():(v=ve.dm.AlienNode,m=v["static"].enableAboutGrouping?y:[l],n=this.createDataElements(v,m),x=this.nodeFactory.isNodeContent(n[0].type))),H.inWrapper&&x&&(f("restore"),F="",E=""),x&&!H.annotations.isEmpty()&&(n[0].annotations=H.annotations.getIndexes().slice()),1===n.length&&1===m.length&&this.nodeFactory.canNodeHaveChildren(n[0].type)&&!this.nodeFactory.doesNodeHandleOwnChildren(n[0].type)?(z=ve.dm.Converter.buildHtmlAttributeList(m,v["static"].storeHtmlAttributes),z&&(n[0].htmlAttributes=z),f("restore"),D=D.concat(this.getDataFromDomSubtree(l,n[0],new ve.dm.AnnotationSet(this.store)))):(1===n.length&&n.push({type:"/"+n[0].type}),z=ve.dm.Converter.buildHtmlAttributeList(m,v["static"].storeHtmlAttributes,!0),z&&(n[0].htmlAttributes=z),f("restore"),D=D.concat(n)),e(n[0]),s=n[0],k+=m.length-1}break;case Node.TEXT_NODE:if(o=l.data,""===o)break;if(!H.originallyExpectingContent){if(o.match(/^\s+$/)){H.inWrapper?(F=o,B=D.length,D=D.concat(ve.dm.Converter.getDataContentFromText(F,H.annotations))):(s?d(s,3,o):b&&d(b,1,o),E=o,F="",f("restore"));break}q=o.match(/^(\s*)([\s\S]*?)(\s*)$/),H.inWrapper?(f("restore"),D=D.concat(ve.dm.Converter.getDataContentFromText(q[1],H.annotations))):(g(),""!==q[1]&&(s?d(s,3,q[1]):b&&d(b,1,q[1]),d(r,0,q[1]))),D=D.concat(ve.dm.Converter.getDataContentFromText(q[2],H.annotations)),F=q[3],B=D.length,D=D.concat(ve.dm.Converter.getDataContentFromText(F,H.annotations)),s=r;break}H.annotations.isEmpty()&&0===k&&b&&!this.nodeFactory.doesNodeHaveSignificantWhitespace(b.type)&&(q=o.match(/^\s+/),q&&""!==q[0]&&(d(b,1,q[0]),o=o.slice(q[0].length))),H.annotations.isEmpty()&&k===a.childNodes.length-1&&b&&!this.nodeFactory.doesNodeHaveSignificantWhitespace(b.type)&&(q=o.match(/\s+$/),q&&""!==q[0]&&(d(b,2,q[0]),o=o.slice(0,o.length-q[0].length))),D=D.concat(ve.dm.Converter.getDataContentFromText(o,H.annotations))}return H.inWrapper&&H.canCloseWrapper&&(h(),H.inWrapper=!0),p=this.nodeFactory.getChildNodeTypes(H.branchType),"paragraph"===H.branchType||!b||D[D.length-1]!==b||H.inWrapper||this.nodeFactory.canNodeContainContent(H.branchType)||this.nodeFactory.isNodeContent(H.branchType)||null!==p&&-1===ve.indexOf("paragraph",p)||(A={type:"paragraph",internal:{generated:"empty"}},e(A),D.push(A),D.push({type:"/paragraph"})),b&&(""!==E&&D[D.length-1]!==b&&(d(b,2,E),E=""),D.push({type:"/"+b.type})),"document"===H.branchType&&j(D,ve.dm.MetaItem)&&!c&&(A={type:"paragraph",internal:{generated:"empty"}},e(A),D.push(A),D.push({type:"/paragraph"})),this.contextStack.pop(),D},ve.dm.Converter.prototype.getInnerWhitespace=function(a){var b,c=new Array(2),d=0,e=a.getLength()-1;if(a.isOpenElementData(0)&&(b=ve.getProp(a.getData(0),"internal","whitespace"),c[0]=b?b[0]:void 0),a.isCloseElementData(e)){for(d++;--e;)if(a.isCloseElementData(e))d++;else if(a.isOpenElementData(e)&&(d--,0===d&&"internalList"!==a.getType(e)))break;b=ve.getProp(a.getData(e),"internal","whitespace"),c[1]=b?b[3]:void 0}return c},ve.dm.Converter.prototype.isDomAllMetaOrWhitespace=function(a,b){var c,d,e,f;for(c=0;c<a.length;c++){switch(d=a[c],d.nodeType){case Node.ELEMENT_NODE:case Node.COMMENT_NODE:if(e=this.modelRegistry.matchElement(d,!1,b),f=this.modelRegistry.lookup(e)||ve.dm.AlienNode,!(f.prototype instanceof ve.dm.Annotation||f.prototype instanceof ve.dm.MetaItem))return!1;if(d.childNodes.length&&!this.isDomAllMetaOrWhitespace(d.childNodes,b))return!1;continue;case Node.TEXT_NODE:if(!d.data.match(/\S/))continue}return!1}return!0},ve.dm.Converter.prototype.getDomFromModel=function(a,b){var c=ve.createDocumentFromHtml("");return this.getDomSubtreeFromModel(a,c.body,b),c},ve.dm.Converter.prototype.getDomSubtreeFromModel=function(a,b,c){this.documentData=a.getFullData(),this.store=a.getStore(),this.internalList=a.getInternalList(),this.forClipboard=!!c,this.getDomSubtreeFromData(this.documentData,b,a.getInnerWhitespace()),this.documentData=null,this.store=null,this.internalList=null,this.forClipboard=null},ve.dm.Converter.prototype.getDomSubtreeFromData=function(a,b,c){function d(){i.length>0&&(C.push(G.createTextNode(i)),i=""),C=[],B.push(C)}function e(a){var b,c,d,e;if(i.length>0&&(C.push(G.createTextNode(i)),i=""),e=B.pop(),C=B[B.length-1],d=F.getDomElementsFromDataElement(a.getElement(),G,e)[0]){for(b=0,c=e.length;c>b;b++)d.appendChild(e[b]);C.push(d)}else for(b=0,c=e.length;c>b;b++)C.push(e[b])}function f(b){var c,d;for(c=b+1,d=1;D>c&&d>0;c++)a[c].type&&(d+="/"===a[c].type.charAt(0)?-1:1);if(0!==d)throw new Error("Unbalanced data: "+d+" element(s) left open.");return c}function g(){var b;return b=ve.dm.nodeFactory.lookup(a[j].type)&&ve.dm.nodeFactory.doesNodeHandleOwnChildren(a[j].type)?a.slice(j,f(j)):a[j]}function h(){var b,c;for(j=0;D>j;j++)a[j].type&&"/"!==a[j].type.charAt(0)&&ve.dm.nodeFactory.lookup(a[j].type)&&ve.dm.nodeFactory.isNodeInternal(a[j].type)&&(b||(b=a.slice()),c=f(j),b.splice(j-(D-b.length),c-j),j=c-1);b&&(a=b,D=a.length)}var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=a.length,E=[],F=this,G=b.ownerDocument,H=b,I=new ve.dm.AnnotationSet(this.store);for(h(),j=0;D>j;j++)if("string"==typeof a[j]){for(i="",l=j>0&&ve.dm.LinearData["static"].isOpenElementData(a[j-1])&&!ve.dm.nodeFactory.doesNodeHaveSignificantWhitespace(ve.dm.LinearData["static"].getType(a[j-1]));"string"==typeof a[j];)l&&a[j].match(/\s/)||(i+=a[j],l=!1),j++;j--,i.length>0&&H.appendChild(G.createTextNode(i))}else if(Array.isArray(a[j])||void 0!==a[j].annotations&&(this.metaItemFactory.lookup(a[j].type)||this.nodeFactory.isNodeContent(a[j].type))){for(i="",C=[],B=[C];void 0!==a[j]&&(Array.isArray(a[j])||void 0!==a[j].annotations&&(this.metaItemFactory.lookup(a[j].type)||this.nodeFactory.isNodeContent(a[j].type)));){if(m=new ve.dm.AnnotationSet(this.store,a[j].annotations||a[j][1]),ve.dm.Converter.openAndCloseAnnotations(I,m,d,e),void 0===a[j].annotations)i+=a[j][0];else{for(i.length>0&&(C.push(G.createTextNode(i)),i=""),o=g(),p=this.getDomElementsFromDataElement(o,G),k=0;k<p.length;k++)C.push(p[k]);Array.isArray(o)?j+=o.length-1:j++}j++}for(j--,i.length>0&&(C.push(G.createTextNode(i)),i=""),ve.dm.Converter.openAndCloseAnnotations(I,new ve.dm.AnnotationSet(this.store),d,e),k=0;k<C.length;k++)H.appendChild(C[k])}else if(void 0!==a[j].type)if(n=a[j],"/"===n.type.charAt(0)){if(t=H.parentNode,A=a[j].type.slice(1),this.metaItemFactory.lookup(A)?v=E[E.length-1]:(v=this.nodeFactory.isNodeContent(A),E.pop()),!v&&H.veInternal&&H.veInternal.whitespace?(q=H.veInternal.whitespace[1],q&&(H.firstChild&&H.firstChild.nodeType===Node.TEXT_NODE?H.firstChild.insertData(0,q):(z=G.createTextNode(q),z.veIsWhitespace=!0,H.insertBefore(z,H.firstChild))),u=H.veInternal.childDomElements?H.veInternal.childDomElements[H.veInternal.childDomElements.length-1].lastChild:H.lastChild,r=H.veInternal.whitespace[2],s=void 0===H.lastOuterPost?r:H.lastOuterPost,r&&r===s&&(u&&u.nodeType===Node.TEXT_NODE?H.lastChild.appendData(r):(z=G.createTextNode(r),z.veIsWhitespace=!0,H.appendChild(z))),t.lastOuterPost=H.veInternal.whitespace[3]||""):v||(t.lastOuterPost=""),y=!1,H.veInternal)switch(H.veInternal.generated){case"slug":0===H.childNodes.length&&(y=!0);break;case"empty":0!==H.childNodes.length||j!==a.length-1&&"/"!==a[j+1].type.charAt(0)||(y=!0);break;case"wrapper":for(y=!0,x=H.parentElement.childNodes,k=x.length-2;k>=0;k--){if(w=x[k],w.nodeType===Node.TEXT_NODE&&!w.veIsWhitespace){y=!1;break}if(ve.isBlockElement(w))break}}if(y){for(;H.firstChild;)t.insertBefore(H.firstChild,H);t.removeChild(H)}delete H.veInternal,delete H.lastOuterPost,ve.dm.nodeFactory.lookup(A)&&ve.dm.nodeFactory.isNodeInternal(A)||(H=t)}else{if(this.metaItemFactory.lookup(a[j].type)?v=E[E.length-1]:(E.push(E[E.length-1]||this.nodeFactory.canNodeContainContent(a[j].type)),v=this.nodeFactory.isNodeContent(a[j].type)),o=g(),p=this.getDomElementsFromDataElement(o,G),p&&!p.length){j=f(j)-1;continue}if(p){for(p[0].veInternal=ve.extendObject({childDomElements:p},n.internal?ve.copy(n.internal):{}),k=0;k<p.length;k++)H.appendChild(p[k]);t=H,H=p[0],H.veInternal&&H.veInternal.whitespace?(r=H.veInternal.whitespace[0],s=void 0,H.previousSibling?s=t.lastOuterPost:t===b?s=c?c[0]:r:t.veInternal&&t.veInternal.whitespace&&(s=t.veInternal.whitespace[1],t.veInternal.whitespace[1]=void 0),r&&r===s&&(z=G.createTextNode(r),z.veIsWhitespace=!0,t.insertBefore(z,H))):!v&&!H.previousSibling&&t.veInternal&&t.veInternal.whitespace&&(t.veInternal.whitespace[1]=void 0)}Array.isArray(o)&&(j+=o.length-2)}void 0===b.lastOuterPost||c&&b.lastOuterPost!==c[1]||(b.lastChild&&b.lastChild.nodeType===Node.TEXT_NODE?b.lastChild.appendData(b.lastOuterPost):b.lastOuterPost.length>0&&b.appendChild(G.createTextNode(b.lastOuterPost)),delete b.lastOuterPost),ve.normalizeNode(b)},ve.dm.converter=new ve.dm.Converter(ve.dm.modelRegistry,ve.dm.nodeFactory,ve.dm.annotationFactory,ve.dm.metaItemFactory),ve.dm.FlatLinearData=function(){ve.dm.FlatLinearData["super"].apply(this,arguments)},OO.inheritClass(ve.dm.FlatLinearData,ve.dm.LinearData),ve.dm.FlatLinearData.prototype.getType=function(a){return ve.dm.LinearData["static"].getType(this.getData(a))},ve.dm.FlatLinearData.prototype.isElementData=function(a){return ve.dm.LinearData["static"].isElementData(this.getData(a))},ve.dm.FlatLinearData.prototype.containsElementData=function(){for(var a=this.getLength();a--;)if(this.isElementData(a))return!0;return!1},ve.dm.FlatLinearData.prototype.isOpenElementData=function(a){return ve.dm.LinearData["static"].isOpenElementData(this.getData(a))},ve.dm.FlatLinearData.prototype.isCloseElementData=function(a){return ve.dm.LinearData["static"].isCloseElementData(this.getData(a))},ve.dm.ElementLinearData=function(){ve.dm.ElementLinearData["super"].apply(this,arguments)},OO.inheritClass(ve.dm.ElementLinearData,ve.dm.FlatLinearData),ve.dm.ElementLinearData["static"].compareElements=function(a,b){if(void 0===a||void 0===b)return!1;var c=a,d=b;return Array.isArray(a)&&(c=a[0]),Array.isArray(b)&&(d=b[0]),a&&a.type&&(c={type:a.type,attributes:a.attributes}),b&&b.type&&(d={type:b.type,attributes:b.attributes}),ve.compare(c,d)},ve.dm.ElementLinearData.prototype.isContentOffset=function(a){if(0===a||a===this.getLength())return!1;var b=this.getData(a-1),c=this.getData(a),d=ve.dm.nodeFactory;return void 0!==b&&void 0!==c&&("string"==typeof b||"string"==typeof c||Array.isArray(b)||Array.isArray(c)||"string"==typeof b.type&&"/"===b.type.charAt(0)&&d.isNodeContent(b.type.slice(1))||"string"==typeof c.type&&"/"!==c.type.charAt(0)&&d.isNodeContent(c.type)||"/"+b.type===c.type&&d.canNodeContainContent(b.type))},ve.dm.ElementLinearData.prototype.isStructuralOffset=function(a,b){if(0===a||a===this.getLength())return!0;var c=this.getData(a-1),d=this.getData(a),e=ve.dm.nodeFactory;return!(void 0===c||void 0===d||"string"!=typeof c.type||"string"!=typeof d.type||("/"!==c.type.charAt(0)||!e.canNodeHaveChildren(c.type.slice(1))&&e.isNodeContent(c.type.slice(1))||b&&null!==e.getParentNodeTypes(c.type.slice(1)))&&("/"===d.type.charAt(0)||!e.canNodeHaveChildren(d.type)&&e.isNodeContent(d.type)||b&&null!==e.getParentNodeTypes(d.type))&&("/"+c.type!==d.type||!e.canNodeHaveChildrenNotContent(c.type)||b&&null!==e.getChildNodeTypes(c.type)))},ve.dm.ElementLinearData.prototype.isContentData=function(){for(var a,b=this.getLength();b--;)if(a=this.getData(b),void 0!==a.type&&"/"!==a.type.charAt(0)&&!ve.dm.nodeFactory.isNodeContent(a.type))return!1;return!0},ve.dm.ElementLinearData.prototype.getAnnotationIndexesFromOffset=function(a,b){if(0>a||a>this.getLength())throw new Error("offset "+a+" out of bounds");b||!this.isCloseElementData(a)||ve.dm.nodeFactory.canNodeHaveChildren(this.getType(a))||(a=this.getRelativeContentOffset(a,-1));var c=this.getData(a);return void 0===c||"string"==typeof c?[]:c.annotations?c.annotations.slice():c[1]?c[1].slice():[]},ve.dm.ElementLinearData.prototype.getAnnotationsFromOffset=function(a,b){return new ve.dm.AnnotationSet(this.getStore(),this.getAnnotationIndexesFromOffset(a,b))},ve.dm.ElementLinearData.prototype.setAnnotationsAtOffset=function(a,b){this.setAnnotationIndexesAtOffset(a,this.getStore().indexes(b.get()))},ve.dm.ElementLinearData.prototype.setAnnotationIndexesAtOffset=function(a,b){var c,d=this.getData(a),e=this.isElementData(a);b.length>0?e?d.annotations=b:(c=this.getCharacterData(a),this.setData(a,[c,b])):e?delete d.annotations:(c=this.getCharacterData(a),this.setData(a,c))},ve.dm.ElementLinearData.prototype.getCharacterData=function(a){var b=this.getData(a),c=Array.isArray(b)?b[0]:b;return"string"==typeof c?c:""},ve.dm.ElementLinearData.prototype.getAnnotatedRangeFromOffset=function(a,b){var c=a,d=a;if(this.getAnnotationsFromOffset(a).contains(b)===!1)return null;for(;c>0;)if(c--,this.getAnnotationsFromOffset(c).contains(b)===!1){c++;break}for(;d<this.getLength()&&this.getAnnotationsFromOffset(d).contains(b)!==!1;)d++;return new ve.Range(c,d)},ve.dm.ElementLinearData.prototype.getAnnotatedRangeFromSelection=function(a,b){for(var c=a.start,d=a.end;c>0;)if(c--,this.getAnnotationsFromOffset(c).contains(b)===!1){c++;break}for(;d<this.getLength()&&this.getAnnotationsFromOffset(d).contains(b)!==!1;)d++;return new ve.Range(c,d)},ve.dm.ElementLinearData.prototype.getAnnotationsFromRange=function(a,b){var c,d,e;for(c=a.start;c<a.end;c++)if(!this.isElementData(c)||ve.dm.nodeFactory.isNodeContent(this.getType(c)))if(d){if(e=this.getAnnotationsFromOffset(c),b&&!e.isEmpty())d.addSet(e);else if(!b){if(e.isEmpty())return new ve.dm.AnnotationSet(this.getStore());if(d=d.getComparableAnnotationsFromSet(e),d.isEmpty())break}}else if(d=this.getAnnotationsFromOffset(c),0===a.getLength()||1===a.getLength())return d;return d||new ve.dm.AnnotationSet(this.getStore())},ve.dm.ElementLinearData.prototype.hasAnnotationsInRange=function(a){var b;for(b=a.start;b<a.end;b++)if(this.getAnnotationIndexesFromOffset(b,!0).length)return!0;return!1},ve.dm.ElementLinearData.prototype.trimOuterSpaceFromRange=function(a){for(var b=a.start,c=a.end;this.getCharacterData(c-1).match(/\s/);)c--;for(;c>b&&this.getCharacterData(b).match(/\s/);)b++;return a.to<a.end?new ve.Range(c,b):new ve.Range(b,c)},ve.dm.ElementLinearData.prototype.getText=function(a,b){var c,d="";for(b=b||new ve.Range(0,this.getLength()),c=b.start;c<b.end;c++)this.isElementData(c)?a&&(d+="\n"):d+=this.getCharacterData(c);return d},ve.dm.ElementLinearData.prototype.getRelativeOffset=function(a,b,c){var d,e,f,g,h=Array.prototype.slice.call(arguments,3),i=a,j=0,k=!1,l=0;if(0===b){if(c.apply(this,[a].concat(h)))return a;b=1}for(e=0>=a?1:a>=this.getLength()?-1:b>0?1:-1,b=Math.abs(b),d=i+e,a=-1;d>=0&&d<=this.getLength();){if(f=d+(e>0?-1:0),this.isElementData(f)&&ve.dm.nodeFactory.doesNodeHandleOwnChildren(this.getType(f)))if(g=this.isOpenElementData(f),e>0&&g||0>e&&!g)l++;else if(l--,0>l)throw new Error("offset was inside a handlesOwnChildren node");if(c.apply(this,[d].concat(h))){if(!l&&(j++,a=d,b===j))return a}else if(!k&&0===j&&(0>e&&0===d||e>0&&d===this.getLength())){if(c.apply(this,[i].concat(h)))return i;e*=-1,d=i,b=1,k=!0,l=0}d+=e}return a},ve.dm.ElementLinearData.prototype.getRelativeContentOffset=function(a,b){return this.getRelativeOffset(a,b,this.constructor.prototype.isContentOffset)},ve.dm.ElementLinearData.prototype.getNearestContentOffset=function(a,b){if(this.isContentOffset(a))return a;if(void 0===b){var c=this.getRelativeContentOffset(a,-1),d=this.getRelativeContentOffset(a,1);return d-a>a-c?c:d}return this.getRelativeContentOffset(a,b>0?1:-1)},ve.dm.ElementLinearData.prototype.getRelativeStructuralOffset=function(a,b,c){return 0!==b||0!==a&&a!==this.getLength()?this.getRelativeOffset(a,b,this.constructor.prototype.isStructuralOffset,c):a},ve.dm.ElementLinearData.prototype.getNearestStructuralOffset=function(a,b,c){if(this.isStructuralOffset(a,c))return a;if(b)return this.getRelativeStructuralOffset(a,b>0?1:-1,c);var d=this.getRelativeStructuralOffset(a,-1,c),e=this.getRelativeStructuralOffset(a,1,c);return e-a>a-d?d:e},ve.dm.ElementLinearData.prototype.getNearestWordRange=function(a){var b,c,d=new ve.dm.DataString(this.getData());if(a=this.getNearestContentOffset(a),unicodeJS.wordbreak.isBreak(d,a))if(unicodeJS.wordbreak.isBreak(d,a+1)){if(unicodeJS.wordbreak.isBreak(d,a-1))return new ve.Range(a);a--}else a++;return c=unicodeJS.wordbreak.nextBreakOffset(d,a),b=unicodeJS.wordbreak.prevBreakOffset(d,a),new ve.Range(b,c)},ve.dm.ElementLinearData.prototype.getUsedStoreValuesFromRange=function(a){var b,c,d,e,f={};for(b=a.start;b<a.end;b++)for(d=this.getAnnotationIndexesFromOffset(b,!0),e=d.length;e--;)c=d[e],Object.prototype.hasOwnProperty.call(f,c)||(f[c]=this.getStore().value(c));return f},ve.dm.ElementLinearData.prototype.remapStoreIndexes=function(a){var b,c,d,e,f,g;for(b=0,c=this.data.length;c>b;b++){for(f=this.getAnnotationIndexesFromOffset(b,!0),d=0,e=f.length;e>d;d++)f[d]=a[f[d]];this.setAnnotationIndexesAtOffset(b,f),this.isOpenElementData(b)&&(g=ve.dm.nodeFactory.lookup(this.getType(b)),g["static"].remapStoreIndexes(this.data[b],a))}},ve.dm.ElementLinearData.prototype.remapInternalListIndexes=function(a,b){var c,d,e;for(c=0,d=this.data.length;d>c;c++)this.isOpenElementData(c)&&(e=ve.dm.nodeFactory.lookup(this.getType(c)),e["static"].remapInternalListIndexes(this.data[c],a,b))},ve.dm.ElementLinearData.prototype.remapInternalListKeys=function(a){var b,c,d;for(b=0,c=this.data.length;c>b;b++)this.isOpenElementData(b)&&(d=ve.dm.nodeFactory.lookup(this.getType(b)),d["static"].remapInternalListKeys(this.data[b],a))},ve.dm.ElementLinearData.prototype.sanitize=function(a,b,c){var d,e,f,g,h,i,j=this.getAnnotationsFromRange(new ve.Range(0,this.getLength()),!0);if(b)g=new ve.dm.AnnotationSet(this.getStore());else{if(a.removeHtmlAttributes)for(d=0,e=j.getLength();e>d;d++)delete j.get(d).element.htmlAttributes;h=j.filter(function(b){return-1!==ve.indexOf(b.name,a.blacklist)||"textStyle/span"===b.name&&a.removeHtmlAttributes})}for(d=0,e=this.getLength();e>d;d++){if(this.isElementData(d)){if(i=this.getType(d),a.conversions&&a.conversions[i]&&(i=a.conversions[i],this.getData(d).type=(this.isCloseElementData(d)?"/":"")+i),b&&"paragraph"!==i&&ve.dm.nodeFactory.canNodeContainContent(i)&&(i="paragraph",this.setData(d,{type:(this.isCloseElementData(d)?"/":"")+i})),-1!==ve.indexOf(i,a.blacklist)||b&&"paragraph"!==i&&"internalList"!==i){this.splice(d,1),ve.getProp(this.getData(d),"internal","generated")&&(delete this.getData(d).internal.generated,ve.isEmptyObject(this.getData(d).internal)&&delete this.getData(d).internal),d--,e--;continue}if(!c&&d>0&&this.isCloseElementData(d)&&this.isOpenElementData(d-1)&&ve.dm.nodeFactory.canNodeContainContent(i)){this.splice(d-1,2),d-=2,e-=2;continue}}f=this.getAnnotationsFromOffset(d,!0),f.isEmpty()||(b?this.setAnnotationsAtOffset(d,g):h.getLength()&&(f.removeSet(h),this.setAnnotationsAtOffset(d,f))),this.isOpenElementData(d)&&a.removeHtmlAttributes&&delete this.getData(d).htmlAttributes}},ve.dm.ElementLinearData.prototype.cloneElements=function(a){var b,c;for(b=0,c=this.getLength();c>b;b++)this.isOpenElementData(b)&&this.setData(b,ve.dm.Node["static"].cloneElement(this.getData(b),a))},ve.dm.ElementLinearData.prototype.countNonInternalElements=function(){var a,b,c,d=0,e=0;for(a=0,b=this.getLength();b>a;a++)c=this.getType(a),c&&ve.dm.nodeFactory.isNodeInternal(c)?this.isOpenElementData(a)?d++:d--:d||e++;return e},ve.dm.MetaLinearData=function(){ve.dm.MetaLinearData["super"].apply(this,arguments)},OO.inheritClass(ve.dm.MetaLinearData,ve.dm.LinearData),ve.dm.MetaLinearData["static"].merge=function(a){var b,c=[],d=!0;for(b=0;b<a.length;b++)void 0!==a[b]&&(d=!1,c=c.concat(a[b]));return d?[void 0]:[c]},ve.dm.MetaLinearData.prototype.getData=function(a,b){return void 0===a?this.data:void 0===b?this.data[a]:void 0===this.data[a]?void 0:this.data[a][b]},ve.dm.MetaLinearData.prototype.getDataLength=function(a){return void 0===this.data[a]?0:this.data[a].length},ve.dm.MetaLinearData.prototype.getTotalDataLength=function(){for(var a=0,b=this.getLength();b--;)a+=this.getDataLength(b);return a},ve.dm.MetaLinearData.prototype.getAnnotationIndexesFromOffsetAndIndex=function(a,b){var c=this.getData(a,b);return c&&c.annotations||[]},ve.dm.MetaLinearData.prototype.getAnnotationsFromOffsetAndIndex=function(a,b){return new ve.dm.AnnotationSet(this.getStore(),this.getAnnotationIndexesFromOffsetAndIndex(a,b))},ve.dm.MetaLinearData.prototype.setAnnotationsAtOffsetAndIndex=function(a,b,c){var d=this.getData(a,b);c.isEmpty()?delete d.annotations:d.annotations=this.getStore().indexes(c.get())},ve.dm.GeneratedContentNode=function(){},ve.dm.GeneratedContentNode["static"]={},ve.dm.GeneratedContentNode["static"].storeGeneratedContents=function(a,b,c){var d=OO.getHash([this.getHashObject(a),void 0]);return c.index(b,d)},ve.dm.AlienNode=function(){ve.dm.AlienNode["super"].apply(this,arguments),ve.dm.GeneratedContentNode.call(this),ve.dm.FocusableNode.call(this)},OO.inheritClass(ve.dm.AlienNode,ve.dm.LeafNode),OO.mixinClass(ve.dm.AlienNode,ve.dm.FocusableNode),OO.mixinClass(ve.dm.AlienNode,ve.dm.GeneratedContentNode),ve.dm.AlienNode["static"].name="alien",ve.dm.AlienNode["static"].storeHtmlAttributes=!1,ve.dm.AlienNode["static"].enableAboutGrouping=!0,ve.dm.AlienNode["static"].matchRdfaTypes=["ve:Alien"],ve.dm.AlienNode["static"].toDataElement=function(a,b){var c=this.isHybridInline(a,b),d=c?"alienInline":"alienBlock";return{type:d,attributes:{domElements:ve.copy(a)}}},ve.dm.AlienNode["static"].toDomElements=function(a,b){return ve.copyDomElements(a.attributes.domElements,b)},ve.dm.AlienNode["static"].getHashObject=function(a){var b=ve.dm.LeafNode["static"].getHashObject(a);return b.attributes&&b.attributes.domElements&&(b.attributes=ve.copy(b.attributes),b.attributes.domElements=ve.copy(b.attributes.domElements,ve.convertDomElements)),b},ve.dm.AlienBlockNode=function(){ve.dm.AlienBlockNode["super"].apply(this,arguments)},OO.inheritClass(ve.dm.AlienBlockNode,ve.dm.AlienNode),ve.dm.AlienBlockNode["static"].name="alienBlock",ve.dm.AlienInlineNode=function(){ve.dm.AlienInlineNode["super"].apply(this,arguments)},OO.inheritClass(ve.dm.AlienInlineNode,ve.dm.AlienNode),ve.dm.AlienInlineNode["static"].name="alienInline",ve.dm.AlienInlineNode["static"].isContent=!0,ve.dm.modelRegistry.register(ve.dm.AlienNode),ve.dm.modelRegistry.register(ve.dm.AlienBlockNode),ve.dm.modelRegistry.register(ve.dm.AlienInlineNode),ve.dm.BlockquoteNode=function(a,b){ve.dm.BranchNode.call(this,a,b)},OO.inheritClass(ve.dm.BlockquoteNode,ve.dm.BranchNode),ve.dm.BlockquoteNode["static"].name="blockquote",ve.dm.BlockquoteNode["static"].canContainContent=!0,ve.dm.BlockquoteNode["static"].matchTagNames=["blockquote"],ve.dm.modelRegistry.register(ve.dm.BlockquoteNode),ve.dm.BreakNode=function(){ve.dm.BreakNode["super"].apply(this,arguments)},OO.inheritClass(ve.dm.BreakNode,ve.dm.LeafNode),ve.dm.BreakNode["static"].name="break",ve.dm.BreakNode["static"].isContent=!0,ve.dm.BreakNode["static"].matchTagNames=["br"],ve.dm.modelRegistry.register(ve.dm.BreakNode),ve.dm.CenterNode=function(){ve.dm.CenterNode["super"].apply(this,arguments)},OO.inheritClass(ve.dm.CenterNode,ve.dm.BranchNode),ve.dm.CenterNode["static"].name="center",ve.dm.CenterNode["static"].matchTagNames=["center"],ve.dm.modelRegistry.register(ve.dm.CenterNode),ve.dm.DefinitionListItemNode=function(){ve.dm.DefinitionListItemNode["super"].apply(this,arguments)},OO.inheritClass(ve.dm.DefinitionListItemNode,ve.dm.BranchNode),ve.dm.DefinitionListItemNode["static"].name="definitionListItem",ve.dm.DefinitionListItemNode["static"].parentNodeTypes=["definitionList"],ve.dm.DefinitionListItemNode["static"].defaultAttributes={style:"term"},ve.dm.DefinitionListItemNode["static"].matchTagNames=["dt","dd"],ve.dm.DefinitionListItemNode["static"].toDataElement=function(a){var b="dt"===a[0].nodeName.toLowerCase()?"term":"definition";return{type:this.name,attributes:{style:b}}},ve.dm.DefinitionListItemNode["static"].toDomElements=function(a,b){var c=a.attributes&&"term"===a.attributes.style?"dt":"dd";return[b.createElement(c)]},ve.dm.modelRegistry.register(ve.dm.DefinitionListItemNode),ve.dm.DefinitionListNode=function(){ve.dm.DefinitionListNode["super"].apply(this,arguments)},OO.inheritClass(ve.dm.DefinitionListNode,ve.dm.BranchNode),ve.dm.DefinitionListNode["static"].name="definitionList",ve.dm.DefinitionListNode["static"].childNodeTypes=["definitionListItem"],ve.dm.DefinitionListNode["static"].matchTagNames=["dl"],ve.dm.modelRegistry.register(ve.dm.DefinitionListNode),ve.dm.DivNode=function(){ve.dm.DivNode["super"].apply(this,arguments)},OO.inheritClass(ve.dm.DivNode,ve.dm.BranchNode),ve.dm.DivNode["static"].name="div",ve.dm.DivNode["static"].matchTagNames=["div"],ve.dm.modelRegistry.register(ve.dm.DivNode),ve.dm.DocumentNode=function(a){ve.dm.DocumentNode["super"].call(this,null,a),this.root=this},OO.inheritClass(ve.dm.DocumentNode,ve.dm.BranchNode),ve.dm.DocumentNode["static"].name="document",ve.dm.DocumentNode["static"].isWrapped=!1,ve.dm.DocumentNode["static"].parentNodeTypes=[],ve.dm.DocumentNode["static"].matchTagNames=[],ve.dm.modelRegistry.register(ve.dm.DocumentNode),ve.dm.HeadingNode=function(){ve.dm.HeadingNode["super"].apply(this,arguments)},OO.inheritClass(ve.dm.HeadingNode,ve.dm.BranchNode),ve.dm.HeadingNode["static"].name="heading",ve.dm.HeadingNode["static"].canContainContent=!0,ve.dm.HeadingNode["static"].defaultAttributes={level:1},ve.dm.HeadingNode["static"].matchTagNames=["h1","h2","h3","h4","h5","h6"],ve.dm.HeadingNode["static"].toDataElement=function(a){var b={h1:1,h2:2,h3:3,h4:4,h5:5,h6:6},c=b[a[0].nodeName.toLowerCase()];return{type:this.name,attributes:{level:c}}},ve.dm.HeadingNode["static"].toDomElements=function(a,b){var c=a.attributes&&a.attributes.level||1;return[b.createElement("h"+c)]},ve.dm.modelRegistry.register(ve.dm.HeadingNode),ve.dm.InternalItemNode=function(){ve.dm.InternalItemNode["super"].apply(this,arguments)},OO.inheritClass(ve.dm.InternalItemNode,ve.dm.BranchNode),ve.dm.InternalItemNode["static"].name="internalItem",ve.dm.InternalItemNode["static"].matchTagNames=[],ve.dm.InternalItemNode["static"].handlesOwnChildren=!0,ve.dm.InternalItemNode["static"].isInternal=!0,ve.dm.modelRegistry.register(ve.dm.InternalItemNode),ve.dm.InternalListNode=function(){ve.dm.InternalListNode["super"].apply(this,arguments)},OO.inheritClass(ve.dm.InternalListNode,ve.dm.BranchNode),ve.dm.InternalListNode["static"].name="internalList",ve.dm.InternalListNode["static"].childNodeTypes=["internalItem"],ve.dm.InternalListNode["static"].matchTagNames=[],ve.dm.InternalListNode["static"].isInternal=!0,ve.dm.modelRegistry.register(ve.dm.InternalListNode),ve.dm.ListItemNode=function(){ve.dm.ListItemNode["super"].apply(this,arguments)},OO.inheritClass(ve.dm.ListItemNode,ve.dm.BranchNode),ve.dm.ListItemNode["static"].name="listItem",ve.dm.ListItemNode["static"].parentNodeTypes=["list"],ve.dm.ListItemNode["static"].matchTagNames=["li"],ve.dm.modelRegistry.register(ve.dm.ListItemNode),ve.dm.ListNode=function(){ve.dm.ListNode["super"].apply(this,arguments)},OO.inheritClass(ve.dm.ListNode,ve.dm.BranchNode),ve.dm.ListNode["static"].name="list",ve.dm.ListNode["static"].childNodeTypes=["listItem"],ve.dm.ListNode["static"].defaultAttributes={style:"bullet"},ve.dm.ListNode["static"].matchTagNames=["ul","ol"],ve.dm.ListNode["static"].toDataElement=function(a){var b="ol"===a[0].nodeName.toLowerCase()?"number":"bullet";return{type:this.name,attributes:{style:b}}},ve.dm.ListNode["static"].toDomElements=function(a,b){var c=a.attributes&&"number"===a.attributes.style?"ol":"ul";return[b.createElement(c)]},ve.dm.ListNode.prototype.canHaveSlugAfter=function(){return!1},ve.dm.modelRegistry.register(ve.dm.ListNode),ve.dm.ParagraphNode=function(){ve.dm.ParagraphNode["super"].apply(this,arguments)
},OO.inheritClass(ve.dm.ParagraphNode,ve.dm.BranchNode),ve.dm.ParagraphNode["static"].name="paragraph",ve.dm.ParagraphNode["static"].canContainContent=!0,ve.dm.ParagraphNode["static"].matchTagNames=["p"],ve.dm.modelRegistry.register(ve.dm.ParagraphNode),ve.dm.PreformattedNode=function(){ve.dm.PreformattedNode["super"].apply(this,arguments)},OO.inheritClass(ve.dm.PreformattedNode,ve.dm.BranchNode),ve.dm.PreformattedNode["static"].name="preformatted",ve.dm.PreformattedNode["static"].canContainContent=!0,ve.dm.PreformattedNode["static"].hasSignificantWhitespace=!0,ve.dm.PreformattedNode["static"].matchTagNames=["pre"],ve.dm.modelRegistry.register(ve.dm.PreformattedNode),ve.dm.TableCaptionNode=function(){ve.dm.TableCaptionNode["super"].apply(this,arguments)},OO.inheritClass(ve.dm.TableCaptionNode,ve.dm.BranchNode),ve.dm.TableCaptionNode["static"].name="tableCaption",ve.dm.TableCaptionNode["static"].parentNodeTypes=["table"],ve.dm.TableCaptionNode["static"].matchTagNames=["caption"],ve.dm.modelRegistry.register(ve.dm.TableCaptionNode),ve.dm.TableCellNode=function(){ve.dm.TableCellNode["super"].apply(this,arguments),this.connect(this,{attributeChange:"onAttributeChange"})},OO.inheritClass(ve.dm.TableCellNode,ve.dm.BranchNode),ve.dm.TableCellNode["static"].name="tableCell",ve.dm.TableCellNode["static"].parentNodeTypes=["tableRow"],ve.dm.TableCellNode["static"].defaultAttributes={style:"data"},ve.dm.TableCellNode["static"].matchTagNames=["td","th"],ve.dm.TableCellNode["static"].storeHtmlAttributes={blacklist:["colspan","rowspan"]},ve.dm.TableCellNode["static"].toDataElement=function(a){var b={style:"th"===a[0].nodeName.toLowerCase()?"header":"data"},c=a[0].getAttribute("colspan"),d=a[0].getAttribute("rowspan");return null!==c&&(b.originalColspan=c,""===c||isNaN(Number(c))||(b.colspan=Number(c))),null!==d&&(b.originalRowspan=d,""===d||isNaN(Number(d))||(b.rowspan=Number(d))),{type:this.name,attributes:b}},ve.dm.TableCellNode["static"].toDomElements=function(a,b){var c=a.attributes&&"header"===a.attributes.style?"th":"td",d=b.createElement(c),e=a.attributes,f={colspan:e.colspan,rowspan:e.rowspan};return 1===e.colspan&&1!==Number(e.originalColspan)&&(f.colspan=null),1===e.rowspan&&1!==Number(e.originalRowspan)&&(f.rowspan=null),(void 0===e.colspan||e.colspan===Number(e.originalColspan))&&(f.colspan=e.originalColspan),(void 0===e.rowspan||e.rowspan===Number(e.originalRowspan))&&(f.rowspan=e.originalRowspan),ve.setDomAttributes(d,f),[d]},ve.dm.TableCellNode["static"].createData=function(a){var b,c;return a=a||{},b={type:"tableCell",attributes:{style:a.style||"data",rowspan:a.rowspan||1,colspan:a.colspan||1}},c=a.content||[{type:"paragraph",internal:{generated:"wrapper"}},{type:"/paragraph"}],[b].concat(c).concat([{type:"/tableCell"}])},ve.dm.TableCellNode.prototype.getRowspan=function(){return this.element.attributes.rowspan||1},ve.dm.TableCellNode.prototype.getColspan=function(){return this.element.attributes.colspan||1},ve.dm.TableCellNode.prototype.getSpans=function(){return{col:this.getColspan(),row:this.getRowspan()}},ve.dm.TableCellNode.prototype.getStyle=function(){return this.element.attributes.style||"data"},ve.dm.TableCellNode.prototype.onAttributeChange=function(a){!this.getParent()||"colspan"!==a&&"rowspan"!==a||this.getParent().getParent().getParent().getMatrix().invalidate()},ve.dm.modelRegistry.register(ve.dm.TableCellNode),ve.dm.TableNode=function(){ve.dm.TableNode["super"].apply(this,arguments),this.matrix=new ve.dm.TableMatrix(this),this.connect(this,{splice:"onSplice"})},OO.inheritClass(ve.dm.TableNode,ve.dm.BranchNode),ve.dm.TableNode["static"].name="table",ve.dm.TableNode["static"].childNodeTypes=["tableSection","tableCaption"],ve.dm.TableNode["static"].matchTagNames=["table"],ve.dm.TableNode.prototype.onSplice=function(){this.getMatrix().invalidate()},ve.dm.TableNode.prototype.getMatrix=function(){return this.matrix},ve.dm.TableNode.prototype.getCaptionNode=function(){var a,b;for(a=0,b=this.children.length;b>a;a++)if(this.children[a]instanceof ve.dm.TableCaptionNode)return this.children[a];return null},ve.dm.TableNode.prototype.getIterator=function(){return new ve.dm.TableNodeCellIterator(this)},ve.dm.modelRegistry.register(ve.dm.TableNode),ve.dm.TableNodeCellIterator=function(a){OO.EventEmitter.call(this),this.table=a,this.sectionIndex=0,this.rowIndex=0,this.cellIndex=0,this.sectionCount=this.table.children.length,this.rowCount=0,this.cellCount=0,this.sectionNode=null,this.rowNode=null,this.cellNode=null,this.finished=!1},OO.mixinClass(ve.dm.TableNodeCellIterator,OO.EventEmitter),ve.dm.TableNodeCellIterator.prototype.isFinished=function(){return this.finished},ve.dm.TableNodeCellIterator.prototype.next=function(){if(this.isFinished())throw new Error("TableNodeCellIterator has no more cells left.");return this.nextCell(this),this.cellNode},ve.dm.TableNodeCellIterator.prototype.nextSection=function(){if(this.sectionIndex>=this.sectionCount)return this.finished=!0,void(this.sectionNode=void 0);var a=this.table.children[this.sectionIndex];return this.sectionIndex++,this.rowIndex=0,a instanceof ve.dm.TableSectionNode?(this.sectionNode=a,this.rowCount=this.sectionNode.children.length,this.emit("newSection",this.sectionNode),void 0):void this.nextSection()},ve.dm.TableNodeCellIterator.prototype.nextRow=function(){if(this.rowIndex>=this.rowCount&&(this.nextSection(),this.isFinished()))return void(this.rowNode=void 0);var a=this.sectionNode.children[this.rowIndex];return this.rowIndex++,this.cellIndex=0,a instanceof ve.dm.TableRowNode?(this.rowNode=a,this.cellCount=this.rowNode.children.length,this.emit("newRow",this.rowNode),void 0):void this.nextRow()},ve.dm.TableNodeCellIterator.prototype.nextCell=function(){if(this.sectionNode||this.nextSection(),this.rowNode||this.nextRow(),this.cellIndex>=this.cellCount&&(this.nextRow(),this.isFinished()))return void(this.cellNode=void 0);var a=this.rowNode.children[this.cellIndex];this.cellNode=a instanceof ve.dm.TableCellNode?a:null,this.cellIndex++},ve.dm.TableRowNode=function(){ve.dm.TableRowNode["super"].apply(this,arguments),this.connect(this,{splice:"onSplice"})},OO.inheritClass(ve.dm.TableRowNode,ve.dm.BranchNode),ve.dm.TableRowNode["static"].name="tableRow",ve.dm.TableRowNode["static"].childNodeTypes=["tableCell"],ve.dm.TableRowNode["static"].parentNodeTypes=["tableSection"],ve.dm.TableRowNode["static"].matchTagNames=["tr"],ve.dm.TableRowNode["static"].createData=function(a){a=a||{};var b,c=[],d=a.cellCount||1;for(c.push({type:"tableRow"}),b=0;d>b;b++)c=c.concat(ve.dm.TableCellNode["static"].createData(a));return c.push({type:"/tableRow"}),c},ve.dm.TableRowNode.prototype.onSplice=function(){this.getRoot()&&this.getParent().getParent().getMatrix().invalidate()},ve.dm.modelRegistry.register(ve.dm.TableRowNode),ve.dm.TableSectionNode=function(){ve.dm.TableSectionNode["super"].apply(this,arguments),this.connect(this,{splice:"onSplice"})},OO.inheritClass(ve.dm.TableSectionNode,ve.dm.BranchNode),ve.dm.TableSectionNode["static"].name="tableSection",ve.dm.TableSectionNode["static"].childNodeTypes=["tableRow"],ve.dm.TableSectionNode["static"].parentNodeTypes=["table"],ve.dm.TableSectionNode["static"].defaultAttributes={style:"body"},ve.dm.TableSectionNode["static"].matchTagNames=["thead","tbody","tfoot"],ve.dm.TableSectionNode["static"].toDataElement=function(a){var b={thead:"header",tbody:"body",tfoot:"footer"},c=b[a[0].nodeName.toLowerCase()]||"body";return{type:this.name,attributes:{style:c}}},ve.dm.TableSectionNode["static"].toDomElements=function(a,b){var c={header:"thead",body:"tbody",footer:"tfoot"},d=c[a.attributes&&a.attributes.style||"body"];return[b.createElement(d)]},ve.dm.TableSectionNode.prototype.onSplice=function(){this.getRoot()&&this.getParent().getMatrix().invalidate()},ve.dm.modelRegistry.register(ve.dm.TableSectionNode),ve.dm.TextNode=function(a){ve.dm.TextNode["super"].call(this),this.length=a||0},OO.inheritClass(ve.dm.TextNode,ve.dm.LeafNode),ve.dm.TextNode["static"].name="text",ve.dm.TextNode["static"].isWrapped=!1,ve.dm.TextNode["static"].isContent=!0,ve.dm.TextNode["static"].matchTagNames=[],ve.dm.TextNode.prototype.canHaveSlugBefore=function(){return!1},ve.dm.TextNode.prototype.canHaveSlugAfter=function(){return!1},ve.dm.modelRegistry.register(ve.dm.TextNode),ve.dm.ImageNode=function(){ve.dm.FocusableNode.call(this),ve.dm.ResizableNode.call(this)},OO.mixinClass(ve.dm.ImageNode,ve.dm.FocusableNode),OO.mixinClass(ve.dm.ImageNode,ve.dm.ResizableNode),ve.dm.ImageNode.prototype.createScalable=function(){return new ve.dm.Scalable({currentDimensions:{width:this.getAttribute("width"),height:this.getAttribute("height")},minDimensions:{width:1,height:1}})},ve.dm.BlockImageNode=function(){ve.dm.BlockImageNode["super"].apply(this,arguments),ve.dm.ImageNode.call(this),ve.dm.AlignableNode.call(this)},OO.inheritClass(ve.dm.BlockImageNode,ve.dm.BranchNode),OO.mixinClass(ve.dm.BlockImageNode,ve.dm.ImageNode),OO.mixinClass(ve.dm.BlockImageNode,ve.dm.AlignableNode),ve.dm.BlockImageNode["static"].name="blockImage",ve.dm.BlockImageNode["static"].storeHtmlAttributes={blacklist:["src","width","height","href"]},ve.dm.BlockImageNode["static"].handlesOwnChildren=!0,ve.dm.BlockImageNode["static"].childNodeTypes=["imageCaption"],ve.dm.BlockImageNode["static"].matchTagNames=["figure"],ve.dm.BlockImageNode["static"].toDataElement=function(a,b){function c(a,b){return Array.prototype.filter.call(a.childNodes,function(a){return-1!==b.indexOf(a.nodeName.toLowerCase())})}var d,e=a[0],f=c(e,"img")[0]||null,g=c(e,"figcaption")[0]||null,h={src:f&&f.getAttribute("src")},i=f&&f.getAttribute("width"),j=f&&f.getAttribute("height"),k=f&&f.getAttribute("alt");return void 0!==k&&(h.alt=k),h.width=void 0!==i&&""!==i?Number(i):null,h.height=void 0!==j&&""!==j?Number(j):null,d={type:this.name,attributes:ve.extendObject(ve.dm.AlignableNode["static"].toDataElementAttributes(a,b),h)},g?[d].concat(b.getDataFromDomClean(g,{type:"imageCaption"})).concat([{type:"/"+this.name}]):[d,{type:"imageCaption"},{type:"/imageCaption"},{type:"/"+this.name}]},ve.dm.BlockImageNode["static"].toDomElements=function(a,b,c){var d=a[0],e=d.attributes.width,f=d.attributes.height,g=b.createElement("figure"),h=b.createElement("img"),i=b.createElement("div"),j=a.slice(1,-1);if(h.setAttribute("src",d.attributes.src),h.setAttribute("width",e),h.setAttribute("height",f),void 0!==d.attributes.alt&&h.setAttribute("alt",d.attributes.alt),g.appendChild(h),j.length>2)for(c.getDomSubtreeFromData(a.slice(1,-1),i);i.firstChild;)g.appendChild(i.firstChild);return ve.dm.AlignableNode["static"].modifyDomElement(g,d),[g]},ve.dm.BlockImageNode.prototype.getCaptionNode=function(){var a=this.children[0];return a instanceof ve.dm.BlockImageCaptionNode?a:null},ve.dm.modelRegistry.register(ve.dm.BlockImageNode),ve.dm.BlockImageCaptionNode=function(){ve.dm.BlockImageCaptionNode["super"].apply(this,arguments)},OO.inheritClass(ve.dm.BlockImageCaptionNode,ve.dm.BranchNode),ve.dm.BlockImageCaptionNode["static"].name="imageCaption",ve.dm.BlockImageCaptionNode["static"].matchTagNames=[],ve.dm.BlockImageCaptionNode["static"].parentNodeTypes=["blockImage"],ve.dm.BlockImageCaptionNode["static"].toDomElements=function(a,b){return[b.createElement("figcaption")]},ve.dm.modelRegistry.register(ve.dm.BlockImageCaptionNode),ve.dm.InlineImageNode=function(){ve.dm.InlineImageNode["super"].apply(this,arguments),ve.dm.ImageNode.call(this)},OO.inheritClass(ve.dm.InlineImageNode,ve.dm.LeafNode),OO.mixinClass(ve.dm.InlineImageNode,ve.dm.ImageNode),ve.dm.InlineImageNode["static"].name="inlineImage",ve.dm.InlineImageNode["static"].isContent=!0,ve.dm.InlineImageNode["static"].matchTagNames=["img"],ve.dm.InlineImageNode["static"].toDataElement=function(a){var b=$(a[0]),c=b.attr("alt"),d=b.attr("width"),e=b.attr("height");return{type:this.name,attributes:{src:b.attr("src"),alt:void 0!==c?c:null,width:void 0!==d&&""!==d?Number(d):null,height:void 0!==e&&""!==e?Number(e):null}}},ve.dm.InlineImageNode["static"].toDomElements=function(a,b){var c=b.createElement("img");return ve.setDomAttributes(c,a.attributes,["alt","src","width","height"]),[c]},ve.dm.modelRegistry.register(ve.dm.InlineImageNode),ve.dm.LanguageAnnotation=function(){ve.dm.LanguageAnnotation["super"].apply(this,arguments)},OO.inheritClass(ve.dm.LanguageAnnotation,ve.dm.Annotation),ve.dm.LanguageAnnotation["static"].name="meta/language",ve.dm.LanguageAnnotation["static"].matchTagNames=["span"],ve.dm.LanguageAnnotation["static"].matchFunction=function(a){var b=a.getAttribute("lang"),c=a.getAttribute("dir");return b||"ltr"===c||"rtl"===c},ve.dm.LanguageAnnotation["static"].applyToAppendedContent=!0,ve.dm.LanguageAnnotation["static"].toDataElement=function(a){return{type:this.name,attributes:{lang:a[0].getAttribute("lang"),dir:a[0].getAttribute("dir")}}},ve.dm.LanguageAnnotation["static"].toDomElements=function(a,b){var c=b.createElement("span");return a.attributes.lang&&c.setAttribute("lang",a.attributes.lang),a.attributes.dir&&c.setAttribute("dir",a.attributes.dir),[c]},ve.dm.LanguageAnnotation.prototype.getComparableObject=function(){return{type:"meta/language",lang:this.getAttribute("lang"),dir:this.getAttribute("dir")}},ve.dm.modelRegistry.register(ve.dm.LanguageAnnotation),ve.dm.LinkAnnotation=function(){ve.dm.LinkAnnotation["super"].apply(this,arguments)},OO.inheritClass(ve.dm.LinkAnnotation,ve.dm.Annotation),ve.dm.LinkAnnotation["static"].name="link",ve.dm.LinkAnnotation["static"].matchTagNames=["a"],ve.dm.LinkAnnotation["static"].splitOnWordbreak=!0,ve.dm.LinkAnnotation["static"].toDataElement=function(a){return{type:this.name,attributes:{href:a[0].getAttribute("href")}}},ve.dm.LinkAnnotation["static"].toDomElements=function(a,b){var c=b.createElement("a");return c.setAttribute("href",this.getHref(a)),[c]},ve.dm.LinkAnnotation["static"].getHref=function(a){return a.attributes.href},ve.dm.LinkAnnotation.prototype.getHref=function(){return this.constructor["static"].getHref(this.element)},ve.dm.LinkAnnotation.prototype.getComparableObject=function(){return{type:this.getType(),href:this.getAttribute("href")}},ve.dm.modelRegistry.register(ve.dm.LinkAnnotation),ve.dm.TextStyleAnnotation=function(){ve.dm.TextStyleAnnotation["super"].apply(this,arguments)},OO.inheritClass(ve.dm.TextStyleAnnotation,ve.dm.Annotation),ve.dm.TextStyleAnnotation["static"].name="textStyle",ve.dm.TextStyleAnnotation["static"].matchTagNames=[],ve.dm.TextStyleAnnotation["static"].toDataElement=function(a){return{type:this.name,attributes:{nodeName:a[0].nodeName.toLowerCase()}}},ve.dm.TextStyleAnnotation["static"].toDomElements=function(a,b){var c=ve.getProp(a,"attributes","nodeName");return[b.createElement(c||this.matchTagNames[0])]},ve.dm.TextStyleAnnotation.prototype.getComparableObject=function(){return{type:this.getType()}},ve.dm.modelRegistry.register(ve.dm.TextStyleAnnotation),ve.dm.AbbreviationAnnotation=function(){ve.dm.AbbreviationAnnotation["super"].apply(this,arguments)},OO.inheritClass(ve.dm.AbbreviationAnnotation,ve.dm.TextStyleAnnotation),ve.dm.AbbreviationAnnotation["static"].name="textStyle/abbreviation",ve.dm.AbbreviationAnnotation["static"].matchTagNames=["abbr"],ve.dm.modelRegistry.register(ve.dm.AbbreviationAnnotation),ve.dm.BigAnnotation=function(){ve.dm.BigAnnotation["super"].apply(this,arguments)},OO.inheritClass(ve.dm.BigAnnotation,ve.dm.TextStyleAnnotation),ve.dm.BigAnnotation["static"].name="textStyle/big",ve.dm.BigAnnotation["static"].matchTagNames=["big"],ve.dm.modelRegistry.register(ve.dm.BigAnnotation),ve.dm.BoldAnnotation=function(){ve.dm.BoldAnnotation["super"].apply(this,arguments)},OO.inheritClass(ve.dm.BoldAnnotation,ve.dm.TextStyleAnnotation),ve.dm.BoldAnnotation["static"].name="textStyle/bold",ve.dm.BoldAnnotation["static"].matchTagNames=["b","strong"],ve.dm.modelRegistry.register(ve.dm.BoldAnnotation),ve.dm.CodeSampleAnnotation=function(){ve.dm.CodeSampleAnnotation["super"].apply(this,arguments)},OO.inheritClass(ve.dm.CodeSampleAnnotation,ve.dm.TextStyleAnnotation),ve.dm.CodeSampleAnnotation["static"].name="textStyle/codeSample",ve.dm.CodeSampleAnnotation["static"].matchTagNames=["samp"],ve.dm.modelRegistry.register(ve.dm.CodeSampleAnnotation),ve.dm.CodeAnnotation=function(){ve.dm.CodeAnnotation["super"].apply(this,arguments)},OO.inheritClass(ve.dm.CodeAnnotation,ve.dm.TextStyleAnnotation),ve.dm.CodeAnnotation["static"].name="textStyle/code",ve.dm.CodeAnnotation["static"].matchTagNames=["code","tt"],ve.dm.modelRegistry.register(ve.dm.CodeAnnotation),ve.dm.DatetimeAnnotation=function(){ve.dm.DatetimeAnnotation["super"].apply(this,arguments)},OO.inheritClass(ve.dm.DatetimeAnnotation,ve.dm.TextStyleAnnotation),ve.dm.DatetimeAnnotation["static"].name="textStyle/datetime",ve.dm.DatetimeAnnotation["static"].matchTagNames=["time"],ve.dm.modelRegistry.register(ve.dm.DatetimeAnnotation),ve.dm.DefinitionAnnotation=function(){ve.dm.DefinitionAnnotation["super"].apply(this,arguments)},OO.inheritClass(ve.dm.DefinitionAnnotation,ve.dm.TextStyleAnnotation),ve.dm.DefinitionAnnotation["static"].name="textStyle/definition",ve.dm.DefinitionAnnotation["static"].matchTagNames=["dfn"],ve.dm.modelRegistry.register(ve.dm.DefinitionAnnotation),ve.dm.HighlightAnnotation=function(){ve.dm.HighlightAnnotation["super"].apply(this,arguments)},OO.inheritClass(ve.dm.HighlightAnnotation,ve.dm.TextStyleAnnotation),ve.dm.HighlightAnnotation["static"].name="textStyle/highlight",ve.dm.HighlightAnnotation["static"].matchTagNames=["mark"],ve.dm.modelRegistry.register(ve.dm.HighlightAnnotation),ve.dm.ItalicAnnotation=function(){ve.dm.ItalicAnnotation["super"].apply(this,arguments)},OO.inheritClass(ve.dm.ItalicAnnotation,ve.dm.TextStyleAnnotation),ve.dm.ItalicAnnotation["static"].name="textStyle/italic",ve.dm.ItalicAnnotation["static"].matchTagNames=["i","em"],ve.dm.modelRegistry.register(ve.dm.ItalicAnnotation),ve.dm.QuotationAnnotation=function(){ve.dm.QuotationAnnotation["super"].apply(this,arguments)},OO.inheritClass(ve.dm.QuotationAnnotation,ve.dm.TextStyleAnnotation),ve.dm.QuotationAnnotation["static"].name="textStyle/quotation",ve.dm.QuotationAnnotation["static"].matchTagNames=["q"],ve.dm.modelRegistry.register(ve.dm.QuotationAnnotation),ve.dm.SmallAnnotation=function(){ve.dm.SmallAnnotation["super"].apply(this,arguments)},OO.inheritClass(ve.dm.SmallAnnotation,ve.dm.TextStyleAnnotation),ve.dm.SmallAnnotation["static"].name="textStyle/small",ve.dm.SmallAnnotation["static"].matchTagNames=["small"],ve.dm.modelRegistry.register(ve.dm.SmallAnnotation),ve.dm.SpanAnnotation=function(){ve.dm.SpanAnnotation["super"].apply(this,arguments)},OO.inheritClass(ve.dm.SpanAnnotation,ve.dm.TextStyleAnnotation),ve.dm.SpanAnnotation["static"].name="textStyle/span",ve.dm.SpanAnnotation["static"].matchTagNames=["span"],ve.dm.modelRegistry.register(ve.dm.SpanAnnotation),ve.dm.StrikethroughAnnotation=function(){ve.dm.StrikethroughAnnotation["super"].apply(this,arguments)},OO.inheritClass(ve.dm.StrikethroughAnnotation,ve.dm.TextStyleAnnotation),ve.dm.StrikethroughAnnotation["static"].name="textStyle/strikethrough",ve.dm.StrikethroughAnnotation["static"].matchTagNames=["s"],ve.dm.modelRegistry.register(ve.dm.StrikethroughAnnotation),ve.dm.SubscriptAnnotation=function(){ve.dm.SubscriptAnnotation["super"].apply(this,arguments)},OO.inheritClass(ve.dm.SubscriptAnnotation,ve.dm.TextStyleAnnotation),ve.dm.SubscriptAnnotation["static"].name="textStyle/subscript",ve.dm.SubscriptAnnotation["static"].matchTagNames=["sub"],ve.dm.SubscriptAnnotation["static"].removes=["textStyle/superscript"],ve.dm.modelRegistry.register(ve.dm.SubscriptAnnotation),ve.dm.SuperscriptAnnotation=function(){ve.dm.SuperscriptAnnotation["super"].apply(this,arguments)},OO.inheritClass(ve.dm.SuperscriptAnnotation,ve.dm.TextStyleAnnotation),ve.dm.SuperscriptAnnotation["static"].name="textStyle/superscript",ve.dm.SuperscriptAnnotation["static"].matchTagNames=["sup"],ve.dm.SuperscriptAnnotation["static"].removes=["textStyle/subscript"],ve.dm.modelRegistry.register(ve.dm.SuperscriptAnnotation),ve.dm.UnderlineAnnotation=function(){ve.dm.UnderlineAnnotation["super"].apply(this,arguments)},OO.inheritClass(ve.dm.UnderlineAnnotation,ve.dm.TextStyleAnnotation),ve.dm.UnderlineAnnotation["static"].name="textStyle/underline",ve.dm.UnderlineAnnotation["static"].matchTagNames=["u"],ve.dm.modelRegistry.register(ve.dm.UnderlineAnnotation),ve.dm.UserInputAnnotation=function(){ve.dm.UserInputAnnotation["super"].apply(this,arguments)},OO.inheritClass(ve.dm.UserInputAnnotation,ve.dm.TextStyleAnnotation),ve.dm.UserInputAnnotation["static"].name="textStyle/userInput",ve.dm.UserInputAnnotation["static"].matchTagNames=["kbd"],ve.dm.modelRegistry.register(ve.dm.UserInputAnnotation),ve.dm.VariableAnnotation=function(){ve.dm.VariableAnnotation["super"].apply(this,arguments)},OO.inheritClass(ve.dm.VariableAnnotation,ve.dm.TextStyleAnnotation),ve.dm.VariableAnnotation["static"].name="textStyle/variable",ve.dm.VariableAnnotation["static"].matchTagNames=["var"],ve.dm.modelRegistry.register(ve.dm.VariableAnnotation),ve.dm.AlienMetaItem=function(){ve.dm.AlienMetaItem["super"].apply(this,arguments)},OO.inheritClass(ve.dm.AlienMetaItem,ve.dm.MetaItem),ve.dm.AlienMetaItem["static"].name="alienMeta",ve.dm.AlienMetaItem["static"].matchTagNames=["meta","link"],ve.dm.AlienMetaItem["static"].storeHtmlAttributes=!1,ve.dm.AlienMetaItem["static"].toDataElement=function(a){return{type:this.name,attributes:{domElements:ve.copy(a)}}},ve.dm.AlienMetaItem["static"].toDomElements=function(a,b){return ve.copyDomElements(a.attributes.domElements,b)},ve.dm.modelRegistry.register(ve.dm.AlienMetaItem),ve.dm.CommentMetaItem=function(){ve.dm.CommentMetaItem["super"].apply(this,arguments)},OO.inheritClass(ve.dm.CommentMetaItem,ve.dm.MetaItem),ve.dm.CommentMetaItem["static"].name="commentMeta",ve.dm.CommentMetaItem["static"].matchTagNames=[],ve.dm.CommentMetaItem["static"].storeHtmlAttributes=!1,ve.dm.CommentMetaItem["static"].toDomElements=function(a,b){return[b.createComment(a.attributes.text)]},ve.dm.modelRegistry.register(ve.dm.CommentMetaItem),ve.dm.CommentNode=function(a){ve.dm.CommentNode["super"].call(this,a),ve.dm.FocusableNode.call(this)},OO.inheritClass(ve.dm.CommentNode,ve.dm.LeafNode),OO.mixinClass(ve.dm.CommentNode,ve.dm.FocusableNode),ve.dm.CommentNode["static"].isContent=!0,ve.dm.CommentNode["static"].storeHtmlAttributes=!1,ve.dm.CommentNode["static"].toDataElement=function(a,b){var c=a[0].nodeType===Node.COMMENT_NODE?a[0].data:a[0].getAttribute("data-ve-comment");return{type:b.isExpectingContent()&&""!==c?"comment":"commentMeta",attributes:{text:c}}},ve.dm.CommentNode["static"].toDomElements=function(a,b,c){if(c.isForClipboard()){var d=b.createElement("span");return d.setAttribute("rel","ve:Comment"),d.setAttribute("data-ve-comment",a.attributes.text),[d]}return[b.createComment(a.attributes.text)]},ve.dm.RealCommentNode=function(){ve.dm.RealCommentNode["super"].apply(this,arguments)},OO.inheritClass(ve.dm.RealCommentNode,ve.dm.CommentNode),ve.dm.RealCommentNode["static"].name="comment",ve.dm.RealCommentNode["static"].matchTagNames=["#comment"],ve.dm.FakeCommentNode=function(){ve.dm.FakeCommentNode["super"].apply(this,arguments)},OO.inheritClass(ve.dm.FakeCommentNode,ve.dm.CommentNode),ve.dm.FakeCommentNode["static"].name="fakeComment",ve.dm.FakeCommentNode["static"].matchRdfaTypes=["ve:Comment"],ve.dm.modelRegistry.register(ve.dm.RealCommentNode),ve.dm.modelRegistry.register(ve.dm.FakeCommentNode),ve.ce={},ve.ce.whitespacePattern=/[\u0020\u00A0]/g,ve.ce.minImgDataUri="data:image/gif;base64,R0lGODdhAQABAADcACwAAAAAAQABAAA",ve.ce.unicornImgDataUri="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAATCAQAAADly58hAAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfeChIMMi319aEqAAAAzUlEQVQoz4XSMUoDURAG4K8NIljaeQZrCwsRb5FWL5Daa1iIjQewTycphAQloBEUAoogFmqMsiBmHSzcdfOWlcyU3/+YGXgsqJZMbvv/wLqZDCw1B9rCBSaOmgOHQsfQvVYT7wszIbPSxO9CCF8ebNXx1J2TIvDoxlrKU3mBIYz1U87mMISB3QqXk7e/A4bp1WV/CiE3sFHymZ4X4cO57yLWdVDyjoknr47/MPRcput1k+ljt/O4V1vu2bXViq9qPNW3WfGoxrk37UVfxQ999n1bP+Vh5gAAAABJRU5ErkJggg==",ve.ce.chimeraImgDataUri="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAABGdBTUEAALGPC/xhBQAAAThJREFUOMvF088rRFEYxvGpKdnwJ8iStVnMytZ2ipJmI6xmZKEUe5aUULMzCxtlSkzNjCh2lClFSUpDmYj8KBZq6vreetLbrXs5Rjn1aWbuuee575z7nljsH8YkepoNaccsHrGFgWbCWpHCLZb+oroFzKOEbpeFHVp8gitsYltzSRyiqrkKhsKCevGMfWQwor/2ghns4BQTGMMcnlBA3Aa14U5VLeMDnqrq1/cDpHGv35eqrI5pG+Y/qYYp3WiN6zOHs8DcA7IK/BqLWMOuY5inQjwbNqheGnYMO9d+XtiwFu1BQU/y96ooKRO2Yq6vqog3jAbfZgKvuDELfGWFXQeu76GB9bD26MQRNnSMotTVJvGoxs2rx2oR/B47Rtd3pyBv3lCYnEtYWo0Yps8l7F3HKErjJ2G/Hp/F9YtlR3MQiAAAAABJRU5ErkJggg==",ve.ce.getDomText=function(a){var b=function(a){var c,d=a.nodeType,e=$(a),f="";if(d===Node.ELEMENT_NODE||d===Node.DOCUMENT_NODE||d===Node.DOCUMENT_FRAGMENT_NODE){if(e.hasClass("ve-ce-branchNode-blockSlugWrapper"))return"";if(e.hasClass("ve-ce-leafNode"))return c=e.data("view"),c&&a===c.$element[0]?new Array(c.getOuterLength()+1).join("☃"):"";for(a=a.firstChild;a;a=a.nextSibling)f+=b(a)}else if(d===Node.TEXT_NODE)return a.data;return f};return b(a).replace(ve.ce.whitespacePattern," ")},ve.ce.getDomHash=function(a){var b=a.nodeType,c=a.nodeName,d="";if(b===Node.TEXT_NODE||b===Node.CDATA_SECTION_NODE)return"#";if(b===Node.ELEMENT_NODE||b===Node.DOCUMENT_NODE){if(d+="<"+c+">",!$(a).hasClass("ve-ce-branchNode-blockSlugWrapper"))for(a=a.firstChild;a;a=a.nextSibling)d+=ve.ce.getDomHash(a);d+="</"+c+">",d=d.replace(/##+/g,"#")}return d},ve.ce.nextCursorOffset=function(a){var b,c;return null!==a.nextSibling&&a.nextSibling.nodeType===Node.TEXT_NODE?(b=a.nextSibling,c=0):(b=a.parentNode,c=1+Array.prototype.indexOf.call(a.parentNode.childNodes,a)),{node:b,offset:c}},ve.ce.previousCursorOffset=function(a){var b,c;return null!==a.previousSibling&&a.previousSibling.nodeType===Node.TEXT_NODE?(b=a.previousSibling,c=b.data.length):(b=a.parentNode,c=Array.prototype.indexOf.call(a.parentNode.childNodes,a)),{node:b,offset:c}},ve.ce.getOffset=function(a,b){function c(a){for(;!a.previousSibling;){if(a=a.parentNode,!a)throw new Error("domNode has no ancestor with a .data( 'view' )");if($(a).data("view")instanceof ve.ce.Node)return a}if(a=a.previousSibling,$(a).data("view")instanceof ve.ce.Node)return a;for(;a.lastChild;)if(a=a.lastChild,$(a).data("view")instanceof ve.ce.Node)return a;return a}var d,e,f,g,h,i=0,j=$(a);if(j.hasClass("ve-ce-unicorn")){if(0!==b)throw new Error("Non-zero offset in unicorn");return j.data("dmOffset")}if(h=a.nodeType===Node.ELEMENT_NODE?a.childNodes.length:a.data.length,0>b||b>h)throw new Error("domOffset is out of bounds");if(a.nodeType===Node.ELEMENT_NODE)if(0===a.childNodes.length){if(g=a,e=$(g).data("view"),e instanceof ve.ce.Node)return e.getOffset()+(e.isWrapped()?1:0);d=g}else if(b===a.childNodes.length){if(g=a.lastChild,e=$(g).data("view"),e instanceof ve.ce.Node)return e.getOffset()+e.getOuterLength();for(;g.lastChild;)if(g=g.lastChild,e=$(g).data("view"),e instanceof ve.ce.Node)return e.getOffset()+e.getOuterLength();d=g}else g=a.childNodes[b],d=c(g);else $(a.parentNode).hasClass("ve-ce-branchNode-blockSlug")||(i+=b),g=a,d=c(g);for(;;){if(e=$(d).data("view"),e instanceof ve.ce.Node)break;d.nodeType!==Node.TEXT_NODE||$(d.parentNode).hasClass("ve-ce-branchNode-blockSlug")||(i+=d.data.length),d=c(d)}if(f=e.getOffset(),$.contains(d,g))e.getModel().isContent()||(f+=e.getModel().isWrapped()?1:0),e.getModel().canContainContent()&&(f+=i);else{if(!e.parent)throw new Error("Node is not in document");f+=e.getOuterLength(),e.isContent()&&(f+=i)}return f},ve.ce.getOffsetOfSlug=function(a){var b;if(0===a.index())return b=a.parent().data("view").getModel(),b.getOffset()+(b.isWrapped()?1:0);if(a.prev().length)return b=a.prev().data("view").getModel(),b.getOffset()+b.getOuterLength();throw new Error("Incorrect slug location")},ve.ce.isShortcutKey=function(a){return!(!a.ctrlKey&&!a.metaKey)},ve.ce.veRangeFromSelection=function(a){try{return new ve.Range(ve.ce.getOffset(a.anchorNode,a.anchorOffset),ve.ce.getOffset(a.focusNode,a.focusOffset))}catch(b){return null}},ve.ce.RangeState=function(a,b,c,d){this.branchNodeChanged=null,this.selectionChanged=null,this.contentChanged=null,this.leftBlockSlug=null,this.enteredBlockSlug=null,this.veRange=null,this.node=null,this.$slugWrapper=null,this.text=null,this.hash=null,this.saveState(a,b,c,d)},OO.initClass(ve.ce.RangeState),ve.ce.RangeState.prototype.saveState=function(a,b,c,d){var e,f,g;f=function(a){return{focusNode:a.focusNode,focusOffset:a.focusOffset,anchorNode:a.anchorNode,anchorOffset:a.anchorOffset}}(c.getElementDocument().getSelection()),f.rangeCount&&$(f.getRangeAt(0).commonAncestorContainer).closest(".ve-ce-surface")[0]!==b[0]&&(f={focusNode:null,focusOffset:null,anchorNode:null,anchorOffset:null}),a&&!a.compareSelection(f)?(this.selectionChanged=!1,this.veRange=a.veRange,this.$slugWrapper=a.$slugWrapper,this.leftBlockSlug=!1,this.enteredBlockSlug=!1):(this.selectionChanged=!0,this.veRange=ve.ce.veRangeFromSelection(f)),g=!a||a.compareAnchorNode(f),g?(e=$(f.anchorNode).closest(".ve-ce-branchNode, .ve-ce-branchNode-blockSlugWrapper"),0===e.length?(this.node=null,this.$slugWrapper=null):e.hasClass("ve-ce-branchNode-blockSlugWrapper")?(this.node=null,this.$slugWrapper=e):(this.node=e.data("view"),this.$slugWrapper=null,this.node&&this.node.root!==c&&(this.node=null,this.veRange=null))):(this.node=a.node,this.$slugWrapper=a.$slugWrapper),this.branchNodeChanged=!a||this.node!==a.node,d&&!g?(this.text=a.text,this.hash=a.hash):null===this.node?(this.text=null,this.hash=null):(this.text=ve.ce.getDomText(this.node.$element[0]),this.hash=ve.ce.getDomHash(this.node.$element[0])),this.leftBlockSlug=a&&a.$slugWrapper&&!a.$slugWrapper.is(this.$slugWrapper),this.enteredBlockSlug=a&&this.$slugWrapper&&this.$slugWrapper.length>0&&!this.$slugWrapper.is(a.$slugWrapper),this.contentChanged=!d&&a&&a.node===this.node&&(null===a.hash||null===a.text||a.hash!==this.hash||a.text!==this.text),this.misleadingSelection=f},ve.ce.RangeState.prototype.compareSelection=function(a){return this.misleadingSelection.focusNode!==a.focusNode||this.misleadingSelection.focusOffset!==a.focusOffset||this.misleadingSelection.anchorNode!==a.anchorNode||this.misleadingSelection.anchorOffset!==a.anchorOffset},ve.ce.RangeState.prototype.compareAnchorNode=function(a){return this.misleadingSelection.anchorNode!==a.anchorNode},ve.ce.AnnotationFactory=function(){OO.Factory.call(this)},OO.inheritClass(ve.ce.AnnotationFactory,OO.Factory),ve.ce.AnnotationFactory.prototype.getDescription=function(a){var b=a.constructor["static"].name;if(Object.prototype.hasOwnProperty.call(this.registry,b))return this.registry[b]["static"].getDescription(a);throw new Error("Unknown annotation type: "+b)},ve.ce.AnnotationFactory.prototype.isAnnotationContinuationForced=function(a){return Object.prototype.hasOwnProperty.call(this.registry,a)?this.registry[a]["static"].forceContinuation:!1},ve.ce.annotationFactory=new ve.ce.AnnotationFactory,ve.ce.NodeFactory=function(){OO.Factory.call(this)},OO.inheritClass(ve.ce.NodeFactory,OO.Factory),ve.ce.NodeFactory.prototype.getDescription=function(a){var b=a.constructor["static"].name;if(Object.prototype.hasOwnProperty.call(this.registry,b))return this.registry[b]["static"].getDescription(a);throw new Error("Unknown node type: "+b)},ve.ce.NodeFactory.prototype.splitNodeOnEnter=function(a){if(Object.prototype.hasOwnProperty.call(this.registry,a))return this.registry[a]["static"].splitOnEnter;throw new Error("Unknown node type: "+a)},ve.ce.NodeFactory.prototype.getNodePrimaryCommandName=function(a){if(Object.prototype.hasOwnProperty.call(this.registry,a))return this.registry[a]["static"].primaryCommandName;throw new Error("Unknown node type: "+a)},ve.ce.nodeFactory=new ve.ce.NodeFactory,ve.ce.Document=function(a,b){ve.Document.call(this,new ve.ce.DocumentNode(a.getDocumentNode(),b,{$:b.$})),this.getDocumentNode().$element.prop({lang:a.getLang(),dir:a.getDir()}),this.model=a},OO.inheritClass(ve.ce.Document,ve.Document),ve.ce.Document.prototype.getSlugAtOffset=function(a){var b=this.getBranchNodeFromOffset(a);
return b?b.getSlugAtOffset(a):null},ve.ce.Document.prototype.getNodeAndOffset=function(a){function b(a){for(;null===a.nextSibling;)if(a=a.parentNode,null===a)return null;for(a=a.nextSibling;a.firstChild;)a=a.firstChild;return a}function c(a){for(;null===a.previousSibling;)if(a=a.parentNode,null===a)return null;for(a=a.previousSibling;a.lastChild;)a=a.lastChild;return a}var d,e,f,g;return d=this.getNodeAndOffsetUnadjustedForUnicorn(a),e=d.node,f=b(e),g=c(e),(e.nodeType===Node.TEXT_NODE&&d.offset===e.data.length||e.nodeType===Node.ELEMENT_NODE&&e.classList.contains("ve-ce-branchNode-inlineSlug"))&&f&&f.nodeType===Node.ELEMENT_NODE&&f.classList.contains("ve-ce-pre-unicorn")?ve.ce.nextCursorOffset(f):e.nodeType===Node.ELEMENT_NODE&&e.childNodes.length>d.offset&&e.childNodes[d.offset].nodeType===Node.ELEMENT_NODE&&e.childNodes[d.offset].classList.contains("ve-ce-pre-unicorn")?{node:d.node,offset:d.offset+1}:(e.nodeType===Node.TEXT_NODE&&0===d.offset||e.nodeType===Node.ELEMENT_NODE&&e.classList.contains("ve-ce-branchNode-inlineSlug"))&&g&&g.nodeType===Node.ELEMENT_NODE&&g.classList.contains("ve-ce-post-unicorn")?ve.ce.previousCursorOffset(g):e.nodeType===Node.ELEMENT_NODE&&d.offset>0&&e.childNodes[d.offset-1].nodeType===Node.ELEMENT_NODE&&e.childNodes[d.offset-1].classList.contains("ve-ce-post-unicorn")?{node:d.node,offset:d.offset-1}:d},ve.ce.Document.prototype.getNodeAndOffsetUnadjustedForUnicorn=function(a){var b,c,d,e,f,g,h,i,j=[],k=this.getSlugAtOffset(a);if(k&&(!k.firstChild||$(k.firstChild).hasClass("ve-ce-chimera")))return{node:k,offset:0};for(b=this.getBranchNodeFromOffset(a),c=b.getOffset()+(b.isWrapped()?1:0),d=[b.$element.contents(),0],e=[d];e.length>0;)if(d[1]>=d[0].length)e.pop(),d=e[e.length-1];else{if(f=d[0][d[1]],f.nodeType===Node.TEXT_NODE){if(h=f.textContent.length,a>=c&&c+h>=a)return{node:f,offset:a-c};c+=h}else if(f.nodeType===Node.ELEMENT_NODE)if(g=d[0].eq(d[1]),g.hasClass("ve-ce-unicorn")){if(a===c){if($(g[0].previousSibling).hasClass("ve-ce-unicorn"))return{node:g[0].parentNode,offset:d[1]-1};if($(g[0].nextSibling).hasClass("ve-ce-unicorn"))return{node:g[0].parentNode,offset:d[1]+1}}}else{if(!g.is(".ve-ce-branchNode, .ve-ce-leafNode")){e.push([g.contents(),0]),d[1]++,d=e[e.length-1];continue}if(i=g.data("view").model,-1===ve.indexOf(i,j)){if(h=i.getOuterLength(),j.push(i),a>=c&&c+h>a){e.push([g.contents(),0]),d[1]++,d=e[e.length-1];continue}c+=h}}d[1]++}throw new Error("Offset could not be translated to a DOM element and offset: "+a)},ve.ce.Document.prototype.getDirectionFromSelection=function(a){var b,c,d;if(a instanceof ve.dm.LinearSelection)c=a.getRange();else{if(!(a instanceof ve.dm.TableSelection))return null;c=a.tableRange}if(d=this.selectNodes(c,"covered"),d.length>1)b=this.selectNodes(c,"siblings")[0].node.getParent();else for(b=d[0].node;b.isContent();)b=b.parent;return b.$element.css("direction")},ve.ce.View=function(a,b){this.model=a,OO.ui.Element.call(this,b),OO.EventEmitter.call(this),this.live=!1,this.connect(this,{setup:"onSetup",teardown:"onTeardown"}),ve.dm.Converter.renderHtmlAttributeList(this.model.getHtmlAttributes(),this.$element,this.constructor["static"].renderHtmlAttributes,!0)},OO.inheritClass(ve.ce.View,OO.ui.Element),OO.mixinClass(ve.ce.View,OO.EventEmitter),ve.ce.View["static"].renderHtmlAttributes=["abbr","about","align","alt","axis","bgcolor","border","cellpadding","cellspacing","char","charoff","cite","class","clear","color","colspan","datatype","datetime","dir","face","frame","headers","height","href","id","itemid","itemprop","itemref","itemscope","itemtype","lang","noshade","nowrap","property","rbspan","rel","resource","rev","rowspan","rules","scope","size","span","src","start","style","summary","title","type","typeof","valign","value","width"],ve.ce.View.prototype.getModelHtmlDocument=function(){return null},ve.ce.View.prototype.onSetup=function(){this.$element.data("view",this)},ve.ce.View.prototype.onTeardown=function(){this.$element.removeData("view")},ve.ce.View.prototype.getModel=function(){return this.model},ve.ce.View.prototype.isLive=function(){return this.live},ve.ce.View.prototype.setLive=function(a){this.live=a,this.emit(this.live?"setup":"teardown")},ve.ce.View.prototype.isInContentEditable=function(){for(var a=this.$element[0].parentNode;a&&"inherit"===a.contentEditable;)a=a.parentNode;return!(!a||"true"!==a.contentEditable)},ve.ce.View.prototype.getResolvedAttribute=function(a){var b=this.model.getAttribute(a),c=this.getModelHtmlDocument();return c&&"string"==typeof b?ve.resolveUrl(b,c):b},ve.ce.Annotation=function(a,b,c){ve.ce.View.call(this,a,c),this.parentNode=b||null},OO.inheritClass(ve.ce.Annotation,ve.ce.View),ve.ce.Annotation["static"].tagName="span",ve.ce.Annotation["static"].forceContinuation=!1,ve.ce.Annotation["static"].getDescription=function(){return""},ve.ce.Annotation.prototype.getParentNode=function(){return this.parentNode},ve.ce.Annotation.prototype.getModelHtmlDocument=function(){return this.parentNode&&this.parentNode.getModelHtmlDocument()},ve.ce.Node=function(a,b){ve.ce.View.call(this,a,b),ve.Node.call(this),this.parent=null},OO.inheritClass(ve.ce.Node,ve.ce.View),OO.mixinClass(ve.ce.Node,ve.Node),ve.ce.Node["static"].splitOnEnter=!1,ve.ce.Node["static"].primaryCommandName=null,ve.ce.Node["static"].getDescription=function(){return""},ve.ce.Node.prototype.getChildNodeTypes=function(){return this.model.getChildNodeTypes()},ve.ce.Node.prototype.getParentNodeTypes=function(){return this.model.getParentNodeTypes()},ve.ce.Node.prototype.getSuggestedParentNodeTypes=function(){return this.model.getSuggestedParentNodeTypes()},ve.ce.Node.prototype.canHaveChildren=function(){return this.model.canHaveChildren()},ve.ce.Node.prototype.canHaveChildrenNotContent=function(){return this.model.canHaveChildrenNotContent()},ve.ce.Node.prototype.isWrapped=function(){return this.model.isWrapped()},ve.ce.Node.prototype.canContainContent=function(){return this.model.canContainContent()},ve.ce.Node.prototype.isContent=function(){return this.model.isContent()},ve.ce.Node.prototype.isFocusable=function(){return this.model.isFocusable()},ve.ce.Node.prototype.hasSignificantWhitespace=function(){return this.model.hasSignificantWhitespace()},ve.ce.Node.prototype.handlesOwnChildren=function(){return this.model.handlesOwnChildren()},ve.ce.Node.prototype.getLength=function(){return this.model.getLength()},ve.ce.Node.prototype.getOuterLength=function(){return this.model.getOuterLength()},ve.ce.Node.prototype.getOffset=function(){return this.model.getOffset()},ve.ce.Node.prototype.splitOnEnter=function(){return this.constructor["static"].splitOnEnter},ve.ce.Node.prototype.destroy=function(){this.parent=null,this.model.disconnect(this)},ve.ce.Node.prototype.getModelHtmlDocument=function(){return this.model.getDocument()&&this.model.getDocument().getHtmlDocument()},ve.ce.BranchNode=function(a,b){ve.BranchNode.call(this),ve.ce.Node.call(this,a,b),this.tagName=this.$element.get(0).nodeName.toLowerCase(),this.slugNodes=[],this.model.connect(this,{splice:"onSplice"}),this.onSplice.apply(this,[0,0].concat(a.getChildren()))},OO.inheritClass(ve.ce.BranchNode,ve.ce.Node),OO.mixinClass(ve.ce.BranchNode,ve.BranchNode),ve.ce.BranchNode.inlineSlugTemplate=$("<span>").addClass("ve-ce-branchNode-slug ve-ce-branchNode-inlineSlug").append($("<img>").prop("src",ve.ce.minImgDataUri).css({width:"0",height:"0"}).addClass("ve-ce-chimera")).get(0),ve.ce.BranchNode.inputDebugInlineSlugTemplate=$("<span>").addClass("ve-ce-branchNode-slug ve-ce-branchNode-inlineSlug").append($("<img>").prop("src",ve.ce.chimeraImgDataUri).addClass("ve-ce-chimera")).get(0),ve.ce.BranchNode.blockSlugTemplate=$("<div>").addClass("ve-ce-branchNode-blockSlugWrapper ve-ce-branchNode-blockSlugWrapper-unfocused").append($("<p>").prop("contentEditable","false").addClass("ve-ce-branchNode-slug ve-ce-branchNode-blockSlug").html("&#xFEFF;")).get(0),ve.ce.BranchNode.prototype.onSetup=function(){ve.ce.Node.prototype.onSetup.call(this),this.$element.addClass("ve-ce-branchNode")},ve.ce.BranchNode.prototype.onTeardown=function(){ve.ce.Node.prototype.onTeardown.call(this),this.$element.removeClass("ve-ce-branchNode")},ve.ce.BranchNode.prototype.updateTagName=function(){var a,b=this.getTagName();b!==this.tagName&&(this.emit("teardown"),a=this.$(document.createElement(b)),a.append(this.$element.contents()),this.$element.replaceWith(a),this.$element=a,this.emit("setup"),this.tagName=b)},ve.ce.BranchNode.prototype.onModelUpdate=function(a){this.emit("childUpdate",a)},ve.ce.BranchNode.prototype.onSplice=function(a){var b,c,d,e,f,g,h,i,j=Array.prototype.slice.call(arguments);if(j.length>=3)for(b=2,d=j.length;d>b;b++)j[b]=ve.ce.nodeFactory.create(j[b].getType(),j[b],{$:this.$}),j[b].model.connect(this,{update:"onModelUpdate"});for(i=this.children.splice.apply(this.children,j),b=0,d=i.length;d>b;b++)i[b].model.disconnect(this,{update:"onModelUpdate"}),i[b].setLive(!1),i[b].detach(),i[b].$element.detach();if(j.length>=3)for(a&&(e=this.children[a-1].$element.last()),b=j.length-1;b>=2;b--){if(j[b].attach(this),a)for(f=e[0].nextSibling,h=e[0].parentNode,c=0,d=j[b].$element.length;d>c;c++)h.insertBefore(j[b].$element[c],f);else for(g=this.$element[0],c=j[b].$element.length-1;c>=0;c--)g.insertBefore(j[b].$element[c],g.firstChild);this.live!==j[b].isLive()&&j[b].setLive(this.live)}this.setupSlugs()},ve.ce.BranchNode.prototype.setupSlugs=function(){var a,b,c,d,e=this.canHaveChildrenNotContent(),f=this.getElementDocument();for(a in this.slugNodes)void 0!==this.slugNodes[a]&&this.slugNodes[a].parentNode&&this.slugNodes[a].parentNode.removeChild(this.slugNodes[a]),delete this.slugNodes[a];b=e?ve.ce.BranchNode.blockSlugTemplate:ve.inputDebug?ve.ce.BranchNode.inputDebugInlineSlugTemplate:ve.ce.BranchNode.inlineSlugTemplate;for(a in this.getModel().slugPositions)c=f.importNode(b,!0),this.children[a]&&this.children[a].$element[0]?(d=this.children[a].$element[0],d.parentNode.insertBefore(c,d)):this.$element[0].appendChild(c),this.slugNodes[a]=c},ve.ce.BranchNode.prototype.getSlugAtOffset=function(a){var b,c=this.model.getOffset()+(this.isWrapped()?1:0);if(a===c)return this.slugNodes[0]||null;for(b=0;b<this.children.length;b++)if(c+=this.children[b].model.getOuterLength(),a===c)return this.slugNodes[b+1]||null},ve.ce.BranchNode.prototype.setLive=function(a){ve.ce.Node.prototype.setLive.call(this,a);for(var b=0;b<this.children.length;b++)this.children[b].setLive(a)},ve.ce.BranchNode.prototype.destroy=function(){var a,b;for(a=0,b=this.children.length;b>a;a++)this.children[a].destroy();ve.ce.Node.prototype.destroy.call(this)},ve.ce.ContentBranchNode=function(a,b){ve.ce.BranchNode.call(this,a,b),this.lastTransaction=null,this.unicornAnnotations=null,this.unicorns=null,this.connect(this,{childUpdate:"onChildUpdate"})},OO.inheritClass(ve.ce.ContentBranchNode,ve.ce.BranchNode),ve.ce.ContentBranchNode["static"].splitOnEnter=!0,ve.ce.ContentBranchNode["static"].appendRenderedContents=function(a,b){function c(a){var b,d,e;for(b=0,d=a.childNodes.length;d>b;b++)e=a.childNodes[b],e.veOrigNode?a.replaceChild(e.veOrigNode,e):e.childNodes&&e.childNodes.length&&c(e)}for(c(b);b.firstChild;)a.appendChild(b.firstChild)},ve.ce.ContentBranchNode.prototype.onChildUpdate=function(a){return null===a||a===this.lastTransaction?void(this.lastTransaction=a):void this.renderContents()},ve.ce.ContentBranchNode.prototype.onSplice=function(a,b){ve.ce.BranchNode.prototype.onSplice.apply(this,arguments),this.root instanceof ve.ce.DocumentNode&&this.root.getSurface().isRenderingLocked&&this.slugNodes.splice.apply(this.slugNodes,[a,b].concat(new Array(arguments.length-2))),this.renderContents()},ve.ce.ContentBranchNode.prototype.setupSlugs=function(){this.root instanceof ve.ce.DocumentNode&&this.root.getSurface().isRenderingLocked()||ve.ce.BranchNode.prototype.setupSlugs.apply(this,arguments)},ve.ce.ContentBranchNode.prototype.getRenderedContents=function(){function a(a){q=!0,""!==E&&(C.appendChild(A.createTextNode(E)),E=""),i=ve.ce.annotationFactory.create(a.getType(),a,F,{$:F.$}).$element[0],C.appendChild(i),C=i}function b(){q=!0,""!==E&&(C.appendChild(A.createTextNode(E)),E=""),C=C.parentNode}var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=this.model.doc.getStore(),y=new ve.dm.AnnotationSet(x),z=[],A=this.getElementDocument(),B=A.createElement("div"),C=B,D={},E="",F=this;for(c=0,d=this.children.length;d>c;c++)z=z.concat(this.children[c].getAnnotatedHtml());if(m=-1,this.getRoot()&&(u=this.getRoot().getSurface(),k=u.getModel(),l=k.getTranslatedSelection(),l instanceof ve.dm.LinearSelection&&l.isCollapsed()&&(m=l.getRange().start-this.getOffset()-1)),0>m||m>this.getLength())D.hasCursor=!1;else{for(D.hasCursor=!0,s=0,c=0,d=z.length;d>c;c++){if(t=z[c][0],r="string"==typeof t?1:2,m>=s&&s+r>m){n=[{},k.getInsertionAnnotations().storeIndexes],z.splice(c,0,n);break}s+=r}c===d&&s===m&&(n=[{},k.getInsertionAnnotations().storeIndexes],z.push(n))}for(c=0,d=z.length;d>c;c++)if(Array.isArray(z[c])?(g=z[c][0],h=new ve.dm.AnnotationSet(x,z[c][1])):(g=z[c],h=new ve.dm.AnnotationSet(x)),n&&g===n[0]&&d-1>c&&(w=h.getAnnotationsByName("link"),v=new ve.dm.AnnotationSet(x,Array.isArray(z[c+1])?z[c+1][1]:void 0),v.containsAllOf(w)||h.removeSet(w)),q=!1,ve.dm.Converter.openAndCloseAnnotations(y,h,a,b),"string"==typeof g)E+=g;else if(n&&g===n[0])q?(""!==E&&(C.appendChild(A.createTextNode(E)),E=""),o=A.createElement("img"),p=A.createElement("img"),o.className="ve-ce-unicorn ve-ce-pre-unicorn",p.className="ve-ce-unicorn ve-ce-post-unicorn",$(o).data("dmOffset",this.getOffset()+1+c),$(p).data("dmOffset",this.getOffset()+1+c),ve.inputDebug?(o.setAttribute("src",ve.ce.unicornImgDataUri),p.setAttribute("src",ve.ce.unicornImgDataUri)):(o.setAttribute("src",ve.ce.minImgDataUri),p.setAttribute("src",ve.ce.minImgDataUri),o.style.width="0px",p.style.width="0px",o.style.height="0px",p.style.height="0px"),C.appendChild(o),C.appendChild(p),D.annotations=k.getInsertionAnnotations(),D.unicorns=[o,p]):(D.unicornAnnotations=null,D.unicorns=null);else for(""!==E&&(C.appendChild(A.createTextNode(E)),E=""),e=0,f=g.length;f>e;e++)j=g[e].cloneNode(!0),j.veOrigNode=g[e],C.appendChild(j);return""!==E&&(C.appendChild(A.createTextNode(E)),E=""),B.unicornInfo=D,B},ve.ce.ContentBranchNode.prototype.renderContents=function(){var a,b,c,d,e,f,g,h=this;if(this.root instanceof ve.ce.DocumentNode&&this.root.getSurface().isRenderingLocked())return!1;for(this.root instanceof ve.ce.DocumentNode&&this.root.getSurface().setContentBranchNodeChanged(),d=this.getRenderedContents(),e=d.unicornInfo,delete d.unicornInfo,f=this.$element[0].cloneNode(!0),g=this.$element[0].cloneNode(!1);d.firstChild;)g.appendChild(d.firstChild);if(ve.normalizeNode(f),ve.normalizeNode(g),g.isEqualNode(f))return!1;for(this.unicornAnnotations=e.annotations||null,this.unicorns=e.unicorns||null,a=0,b=this.$element.length;b>a;a++)for(c=this.$element[a];c.firstChild;)c.removeChild(c.firstChild);return this.constructor["static"].appendRenderedContents(this.$element[0],g),this.getRoot()&&(e.hasCursor?this.unicorns?this.getRoot().getSurface().setUnicorning(this):this.getRoot().getSurface().setNotUnicorningAll(this):this.getRoot().getSurface().setNotUnicorning(this)),this.hasCursor=null,this.setupSlugs(),ve.debug&&(this.$element.css("backgroundColor","#eee"),setTimeout(function(){h.$element.css("backgroundColor","")},500)),!0},ve.ce.ContentBranchNode.prototype.onTeardown=function(){var a=this.getRoot().getSurface();ve.ce.BranchNode.prototype.onTeardown.call(this),a.setNotUnicorning(this)},ve.ce.LeafNode=function(a){ve.LeafNode.call(this),ve.ce.Node.apply(this,arguments),a.isWrapped()&&this.$element.addClass("ve-ce-leafNode")},OO.inheritClass(ve.ce.LeafNode,ve.ce.Node),OO.mixinClass(ve.ce.LeafNode,ve.LeafNode),ve.ce.LeafNode["static"].tagName="span",ve.ce.LeafNode.prototype.onSetup=function(){ve.ce.Node.prototype.onSetup.call(this),this.$element.addClass("ve-ce-leafNode")},ve.ce.LeafNode.prototype.onTeardown=function(){ve.ce.Node.prototype.onTeardown.call(this),this.$element.removeClass("ve-ce-leafNode")},ve.ce.LeafNode.prototype.getAnnotatedHtml=function(){return[[this.$element,this.getModel().getAnnotations()]]},ve.ce.AlignableNode=function(a,b){b=b||{},this.$alignable=a||this.$element,this.connect(this,{setup:"onAlignableSetup"}),this.model.connect(this,{attributeChange:"onAlignableAttributeChange"})},OO.initClass(ve.ce.AlignableNode),ve.ce.AlignableNode.prototype.onAlignableAttributeChange=function(a,b,c){var d;"align"===a&&(d=this.model.constructor["static"].cssClasses,b&&d[b]&&this.$alignable.removeClass(d[b]),c&&d[c]&&this.$alignable.addClass(d[c]),this.emit("align",c))},ve.ce.AlignableNode.prototype.onAlignableSetup=function(){var a=this.model.getAttribute("align"),b=this.model.constructor["static"].cssClasses;a&&b[a]&&(this.$alignable.addClass(b[a]),this.emit("align",a))},ve.ce.FocusableNode=function(a){this.focused=!1,this.highlighted=!1,this.isSetup=!1,this.$highlights=this.$("<div>").addClass("ve-ce-focusableNode-highlights"),this.$focusable=a||this.$element,this.surface=null,this.rects=null,this.boundingRect=null,this.startAndEndRects=null,this.connect(this,{setup:"onFocusableSetup",teardown:"onFocusableTeardown",resizeStart:"onFocusableResizeStart",resizeEnd:"onFocusableResizeEnd",rerender:"onFocusableRerender"})},OO.initClass(ve.ce.FocusableNode),ve.ce.FocusableNode.prototype.createHighlight=function(){return this.$("<div>").addClass("ve-ce-focusableNode-highlight").prop({title:this.constructor["static"].getDescription(this.model),draggable:!1}).append(this.$("<img>").addClass("ve-ce-focusableNode-highlight-relocatable-marker").attr("src","data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==").on({dragstart:this.onFocusableDragStart.bind(this),dragend:this.onFocusableDragEnd.bind(this)}))},ve.ce.FocusableNode.prototype.onFocusableSetup=function(){!this.isSetup&&this.root&&(this.surface=this.getRoot().getSurface(),this.$element.addClass("ve-ce-focusableNode").prop("contentEditable","false"),this.$focusable.on({"mouseenter.ve-ce-focusableNode":this.onFocusableMouseEnter.bind(this),"mousedown.ve-ce-focusableNode touchend.ve-ce-focusableNode":this.onFocusableMouseDown.bind(this)}),this.$element.is(this.$focusable)||this.$element.on({"mousedown.ve-ce-focusableNode":function(a){a.preventDefault()}}),this.isSetup=!0)},ve.ce.FocusableNode.prototype.onFocusableTeardown=function(){this.isSetup&&this.root&&(this.$focusable.off(".ve-ce-focusableNode"),this.$element.off(".ve-ce-focusableNode"),this.clearHighlights(),this.$element.removeClass("ve-ce-focusableNode").removeProp("contentEditable"),this.isSetup=!1,this.surface=null)},ve.ce.FocusableNode.prototype.onFocusableMouseDown=function(a){var b,c=this.surface.getModel(),d=c.getSelection(),e=this.model.getOuterRange();this.isInContentEditable()&&setTimeout(function(){b=d instanceof ve.dm.LinearSelection&&d.getRange(),c.getLinearFragment(a.shiftKey&&b?ve.Range["static"].newCoveringRange([b,e],b.from>e.from):e).select()})},ve.ce.FocusableNode.prototype.onFocusableDblClick=function(){this.isInContentEditable()&&this.executeCommand()},ve.ce.FocusableNode.prototype.executeCommand=function(){if(!this.model.isInspectable())return!1;var a=ve.ui.commandRegistry.getCommandForNode(this);a&&a.execute(this.surface.getSurface())},ve.ce.FocusableNode.prototype.onFocusableDragStart=function(){this.surface&&this.surface.startRelocation(this),this.$highlights.addClass("ve-ce-focusableNode-highlights-relocating")},ve.ce.FocusableNode.prototype.onFocusableDragEnd=function(){this.surface&&this.surface.endRelocation(),this.$highlights.removeClass("ve-ce-focusableNode-highlights-relocating")},ve.ce.FocusableNode.prototype.onFocusableMouseEnter=function(){this.root.getSurface().dragging||this.root.getSurface().resizing||!this.isInContentEditable()||this.createHighlights()},ve.ce.FocusableNode.prototype.onSurfaceMouseMove=function(a){var b=this.$(a.target);b.hasClass("ve-ce-focusableNode-highlight")||0!==b.closest(".ve-ce-focusableNode").length||this.clearHighlights()},ve.ce.FocusableNode.prototype.onSurfaceMouseOut=function(a){null===a.relatedTarget&&this.clearHighlights()},ve.ce.FocusableNode.prototype.onFocusableResizeStart=function(){this.clearHighlights()},ve.ce.FocusableNode.prototype.onFocusableResizeEnd=function(){this.redrawHighlights()},ve.ce.FocusableNode.prototype.onFocusableRerender=function(){this.focused&&(this.redrawHighlights(),this.surface.getSurface().getContext().updateDimensions(!0))},ve.ce.FocusableNode.prototype.isFocused=function(){return this.focused},ve.ce.FocusableNode.prototype.setFocused=function(a){a=!!a,this.focused!==a&&(this.focused=a,this.focused?(this.emit("focus"),this.$element.addClass("ve-ce-focusableNode-focused"),this.createHighlights(),this.surface.appendHighlights(this.$highlights,this.focused),this.surface.$element.off(".ve-ce-focusableNode")):(this.emit("blur"),this.$element.removeClass("ve-ce-focusableNode-focused"),this.clearHighlights()))},ve.ce.FocusableNode.prototype.createHighlights=function(){this.highlighted||(this.$highlights.on({mousedown:this.onFocusableMouseDown.bind(this),dblclick:this.onFocusableDblClick.bind(this)}),this.highlighted=!0,this.positionHighlights(),this.surface.appendHighlights(this.$highlights,this.focused),this.focused||this.surface.$element.on({"mousemove.ve-ce-focusableNode":this.onSurfaceMouseMove.bind(this),"mouseout.ve-ce-focusableNode":this.onSurfaceMouseOut.bind(this)}),this.surface.connect(this,{position:"positionHighlights"}))},ve.ce.FocusableNode.prototype.clearHighlights=function(){this.highlighted&&(this.$highlights.remove().empty(),this.surface.$element.off(".ve-ce-focusableNode"),this.surface.disconnect(this,{position:"positionHighlights"}),this.highlighted=!1,this.boundingRect=null)},ve.ce.FocusableNode.prototype.redrawHighlights=function(){this.clearHighlights(),this.createHighlights()},ve.ce.FocusableNode.prototype.calculateHighlights=function(){function a(a,b){return b.left>=a.left&&b.top>=a.top&&b.right<=a.right&&b.bottom<=a.bottom}var b,c,d=[],e=[],f=this.surface.getSurface().getBoundingClientRect();for(this.$focusable.find("*").addBack().each(function(){var b,c,e,f,g,h;if(!$(this).hasClass("ve-ce-noHighlight"))for(h=this.getClientRects(),b=0,e=h.length;e>b;b++){for(g=!1,c=0,f=d.length;f>c;c++){if(a(d[c],h[b])){g=!0;break}a(h[b],d[c])&&(d.splice(c,1),c--,f--)}g||d.push(h[b])}}),e=d.filter(function(a){return a.width>1&&a.height>1}),e.length>0&&(d=e),this.boundingRect=null,this.startAndEndRects=null,b=0,c=d.length;c>b;b++)d[b]=ve.translateRect(d[b],-f.left,-f.top),this.$highlights.append(this.createHighlight().css({top:d[b].top,left:d[b].left,width:d[b].width,height:d[b].height})),this.boundingRect?(this.boundingRect.top=Math.min(this.boundingRect.top,d[b].top),this.boundingRect.left=Math.min(this.boundingRect.left,d[b].left),this.boundingRect.bottom=Math.max(this.boundingRect.bottom,d[b].bottom),this.boundingRect.right=Math.max(this.boundingRect.right,d[b].right)):this.boundingRect=ve.copy(d[b]);this.boundingRect&&(this.boundingRect.width=this.boundingRect.right-this.boundingRect.left,this.boundingRect.height=this.boundingRect.bottom-this.boundingRect.top),this.rects=d},ve.ce.FocusableNode.prototype.positionHighlights=function(){if(this.highlighted){var a,b;for(this.calculateHighlights(),this.$highlights.empty(),a=0,b=this.rects.length;b>a;a++)this.$highlights.append(this.createHighlight().css({top:this.rects[a].top,left:this.rects[a].left,width:this.rects[a].width,height:this.rects[a].height}))}},ve.ce.FocusableNode.prototype.getRects=function(){return this.highlighted||this.calculateHighlights(),this.rects},ve.ce.FocusableNode.prototype.getBoundingRect=function(){return this.highlighted||this.calculateHighlights(),this.boundingRect},ve.ce.FocusableNode.prototype.getStartAndEndRects=function(){return this.highlighted||this.calculateHighlights(),this.startAndEndRects||(this.startAndEndRects=ve.getStartAndEndRects(this.rects)),this.startAndEndRects},ve.ce.ResizableNode=function(a,b){b=b||{},this.$resizable=a||this.$element,this.resizing=!1,this.$resizeHandles=this.$("<div>"),this.snapToGrid=void 0!==b.snapToGrid?b.snapToGrid:10,this.outline=!!b.outline,this.showSizeLabel=b.showSizeLabel!==!1,this.showScaleLabel=b.showScaleLabel!==!1,this.canShowScaleLabel=!1,(this.showSizeLabel||this.showScaleLabel)&&(this.$sizeText=this.$("<span>").addClass("ve-ce-resizableNode-sizeText"),this.$sizeLabel=this.$("<div>").addClass("ve-ce-resizableNode-sizeLabel").append(this.$sizeText)),this.resizableOffset=null,this.connect(this,{focus:"onResizableFocus",blur:"onResizableBlur",teardown:"onResizableTeardown",resizing:"onResizableResizing",resizeEnd:"onResizableFocus",rerender:"onResizableFocus",align:"onResizableAlign"}),this.model.connect(this,{attributeChange:"onResizableAttributeChange"}),this.$resizeHandles.addClass("ve-ce-resizableNode-handles").append(this.$("<div>").addClass("ve-ce-resizableNode-nwHandle").data("handle","nw")).append(this.$("<div>").addClass("ve-ce-resizableNode-neHandle").data("handle","ne")).append(this.$("<div>").addClass("ve-ce-resizableNode-seHandle").data("handle","se")).append(this.$("<div>").addClass("ve-ce-resizableNode-swHandle").data("handle","sw"))},OO.initClass(ve.ce.ResizableNode),ve.ce.ResizableNode.prototype.getResizableOffset=function(){return this.resizableOffset||(this.resizableOffset=OO.ui.Element["static"].getRelativePosition(this.$resizable,this.getRoot().getSurface().getSurface().$element)),this.resizableOffset},ve.ce.ResizableNode.prototype.setOriginalDimensions=function(a){var b=this.model.getScalable();b.setOriginalDimensions(a),this.canShowScaleLabel=this.showScaleLabel&&b.getOriginalDimensions().width&&b.getOriginalDimensions().height},ve.ce.ResizableNode.prototype.hideSizeLabel=function(){var a=this;setTimeout(function(){a.$sizeLabel.removeClass("ve-ce-resizableNode-sizeLabel-resizing")}),setTimeout(function(){a.$sizeLabel.addClass("oo-ui-element-hidden")},200)},ve.ce.ResizableNode.prototype.updateSizeLabel=function(){if(this.showSizeLabel||this.canShowScaleLabel){var a,b,c=this.model.getScalable(),d=c.getCurrentDimensions(),e=this.getResizableOffset(),f=(this.showSizeLabel?100:0)+(this.showScaleLabel?30:0);d.width<f?(a=e.top+d.height,b=30):(a=e.top,b=d.height),this.$sizeLabel.removeClass("oo-ui-element-hidden").addClass("ve-ce-resizableNode-sizeLabel-resizing").css({top:a,left:e.left,width:d.width,height:b,lineHeight:b+"px"}),this.$sizeText.empty(),this.showSizeLabel&&this.$sizeText.append(this.$("<span>").addClass("ve-ce-resizableNode-sizeText-size").text(Math.round(d.width)+" × "+Math.round(d.height))),this.canShowScaleLabel&&this.$sizeText.append(this.$("<span>").addClass("ve-ce-resizableNode-sizeText-scale").text(Math.round(100*c.getCurrentScale())+"%")),this.$sizeText.toggleClass("ve-ce-resizableNode-sizeText-warning",c.isTooSmall()||c.isTooLarge())}},ve.ce.ResizableNode.prototype.showHandles=function(a){var b,c,d=[],e=[],f=["nw","ne","sw","se"];for(b=0,c=f.length;c>b;b++)void 0===a||-1!==a.indexOf(f[b])?e.push("ve-ce-resizableNode-hide-"+f[b]):d.push("ve-ce-resizableNode-hide-"+f[b]);this.$resizeHandles.addClass(d.join(" ")).removeClass(e.join(" "))},ve.ce.ResizableNode.prototype.onResizableFocus=function(){var a=this.getRoot().getSurface();this.$resizeHandles.appendTo(a.getSurface().$controls),this.$sizeLabel&&this.$sizeLabel.appendTo(a.getSurface().$controls),this.model.getScalable(),this.setResizableHandlesSizeAndPosition(),this.$resizeHandles.find(".ve-ce-resizableNode-neHandle").css({marginRight:-this.$resizable.width()}).end().find(".ve-ce-resizableNode-swHandle").css({marginBottom:-this.$resizable.height()}).end().find(".ve-ce-resizableNode-seHandle").css({marginRight:-this.$resizable.width(),marginBottom:-this.$resizable.height()}),this.$resizeHandles.children().off(".ve-ce-resizableNode").on("mousedown.ve-ce-resizableNode",this.onResizeHandlesCornerMouseDown.bind(this)),a.connect(this,{position:"setResizableHandlesSizeAndPosition"})},ve.ce.ResizableNode.prototype.onResizableBlur=function(){if(this.getRoot()){var a=this.getRoot().getSurface();this.$resizeHandles.detach(),this.$sizeLabel&&this.$sizeLabel.detach(),a.disconnect(this,{position:"setResizableHandlesSizeAndPosition"})}},ve.ce.ResizableNode.prototype.onResizableAlign=function(a){switch(a){case"right":this.showHandles(["sw"]);break;case"left":this.showHandles(["se"]);break;case"center":this.showHandles(["sw","se"]);break;default:this.showHandles()}},ve.ce.ResizableNode.prototype.onResizableTeardown=function(){this.onResizableBlur()},ve.ce.ResizableNode.prototype.onResizableResizing=function(a){this.resizableOffset=null,this.model.getScalable().setCurrentDimensions(a),this.outline||(this.$resizable.css(this.model.getScalable().getCurrentDimensions()),this.setResizableHandlesPosition()),this.updateSizeLabel()},ve.ce.ResizableNode.prototype.onResizableAttributeChange=function(a,b,c){("width"===a||"height"===a)&&this.$resizable.css(a,c)},ve.ce.ResizableNode.prototype.onResizeHandlesCornerMouseDown=function(a){return this.root.getSurface().getSurface().getContext().toggle(!1),this.$resizeHandles.addClass("ve-ce-resizableNode-handles-resizing").css({width:this.$resizable.width(),height:this.$resizable.height()}),this.$resizeHandles.children().css("margin",0),this.resizeInfo={mouseX:a.screenX,mouseY:a.screenY,top:this.$resizeHandles.position().top,left:this.$resizeHandles.position().left,height:this.$resizeHandles.height(),width:this.$resizeHandles.width(),handle:$(a.target).data("handle")},this.resizing=!0,this.root.getSurface().resizing=!0,this.model.getScalable().setCurrentDimensions({width:this.resizeInfo.width,height:this.resizeInfo.height}),this.updateSizeLabel(),this.$(this.getElementDocument()).on({"mousemove.ve-ce-resizableNode":this.onDocumentMouseMove.bind(this),"mouseup.ve-ce-resizableNode":this.onDocumentMouseUp.bind(this)}),this.emit("resizeStart"),!1},ve.ce.ResizableNode.prototype.setResizableHandlesSizeAndPosition=function(){var a=this.$resizable.width(),b=this.$resizable.height();this.resizableOffset=null,this.setResizableHandlesPosition(),this.$resizeHandles.css({width:0,height:0}).find(".ve-ce-resizableNode-neHandle").css({marginRight:-a}).end().find(".ve-ce-resizableNode-swHandle").css({marginBottom:-b}).end().find(".ve-ce-resizableNode-seHandle").css({marginRight:-a,marginBottom:-b})},ve.ce.ResizableNode.prototype.setResizableHandlesPosition=function(){var a=this.getResizableOffset();this.$resizeHandles.css({top:a.top,left:a.left})},ve.ce.ResizableNode.prototype.onDocumentMouseMove=function(a){var b={},c={width:0,height:0,top:this.resizeInfo.top,left:this.resizeInfo.left};if(this.resizing){switch(this.resizeInfo.handle){case"se":b.x=a.screenX-this.resizeInfo.mouseX,b.y=a.screenY-this.resizeInfo.mouseY;break;case"nw":b.x=this.resizeInfo.mouseX-a.screenX,b.y=this.resizeInfo.mouseY-a.screenY;break;case"ne":b.x=a.screenX-this.resizeInfo.mouseX,b.y=this.resizeInfo.mouseY-a.screenY;break;case"sw":b.x=this.resizeInfo.mouseX-a.screenX,b.y=a.screenY-this.resizeInfo.mouseY}switch(c=this.model.getScalable().getBoundedDimensions({width:this.resizeInfo.width+b.x,height:this.resizeInfo.height+b.y},a.shiftKey&&this.snapToGrid),this.resizeInfo.handle){case"ne":c.top=this.resizeInfo.top+(this.resizeInfo.height-c.height);break;case"sw":c.left=this.resizeInfo.left+(this.resizeInfo.width-c.width);break;case"nw":c.top=this.resizeInfo.top+(this.resizeInfo.height-c.height),c.left=this.resizeInfo.left+(this.resizeInfo.width-c.width)}this.$resizeHandles.css(c),this.emit("resizing",{width:c.width,height:c.height})}},ve.ce.ResizableNode.prototype.onDocumentMouseUp=function(){var a,b=this.model.getOffset(),c=this.$resizeHandles.outerWidth(),d=this.$resizeHandles.outerHeight(),e=this.getRoot().getSurface().getModel(),f=e.getDocument(),g=e.getSelection();this.$resizeHandles.removeClass("ve-ce-resizableNode-handles-resizing"),this.$(this.getElementDocument()).off(".ve-ce-resizableNode"),this.resizing=!1,this.root.getSurface().resizing=!1,this.hideSizeLabel(),a=this.getAttributeChanges(c,d),ve.isEmptyObject(a)||e.change(ve.dm.Transaction.newFromAttributeChanges(f,b,a),g),this.root.getSurface().getSurface().getContext().updateDimensions(),this.emit("resizeEnd")
},ve.ce.ResizableNode.prototype.getAttributeChanges=function(a,b){var c={};return this.model.getAttribute("width")!==a&&(c.width=a),this.model.getAttribute("height")!==b&&(c.height=b),c},ve.ce.Surface=function(a,b,c){var d=this;OO.ui.Element.call(this,c),OO.EventEmitter.call(this),this.surface=b,this.model=a,this.documentView=new ve.ce.Document(a.getDocument(),this),this.surfaceObserver=new ve.ce.SurfaceObserver(this),this.selectionTimeout=null,this.$window=this.$(this.getElementWindow()),this.$document=this.$(this.getElementDocument()),this.$documentNode=this.getDocument().getDocumentNode().$element,this.nativeSelection=this.getElementWindow().getSelection(),this.eventSequencer=new ve.EventSequencer(["keydown","keypress","keyup","compositionstart","compositionend","input"]),this.clipboard=[],this.clipboardId=String(Math.random()),this.renderLocks=0,this.dragging=!1,this.relocatingNode=!1,this.selecting=!1,this.resizing=!1,this.focused=!1,this.deactivated=!1,this.$deactivatedSelection=this.$("<div>"),this.activeTableNode=null,this.contentBranchNodeChanged=!1,this.$highlightsFocused=this.$("<div>"),this.$highlightsBlurred=this.$("<div>"),this.$highlights=this.$("<div>").append(this.$highlightsFocused,this.$highlightsBlurred),this.$findResults=this.$("<div>"),this.$dropMarker=this.$("<div>").addClass("ve-ce-focusableNode-dropMarker"),this.$lastDropTarget=null,this.lastDropPosition=null,this.$pasteTarget=this.$("<div>"),this.pasting=!1,this.copying=!1,this.pasteSpecial=!1,this.focusedNode=null,this.newModelSelection=null,this.cursorEvent=null,this.misleadingCursorStartSelection=null,this.cursorDirectionality=null,this.unicorningNode=null,this.setUnicorningRecursionGuard=!1,this.hasSelectionChangeEvents="onselectionchange"in this.getElementDocument(),this.surfaceObserver.connect(this,{contentChange:"onSurfaceObserverContentChange",rangeChange:"onSurfaceObserverRangeChange",branchNodeChange:"onSurfaceObserverBranchNodeChange",slugEnter:"onSurfaceObserverSlugEnter"}),this.model.connect(this,{select:"onModelSelect",documentUpdate:"onModelDocumentUpdate",insertionAnnotationsChange:"onInsertionAnnotationsChange"}),this.onDocumentMouseUpHandler=this.onDocumentMouseUp.bind(this),this.$documentNode.on({mousedown:this.onDocumentMouseDown.bind(this),mousemove:this.onDocumentMouseMove.bind(this),cut:this.onCut.bind(this),copy:this.onCopy.bind(this)}),this.onWindowResizeHandler=this.onWindowResize.bind(this),this.$window.on("resize",this.onWindowResizeHandler),this.onDocumentFocusInOutHandler=this.onDocumentFocusInOut.bind(this),this.$document.on("focusin focusout",this.onDocumentFocusInOutHandler),this.debounceFocusChange=ve.debounce(this.onFocusChange).bind(this),this.$document.on("mousedown",this.debounceFocusChange),this.$pasteTarget.on({cut:this.onCut.bind(this),copy:this.onCopy.bind(this),paste:this.onPaste.bind(this)}),this.$documentNode.on("paste",this.onPaste.bind(this)).on("focus","a",function(){d.$documentNode[0].focus()}),this.hasSelectionChangeEvents?this.$document.on("selectionchange",this.onDocumentSelectionChange.bind(this)):this.$documentNode.on("mousemove",this.onDocumentSelectionChange.bind(this)),this.$element.on({dragstart:this.onDocumentDragStart.bind(this),dragover:this.onDocumentDragOver.bind(this),drop:this.onDocumentDrop.bind(this)}),this.eventSequencer.on({keydown:this.onDocumentKeyDown.bind(this),keyup:this.onDocumentKeyUp.bind(this),keypress:this.onDocumentKeyPress.bind(this),input:this.onDocumentInput.bind(this)}).after({keydown:this.afterDocumentKeyDown.bind(this)}),this.$element.addClass("ve-ce-surface"),this.$highlights.addClass("ve-ce-surface-highlights"),this.$highlightsFocused.addClass("ve-ce-surface-highlights-focused"),this.$highlightsBlurred.addClass("ve-ce-surface-highlights-blurred"),this.$deactivatedSelection.addClass("ve-ce-surface-deactivatedSelection"),this.$pasteTarget.addClass("ve-ce-surface-paste").prop({tabIndex:-1,contentEditable:"true"}),this.$element.append(this.$documentNode,this.$pasteTarget),this.surface.$blockers.append(this.$highlights),this.surface.$selections.append(this.$deactivatedSelection)},OO.inheritClass(ve.ce.Surface,OO.ui.Element),OO.mixinClass(ve.ce.Surface,OO.EventEmitter),ve.ce.Surface["static"].unsafeAttributes=["about","content","datatype","property","rel","resource","rev","typeof","style"],ve.ce.Surface["static"].getClipboardHash=function(a){var b,c,d,e="";for(b=0,c=a.length;c>b;b++)d=a[b],d.nodeType===Node.TEXT_NODE?e+=d.textContent:d.nodeType===Node.ELEMENT_NODE&&(e+="<"+d.nodeName+">"+this.getClipboardHash(d.childNodes));return e.replace(/\s/gm,"")},ve.ce.Surface.prototype.destroy=function(){var a=this.documentView.getDocumentNode();this.surfaceObserver.detach(),this.eventSequencer.detach(),a.setLive(!1),this.surfaceObserver.disconnect(this),this.model.disconnect(this),this.$document.off("focusin focusout",this.onDocumentFocusInOutHandler),this.$document.off("mousedown",this.documentFocusChangeHandler),this.$window.off("resize",this.onWindowResizeHandler),this.$documentNode[0].blur(),this.$element.remove(),this.$highlights.remove()},ve.ce.Surface.prototype.getOffsetFromCoords=function(a,b){var c,d,e,f,g,h=this.getElementDocument();try{return h.caretPositionFromPoint?(d=document.caretPositionFromPoint(a,b),c=ve.ce.getOffset(d.offsetNode,d.offset)):h.caretRangeFromPoint?(e=document.caretRangeFromPoint(a,b),c=ve.ce.getOffset(e.startContainer,e.startOffset)):document.body.createTextRange&&(f=document.body.createTextRange(),f.moveToPoint(a,b),f.pasteHTML('<span class="ve-ce-textRange-drop-marker">&nbsp;</span>'),g=this.$(".ve-ce-textRange-drop-marker"),c=ve.ce.getOffset(g.get(0),0),g.remove()),c}catch(i){return-1}},ve.ce.Surface.prototype.getNodeClientRectFromRange=function(a){for(var b,c,d,e,f,g=a.endContainer;g&&g.nodeType!==Node.ELEMENT_NODE;)g=g.parentNode;if(!g)return null;if(b=g.getClientRects()[0],!b)return null;if(c="rtl"===this.getModel().getDocument().getDir()?"right":"left",e=a.endContainer.childNodes[a.endOffset],a.collapsed&&$(e).hasClass("ve-ce-unicorn")){if(f=e.getClientRects()[0],!f)return null;d=f[c]}else d=b[c];return{top:b.top,bottom:b.bottom,left:d,right:d,width:0,height:b.height}},ve.ce.Surface.prototype.getSelectionRects=function(a){var b,c,d,e,f,g,h,i=[],j=[];if(a=a||this.getModel().getSelection(),!(a instanceof ve.dm.LinearSelection))return null;if(d=a.getRange(),g=this.getFocusedNode(d))return g.getRects();if(e=this.getNativeRange(d),!e)return null;try{if(i=RangeFix.getClientRects(e),!i.length)throw new Error("getClientRects returned empty list")}catch(k){h=this.getNodeClientRectFromRange(e),h&&(i=[h])}if(f=this.getSurface().getBoundingClientRect(),!i||!f)return null;for(b=0,c=i.length;c>b;b++)j.push(ve.translateRect(i[b],-f.left,-f.top));return j},ve.ce.Surface.prototype.getSelectionStartAndEndRects=function(a){var b,c;return a=a||this.getModel().getSelection(),a instanceof ve.dm.LinearSelection?(b=a.getRange(),c=this.getFocusedNode(b),c?c.getStartAndEndRects():ve.getStartAndEndRects(this.getSelectionRects())):null},ve.ce.Surface.prototype.getSelectionBoundingRect=function(a){var b,c,d,e,f;if(a=a||this.getModel().getSelection(),!(a instanceof ve.dm.LinearSelection))return null;if(b=a.getRange(),f=this.getFocusedNode(b))return f.getBoundingRect();if(c=this.getNativeRange(b),!c)return null;try{if(d=RangeFix.getBoundingClientRect(c),!d)throw new Error("getBoundingClientRect returned null")}catch(g){d=this.getNodeClientRectFromRange(c)}return e=this.getSurface().getBoundingClientRect(),d&&e?ve.translateRect(d,-e.left,-e.top):null},ve.ce.Surface.prototype.initialize=function(){this.documentView.getDocumentNode().setLive(!0);try{this.$document[0].execCommand("enableObjectResizing",!1,!1),this.$document[0].execCommand("enableInlineTableEditing",!1,!1)}catch(a){}},ve.ce.Surface.prototype.enable=function(){this.documentView.getDocumentNode().enable()},ve.ce.Surface.prototype.disable=function(){this.documentView.getDocumentNode().disable()},ve.ce.Surface.prototype.focus=function(){var a,b=this,c=this.getModel().getSelection();if(this.focusedNode||c instanceof ve.dm.TableSelection)this.$pasteTarget[0].focus();else if(c instanceof ve.dm.LinearSelection)a=this.getDocument().getNodeAndOffset(c.getRange().start).node,$(a).closest("[contenteditable=true]")[0].focus();else if(c instanceof ve.dm.NullSelection)return void this.getModel().selectFirstContentOffset();this.onModelSelect(),setTimeout(function(){b.isFocused()||b.getModel().selectFirstContentOffset()})},ve.ce.Surface.prototype.onDocumentFocusInOut=function(a){"iframe"!==a.target.nodeName.toLowerCase()&&this.debounceFocusChange()},ve.ce.Surface.prototype.onFocusChange=function(){var a=!1;a=OO.ui.contains([this.$documentNode[0],this.$pasteTarget[0]],this.nativeSelection.anchorNode,!0),this.deactivated?OO.ui.contains(this.$documentNode[0],this.nativeSelection.anchorNode,!0)&&this.onDocumentFocus():(a&&!this.isFocused()&&this.onDocumentFocus(),!a&&this.isFocused()&&this.onDocumentBlur())},ve.ce.Surface.prototype.deactivate=function(){this.deactivated||(this.surfaceObserver.disable(),this.deactivated=!0,this.nativeSelection.removeAllRanges(),this.updateDeactivatedSelection())},ve.ce.Surface.prototype.activate=function(){this.deactivated&&(this.deactivated=!1,this.updateDeactivatedSelection(),this.surfaceObserver.enable(),OO.ui.contains(this.$documentNode[0],this.nativeSelection.anchorNode,!0)?this.surfaceObserver.pollOnce():(this.focusedNode=null,this.onModelSelect()))},ve.ce.Surface.prototype.updateDeactivatedSelection=function(){var a,b,c,d=this.getModel().getSelection();if(this.$deactivatedSelection.empty(),this.deactivated&&!this.focusedNode&&d instanceof ve.dm.LinearSelection&&!d.isCollapsed()&&(c=this.getSelectionRects(d)))for(a=0,b=c.length;b>a;a++)this.$deactivatedSelection.append(this.$("<div>").css({top:c[a].top,left:c[a].left,width:c[a].width,height:c[a].height}))},ve.ce.Surface.prototype.onDocumentFocus=function(){this.getModel().getSelection().isNull()&&this.getModel().selectFirstContentOffset(),this.eventSequencer.attach(this.$element),this.surfaceObserver.startTimerLoop(),this.focused=!0,this.activate(),this.emit("focus")},ve.ce.Surface.prototype.onDocumentBlur=function(){this.eventSequencer.detach(),this.surfaceObserver.stopTimerLoop(),this.surfaceObserver.pollOnce(),this.surfaceObserver.clear(),this.dragging=!1,this.focused=!1,this.focusedNode&&(this.focusedNode.setFocused(!1),this.focusedNode=null),this.getModel().setNullSelection(),this.emit("blur")},ve.ce.Surface.prototype.isFocused=function(){return this.focused},ve.ce.Surface.prototype.onDocumentMouseDown=function(a){1===a.which&&(this.dragging=!0,this.$document.on("mouseup",this.onDocumentMouseUpHandler),this.surfaceObserver.stopTimerLoop(),setTimeout(this.afterDocumentMouseDown.bind(this,a,this.getModel().getSelection())),a.originalEvent.detail>=3&&!ve.init.platform.constructor["static"].isInternetExplorer()&&(a.preventDefault(),this.getModel().getFragment().expandLinearSelection("closest",ve.dm.BranchNode).adjustLinearSelection(1,-1).select()))},ve.ce.Surface.prototype.afterDocumentMouseDown=function(a,b){this.surfaceObserver.pollOnce(),a.shiftKey&&this.fixShiftClickSelect(b)},ve.ce.Surface.prototype.onDocumentMouseUp=function(a){this.$document.off("mouseup",this.onDocumentMouseUpHandler),this.surfaceObserver.startTimerLoop(),setTimeout(this.afterDocumentMouseUp.bind(this,a,this.getModel().getSelection()))},ve.ce.Surface.prototype.afterDocumentMouseUp=function(a,b){this.surfaceObserver.pollOnce(),a.shiftKey&&this.fixShiftClickSelect(b),!a.shiftKey&&this.selecting&&(this.emit("selectionEnd"),this.selecting=!1),this.dragging=!1},ve.ce.Surface.prototype.fixShiftClickSelect=function(a){if(a instanceof ve.dm.LinearSelection){var b=this.getModel().getSelection();b.isCollapsed()&&!b.equals(a)&&this.getModel().setLinearSelection(new ve.Range(a.getRange().from,b.getRange().to))}},ve.ce.Surface.prototype.onDocumentMouseMove=function(){this.dragging&&!this.selecting&&(this.selecting=!0,this.emit("selectionStart"))},ve.ce.Surface.prototype.onDocumentSelectionChange=function(){this.dragging&&this.surfaceObserver.pollOnceSelection()},ve.ce.Surface.prototype.onDocumentDragStart=function(a){var b=a.originalEvent.dataTransfer;try{b.setData("application-x/VisualEditor",JSON.stringify(this.getModel().getSelection()))}catch(c){b.setData("text","__ve__"+JSON.stringify(this.getModel().getSelection()))}},ve.ce.Surface.prototype.onDocumentDragOver=function(a){if(this.relocatingNode){var b,c,d,e,f,g;if(!this.relocatingNode.isContent()){if(a.preventDefault(),b=$(a.target).closest(".ve-ce-branchNode, .ve-ce-leafNode"),b.length){for(f=this.relocatingNode.getType(),d=b.data("view");d.parent&&!d.parent.isAllowedChildNodeType(f);)d=d.parent;d.parent&&(g=!1,d.parent.traverseUpstream(function(a){return a.handlesOwnChildren()?(g=!0,!1):void 0})),d.parent&&!g?(c=d.$element,e=a.originalEvent.pageY-c.offset().top>c.outerHeight()/2?"bottom":"top"):(c=this.$lastDropTarget,e=this.lastDropPosition)}!this.$lastDropTarget||this.$lastDropTarget.is(c)&&e===this.lastDropPosition||(this.$dropMarker.detach(),c=null),!c||c.is(this.$lastDropTarget)&&e===this.lastDropPosition||(this.$dropMarker.width(c.width()),"top"===e?this.$dropMarker.insertBefore(c):this.$dropMarker.insertAfter(c)),void 0!==c&&(this.$lastDropTarget=c,this.lastDropPosition=e)}this.selecting&&(this.emit("selectionEnd"),this.selecting=!1,this.dragging=!1)}},ve.ce.Surface.prototype.onDocumentDrop=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=[],q=a.originalEvent.dataTransfer,r=this.$lastDropTarget,s=this.lastDropPosition;a.preventDefault();try{b=q.getData("application-x/VisualEditor")}catch(t){b=q.getData("text"),b="__ve__"===b.slice(0,6)?b.slice(6):null}if(this.relocatingNode)d=this.relocatingNode.getModel().getOuterRange();else if(b)c=ve.dm.Selection["static"].newFromJSON(this.getModel().getDocument(),b),c instanceof ve.dm.LinearSelection&&(d=c.getRange());else if(q.files.length)for(l=0,m=q.files.length;m>l;l++)n=ve.ui.dataTransferHandlerFactory.getHandlerNameForType(q.files[l].type),n&&p.push(ve.ui.dataTransferHandlerFactory.create(n,this.surface,q.files[l]));else try{j=q.getData("text/html"),j||(k=q.getData("text/plain"))}catch(t){k=q.getData("text")}if(d&&!d.isCollapsed()||p.length||j||k){if(this.relocatingNode&&!this.relocatingNode.getModel().isContent()){if(!r)return;g=r.data("view").getModel().getOuterRange(),h="top"===s?g.start:g.end}else if(h=this.getOffsetFromCoords(a.originalEvent.pageX-this.$document.scrollLeft(),a.originalEvent.pageY-this.$document.scrollTop()),-1===h)return;if(i=this.getModel().getLinearFragment(new ve.Range(h)),d)e=this.getModel().getLinearFragment(d),f=e.getData(),e.removeContent(),i.insertContent(f);else if(p.length)for(o=function(a){a instanceof ve.dm.Document?i.collapseToEnd().insertDocument(a):i.collapseToEnd().insertContent(a)},l=0,m=p.length;m>l;l++)p[l].getInsertableData().done(o);else j?i.insertHtml(j,this.getSurface().getImportRules()):k&&i.insertContent(k)}this.endRelocation()},ve.ce.Surface.prototype.onDocumentKeyDown=function(a){var b,c,d=this.getModel().getSelection(),e=!1;if(!(d instanceof ve.dm.NullSelection)&&229!==a.which){this.surfaceObserver.stopTimerLoop(),this.incRenderLock();try{this.surfaceObserver.pollOnce()}finally{this.decRenderLock()}switch(this.storeKeyDownState(a),a.keyCode){case OO.ui.Keys.LEFT:case OO.ui.Keys.RIGHT:case OO.ui.Keys.UP:case OO.ui.Keys.DOWN:this.dragging||this.selecting||!a.shiftKey||(this.selecting=!0,this.emit("selectionStart")),d instanceof ve.dm.LinearSelection?(this.handleLinearArrowKey(a),e=!0):d instanceof ve.dm.TableSelection&&this.handleTableArrowKey(a);break;case OO.ui.Keys.END:case OO.ui.Keys.HOME:case OO.ui.Keys.PAGEUP:case OO.ui.Keys.PAGEDOWN:d instanceof ve.dm.TableSelection&&this.handleTableArrowKey(a);break;case OO.ui.Keys.ENTER:a.preventDefault(),c=this.getFocusedNode(),c?c.executeCommand():d instanceof ve.dm.LinearSelection?(this.handleLinearEnter(a),e=!0):d instanceof ve.dm.TableSelection&&this.handleTableEnter(a);break;case OO.ui.Keys.BACKSPACE:case OO.ui.Keys.DELETE:d instanceof ve.dm.LinearSelection?(this.handleLinearDelete(a)&&a.preventDefault(),e=!0):d instanceof ve.dm.TableSelection&&(a.preventDefault(),this.handleTableDelete(a));break;case OO.ui.Keys.ESCAPE:this.getActiveTableNode()&&this.handleTableEditingEscape(a);break;default:b=new ve.ui.Trigger(a),b.isComplete()&&this.surface.execute(b)&&(a.preventDefault(),a.stopPropagation(),e=!0)}e||this.incRenderLock();try{this.surfaceObserver.pollOnce()}finally{e||this.decRenderLock()}this.surfaceObserver.startTimerLoop()}},ve.ce.Surface.prototype.onDocumentKeyPress=function(a){0===a.which||0===a.charCode||a.keyCode===OO.ui.Keys.TAB||a.keyCode===OO.ui.Keys.ESCAPE||ve.ce.isShortcutKey(a)||this.handleInsertion()},ve.ce.Surface.prototype.afterDocumentKeyDown=function(a){function b(a,b,c){var d,e,f;return d=a.nodeType===Node.TEXT_NODE?a:c>0&&b<a.childNodes.length?a.childNodes[b]:0>c&&b>0?a.childNodes[b-1]:a,e=$(d).closest("[contenteditable], .ve-ce-branchNode"),"false"!==e.prop("contenteditable")?null:(f=e.closest(".ve-ce-branchNode, .ve-ce-leafNode").data("view"),f&&f.isFocusable()?f:null)}function c(){return l&&k.misleadingCursorStartSelection.focusNode&&k.nativeSelection.focusNode&&ve.compareDocumentOrder(k.nativeSelection.focusNode,k.nativeSelection.focusOffset,k.misleadingCursorStartSelection.focusNode,k.misleadingCursorStartSelection.focusOffset)||null}var d,e,f,g,h,i,j,k=this,l=a.keyCode===OO.ui.Keys.UP||a.keyCode===OO.ui.Keys.DOWN||a.keyCode===OO.ui.Keys.LEFT||a.keyCode===OO.ui.Keys.RIGHT;if(!(a!==this.cursorEvent||l&&this.restoreActiveTableNodeSelection())){if(l&&!a.ctrlKey&&!a.altKey&&!a.metaKey&&this.misleadingCursorStartSelection.isCollapsed&&this.nativeSelection.isCollapsed&&null!==(d=c())){if(e=b(this.nativeSelection.focusNode,this.nativeSelection.focusOffset,d),!e){try{f=ve.ce.getOffset(this.misleadingCursorStartSelection.focusNode,this.misleadingCursorStartSelection.focusOffset),g=ve.ce.getOffset(this.nativeSelection.focusNode,this.nativeSelection.focusOffset),h=g-f}catch(m){f=g=h=void 0}2===Math.abs(h)&&(e=this.model.documentModel.documentNode.getNodeFromOffset((f+g)/2),e.isFocusable()?i=new ve.Range(f,g):e=void 0)}e&&(i||(i=e.getOuterRange(),0>d&&(i=i.flip())),this.model.setLinearSelection(i),a.keyCode===OO.ui.Keys.LEFT?this.cursorDirectionality=d>0?"rtl":"ltr":a.keyCode===OO.ui.Keys.RIGHT&&(this.cursorDirectionality=0>d?"rtl":"ltr"))}j=!a.shiftKey&&(a.keyCode===OO.ui.Keys.LEFT||a.keyCode===OO.ui.Keys.RIGHT),this.incRenderLock();try{this.surfaceObserver.pollOnce()}finally{this.decRenderLock()}this.checkUnicorns(j)}},ve.ce.Surface.prototype.checkUnicorns=function(a){var b,c,d,e,f;if(this.unicorningNode&&this.unicorningNode.unicorns&&(b=this.unicorningNode.unicorns[0],c=this.unicorningNode.unicorns[1],0!==this.nativeSelection.rangeCount)){for(d=this.nativeSelection.getRangeAt(0),e=d.endContainer,e.nodeType===Node.ELEMENT_NODE&&(e=d.endOffset>0?e.childNodes[d.endOffset-1]:null);null!==e&&e.nodeType===Node.TEXT_NODE;)e=e.previousSibling;if(e!==b){if(f=ve.compareDocumentOrder(d.endContainer,d.endOffset,b.parentNode,Array.prototype.indexOf.call(b.parentNode.childNodes,b))<0?-1:1,a){this.incRenderLock();try{this.moveModelCursor(f)}finally{this.decRenderLock()}}this.renderSelectedContentBranchNode(),this.showSelection(this.getModel().getSelection())}}},ve.ce.Surface.prototype.onDocumentKeyUp=function(a){!this.dragging&&this.selecting&&a.keyCode===OO.ui.Keys.SHIFT&&(this.selecting=!1,this.emit("selectionEnd"));var b,c,d;if(this.surface.toolbarHeight){if(b=this.getNativeRange(),!b)return null;c=RangeFix.getBoundingClientRect(b),c&&c.top<this.surface.toolbarHeight&&(d=this.getScrollPosition()+c.top-this.surface.toolbarHeight,this.setScrollPosition(d))}},ve.ce.Surface.prototype.onCut=function(a){var b=this;this.onCopy(a),setTimeout(function(){b.getModel().getFragment()["delete"]().select()})},ve.ce.Surface.prototype.onCopy=function(a){var b,c,d,e,f,g,h,i,j=this.getModel().getSelection(),k=this,l=this.getModel().getDocument().getHtmlDocument(),m=a.originalEvent.clipboardData;(j instanceof ve.dm.LinearSelection||j instanceof ve.dm.TableSelection&&j.isSingleCell())&&(h=j.getRanges()[0],i=this.model.documentModel.cloneSliceFromRange(h),this.$pasteTarget.empty(),e=i.data.clone(),i.data.cloneElements(!0),ve.dm.converter.getDomSubtreeFromModel(i,this.$pasteTarget[0],!0),this.$pasteTarget.find("span").addClass("ve-pasteProtect"),this.$pasteTarget.find("a").attr("href",function(a,b){return ve.resolveUrl(b,l)}),g="["+ve.ce.Surface["static"].unsafeAttributes.join("],[")+"]",this.$pasteTarget.find(g).each(function(){var a,b,c={},d=ve.ce.Surface["static"].unsafeAttributes;for(a=d.length;a--;)b=this.getAttribute(d[a]),null!==b&&(c[d[a]]=b);this.setAttribute("data-ve-attributes",JSON.stringify(c))}),d={slice:i,hash:null},c=this.clipboard.push(d)-1,m&&m.items?(a.preventDefault(),m.setData("text/xcustom",this.clipboardId+"-"+c),m.setData("text/html",this.$pasteTarget.html()),m.setData("text/plain",this.$pasteTarget.text())):(d.hash=this.constructor["static"].getClipboardHash(this.$pasteTarget.contents()),this.$pasteTarget.prepend(this.$("<span>").attr("data-ve-clipboard-key",this.clipboardId+"-"+c).html("&nbsp;")),b=this.getNativeRange(),b?(f=this.getScrollPosition(),this.surfaceObserver.disable(),ve.selectElement(this.$pasteTarget[0]),this.setScrollPosition(f),setTimeout(function(){k.$documentNode[0].focus(),k.nativeSelection.removeAllRanges(),k.nativeSelection.addRange(b.cloneRange()),k.setScrollPosition(f),k.surfaceObserver.clear(),k.surfaceObserver.enable()})):ve.selectElement(this.$pasteTarget[0])))},ve.ce.Surface.prototype.onPaste=function(a){var b=this;return this.pasting?!1:(this.surfaceObserver.disable(),this.pasting=!0,this.beforePaste(a),void setTimeout(function(){b.afterPaste(a),b.surfaceObserver.clear(),b.surfaceObserver.enable(),b.pasting=!1,b.pasteSpecial=!1,b.beforePasteData=null}))},ve.ce.Surface.prototype.beforePaste=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n=this.getModel().getSelection(),o=a.originalEvent.clipboardData,p=this.getModel().getDocument();(n instanceof ve.dm.LinearSelection||n instanceof ve.dm.TableSelection&&n.isSingleCell())&&(c=n.getRanges()[0],this.beforePasteData={},o&&(this.beforePasteData.custom=o.getData("text/xcustom"),this.beforePasteData.html=o.getData("text/html"),this.beforePasteData.html&&(this.beforePasteData.html=this.beforePasteData.html.replace(/^[\s\S]*<!-- *StartFragment *-->/,"").replace(/<!-- *EndFragment *-->[\s\S]*$/,""))),c.isCollapsed()||(b=ve.dm.Transaction.newFromRemoval(p,c),n=n.translateByTransaction(b),this.model.change(b,n),c=n.getRanges()[0]),this.beforePasteData.scrollTop=this.getScrollPosition(),this.$pasteTarget.empty(),d=p.getBranchNodeFromOffset(c.start),d.canContainContent()?(l=m=0,e=d.getRange(),f=d.getClonedElement(),h=[f],c.start>e.start&&(i="☀",h.push(i),l=m=1),c.end<e.end&&(j="☂",h.push(j)),i||j||(h.push("☁"),m=1),h.push({type:"/"+h[0].type}),delete f.internal,ve.dm.converter.getDomSubtreeFromModel(new ve.dm.Document(new ve.dm.ElementLinearData(p.getStore(),h),p.getHtmlDocument(),void 0,p.getInternalList(),p.getLang(),p.getDir()),this.$pasteTarget[0]),this.$pasteTarget[0].focus(),g=this.getElementDocument().createRange(),k=this.$pasteTarget.children().contents()[0],g.setStart(k,l),g.setEnd(k,m),this.nativeSelection.removeAllRanges(),this.nativeSelection.addRange(g),this.beforePasteData.context=h,this.beforePasteData.leftText=i,this.beforePasteData.rightText=j):this.$pasteTarget[0].focus(),this.setScrollPosition(this.beforePasteData.scrollTop))},ve.ce.Surface.prototype.afterPaste=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r="span[id],span[typeof],span[rel]",s=this.getSurface().getImportRules(),t=this.beforePasteData||{},u=this.model.getSelection(),v=this;if(this.nativeSelection.isCollapsed&&(u instanceof ve.dm.LinearSelection||u instanceof ve.dm.TableSelection&&u.isSingleCell())){if(d=u.getRanges()[0],this.$pasteTarget.find("span").removeClass("ve-pasteProtect"),this.$pasteTarget.find("[style]").removeAttr("style"),this.$pasteTarget.find("[data-ve-attributes]").each(function(){var a;try{a=JSON.parse(this.getAttribute("data-ve-attributes"))}catch(b){return}$(this).attr(a),this.removeAttribute("data-ve-attributes")}),t.custom?a=t.custom:t.html?(e=this.$($.parseHTML(t.html)),e=e.filter(function(){var b=this.getAttribute&&this.getAttribute("data-ve-clipboard-key");return b?(a=b,!1):!0})):(a=this.$pasteTarget.find("span[data-ve-clipboard-key]").data("ve-clipboard-key"),e=this.$pasteTarget.contents()),this.$pasteTarget.find("span[data-ve-clipboard-key]").remove(),a&&(f=a.split("-"),b=f[0],c=f[1],b===this.clipboardId&&this.clipboard[c]&&(t.custom||this.clipboard[c].hash===this.constructor["static"].getClipboardHash(e.toArray()))&&(h=this.clipboard[c].slice)),h)try{g=new ve.dm.ElementLinearData(h.getStore(),ve.copy(h.getOriginalData())),(s.all||this.pasteSpecial)&&g.sanitize(s.all||{},this.pasteSpecial),ve.dm.Document["static"].addAnnotationsToData(g.getData(),this.model.getInsertionAnnotations()),i=ve.dm.Transaction.newFromInsertion(this.documentView.model,d.start,g.getData())}catch(w){g=new ve.dm.ElementLinearData(h.getStore(),ve.copy(h.getBalancedData())),(s.all||this.pasteSpecial)&&g.sanitize(s.all||{},this.pasteSpecial),ve.dm.Document["static"].addAnnotationsToData(g.getData(),this.model.getInsertionAnnotations()),i=ve.dm.Transaction.newFromInsertion(this.documentView.model,d.start,g.getData())}else{if(a&&t.html&&(e||(e=this.$($.parseHTML(t.html))),("useClipboardData-0"===a||e.find(r).andSelf().filter(r).length>0&&0===this.$pasteTarget.find(r).length)&&(m=ve.createDocumentFromHtml(t.html),$(m).find("span").removeClass("ve-pasteProtect"),t.context=null)),m||(m=ve.createDocumentFromHtml(this.$pasteTarget.html())),l=ve.dm.converter.getModelFromDom(m,this.getModel().getDocument().getHtmlDocument()),k=l.data,l.metadata=new ve.dm.MetaLinearData(l.getStore(),new Array(1+k.getLength())),a?(s.all||this.pasteSpecial)&&k.sanitize(s.all||{},this.pasteSpecial):(k.sanitize(s.external,this.pasteSpecial),s.all&&k.sanitize(s.all)),k.remapInternalListKeys(this.model.getDocument().getInternalList()),l.buildNodeTree(),t.context){for(j=l.getInternalList().getListNode().getOuterRange(),n=new ve.dm.ElementLinearData(l.getStore(),ve.copy(t.context)),this.pasteSpecial&&n.sanitize(s,this.pasteSpecial,!0),o=0;n.getLength()&&ve.dm.ElementLinearData["static"].compareElements(k.getData(o),k.isElementData(o)?n.getData(0):t.leftText);)o++,n.splice(0,1);for(p=j.start;n.getLength()&&ve.dm.ElementLinearData["static"].compareElements(k.getData(p-1),k.isElementData(p-1)?n.getData(n.getLength()-1):t.rightText);)p--,n.splice(n.getLength()-1,1);for(;"break"===k.getType(p-1);)p--;q=new ve.Range(o,p)}i=ve.dm.Transaction.newFromDocumentInsertion(this.documentView.model,d.start,l,q)}this.$documentNode[0].focus(),setTimeout(function(){v.setScrollPosition(t.scrollTop)}),u=u.translateByTransaction(i),this.model.change(i,u.collapseToStart()),this.model.setSelection(u.collapseToEnd())}},ve.ce.Surface.prototype.selectAll=function(){var a,b,c,d=this.getModel().getSelection();d instanceof ve.dm.LinearSelection?(this.getActiveTableNode()&&this.getActiveTableNode().getEditingFragment()?(b=this.getActiveTableNode().getEditingRange(),b=new ve.Range(b.from+1,b.to-1)):(a=this.getModel().getDocument().getInternalList().getListNode().getOuterRange(),b=new ve.Range(this.getNearestCorrectOffset(0,1),this.getNearestCorrectOffset(a.start,-1))),this.getModel().setLinearSelection(b)):d instanceof ve.dm.TableSelection&&(c=d.getTableNode().getMatrix(),this.getModel().setSelection(new ve.dm.TableSelection(d.getDocument(),d.tableRange,0,0,c.getColCount()-1,c.getRowCount()-1)))},ve.ce.Surface.prototype.onDocumentInput=function(){this.incRenderLock();try{this.surfaceObserver.pollOnce()}finally{this.decRenderLock()}},ve.ce.Surface.prototype.onModelSelect=function(){var a,b=this.getModel().getSelection();this.cursorDirectionality=null,this.contentBranchNodeChanged=!1,b instanceof ve.dm.LinearSelection?(a=this.findFocusedNode(b.getRange()),a!==this.focusedNode&&(this.focusedNode&&(this.focusedNode.setFocused(!1),this.focusedNode=null),a&&(a.setFocused(!0),this.focusedNode=a,this.dragging||(this.$pasteTarget.text(" "),ve.selectElement(this.$pasteTarget[0]),this.$pasteTarget[0].focus(),this.surfaceObserver.clear())))):(b instanceof ve.dm.TableSelection&&(this.$pasteTarget.text(" "),ve.selectElement(this.$pasteTarget[0]),this.$pasteTarget[0].focus()),this.focusedNode&&this.focusedNode.setFocused(!1),this.focusedNode=null),this.isRenderingLocked()||b===this.newModelSelection||(this.showSelection(b),this.checkUnicorns(!1)),this.surfaceObserver.pollOnceNoEmit(),this.updateSlug()},ve.ce.Surface.prototype.getFocusedNode=function(a){if(!a)return this.focusedNode;var b=this.getModel().getSelection();return b instanceof ve.dm.LinearSelection&&a.equalsSelection(b.getRange())?this.focusedNode:this.findFocusedNode(a)},ve.ce.Surface.prototype.findFocusedNode=function(a){var b,c,d=this.documentView.getDocumentNode();if(a.isCollapsed()){if(b=d.getNodeFromOffset(a.start),b&&b.isFocusable())return b}else if(b=d.getNodeFromOffset(a.start+1),b&&b.isFocusable()&&(c=d.getNodeFromOffset(a.end-1),b===c))return b;return null},ve.ce.Surface.prototype.onModelDocumentUpdate=function(){var a=this;this.contentBranchNodeChanged&&this.onModelSelect(),this.surfaceObserver.pollOnceNoEmit(),setTimeout(function(){a.emit("position")})},ve.ce.Surface.prototype.onInsertionAnnotationsChange=function(){var a=this.renderSelectedContentBranchNode();a&&(this.showSelection(this.surface.getModel().getSelection()),this.surfaceObserver.pollOnceNoEmit())},ve.ce.Surface.prototype.renderSelectedContentBranchNode=function(){var a,b;return a=this.model.getSelection(),a instanceof ve.dm.LinearSelection?(b=this.documentView.getBranchNodeFromOffset(a.getRange().start),null===b?!1:b instanceof ve.ce.ContentBranchNode?b.renderContents():!1):!1},ve.ce.Surface.prototype.onSurfaceObserverBranchNodeChange=function(a){a instanceof ve.ce.ContentBranchNode&&a.renderContents()},ve.ce.Surface.prototype.onSurfaceObserverRangeChange=function(a,b){if(!a||!a.equalsSelection(b)){this.incRenderLock();try{this.changeModel(null,b?new ve.dm.LinearSelection(this.getModel().getDocument(),b):new ve.dm.NullSelection(this.getModel().getDocument()))}finally{this.decRenderLock()}this.checkUnicorns(!1)}},ve.ce.Surface.prototype.onSurfaceObserverSlugEnter=function(){var a,b,c,d=this.getModel(),e=d.getDocument();this.updateSlug(),a=d.getFragment(),a.getSelection()instanceof ve.dm.LinearSelection&&(b=a.getSelection().getRange().start,d.pushStaging(!0),this.changeModel(ve.dm.Transaction.newFromInsertion(e,b,[{type:"paragraph",internal:{generated:"slug"}},{type:"/paragraph"}]),new ve.dm.LinearSelection(e,new ve.Range(b+1))),this.slugFragment=a,this.$element.find(".ve-ce-branchNode-blockSlugWrapper-former").remove(),c=this.getDocument().getBranchNodeFromOffset(b+1).$element,c.wrap(this.$("<div>").addClass("ve-ce-branchNode-blockSlugWrapper-former-unfocused")),this.onModelSelect(),c.parent().addClass("ve-ce-branchNode-blockSlugWrapper-former").removeClass("ve-ce-branchNode-blockSlugWrapper-former-unfocused"))},ve.ce.Surface.prototype.updateSlug=function(){if(!this.updatingSlug){if(this.updatingSlug=!0,this.slugFragment){var a,b,c,d=this.slugFragment.getSelection().getRange(),e=this.getModel();e.getSelection()instanceof ve.dm.LinearSelection&&(a=e.getSelection().getRange()),2===d.getLength()?a&&d.containsOffset(a.start)||(e.popStaging(),this.surfaceObserver.clear(),this.surfaceObserver.pollOnceNoEmit(),b=$(this.documentView.getSlugAtOffset(d.start)),c=b[0].previousSibling,b.detach().removeClass("ve-ce-branchNode-blockSlugWrapper-unfocused").addClass("ve-ce-branchNode-blockSlugWrapper-focused").insertAfter(c).height(),b.removeClass("ve-ce-branchNode-blockSlugWrapper-focused").addClass("ve-ce-branchNode-blockSlugWrapper-unfocused"),this.slugFragment=null):(this.getDocument().getBranchNodeFromOffset(d.start+1).$element.unwrap(),this.showSelection(this.getModel().getSelection()),e.applyStaging(),this.slugFragment=null)
}this.updatingSlug=!1}},ve.ce.Surface.prototype.onSurfaceObserverContentChange=function(a,b,c){function d(a,b){var c,d,e,f,g,h,i=b.start,j=b.end,k=unicodeJS.wordbreak.isBreak(u,i-q-1),l=unicodeJS.wordbreak.isBreak(u,j+t-q-1);if(k||l)for(g=v.getModel().getDocument().data.getAnnotationsFromOffset(i-1),h=v.getModel().getDocument().data.getAnnotationsFromOffset(j),c=0,d=a.getLength();d>c;c++)e=a.get(c),f=a.getIndex(c),e.constructor["static"].splitOnWordbreak&&(k&&!h.containsIndex(f)||l&&!g.containsIndex(f))&&(a.removeAt(c),c--,d--)}var e,f,g,h,i,j,k,l,m,n,o=0,p=0,q=a.getModel().getOffset(),r=b.text.split(""),s=c.text.split(""),t=c.text.length-b.text.length,u=new ve.dm.DataString(s),v=this;if(b.range&&c.range){if(i=b.range.isCollapsed()&&c.range.isCollapsed()?c.range.start-b.range.start:null,k=b.range.start-q-1,l=c.range.start-q-1,j=null!==i&&(t>0&&b.text.slice(0,k)===c.text.slice(0,k)&&b.text.slice(k)===c.text.slice(l)||0>t&&b.text.slice(0,l)===c.text.slice(0,l)&&b.text.slice(k-t+i)===c.text.slice(l)),t>0&&i===t&&j){e=s.slice(k,l),h=a.unicornAnnotations||this.model.getInsertionAnnotations(),h.getLength()&&(d(h,new ve.Range(b.range.start)),ve.dm.Document["static"].addAnnotationsToData(e,h)),this.incRenderLock();try{this.changeModel(ve.dm.Transaction.newFromInsertion(this.documentView.model,b.range.start,e),new ve.dm.LinearSelection(this.documentView.model,c.range))}finally{this.decRenderLock()}return void setTimeout(function(){v.checkSequences()})}if((0===i||i===t)&&j){f=0===i?new ve.Range(c.range.start,c.range.start-t):new ve.Range(c.range.start,b.range.start),this.incRenderLock();try{this.changeModel(ve.dm.Transaction.newFromRemoval(this.documentView.model,f),new ve.dm.LinearSelection(this.documentView.model,c.range))}finally{this.decRenderLock()}return}}for(g=Math.min(r.length,s.length);g>o&&r[o]===s[o];)++o;for(;g-o>p&&r[r.length-1-p]===s[s.length-1-p];)++p;n=new ve.Range(q+1+o,q+1+r.length-p),e=s.slice(o,s.length-p),h=a.unicornAnnotations?a.unicornAnnotations:this.model.getDocument().data.getAnnotationsFromOffset(n.start),h.getLength()&&(d(h,n),ve.dm.Document["static"].addAnnotationsToData(e,h)),m=c.range,m.isCollapsed()&&(m=new ve.Range(this.getNearestCorrectOffset(m.start,1))),this.changeModel(ve.dm.Transaction.newFromReplacement(this.documentView.model,n,e),new ve.dm.LinearSelection(this.documentView.model,m)),this.queueCheckSequences=!0,setTimeout(function(){v.checkSequences()})},ve.ce.Surface.prototype.checkSequences=function(){var a,b,c=!1,d=this.surface.getModel(),e=d.getSelection();if(e instanceof ve.dm.LinearSelection){for(b=ve.ui.sequenceRegistry.findMatching(d.getDocument().data,e.getRange().end),a=0;a<b.length;a++)c=b[a].execute(this.surface)||c;c&&this.showSelection(this.surface.getModel().getSelection())}},ve.ce.Surface.prototype.onWindowResize=ve.debounce(function(){this.emit("position")},50),ve.ce.Surface.prototype.startRelocation=function(a){this.relocatingNode=a,this.emit("relocationStart",a)},ve.ce.Surface.prototype.endRelocation=function(){this.relocatingNode&&(this.emit("relocationEnd",this.relocatingNode),this.relocatingNode=null,this.$lastDropTarget&&(this.$dropMarker.detach(),this.$lastDropTarget=null,this.lastDropPosition=null))},ve.ce.Surface.prototype.setActiveTableNode=function(a){this.activeTableNode=a},ve.ce.Surface.prototype.getActiveTableNode=function(){return this.activeTableNode},ve.ce.Surface.prototype.storeKeyDownState=function(a){return 0===this.nativeSelection.rangeCount?(this.cursorEvent=null,void(this.misleadingCursorStartSelection=null)):(this.cursorEvent=a,this.misleadingCursorStartSelection=null,void((a.keyCode===OO.ui.Keys.UP||a.keyCode===OO.ui.Keys.DOWN||a.keyCode===OO.ui.Keys.LEFT||a.keyCode===OO.ui.Keys.RIGHT)&&(this.misleadingCursorStartSelection={isCollapsed:this.nativeSelection.isCollapsed,anchorNode:this.nativeSelection.anchorNode,anchorOffset:this.nativeSelection.anchorOffset,focusNode:this.nativeSelection.focusNode,focusOffset:this.nativeSelection.focusOffset})))},ve.ce.Surface.prototype.moveModelCursor=function(a){var b=this.model.getSelection();b instanceof ve.dm.LinearSelection&&this.model.setLinearSelection(this.model.getDocument().getRelativeRange(b.getRange(),a,"character",!1))},ve.ce.Surface.prototype.getFocusedNodeDirectionality=function(){var a,b=this.model.getSelection().getRange();return this.cursorDirectionality?this.cursorDirectionality:(a=this.getDocument().getNodeAndOffset(b.to).node,a.nodeType===Node.TEXT_NODE&&(a=a.parentNode),this.$(a).css("direction"))},ve.ce.Surface.prototype.restoreActiveTableNodeSelection=function(){var a,b;return(a=this.getActiveTableNode())&&(b=a.getEditingRange())&&!b.containsRange(ve.ce.veRangeFromSelection(this.nativeSelection))?(this.showSelection(this.getModel().getSelection()),!0):!1},ve.ce.Surface.prototype.handleLinearArrowKey=function(a){var b,c,d,e,f,g,h,i,j=this.model.getSelection().getRange(),k=this;if(this.surfaceObserver.stopTimerLoop(),this.surfaceObserver.pollOnce(),g=a.keyCode===OO.ui.Keys.UP||a.keyCode===OO.ui.Keys.DOWN,this.focusedNode){if(g?e=a.keyCode===OO.ui.Keys.DOWN?1:-1:(f=this.getFocusedNodeDirectionality(),e=a.keyCode===OO.ui.Keys.LEFT^"rtl"===f?-1:1),!this.focusedNode.isContent())return j=this.model.getDocument().getRelativeRange(j,e,"character",a.shiftKey,this.getActiveTableNode()?this.getActiveTableNode().getEditingRange():null),this.model.setLinearSelection(j),void a.preventDefault();if(a.shiftKey)-1===e^j.isBackwards()&&(j=j.flip()),this.model.setLinearSelection(new ve.Range(j.to));else if(j=new ve.Range(1===e?j.end:j.start),this.model.setLinearSelection(j),!g)return void a.preventDefault()}!this.nativeSelection.extend&&j.isBackwards()?(c=this.nativeSelection.anchorNode,d=this.nativeSelection.anchorOffset):!j.isCollapsed()&&g&&(c=this.nativeSelection.focusNode,d=this.nativeSelection.focusOffset),c&&(b=this.getElementDocument().createRange(),b.setStart(c,d),b.setEnd(c,d),this.nativeSelection.removeAllRanges(),this.nativeSelection.addRange(b)),h=this.nativeSelection.focusNode,i=this.nativeSelection.focusOffset,this.eventSequencer.afterOne({keydown:function(){var b,c,d;b=$(k.nativeSelection.focusNode).closest(".ve-ce-leafNode,.ve-ce-branchNode").data("view"),b&&(b.isFocusable()?(d=g?a.keyCode===OO.ui.Keys.DOWN?1:-1:ve.compareDocumentOrder(h,h,k.nativeSelection.focusNode,k.nativeSelection.focusOffset),c=1===d?b.getOuterRange():b.getOuterRange().flip()):(k.surfaceObserver.pollOnceNoEmit(),c=new ve.Range(k.surfaceObserver.getRange().to)),a.shiftKey&&(c=new ve.Range(j.from,c.to),k.getModel().setLinearSelection(c)),k.surfaceObserver.pollOnce())}})},ve.ce.Surface.prototype.handleTableArrowKey=function(a){var b,c,d=!1,e=this.getModel().getSelection(),f=0,g=0;switch(a.keyCode){case OO.ui.Keys.LEFT:f=-1,d=!0;break;case OO.ui.Keys.RIGHT:f=1,d=!0;break;case OO.ui.Keys.UP:g=-1;break;case OO.ui.Keys.DOWN:g=1;break;case OO.ui.Keys.HOME:f=-1/0;break;case OO.ui.Keys.END:f=1/0;break;case OO.ui.Keys.PAGEUP:g=-1/0;break;case OO.ui.Keys.PAGEDOWN:g=1/0}a.preventDefault(),f&&d&&(b=this.documentView.getBranchNodeFromOffset(e.tableRange.start+1),"ltr"!==b.$element.css("direction")&&(f*=-1)),a.shiftKey||e.isSingleCell()||(e=e.collapseToFrom()),c=e.newFromAdjustment(a.shiftKey?0:f,a.shiftKey?0:g,f,g),this.getModel().setSelection(c)},ve.ce.Surface.prototype.handleInsertion=function(){if(!this.focusedNode){var a,b,c,d=!1,e=this.model.getSelection(),f=this.model.getDocument();e instanceof ve.dm.TableSelection&&(c=e.collapseToFrom(),b=f.data.getAnnotationsFromRange(c.getRanges()[0]),this.model.setSelection(c),this.handleTableDelete(),this.documentView.getBranchNodeFromOffset(e.tableRange.start+1).setEditing(!0),this.model.setInsertionAnnotations(b),e=this.model.getSelection()),e instanceof ve.dm.LinearSelection&&(a=e.getRange(),a.isCollapsed()||(b=f.data.getAnnotationsFromRange(new ve.Range(a.start,a.start+1)),this.documentView.rangeInsideOneLeafNode(a)||(this.model.change(ve.dm.Transaction.newFromRemoval(this.documentView.model,a),new ve.dm.LinearSelection(f,new ve.Range(a.start))),d=!0,this.surfaceObserver.clear(),a=this.model.getSelection().getRange()),this.model.setInsertionAnnotations(b)),d&&(this.surfaceObserver.stopTimerLoop(),this.surfaceObserver.pollOnce()))}},ve.ce.Surface.prototype.handleLinearEnter=function(a){var b,c,d,e,f,g,h,i,j=this.model.getSelection().getRange(),k=j.from,l=this.model.getDocument(),m=[{type:"paragraph"},{type:"/paragraph"}],n=!0,o=[],p=null,q=null,r=null;if(j.isCollapsed()||(b=ve.dm.Transaction.newFromRemoval(l,j),j=b.translateRange(j),this.model.change(b,new ve.dm.LinearSelection(l,j))),i=this.documentView.getBranchNodeFromOffset(j.from),null!==i&&(q=i.getModel(),r=q.getRange()),i&&i.handleEnter)return i.handleEnter(this);if(null===i)throw new Error("node === null");if("paragraph"===q.getType()||k!==r.from&&k!==r.to){if(a.shiftKey&&q.hasSignificantWhitespace())c=ve.dm.Transaction.newFromInsertion(l,j.from,"\n");else if(!i.splitOnEnter()){if(h=!1,l.hasSlugAtOffset(j.from)?h=!0:(g=l.data.getNearestContentOffset(k,-1),-1===g&&(h=!0)),!h)return k=g,i=this.documentView.getBranchNodeFromOffset(k),void(c=void 0);c=ve.dm.Transaction.newFromInsertion(l,k,m),h=void 0}}else k===r.to?c=ve.dm.Transaction.newFromInsertion(l,q.getOuterRange().to,m):k===r.from&&(c=ve.dm.Transaction.newFromInsertion(l,q.getOuterRange().from,m),n=!1);void 0===c&&(i.traverseUpstream(function(b){return b.splitOnEnter()?(o.splice(o.length/2,0,{type:"/"+b.type},b.getModel().getClonedElement()),p=b,a.shiftKey?!1:!0):!1}),d=p.getModel().getParent(),e=d.getChildren().length,"listItem"===p.type&&d.getChildren()[e-1]===p.getModel()&&1===p.children.length&&0===i.getModel().length?(f=p.getModel().getParent(),1===f.getChildren().length?c=ve.dm.Transaction.newFromRemoval(l,f.getOuterRange()):(c=ve.dm.Transaction.newFromRemoval(l,p.getModel().getOuterRange()),this.model.change(c),j=c.translateRange(j),c=ve.dm.Transaction.newFromInsertion(l,f.getOuterRange().to,m)),n=!1):c=ve.dm.Transaction.newFromInsertion(l,j.from,o)),this.model.change(c),j=c.translateRange(j),k=n?l.data.getRelativeContentOffset(j.from,1):l.data.getNearestContentOffset(j.from),-1===k?(this.model.change(ve.dm.Transaction.newFromInsertion(l,j.from,m)),this.model.setLinearSelection(new ve.Range(j.from+1))):this.model.setLinearSelection(new ve.Range(k)),this.surfaceObserver.clear()},ve.ce.Surface.prototype.handleTableEnter=function(a){var b=this.getModel().getSelection(),c=this.documentView.getBranchNodeFromOffset(b.tableRange.start+1);a.preventDefault(),c.setEditing(!0)},ve.ce.Surface.prototype.handleLinearDelete=function(a){var b,c,d,e=a.keyCode===OO.ui.Keys.DELETE?1:-1,f=a.altKey===!0||a.ctrlKey===!0?"word":"character",g=0,h=this.getModel().getSelection().getRange(),i=this.getModel().getDocument(),j=i.data;if(h.isCollapsed()){if(g=h.start,!a.ctrlKey&&(-1===e&&!j.isElementData(g-1)||1===e&&!j.isElementData(g)))return this.eventSequencer.afterOne({keydown:this.surfaceObserver.pollOnce.bind(this.surfaceObserver)}),!1;if(h=i.getRelativeRange(h,e,f,!0),d=this.getActiveTableNode()?this.getActiveTableNode().getEditingRange():null,d&&!d.containsRange(h))return!0;if(g=h.start,b=j.getLength(),b>g){for(;b>g&&j.isCloseElementData(g);)g++;if(c=i.getDocumentNode().getNodeFromOffset(g+1),c.isFocusable())return this.getModel().setLinearSelection(c.getOuterRange()),!0}if(h.isCollapsed())return!0}return this.getModel().getLinearFragment(h)["delete"](e),this.focus(),this.surfaceObserver.clear(),!1},ve.ce.Surface.prototype.handleTableDelete=function(){var a,b,c=this.getModel(),d=[],e=c.getSelection().getRanges();for(a=0,b=e.length;b>a;a++)d.push(c.getLinearFragment(e[a],!0));for(a=0,b=d.length;b>a;a++)d[a].insertContent([{type:"paragraph",internal:{generated:"wrapper"}},{type:"/paragraph"}])},ve.ce.Surface.prototype.handleTableEditingEscape=function(a){a.preventDefault(),a.stopPropagation(),this.getActiveTableNode().setEditing(!1)},ve.ce.Surface.prototype.getViewportRange=function(){function a(a,e,f){for(var g,h,i=e.start,j=e.end,k=1/0;e.getLength()<k;)k=e.getLength(),g=d.getNearestContentOffset(Math.round((e.start+e.end)/2)),h=b.getSelectionBoundingRect(new ve.dm.LinearSelection(c,new ve.Range(g))),h[f]>a?(j=g,e=new ve.Range(e.start,j)):(i=g,e=new ve.Range(i,e.end));return"bottom"===f?i:j}var b=this,c=this.getModel().getDocument(),d=c.data,e=this.getSurface().getBoundingClientRect(),f=50,g=Math.max(this.surface.toolbarHeight-e.top-f,0),h=g+this.$window.height()-this.surface.toolbarHeight+2*f,i=new ve.Range(0,this.getModel().getDocument().getInternalList().getListNode().getOuterRange().start);return new ve.Range(a(g,i,"bottom"),a(h,i,"top"))},ve.ce.Surface.prototype.showSelection=function(a){if(this.deactivated)return void setTimeout(this.updateDeactivatedSelection.bind(this));if(a instanceof ve.dm.LinearSelection&&!this.focusedNode){var b,c=a.getRange(),d=this.getRangeSelection(c),e=this.getElementDocument().createRange();if(this.nativeSelection.removeAllRanges(),d.end)if(e.setStart(d.start.node,d.start.offset),e.setEnd(d.end.node,d.end.offset),d.isBackwards&&this.nativeSelection.extend){b=e.cloneRange(),b.collapse(!1),this.nativeSelection.addRange(b);try{this.nativeSelection.extend(e.startContainer,e.startOffset)}catch(f){this.nativeSelection.addRange(e)}}else this.nativeSelection.addRange(e);else e.setStart(d.start.node,d.start.offset),this.nativeSelection.addRange(e);OO.ui.contains(this.getElementDocument().activeElement,d.start.node,!0)||$(d.start.node).closest("[contenteditable=true]").focus()}},ve.ce.Surface.prototype.getRangeSelection=function(a){return a=new ve.Range(this.getNearestCorrectOffset(a.from,-1),this.getNearestCorrectOffset(a.to,1)),a.isCollapsed()?{start:this.documentView.getNodeAndOffset(a.start)}:{start:this.documentView.getNodeAndOffset(a.start),end:this.documentView.getNodeAndOffset(a.end),isBackwards:a.isBackwards()}},ve.ce.Surface.prototype.getNativeRange=function(a){var b,c,d=this.getModel().getSelection();if(a&&!this.deactivated&&d instanceof ve.dm.LinearSelection&&d.getRange().equalsSelection(a)&&(a=null),!a){if(!(d instanceof ve.dm.LinearSelection))return null;if(this.nativeSelection.rangeCount>0)try{return this.nativeSelection.getRangeAt(0)}catch(e){}return null}return b=document.createRange(),c=this.getRangeSelection(a),b.setStart(c.start.node,c.start.offset),c.end&&b.setEnd(c.end.node,c.end.offset),b},ve.ce.Surface.prototype.appendHighlights=function(a,b){this.$highlightsBlurred.children().detach(),b?this.$highlightsFocused.append(a):this.$highlightsBlurred.append(a)},ve.ce.Surface.prototype.getNearestCorrectOffset=function(a,b){var c,d,e=this.getModel().getDocument(),f=e.data;return b=b>0?1:-1,f.isContentOffset(a)||e.hasSlugAtOffset(a)?a:(c=f.getNearestContentOffset(a,b),d=f.getNearestStructuralOffset(a,b,!0),e.hasSlugAtOffset(d)||-1===c?1===b?a>c?d:Math.min(c,d):c>a?d:Math.max(c,d):c)},ve.ce.Surface.prototype.getSurface=function(){return this.surface},ve.ce.Surface.prototype.getModel=function(){return this.model},ve.ce.Surface.prototype.getDocument=function(){return this.documentView},ve.ce.Surface.prototype.isRenderingLocked=function(){return this.renderLocks>0},ve.ce.Surface.prototype.incRenderLock=function(){this.renderLocks++},ve.ce.Surface.prototype.decRenderLock=function(){this.renderLocks--},ve.ce.Surface.prototype.changeModel=function(a,b){if(null!==this.newModelSelection)throw new Error("Nested change of newModelSelection");this.newModelSelection=b;try{this.model.change(a,b)}finally{this.newModelSelection=null}},ve.ce.Surface.prototype.setContentBranchNodeChanged=function(){this.contentBranchNodeChanged=!0,this.cursorEvent=null,this.cursorStartRange=null},ve.ce.Surface.prototype.setUnicorning=function(a){if(this.setUnicorningRecursionGuard)throw new Error("setUnicorning recursing");if(this.unicorningNode&&this.unicorningNode!==a){this.setUnicorningRecursionGuard=!0;try{this.unicorningNode.renderContents()}finally{this.setUnicorningRecursionGuard=!1}}this.unicorningNode=a},ve.ce.Surface.prototype.setNotUnicorning=function(a){this.unicorningNode===a&&(this.unicorningNode=null)},ve.ce.Surface.prototype.setNotUnicorningAll=function(a){this.unicorningNode===a&&(this.unicorningNode=null),this.setUnicorning(null)},ve.ce.Surface.prototype.setScrollPosition=function(a){this.$window.scrollTop(a)},ve.ce.Surface.prototype.getScrollPosition=function(){return this.$window.scrollTop()},ve.ce.SurfaceObserver=function(a){OO.EventEmitter.call(this),this.surface=a,this.documentView=a.getDocument(),this.domDocument=this.documentView.getDocumentNode().getElementDocument(),this.polling=!1,this.disabled=!1,this.timeoutId=null,this.pollInterval=250,this.rangeState=null},OO.mixinClass(ve.ce.SurfaceObserver,OO.EventEmitter),ve.ce.SurfaceObserver.prototype.clear=function(){this.rangeState=null},ve.ce.SurfaceObserver.prototype.detach=function(){this.surface=null,this.documentView=null,this.domDocument=null},ve.ce.SurfaceObserver.prototype.startTimerLoop=function(){this.polling=!0,this.timerLoop(!0)},ve.ce.SurfaceObserver.prototype.timerLoop=function(a){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null),a||this.pollOnce(),null!==this.pollInterval&&(this.timeoutId=this.setTimeout(this.timerLoop.bind(this),this.pollInterval))},ve.ce.SurfaceObserver.prototype.stopTimerLoop=function(){this.polling===!0&&(this.polling=!1,clearTimeout(this.timeoutId),this.timeoutId=null)},ve.ce.SurfaceObserver.prototype.disable=function(){this.disabled=!0},ve.ce.SurfaceObserver.prototype.enable=function(){this.disabled=!1},ve.ce.SurfaceObserver.prototype.pollOnce=function(){this.pollOnceInternal(!0)},ve.ce.SurfaceObserver.prototype.pollOnceNoEmit=function(){this.pollOnceInternal(!1)},ve.ce.SurfaceObserver.prototype.pollOnceSelection=function(){this.pollOnceInternal(!0,!0)},ve.ce.SurfaceObserver.prototype.pollOnceInternal=function(a,b){var c,d,e=this;this.domDocument&&!this.disabled&&(c=this.rangeState,d=new ve.ce.RangeState(c,this.surface.$element,this.documentView.getDocumentNode(),b),d.leftBlockSlug&&c.$slugWrapper.addClass("ve-ce-branchNode-blockSlugWrapper-unfocused").removeClass("ve-ce-branceNode-blockSlugWrapper-focused"),d.enteredBlockSlug&&d.$slugWrapper.addClass("ve-ce-branchNode-blockSlugWrapper-focused").removeClass("ve-ce-branchNode-blockSlugWrapper-unfocused"),this.rangeState=d,(d.enteredBlockSlug||d.leftBlockSlug)&&this.setTimeout(function(){e.surface&&e.surface.emit("position")},200),!b&&null!==d.node&&d.contentChanged&&a&&this.emit("contentChange",d.node,{text:c.text,hash:c.hash,range:c.veRange},{text:d.text,hash:d.hash,range:d.veRange}),d.branchNodeChanged&&this.emit("branchNodeChange",c&&c.node&&c.node.root?c.node:null,d.node),d.selectionChanged&&a&&this.emit("rangeChange",c?c.veRange:null,d.veRange),d.enteredBlockSlug&&a&&this.emit("slugEnter"))},ve.ce.SurfaceObserver.prototype.setTimeout=function(a,b){return setTimeout(a,b)},ve.ce.SurfaceObserver.prototype.getRange=function(){return this.rangeState?this.rangeState.veRange:null},ve.ce.GeneratedContentNode=function(){this.generatingPromise=null,this.model.connect(this,{update:"onGeneratedContentNodeUpdate"}),this.connect(this,{teardown:"abortGenerating"}),this.update()},ve.ce.GeneratedContentNode["static"]={},ve.ce.GeneratedContentNode["static"].renderHtmlAttributes=!1,ve.ce.GeneratedContentNode.prototype.generateContents=function(){throw new Error("ve.ce.GeneratedContentNode subclass must implement generateContents")},ve.ce.GeneratedContentNode.prototype.onGeneratedContentNodeUpdate=function(){this.update()},ve.ce.GeneratedContentNode.prototype.getRenderedDomElements=function(a){function b(){var b=a[0].ownerDocument,c=b.createElement(this.nodeName);c.setAttribute(e,this.getAttribute(e)),this.setAttribute(e,c[e])}var c,d,e,f,g=this.getElementDocument();if(f=$(ve.copyDomElements(a,g)),f=f.not("link, style"),f.find("link, style").remove(),f.length)for(c=0,d=f.length;d>c;c++)f[c].nodeType===Node.TEXT_NODE&&(f[c]=this.$("<span>").append(f[c])[0]);else f=this.$("<span>");for(c=0,d=ve.dm.Converter.computedAttributes.length;d>c;c++)e=ve.dm.Converter.computedAttributes[c],f.find("["+e+"]").add(f.filter("["+e+"]")).each(b);return f.toArray()},ve.ce.GeneratedContentNode.prototype.render=function(a){this.live&&this.emit("teardown");var b=this.$(this.getRenderedDomElements(ve.copyDomElements(a)));this.$element[0].parentNode?(this.$element.first().replaceWith(b),this.$element.remove(),this.$element=b):this.$element=b,this.$focusable&&(this.$focusable=this.getFocusableElement()),this.$resizable&&(this.$resizable=this.getResizableElement()),this.live&&(this.emit("setup"),this.afterRender())},ve.ce.GeneratedContentNode.prototype.afterRender=function(){this.emit("rerender")},ve.ce.GeneratedContentNode.prototype.update=function(a){var b=this.model.doc.getStore(),c=b.indexOfHash(OO.getHash([this.model,a]));null!==c?this.render(b.value(c)):this.forceUpdate(a)},ve.ce.GeneratedContentNode.prototype.forceUpdate=function(a){var b,c=this;this.generatingPromise?this.abortGenerating():this.startGenerating(),b=this.generatingPromise=this.generateContents(a),b.done(function(d){c.generatingPromise===b&&c.doneGenerating(d,a)}).fail(function(){c.generatingPromise===b&&c.failGenerating()})},ve.ce.GeneratedContentNode.prototype.startGenerating=function(){this.$element.addClass("ve-ce-generatedContentNode-generating")},ve.ce.GeneratedContentNode.prototype.abortGenerating=function(){var a=this.generatingPromise;a&&(this.generatingPromise=null,$.isFunction(a.abort)&&a.abort()),this.$element.removeClass("ve-ce-generatedContentNode-generating")},ve.ce.GeneratedContentNode.prototype.doneGenerating=function(a,b){var c,d;this.model.doc&&(c=this.model.doc.getStore(),d=OO.getHash([this.model,b]),c.index(a,d)),this.$element.removeClass("ve-ce-generatedContentNode-generating"),this.generatingPromise=null,this.render(a)},ve.ce.GeneratedContentNode.prototype.failGenerating=function(){this.$element.removeClass("ve-ce-generatedContentNode-generating"),this.generatingPromise=null},ve.ce.GeneratedContentNode.prototype.getFocusableElement=function(){return this.$element},ve.ce.GeneratedContentNode.prototype.getResizableElement=function(){return this.$element},ve.ce.AlienNode=function(){ve.ce.AlienNode["super"].apply(this,arguments),ve.ce.FocusableNode.call(this),ve.ce.GeneratedContentNode.call(this),this.$highlights.addClass("ve-ce-alienNode-highlights")},OO.inheritClass(ve.ce.AlienNode,ve.ce.LeafNode),OO.mixinClass(ve.ce.AlienNode,ve.ce.FocusableNode),OO.mixinClass(ve.ce.AlienNode,ve.ce.GeneratedContentNode),ve.ce.AlienNode["static"].name="alien",ve.ce.AlienNode.prototype.createHighlight=function(){return ve.ce.FocusableNode.prototype.createHighlight.call(this).addClass("ve-ce-alienNode-highlight").prop("title",ve.msg("visualeditor-aliennode-tooltip"))},ve.ce.AlienNode.prototype.generateContents=function(a){var b=$.Deferred();return b.resolve(a&&a.domElements||this.model.getAttribute("domElements")||[]),b.promise()},ve.ce.AlienBlockNode=function(){ve.ce.AlienBlockNode["super"].apply(this,arguments)},OO.inheritClass(ve.ce.AlienBlockNode,ve.ce.AlienNode),ve.ce.AlienBlockNode["static"].name="alienBlock",ve.ce.AlienInlineNode=function(){ve.ce.AlienInlineNode["super"].apply(this,arguments)},OO.inheritClass(ve.ce.AlienInlineNode,ve.ce.AlienNode),ve.ce.AlienInlineNode["static"].name="alienInline",ve.ce.nodeFactory.register(ve.ce.AlienNode),ve.ce.nodeFactory.register(ve.ce.AlienBlockNode),ve.ce.nodeFactory.register(ve.ce.AlienInlineNode),ve.ce.BlockquoteNode=function(a,b){ve.ce.ContentBranchNode.call(this,a,b)},OO.inheritClass(ve.ce.BlockquoteNode,ve.ce.ContentBranchNode),ve.ce.BlockquoteNode["static"].name="blockquote",ve.ce.BlockquoteNode["static"].tagName="blockquote",ve.ce.nodeFactory.register(ve.ce.BlockquoteNode),ve.ce.BreakNode=function(){ve.ce.BreakNode["super"].apply(this,arguments),this.$element.addClass("ve-ce-breakNode")},OO.inheritClass(ve.ce.BreakNode,ve.ce.LeafNode),ve.ce.BreakNode["static"].name="break",ve.ce.BreakNode["static"].tagName="br",ve.ce.nodeFactory.register(ve.ce.BreakNode),ve.ce.CenterNode=function(){ve.ce.CenterNode["super"].apply(this,arguments)},OO.inheritClass(ve.ce.CenterNode,ve.ce.BranchNode),ve.ce.CenterNode["static"].name="center",ve.ce.CenterNode["static"].tagName="center",ve.ce.nodeFactory.register(ve.ce.CenterNode),ve.ce.CommentNode=function(a,b){ve.ce.CommentNode["super"].call(this,a,b),ve.ce.FocusableNode.call(this,this.$element,b),OO.ui.IndicatorElement.call(this,$.extend({},b,{$indicator:this.$element,indicator:"alert"})),this.$element.addClass("ve-ce-commentNode").text(" ")},OO.inheritClass(ve.ce.CommentNode,ve.ce.LeafNode),OO.mixinClass(ve.ce.CommentNode,ve.ce.FocusableNode),OO.mixinClass(ve.ce.CommentNode,OO.ui.IndicatorElement),ve.ce.CommentNode["static"].name="comment",ve.ce.CommentNode["static"].primaryCommandName="comment",ve.ce.CommentNode["static"].getDescription=function(a){return a.getAttribute("text")},ve.ce.nodeFactory.register(ve.ce.CommentNode),ve.ce.DefinitionListItemNode=function(){ve.ce.DefinitionListItemNode["super"].apply(this,arguments),this.model.connect(this,{update:"onUpdate"})},OO.inheritClass(ve.ce.DefinitionListItemNode,ve.ce.BranchNode),ve.ce.DefinitionListItemNode["static"].name="definitionListItem",ve.ce.DefinitionListItemNode["static"].splitOnEnter=!0,ve.ce.DefinitionListItemNode.prototype.getTagName=function(){var a=this.model.getAttribute("style"),b={definition:"dd",term:"dt"};if(!Object.prototype.hasOwnProperty.call(b,a))throw new Error("Invalid style");return b[a]},ve.ce.DefinitionListItemNode.prototype.onUpdate=function(){this.updateTagName()},ve.ce.nodeFactory.register(ve.ce.DefinitionListItemNode),ve.ce.DefinitionListNode=function(){ve.ce.DefinitionListNode["super"].apply(this,arguments)},OO.inheritClass(ve.ce.DefinitionListNode,ve.ce.BranchNode),ve.ce.DefinitionListNode["static"].name="definitionList",ve.ce.DefinitionListNode["static"].tagName="dl",ve.ce.nodeFactory.register(ve.ce.DefinitionListNode),ve.ce.DivNode=function(){ve.ce.DivNode["super"].apply(this,arguments)},OO.inheritClass(ve.ce.DivNode,ve.ce.BranchNode),ve.ce.DivNode["static"].name="div",ve.ce.nodeFactory.register(ve.ce.DivNode),ve.ce.DocumentNode=function(a,b,c){ve.ce.DocumentNode["super"].call(this,a,c),this.surface=b,this.setRoot(this),this.$element.addClass("ve-ce-documentNode"),this.$element.prop({contentEditable:"true",spellcheck:!0})},OO.inheritClass(ve.ce.DocumentNode,ve.ce.BranchNode),ve.ce.DocumentNode["static"].name="document",ve.ce.DocumentNode.prototype.getOuterLength=function(){return this.length},ve.ce.DocumentNode.prototype.getSurface=function(){return this.surface},ve.ce.DocumentNode.prototype.disable=function(){this.$element.prop("contentEditable","false")},ve.ce.DocumentNode.prototype.enable=function(){this.$element.prop("contentEditable","true")},ve.ce.nodeFactory.register(ve.ce.DocumentNode),ve.ce.HeadingNode=function(){ve.ce.HeadingNode["super"].apply(this,arguments),this.model.connect(this,{update:"onUpdate"})},OO.inheritClass(ve.ce.HeadingNode,ve.ce.ContentBranchNode),ve.ce.HeadingNode["static"].name="heading",ve.ce.HeadingNode.prototype.getTagName=function(){var a=this.model.getAttribute("level"),b={1:"h1",2:"h2",3:"h3",4:"h4",5:"h5",6:"h6"};if(!Object.prototype.hasOwnProperty.call(b,a))throw new Error("Invalid level");return b[a]},ve.ce.HeadingNode.prototype.onUpdate=function(){this.updateTagName()},ve.ce.nodeFactory.register(ve.ce.HeadingNode),ve.ce.InternalItemNode=function(){ve.ce.InternalItemNode["super"].apply(this,arguments),this.$element.addClass("ve-ce-internalItemNode")},OO.inheritClass(ve.ce.InternalItemNode,ve.ce.BranchNode),ve.ce.InternalItemNode["static"].name="internalItem",ve.ce.InternalItemNode["static"].tagName="span",ve.ce.nodeFactory.register(ve.ce.InternalItemNode),ve.ce.InternalListNode=function(){ve.ce.InternalListNode["super"].apply(this,arguments),this.$element=this.$([])},OO.inheritClass(ve.ce.InternalListNode,ve.ce.BranchNode),ve.ce.InternalListNode["static"].name="internalList",ve.ce.InternalListNode.prototype.onSplice=function(){},ve.ce.nodeFactory.register(ve.ce.InternalListNode),ve.ce.ListItemNode=function(){ve.ce.ListItemNode["super"].apply(this,arguments)},OO.inheritClass(ve.ce.ListItemNode,ve.ce.BranchNode),ve.ce.ListItemNode["static"].name="listItem",ve.ce.ListItemNode["static"].tagName="li",ve.ce.ListItemNode["static"].splitOnEnter=!0,ve.ce.nodeFactory.register(ve.ce.ListItemNode),ve.ce.ListNode=function(){ve.ce.ListNode["super"].apply(this,arguments),this.model.connect(this,{update:"onUpdate"})},OO.inheritClass(ve.ce.ListNode,ve.ce.BranchNode),ve.ce.ListNode["static"].name="list",ve.ce.ListNode.prototype.getTagName=function(){var a=this.model.getAttribute("style"),b={bullet:"ul",number:"ol"};if(!Object.prototype.hasOwnProperty.call(b,a))throw new Error("Invalid style");return b[a]},ve.ce.ListNode.prototype.onUpdate=function(){this.updateTagName()},ve.ce.nodeFactory.register(ve.ce.ListNode),ve.ce.ParagraphNode=function(){ve.ce.ParagraphNode["super"].apply(this,arguments),this.$element.addClass("ve-ce-paragraphNode"),this.model.getElement().internal&&"wrapper"===this.model.getElement().internal.generated&&this.$element.addClass("ve-ce-generated-wrapper")},OO.inheritClass(ve.ce.ParagraphNode,ve.ce.ContentBranchNode),ve.ce.ParagraphNode["static"].name="paragraph",ve.ce.ParagraphNode["static"].tagName="p",ve.ce.nodeFactory.register(ve.ce.ParagraphNode),ve.ce.PreformattedNode=function(){ve.ce.PreformattedNode["super"].apply(this,arguments)},OO.inheritClass(ve.ce.PreformattedNode,ve.ce.ContentBranchNode),ve.ce.PreformattedNode["static"].name="preformatted",ve.ce.PreformattedNode["static"].tagName="pre",ve.ce.nodeFactory.register(ve.ce.PreformattedNode),ve.ce.TableCaptionNode=function(){ve.ce.TableCaptionNode["super"].apply(this,arguments)},OO.inheritClass(ve.ce.TableCaptionNode,ve.ce.BranchNode),ve.ce.TableCaptionNode["static"].name="tableCaption",ve.ce.TableCaptionNode["static"].tagName="caption",ve.ce.TableCaptionNode.prototype.onSetup=function(){ve.ce.TableCaptionNode["super"].prototype.onSetup.call(this),this.$element.addClass("ve-ce-tableCaptionNode").prop("contentEditable","true")},ve.ce.nodeFactory.register(ve.ce.TableCaptionNode),ve.ce.TableCellNode=function(){ve.ce.TableCellNode["super"].apply(this,arguments),this.model.connect(this,{update:"onUpdate",attributeChange:"onAttributeChange"})},OO.inheritClass(ve.ce.TableCellNode,ve.ce.BranchNode),ve.ce.TableCellNode["static"].name="tableCell",ve.ce.TableCellNode.prototype.onSetup=function(){var a=this.model.getRowspan(),b=this.model.getColspan();ve.ce.TableCellNode["super"].prototype.onSetup.call(this),!this.isSetup&&this.root&&(this.$element.addClass("ve-ce-tableCellNode ve-ce-tableCellNode-"+this.model.getAttribute("style")),a>1&&this.$element.attr("rowspan",a),b>1&&this.$element.attr("colspan",b))},ve.ce.TableCellNode.prototype.getTagName=function(){var a=this.model.getAttribute("style"),b={data:"td",header:"th"};if(!Object.prototype.hasOwnProperty.call(b,a))throw new Error("Invalid style");return b[a]},ve.ce.TableCellNode.prototype.setEditing=function(a){this.$element.toggleClass("ve-ce-tableCellNode-editing",a).prop("contentEditable",a.toString())},ve.ce.TableCellNode.prototype.onUpdate=function(){this.updateTagName()},ve.ce.TableCellNode.prototype.onAttributeChange=function(a,b,c){switch(a){case"colspan":case"rowspan":c>1?this.$element.attr(a,c):this.$element.removeAttr(a);break;case"style":this.updateTagName()}},ve.ce.nodeFactory.register(ve.ce.TableCellNode),ve.ce.TableNode=function(){ve.ce.TableNode["super"].apply(this,arguments),this.surface=null,this.active=!1,this.startCell=null,this.editingFragment=null},OO.inheritClass(ve.ce.TableNode,ve.ce.BranchNode),ve.ce.TableNode.prototype.onSetup=function(){ve.ce.TableNode["super"].prototype.onSetup.call(this),!this.isSetup&&this.root&&(this.surface=this.getRoot().getSurface(),this.$element.addClass("ve-ce-tableNode").prop("contentEditable","false"),this.$selectionBox=this.$("<div>").addClass("ve-ce-tableNodeOverlay-selection-box"),this.$selectionBoxAnchor=this.$("<div>").addClass("ve-ce-tableNodeOverlay-selection-box-anchor"),this.colContext=new ve.ui.TableContext(this,"table-col",{$:this.$,classes:["ve-ui-tableContext-colContext"],indicator:"down"}),this.rowContext=new ve.ui.TableContext(this,"table-row",{$:this.$,classes:["ve-ui-tableContext-rowContext"],indicator:"next"}),this.$overlay=this.$("<div>").addClass("ve-ce-tableNodeOverlay oo-ui-element-hidden").append([this.$selectionBox,this.$selectionBoxAnchor,this.colContext.$element,this.rowContext.$element,this.$rowBracket,this.$colBracket]),this.surface.surface.$blockers.append(this.$overlay),this.$element.on({"mousedown.ve-ce-tableNode":this.onTableMouseDown.bind(this),"dblclick.ve-ce-tableNode":this.onTableDblClick.bind(this)}),this.onTableMouseUpHandler=this.onTableMouseUp.bind(this),this.onTableMouseMoveHandler=this.onTableMouseMove.bind(this),this.updateOverlayDebounced=ve.debounce(this.updateOverlay.bind(this)),this.surface.getModel().connect(this,{select:"onSurfaceModelSelect"}),this.surface.connect(this,{position:this.updateOverlayDebounced}))
},ve.ce.TableNode.prototype.onTeardown=function(){ve.ce.TableNode["super"].prototype.onTeardown.call(this),this.$element.off(".ve-ce-tableNode"),this.surface.getModel().disconnect(this),this.surface.disconnect(this),this.$overlay.remove()},ve.ce.TableNode.prototype.onTableDblClick=function(a){this.getCellNodeFromTarget(a.target)&&this.surface.getModel().getSelection()instanceof ve.dm.TableSelection&&this.setEditing(!0)},ve.ce.TableNode.prototype.onTableMouseDown=function(a){var b,c,d,e,f;if(!("touchstart"===a.type&&a.originalEvent.touches.length>1)&&(b=this.getCellNodeFromTarget(a.target))){if(d=this.getModel().getMatrix().lookupCell(b.getModel()),!d)return void a.preventDefault();if(e=this.surface.getModel().getSelection(),c=a.shiftKey&&this.active?{col:e.fromCol,row:e.fromRow}:d,f=new ve.dm.TableSelection(this.getModel().getDocument(),this.getModel().getOuterRange(),c.col,c.row,d.col,d.row,!0),this.editingFragment){if(f.equals(this.editingFragment.getSelection()))return;this.setEditing(!1,!0)}this.surface.getModel().setSelection(f),this.startCell=c,this.surface.$document.on({"mouseup touchend":this.onTableMouseUpHandler,"mousemove touchmove":this.onTableMouseMoveHandler}),a.preventDefault()}},ve.ce.TableNode.prototype.getCellNodeFromTarget=function(a){var b=$(a),c=b.closest("table");return this.$element.is(c)?b.closest("td, th").data("view"):null},ve.ce.TableNode.prototype.onTableMouseMove=function(a){var b,c,d,e,f;if("touchmove"===a.type){if(a.originalEvent.touches.length>1)return;d=a.originalEvent.touches[0],e=this.surface.getElementDocument().elementFromPoint(d.clientX,d.clientY)}else e=a.target;f=this.getCellNodeFromTarget(e),f&&(b=this.getModel().matrix.lookupCell(f.getModel()),b&&(c=new ve.dm.TableSelection(this.getModel().getDocument(),this.getModel().getOuterRange(),this.startCell.col,this.startCell.row,b.col,b.row,!0),this.surface.getModel().setSelection(c)))},ve.ce.TableNode.prototype.onTableMouseUp=function(){this.startCell=null,this.surface.$document.off({"mouseup touchend":this.onTableMouseUpHandler,"mousemove touchmove":this.onTableMouseMoveHandler})},ve.ce.TableNode.prototype.setEditing=function(a,b){if(a){var c,d=this.surface.getModel().getSelection();d.isSingleCell()||(d=d.collapseToFrom(),this.surface.getModel().setSelection(d)),this.editingFragment=this.surface.getModel().getFragment(d),c=this.getCellNodesFromSelection(d)[0],c.setEditing(!0),b||this.surface.getModel().setLinearSelection(new ve.Range(c.getModel().getRange().end-1))}else this.editingFragment&&(this.getCellNodesFromSelection(this.editingFragment.getSelection())[0].setEditing(!1),b||this.surface.getModel().setSelection(this.editingFragment.getSelection()),this.editingFragment=null);this.$element.toggleClass("ve-ce-tableNode-editing",a),this.$overlay.toggleClass("ve-ce-tableNodeOverlay-editing",a)},ve.ce.TableNode.prototype.getEditingFragment=function(){return this.editingFragment},ve.ce.TableNode.prototype.getEditingRange=function(){var a=this.getEditingFragment();return a?a.getSelection().getRanges()[0]:null},ve.ce.TableNode.prototype.onSurfaceModelSelect=function(a){var b=null!==this.editingFragment&&a instanceof ve.dm.LinearSelection&&this.editingFragment.getSelection().getRanges()[0].containsRange(a.getRange())||a instanceof ve.dm.TableSelection&&a.tableRange.equals(this.getModel().getOuterRange());b?(this.active||(this.$overlay.removeClass("oo-ui-element-hidden"),this.$element.on("touchstart.ve-ce-tableNode",this.onTableMouseDown.bind(this))),this.surface.setActiveTableNode(this),this.updateOverlayDebounced()):!b&&this.active&&(this.$overlay.addClass("oo-ui-element-hidden"),this.editingFragment&&this.setEditing(!1,!0),this.surface.getActiveTableNode()===this&&this.surface.setActiveTableNode(null),this.$element.off("touchstart.ve-ce-tableNode")),this.$element.toggleClass("ve-ce-tableNode-active",b),this.active=b},ve.ce.TableNode.prototype.updateOverlay=function(){if(this.active){var a,b,c,d,e,f,g,h,i,j,k,l=this.editingFragment?this.editingFragment.getSelection():this.surface.getModel().getSelection(),m=this.getFirstSectionNode().$element[0].getBoundingClientRect(),n=this.surface.getSurface().$element[0].getBoundingClientRect();if(m){for(c=this.getCellNodesFromSelection(l),e=this.getCellNodesFromSelection(l.collapseToFrom())[0],f=ve.translateRect(e.$element[0].getBoundingClientRect(),-m.left,-m.top),h=1/0,j=-1/0,i=1/0,k=-1/0,a=0,b=c.length;b>a;a++)d=c[a].$element[0].getBoundingClientRect(),h=Math.min(h,d.top),j=Math.max(j,d.bottom),i=Math.min(i,d.left),k=Math.max(k,d.right);g=ve.translateRect({top:h,bottom:j,left:i,right:k,width:k-i,height:j-h},-m.left,-m.top),this.$selectionBox.css({top:g.top,left:g.left,width:g.width,height:g.height}),this.$selectionBoxAnchor.css({top:f.top,left:f.left,width:f.width,height:f.height}),this.$overlay.css({top:m.top-n.top,left:m.left-n.left,width:m.width}),this.colContext.$element.css({left:g.left}),this.colContext.indicator.$element.css({width:g.width}),this.colContext.popup.$element.css({"margin-left":g.width/2}),this.rowContext.$element.css({top:g.top}),this.rowContext.indicator.$element.css({height:g.height}),this.rowContext.popup.$element.css({"margin-top":g.height/2}),this.$selectionBox.toggleClass("ve-ce-tableNodeOverlay-selection-box-fullRow",l.isFullRow()).toggleClass("ve-ce-tableNodeOverlay-selection-box-fullCol",l.isFullCol())}}},ve.ce.TableNode.prototype.getFirstSectionNode=function(){for(var a=0;!(this.children[a]instanceof ve.ce.TableSectionNode);)a++;return this.children[a]},ve.ce.TableNode.prototype.getCellNodesFromSelection=function(a){var b,c,d,e,f=a.getMatrixCells(),g=[];for(b=0,c=f.length;c>b;b++)d=f[b].node,e=this.getNodeFromOffset(d.getOffset()-this.model.getOffset()),g.push(e);return g},ve.ce.TableNode["static"].name="table",ve.ce.TableNode["static"].tagName="table",ve.ce.nodeFactory.register(ve.ce.TableNode),ve.ce.TableRowNode=function(){ve.ce.TableRowNode["super"].apply(this,arguments)},OO.inheritClass(ve.ce.TableRowNode,ve.ce.BranchNode),ve.ce.TableRowNode["static"].name="tableRow",ve.ce.TableRowNode["static"].tagName="tr",ve.ce.nodeFactory.register(ve.ce.TableRowNode),ve.ce.TableSectionNode=function(){ve.ce.TableSectionNode["super"].apply(this,arguments),this.model.connect(this,{update:"onUpdate"})},OO.inheritClass(ve.ce.TableSectionNode,ve.ce.BranchNode),ve.ce.TableSectionNode["static"].name="tableSection",ve.ce.TableSectionNode.prototype.getTagName=function(){var a=this.model.getAttribute("style"),b={header:"thead",body:"tbody",footer:"tfoot"};if(!Object.prototype.hasOwnProperty.call(b,a))throw new Error("Invalid style");return b[a]},ve.ce.TableSectionNode.prototype.onUpdate=function(){this.updateTagName()},ve.ce.nodeFactory.register(ve.ce.TableSectionNode),ve.ce.TextNode=function(){ve.ce.TextNode["super"].apply(this,arguments),this.$element=$([])},OO.inheritClass(ve.ce.TextNode,ve.ce.LeafNode),ve.ce.TextNode["static"].name="text",ve.ce.TextNode["static"].splitOnEnter=!0,ve.ce.TextNode.whitespaceHtmlCharacters={"\n":"↵","	":"➞"},ve.ce.TextNode.prototype.getAnnotatedHtml=function(){function a(a,b,c){Array.isArray(c[b])?(c[b]=c[b].slice(0),c[b][0]=a):c[b]=a}function b(a,b){return Array.isArray(b[a])?b[a][0]:b[a]}var c,d,e=this.model.getDocument().getDataFromNode(this.model),f=ve.ce.TextNode.whitespaceHtmlCharacters,g=this.getModel().getParent().hasSignificantWhitespace();if(!g)for(e.length>0&&" "===b(0,e)&&a(" ",0,e),e.length>1&&" "===b(e.length-1,e)&&a(" ",e.length-1,e),c=0;c<e.length;c++)d=b(c,e)," "===d&&" "===b(c+1,e)&&a(" ",c+1,e),Object.prototype.hasOwnProperty.call(f,d)&&a(f[d],c,e);return e},ve.ce.nodeFactory.register(ve.ce.TextNode),ve.ce.ImageNode=function(a,b,c){c=ve.extendObject({enforceMax:!1,minDimensions:{width:1,height:1}},c),this.$figure=a,this.$image=b||a,ve.ce.FocusableNode.call(this,this.$figure,c),ve.ce.ResizableNode.call(this,this.$image,c),this.$image.on("load",this.onLoad.bind(this)),this.model.connect(this,{attributeChange:"onAttributeChange"}),this.$element.addClass("ve-ce-imageNode")},OO.mixinClass(ve.ce.ImageNode,ve.ce.FocusableNode),OO.mixinClass(ve.ce.ImageNode,ve.ce.ResizableNode),ve.ce.ImageNode["static"].getDescription=function(a){return a.getAttribute("src")},ve.ce.ImageNode.prototype.onAttributeChange=function(a,b,c){switch(a){case"src":this.$image.prop("src",this.getResolvedAttribute("src"));break;case"width":case"height":this.$image.css(a,null!==c?c:"")}},ve.ce.ImageNode.prototype.onLoad=function(){this.setOriginalDimensions({width:this.$image.prop("naturalWidth"),height:this.$image.prop("naturalHeight")})},ve.ce.BlockImageNode=function(a,b){b=ve.extendObject({minDimensions:{width:1,height:1}},b),ve.ce.BlockImageNode["super"].call(this,a,b),this.$image=this.$("<img>").prop("src",this.getResolvedAttribute("src")).prependTo(this.$element),ve.ce.ImageNode.call(this,this.$element,this.$image,b),ve.ce.AlignableNode.call(this,this.$element,b),this.$element.addClass("ve-ce-blockImageNode"),this.$image.prop({alt:this.model.getAttribute("alt"),src:this.getResolvedAttribute("src")}).css({width:this.model.getAttribute("width"),height:this.model.getAttribute("height")})},OO.inheritClass(ve.ce.BlockImageNode,ve.ce.BranchNode),OO.mixinClass(ve.ce.BlockImageNode,ve.ce.ImageNode),OO.mixinClass(ve.ce.BlockImageNode,ve.ce.AlignableNode),ve.ce.BlockImageNode["static"].name="blockImage",ve.ce.BlockImageNode["static"].tagName="figure",ve.ce.nodeFactory.register(ve.ce.BlockImageNode),ve.ce.BlockImageCaptionNode=function(){ve.ce.BlockImageCaptionNode["super"].apply(this,arguments)},OO.inheritClass(ve.ce.BlockImageCaptionNode,ve.ce.BranchNode),ve.ce.BlockImageCaptionNode["static"].name="imageCaption",ve.ce.BlockImageCaptionNode["static"].tagName="figcaption",ve.ce.nodeFactory.register(ve.ce.BlockImageCaptionNode),ve.ce.InlineImageNode=function(a,b){b=ve.extendObject({minDimensions:{width:1,height:1}},b),ve.ce.InlineImageNode["super"].call(this,a,b),ve.ce.ImageNode.call(this,this.$element,null,b),this.$element.addClass("ve-ce-inlineImageNode").prop({alt:this.model.getAttribute("alt"),src:this.getResolvedAttribute("src")}).css({width:this.model.getAttribute("width"),height:this.model.getAttribute("height")})},OO.inheritClass(ve.ce.InlineImageNode,ve.ce.LeafNode),OO.mixinClass(ve.ce.InlineImageNode,ve.ce.ImageNode),ve.ce.InlineImageNode["static"].name="inlineImage",ve.ce.InlineImageNode["static"].tagName="img",ve.ce.nodeFactory.register(ve.ce.InlineImageNode),ve.ce.LanguageAnnotation=function(){ve.ce.LanguageAnnotation["super"].apply(this,arguments),this.$element.addClass("ve-ce-languageAnnotation").addClass("ve-ce-bidi-isolate").prop({lang:this.model.getAttribute("lang"),dir:this.model.getAttribute("dir"),title:this.constructor["static"].getDescription(this.model)})},OO.inheritClass(ve.ce.LanguageAnnotation,ve.ce.Annotation),ve.ce.LanguageAnnotation["static"].name="meta/language",ve.ce.LanguageAnnotation["static"].tagName="span",ve.ce.LanguageAnnotation["static"].getDescription=function(a){var b=(a.getAttribute("lang")||"").toLowerCase(),c=ve.init.platform.getLanguageName(b),d=(a.getAttribute("dir")||"").toUpperCase();return d&&d!==ve.init.platform.getLanguageDirection(b).toUpperCase()?ve.msg("visualeditor-languageannotation-description-with-dir",c,d):ve.msg("visualeditor-languageannotation-description",c)},ve.ce.annotationFactory.register(ve.ce.LanguageAnnotation),ve.ce.LinkAnnotation=function(){ve.ce.LinkAnnotation["super"].apply(this,arguments),this.$element.addClass("ve-ce-linkAnnotation").prop({href:ve.resolveUrl(this.model.getHref(),this.getModelHtmlDocument()),title:this.constructor["static"].getDescription(this.model)}).on("click",function(a){a.altKey||a.ctrlKey||a.metaKey||a.shiftKey||a.preventDefault()})},OO.inheritClass(ve.ce.LinkAnnotation,ve.ce.Annotation),ve.ce.LinkAnnotation["static"].name="link",ve.ce.LinkAnnotation["static"].tagName="a",ve.ce.LinkAnnotation["static"].forceContinuation=!0,ve.ce.LinkAnnotation["static"].getDescription=function(a){return a.getHref()},ve.ce.annotationFactory.register(ve.ce.LinkAnnotation),ve.ce.TextStyleAnnotation=function(){ve.ce.TextStyleAnnotation["super"].apply(this,arguments),this.$element.addClass("ve-ce-textStyleAnnotation")},OO.inheritClass(ve.ce.TextStyleAnnotation,ve.ce.Annotation),ve.ce.TextStyleAnnotation["static"].name="textStyle",ve.ce.TextStyleAnnotation.prototype.getTagName=function(){return this.getModel().getAttribute("nodeName")||this.constructor["static"].tagName},ve.ce.annotationFactory.register(ve.ce.TextStyleAnnotation),ve.ce.AbbreviationAnnotation=function(){ve.ce.AbbreviationAnnotation["super"].apply(this,arguments),this.$element.addClass("ve-ce-abbreviationAnnotation")},OO.inheritClass(ve.ce.AbbreviationAnnotation,ve.ce.TextStyleAnnotation),ve.ce.AbbreviationAnnotation["static"].name="textStyle/abbreviation",ve.ce.AbbreviationAnnotation["static"].tagName="abbr",ve.ce.annotationFactory.register(ve.ce.AbbreviationAnnotation),ve.ce.BigAnnotation=function(){ve.ce.BigAnnotation["super"].apply(this,arguments),this.$element.addClass("ve-ce-bigAnnotation")},OO.inheritClass(ve.ce.BigAnnotation,ve.ce.TextStyleAnnotation),ve.ce.BigAnnotation["static"].name="textStyle/big",ve.ce.BigAnnotation["static"].tagName="big",ve.ce.annotationFactory.register(ve.ce.BigAnnotation),ve.ce.BoldAnnotation=function(){ve.ce.BoldAnnotation["super"].apply(this,arguments),this.$element.addClass("ve-ce-boldAnnotation")},OO.inheritClass(ve.ce.BoldAnnotation,ve.ce.TextStyleAnnotation),ve.ce.BoldAnnotation["static"].name="textStyle/bold",ve.ce.BoldAnnotation["static"].tagName="b",ve.ce.annotationFactory.register(ve.ce.BoldAnnotation),ve.ce.CodeAnnotation=function(){ve.ce.CodeAnnotation["super"].apply(this,arguments),this.$element.addClass("ve-ce-codeAnnotation")},OO.inheritClass(ve.ce.CodeAnnotation,ve.ce.TextStyleAnnotation),ve.ce.CodeAnnotation["static"].name="textStyle/code",ve.ce.CodeAnnotation["static"].tagName="code",ve.ce.annotationFactory.register(ve.ce.CodeAnnotation),ve.ce.CodeSampleAnnotation=function(){ve.ce.CodeSampleAnnotation["super"].apply(this,arguments),this.$element.addClass("ve-ce-codeSampleAnnotation")},OO.inheritClass(ve.ce.CodeSampleAnnotation,ve.ce.TextStyleAnnotation),ve.ce.CodeSampleAnnotation["static"].name="textStyle/codeSample",ve.ce.CodeSampleAnnotation["static"].tagName="samp",ve.ce.annotationFactory.register(ve.ce.CodeSampleAnnotation),ve.ce.DatetimeAnnotation=function(){ve.ce.DatetimeAnnotation["super"].apply(this,arguments),this.$element.addClass("ve-ce-datetimeAnnotation")},OO.inheritClass(ve.ce.DatetimeAnnotation,ve.ce.TextStyleAnnotation),ve.ce.DatetimeAnnotation["static"].name="textStyle/datetime",ve.ce.DatetimeAnnotation["static"].tagName="time",ve.ce.annotationFactory.register(ve.ce.DatetimeAnnotation),ve.ce.DefinitionAnnotation=function(){ve.ce.DefinitionAnnotation["super"].apply(this,arguments),this.$element.addClass("ve-ce-definitionAnnotation")},OO.inheritClass(ve.ce.DefinitionAnnotation,ve.ce.TextStyleAnnotation),ve.ce.DefinitionAnnotation["static"].name="textStyle/definition",ve.ce.DefinitionAnnotation["static"].tagName="dfn",ve.ce.annotationFactory.register(ve.ce.DefinitionAnnotation),ve.ce.HighlightAnnotation=function(){ve.ce.HighlightAnnotation["super"].apply(this,arguments),this.$element.addClass("ve-ce-highlightAnnotation")},OO.inheritClass(ve.ce.HighlightAnnotation,ve.ce.TextStyleAnnotation),ve.ce.HighlightAnnotation["static"].name="textStyle/highlight",ve.ce.HighlightAnnotation["static"].tagName="mark",ve.ce.annotationFactory.register(ve.ce.HighlightAnnotation),ve.ce.ItalicAnnotation=function(){ve.ce.ItalicAnnotation["super"].apply(this,arguments),this.$element.addClass("ve-ce-italicAnnotation")},OO.inheritClass(ve.ce.ItalicAnnotation,ve.ce.TextStyleAnnotation),ve.ce.ItalicAnnotation["static"].name="textStyle/italic",ve.ce.ItalicAnnotation["static"].tagName="i",ve.ce.annotationFactory.register(ve.ce.ItalicAnnotation),ve.ce.QuotationAnnotation=function(){ve.ce.QuotationAnnotation["super"].apply(this,arguments),this.$element.addClass("ve-ce-quotationAnnotation")},OO.inheritClass(ve.ce.QuotationAnnotation,ve.ce.TextStyleAnnotation),ve.ce.QuotationAnnotation["static"].name="textStyle/quotation",ve.ce.QuotationAnnotation["static"].tagName="q",ve.ce.annotationFactory.register(ve.ce.QuotationAnnotation),ve.ce.SmallAnnotation=function(){ve.ce.SmallAnnotation["super"].apply(this,arguments),this.$element.addClass("ve-ce-smallAnnotation")},OO.inheritClass(ve.ce.SmallAnnotation,ve.ce.TextStyleAnnotation),ve.ce.SmallAnnotation["static"].name="textStyle/small",ve.ce.SmallAnnotation["static"].tagName="small",ve.ce.annotationFactory.register(ve.ce.SmallAnnotation),ve.ce.SpanAnnotation=function(){ve.ce.SpanAnnotation["super"].apply(this,arguments),this.$element.addClass("ve-ce-spanAnnotation")},OO.inheritClass(ve.ce.SpanAnnotation,ve.ce.TextStyleAnnotation),ve.ce.SpanAnnotation["static"].name="textStyle/span",ve.ce.SpanAnnotation["static"].tagName="span",ve.ce.annotationFactory.register(ve.ce.SpanAnnotation),ve.ce.StrikethroughAnnotation=function(){ve.ce.StrikethroughAnnotation["super"].apply(this,arguments),this.$element.addClass("ve-ce-strikethroughAnnotation")},OO.inheritClass(ve.ce.StrikethroughAnnotation,ve.ce.TextStyleAnnotation),ve.ce.StrikethroughAnnotation["static"].name="textStyle/strikethrough",ve.ce.StrikethroughAnnotation["static"].tagName="s",ve.ce.annotationFactory.register(ve.ce.StrikethroughAnnotation),ve.ce.SubscriptAnnotation=function(){ve.ce.SubscriptAnnotation["super"].apply(this,arguments),this.$element.addClass("ve-ce-subscriptAnnotation")},OO.inheritClass(ve.ce.SubscriptAnnotation,ve.ce.TextStyleAnnotation),ve.ce.SubscriptAnnotation["static"].name="textStyle/subscript",ve.ce.SubscriptAnnotation["static"].tagName="sub",ve.ce.annotationFactory.register(ve.ce.SubscriptAnnotation),ve.ce.SuperscriptAnnotation=function(){ve.ce.SuperscriptAnnotation["super"].apply(this,arguments),this.$element.addClass("ve-ce-superscriptAnnotation")},OO.inheritClass(ve.ce.SuperscriptAnnotation,ve.ce.TextStyleAnnotation),ve.ce.SuperscriptAnnotation["static"].name="textStyle/superscript",ve.ce.SuperscriptAnnotation["static"].tagName="sup",ve.ce.annotationFactory.register(ve.ce.SuperscriptAnnotation),ve.ce.UnderlineAnnotation=function(){ve.ce.UnderlineAnnotation["super"].apply(this,arguments),this.$element.addClass("ve-ce-underlineAnnotation")},OO.inheritClass(ve.ce.UnderlineAnnotation,ve.ce.TextStyleAnnotation),ve.ce.UnderlineAnnotation["static"].name="textStyle/underline",ve.ce.UnderlineAnnotation["static"].tagName="u",ve.ce.annotationFactory.register(ve.ce.UnderlineAnnotation),ve.ce.UserInputAnnotation=function(){ve.ce.UserInputAnnotation["super"].apply(this,arguments),this.$element.addClass("ve-ce-userInputAnnotation")},OO.inheritClass(ve.ce.UserInputAnnotation,ve.ce.TextStyleAnnotation),ve.ce.UserInputAnnotation["static"].name="textStyle/userInput",ve.ce.UserInputAnnotation["static"].tagName="kbd",ve.ce.annotationFactory.register(ve.ce.UserInputAnnotation),ve.ce.VariableAnnotation=function(){ve.ce.VariableAnnotation["super"].apply(this,arguments),this.$element.addClass("ve-ce-variableAnnotation")},OO.inheritClass(ve.ce.VariableAnnotation,ve.ce.TextStyleAnnotation),ve.ce.VariableAnnotation["static"].name="textStyle/variable",ve.ce.VariableAnnotation["static"].tagName="var",ve.ce.annotationFactory.register(ve.ce.VariableAnnotation),ve.ui={windowFactory:new OO.Factory},ve.ui.windowFactory.register(OO.ui.MessageDialog),ve.ui.Overlay=function(a){OO.ui.Element.call(this,a),this.$element.addClass("ve-ui-overlay")},OO.inheritClass(ve.ui.Overlay,OO.ui.Element),ve.ui.Surface=function(a,b){b=b||{};var c;OO.ui.Element.call(this,b),OO.EventEmitter.call(this,b),this.globalOverlay=new ve.ui.Overlay({classes:["ve-ui-overlay-global"]}),this.localOverlay=new ve.ui.Overlay({$:this.$,classes:["ve-ui-overlay-local"]}),this.$selections=this.$("<div>"),this.$blockers=this.$("<div>"),this.$controls=this.$("<div>"),this.$menus=this.$("<div>"),this.triggerListener=new ve.TriggerListener(OO.simpleArrayDifference(Object.keys(ve.ui.commandRegistry.registry),b.excludeCommands||[])),a instanceof ve.dm.Document?c=a:a instanceof ve.dm.LinearData||Array.isArray(a)?c=new ve.dm.Document(a):a instanceof ve.dm.Surface?(this.model=a,this.documentModel=this.model.getDocument()):c=ve.dm.converter.getModelFromDom(a),this.model=this.model||new ve.dm.Surface(c),this.view=new ve.ce.Surface(this.model,this,{$:this.$}),this.dialogs=this.createDialogWindowManager(),this.importRules=b.importRules||{},this.enabled=!0,this.context=this.createContext(),this.progresses=[],this.showProgressDebounced=ve.debounce(this.showProgress.bind(this)),this.filibuster=null,this.debugBar=null,this.toolbarHeight=0,this.toolbarDialogs=new ve.ui.ToolbarDialogWindowManager({$:this.$,factory:ve.ui.windowFactory,modal:!1}),this.$menus.append(this.context.$element),this.$element.addClass("ve-ui-surface").append(this.view.$element),this.view.$element.after(this.localOverlay.$element),this.localOverlay.$element.append(this.$selections,this.$blockers,this.$controls,this.$menus),this.globalOverlay.$element.append(this.dialogs.$element)},OO.inheritClass(ve.ui.Surface,OO.ui.Element),OO.mixinClass(ve.ui.Surface,OO.EventEmitter),ve.ui.Surface.prototype.destroy=function(){this.model.stopHistoryTracking(),this.dialogs.disconnect(this),this.view.destroy(),this.context.destroy(),this.dialogs.destroy(),this.toolbarDialogs.destroy(),this.debugBar&&this.debugBar.destroy(),this.$element.remove(),this.globalOverlay.$element.remove(),this.emit("destroy")},ve.ui.Surface.prototype.initialize=function(){$("body").append(this.globalOverlay.$element),ve.debug&&this.setupDebugBar(),this.$element.addClass("ve-ui-surface-dir-"+this.getDir()),this.getView().initialize(),this.getModel().startHistoryTracking()},ve.ui.Surface.prototype.createContext=function(){throw new Error("ve.ui.Surface.createContext must be overridden in subclass")},ve.ui.Surface.prototype.createDialogWindowManager=function(){throw new Error("ve.ui.Surface.createDialogWindowManager must be overridden in subclass")},ve.ui.Surface.prototype.setupDebugBar=function(){this.debugBar=new ve.ui.DebugBar(this),this.debugBar.$element.insertAfter(this.$element)},ve.ui.Surface.prototype.getBoundingClientRect=function(){return this.$element[0].getClientRects()[0]},ve.ui.Surface.prototype.isEnabled=function(){return this.enabled},ve.ui.Surface.prototype.getModel=function(){return this.model},ve.ui.Surface.prototype.getView=function(){return this.view},ve.ui.Surface.prototype.getContext=function(){return this.context},ve.ui.Surface.prototype.getDialogs=function(){return this.dialogs},ve.ui.Surface.prototype.getToolbarDialogs=function(){return this.toolbarDialogs},ve.ui.Surface.prototype.getLocalOverlay=function(){return this.localOverlay},ve.ui.Surface.prototype.getGlobalOverlay=function(){return this.globalOverlay},ve.ui.Surface.prototype.disable=function(){this.view.disable(),this.model.disable(),this.enabled=!1},ve.ui.Surface.prototype.enable=function(){this.enabled=!0,this.view.enable(),this.model.enable()},ve.ui.Surface.prototype.execute=function(a,b){var c,d,e;if(this.enabled){if(a instanceof ve.ui.Trigger){if(c=this.triggerListener.getCommandByTrigger(a.toString()))return c.execute(this)}else if("string"==typeof a&&"string"==typeof b&&ve.ui.actionFactory.doesActionSupportMethod(a,b))return d=ve.ui.actionFactory.create(a,this),e=d[b].apply(d,Array.prototype.slice.call(arguments,2)),void 0===e||!!e;return!1}},ve.ui.Surface.prototype.setToolbarHeight=function(a){this.toolbarHeight=a},ve.ui.Surface.prototype.createProgress=function(a,b){var c=$.Deferred();return this.progresses.push({label:b,progressCompletePromise:a,progressBarDeferred:c}),this.showProgressDebounced(),c.promise()},ve.ui.Surface.prototype.showProgress=function(){var a=this.dialogs,b=this.progresses;a.openWindow("progress",{progresses:b}),this.progresses=[]},ve.ui.Surface.prototype.getImportRules=function(){return this.importRules},ve.ui.Surface.prototype.getDir=function(){return this.$element.css("direction")},ve.ui.Surface.prototype.initFilibuster=function(){var a=this;this.filibuster=(new ve.Filibuster).wrapClass(ve.EventSequencer).wrapNamespace(ve.dm,"ve.dm",[ve.dm.LinearSelection.prototype.getDescription,ve.dm.TableSelection.prototype.getDescription,ve.dm.NullSelection.prototype.getDescription]).wrapNamespace(ve.ce,"ve.ce").wrapNamespace(ve.ui,"ve.ui",[ve.ui.Surface.prototype.startFilibuster,ve.ui.Surface.prototype.stopFilibuster]).setObserver("dm doc",function(){return JSON.stringify(a.model.documentModel.data.data)}).setObserver("dm selection",function(){var b=a.model.selection;return b?b.getDescription():null}).setObserver("DOM doc",function(){return ve.serializeNodeDebug(a.view.$element[0])}).setObserver("DOM selection",function(){var b,c=a.view.nativeSelection;return 0===c.rangeCount?null:(b=c.getRangeAt(0),JSON.stringify({startContainer:ve.serializeNodeDebug(b.startContainer),startOffset:b.startOffset,endContainer:b.startContainer===b.endContainer?"(=startContainer)":ve.serializeNodeDebug(b.endContainer),endOffset:b.endOffset}))})},ve.ui.Surface.prototype.startFilibuster=function(){this.filibuster?this.filibuster.clearLogs():this.initFilibuster(),this.filibuster.start()},ve.ui.Surface.prototype.stopFilibuster=function(){this.filibuster.stop()},ve.ui.Context=function(a,b){OO.ui.Element.call(this,b),this.surface=a,this.visible=!1,this.inspector=null,this.inspectors=this.createInspectorWindowManager(),this.menu=new ve.ui.ContextSelectWidget({$:this.$}),this.lastSelectedNode=null,this.afterContextChangeTimeout=null,this.afterContextChangeHandler=this.afterContextChange.bind(this),this.updateDimensionsDebounced=ve.debounce(this.updateDimensions.bind(this)),this.surface.getModel().connect(this,{contextChange:"onContextChange"}),this.inspectors.connect(this,{opening:"onInspectorOpening"}),this.menu.connect(this,{choose:"onContextItemChoose"}),this.$element.addClass("ve-ui-context oo-ui-element-hidden"),this.menu.toggle(!1),this.inspectors.$element.addClass("ve-ui-context-inspectors")},OO.inheritClass(ve.ui.Context,OO.ui.Element),ve.ui.Context.prototype.onContextChange=function(){this.inspector&&(this.inspector.isOpening()||this.inspector.isClosing())?(clearTimeout(this.afterContextChangeTimeout),this.afterContextChangeTimeout=null,this.lastSelectedNode=this.surface.getModel().getSelectedNode()):null===this.afterContextChangeTimeout&&(this.afterContextChangeTimeout=setTimeout(this.afterContextChangeHandler)),this.availableTools=null},ve.ui.Context.prototype.afterContextChange=function(){var a=this.surface.getModel().getSelectedNode();this.afterContextChangeTimeout=null,this.isVisible()?this.menu.isVisible()?this.isInspectable()?(this.populateMenu(),this.updateDimensionsDebounced()):(this.menu.toggle(!1),this.toggle(!1)):!this.inspector||a&&a===this.lastSelectedNode||this.inspector.close():this.isInspectable()&&(this.menu.toggle(!0),this.populateMenu(),this.toggle(!0)),this.lastSelectedNode=a},ve.ui.Context.prototype.onInspectorOpening=function(a,b){var c=this,d=this.surface.getView().surfaceObserver;this.inspector=a,d.pollOnce(),d.stopTimerLoop(),b.progress(function(a){"setup"===a.state&&(c.menu.isVisible()?c.menu.toggle(!1):c.isVisible()||c.toggle(!0)),c.updateDimensionsDebounced()}).always(function(a){a.always(function(a){a.always(function(){var a=!!c.getAvailableTools().length;c.inspector=null,d.startTimerLoop(),a?(c.menu.toggle(!0),c.populateMenu(),c.updateDimensionsDebounced()):c.toggle(!1),c.getSurface().getModel().getSelection()&&c.getSurface().getView().focus()})})})},ve.ui.Context.prototype.onContextItemChoose=function(a){a&&a.getCommand().execute(this.surface)},ve.ui.Context.prototype.isVisible=function(){return this.visible},ve.ui.Context.prototype.isInspectable=function(){return!!this.getAvailableTools().length},ve.ui.Context.prototype.hasInspector=function(){var a,b=this.getAvailableTools();for(a=b.length-1;a>=0;a--)if(b[a].tool.prototype instanceof ve.ui.InspectorTool)return!0;return!1},ve.ui.Context.prototype.getAvailableTools=function(){return this.availableTools||(this.availableTools=this.surface.getModel().getSelection()instanceof ve.dm.LinearSelection?ve.ui.toolFactory.getToolsForFragment(this.surface.getModel().getFragment()):[]),this.availableTools},ve.ui.Context.prototype.getSurface=function(){return this.surface},ve.ui.Context.prototype.getInspectors=function(){return this.inspectors},ve.ui.Context.prototype.getMenu=function(){return this.menu},ve.ui.Context.prototype.createInspectorWindowManager=function(){throw new Error("ve.ui.Context.createInspectorWindowManager must be overridden in subclass")},ve.ui.Context.prototype.createItem=function(a){return new ve.ui.ContextOptionWidget(a.tool,a.model,{$:this.$,data:a.tool["static"].name})},ve.ui.Context.prototype.populateMenu=function(){var a,b,c=[],d=this.getAvailableTools();if(this.menu.clearItems(),d.length){for(a=0,b=d.length;b>a;a++)c.push(this.createItem(d[a]));this.menu.addItems(c)}return this},ve.ui.Context.prototype.toggle=function(a){return a=void 0===a?!this.visible:!!a,a!==this.visible&&(this.visible=a,this.$element.toggleClass("oo-ui-element-hidden",!this.visible)),$.Deferred().resolve().promise()},ve.ui.Context.prototype.updateDimensions=function(){return this},ve.ui.Context.prototype.destroy=function(){return this.surface.getModel().disconnect(this),this.inspectors.disconnect(this),this.menu.disconnect(this),this.inspectors.destroy(),clearTimeout(this.afterContextChangeTimeout),this.$element.remove(),this},ve.ui.TableContext=function(a,b,c){c=c||{},ve.ui.TableContext["super"].call(this,c),this.tableNode=a,this.toolGroup=b,this.surface=a.surface.getSurface(),this.visible=!1,this.indicator=new OO.ui.IndicatorWidget({$:this.$,classes:["ve-ui-tableContext-indicator"],indicator:c.indicator}),this.menu=new ve.ui.ContextSelectWidget({$:this.$}),this.popup=new OO.ui.PopupWidget({$:this.$,$container:this.surface.$element,width:150}),this.indicator.$element.on("mousedown",this.onIndicatorMouseDown.bind(this)),this.menu.connect(this,{choose:"onContextItemChoose"}),this.onDocumentMouseDownHandler=this.onDocumentMouseDown.bind(this),this.populateMenu(),this.menu.$element.addClass("ve-ui-tableContext-menu"),this.popup.$body.append(this.menu.$element),this.$element.addClass("ve-ui-tableContext").append(this.indicator.$element,this.popup.$element)},OO.inheritClass(ve.ui.TableContext,OO.ui.Element),ve.ui.TableContext.prototype.populateMenu=function(){var a,b,c,d=[],e=ve.ui.toolFactory.getTools([{group:this.toolGroup}]);for(this.menu.clearItems(),a=0,b=e.length;b>a;a++)c=ve.ui.toolFactory.lookup(e[a]),d.push(new ve.ui.ContextOptionWidget(c,this.tableNode.getModel(),{$:this.$,data:c["static"].name}));this.menu.addItems(d)},ve.ui.TableContext.prototype.onContextItemChoose=function(a){a&&(a.getCommand().execute(this.surface),this.toggle(!1))},ve.ui.TableContext.prototype.onIndicatorMouseDown=function(a){a.preventDefault(),this.toggle()},ve.ui.TableContext.prototype.onDocumentMouseDown=function(a){$(a.target).closest(this.$element).length||this.toggle(!1)},ve.ui.TableContext.prototype.toggle=function(a){var b,c=this.surface.getModel(),d=this.surface.getView();this.popup.toggle(a),this.popup.isVisible()?(this.tableNode.setEditing(!1),c.connect(this,{select:"toggle"}),d.$document.on("mousedown",this.onDocumentMouseDownHandler),b=d.getDocument().getDirectionFromSelection(c.getSelection())||c.getDocument().getDir(),this.$element.removeClass("ve-ui-dir-block-rtl ve-ui-dir-block-ltr").addClass("ve-ui-dir-block-"+b)):(c.disconnect(this),d.$document.off("mousedown",this.onDocumentMouseDownHandler))},ve.ui.Tool=function(a,b){OO.ui.Tool.call(this,a,b)},OO.inheritClass(ve.ui.Tool,OO.ui.Tool),ve.ui.Tool["static"].commandName=null,ve.ui.Tool["static"].deactivateOnSelect=!0,ve.ui.Tool["static"].getCommandName=function(){return this.commandName},ve.ui.Tool.prototype.onUpdateState=function(a){var b=this.getCommand();null!==b&&this.setDisabled(!b||!a||!b.isExecutable(a))},ve.ui.Tool.prototype.onSelect=function(){var a=this.getCommand();
a instanceof ve.ui.Command&&a.execute(this.toolbar.getSurface()),this.constructor["static"].deactivateOnSelect&&this.setActive(!1)},ve.ui.Tool.prototype.getCommand=function(){return null===this.constructor["static"].commandName?null:ve.ui.commandRegistry.lookup(this.constructor["static"].commandName)},ve.ui.Toolbar=function(a){a=a||{},OO.ui.Toolbar.call(this,ve.ui.toolFactory,ve.ui.toolGroupFactory,a),this.floating=!1,this.floatable=!!a.floatable,this.$window=null,this.elementOffset=null,this.windowEvents={resize:this.onWindowResize.bind(this),scroll:this.onWindowScroll.bind(this)},this.contextDirection={inline:"ltr",block:"ltr"},this.$element.addClass("ve-ui-toolbar").addClass("ve-ui-dir-inline-"+this.contextDirection.inline).addClass("ve-ui-dir-block-"+this.contextDirection.block)},OO.inheritClass(ve.ui.Toolbar,OO.ui.Toolbar),ve.ui.Toolbar.prototype.setup=function(a,b){this.detach(),this.surface=b,ve.ui.Toolbar["super"].prototype.setup.call(this,a),this.getSurface().getModel().connect(this,{contextChange:"onContextChange"}),this.getSurface().getToolbarDialogs().connect(this,{opening:"onToolbarWindowOpeningOrClosing",closing:"onToolbarWindowOpeningOrClosing"})},ve.ui.Toolbar.prototype.isToolAvailable=function(a){if(!ve.ui.Toolbar["super"].prototype.isToolAvailable.apply(this,arguments))return!1;var b,c=this.getToolFactory().lookup(a);return c?(b=c["static"].commandName,!b||-1!==ve.indexOf(b,this.getCommands())):!1},ve.ui.Toolbar.prototype.onWindowScroll=function(){var a=this.$window.scrollTop();a>this.elementOffset.top?this["float"]():this.floating&&this.unfloat()},ve.ui.Toolbar.prototype.onWindowResize=function(){this.calculateOffset(),this.floating&&this.$bar.css({left:this.elementOffset.left,right:this.elementOffset.right})},ve.ui.Toolbar.prototype.onToolbarWindowOpeningOrClosing=function(a,b){var c=this;b.then(function(){setTimeout(function(){c.floating&&(c.unfloat(),c["float"]())},250)})},ve.ui.Toolbar.prototype.onContextChange=function(){this.updateToolState()},ve.ui.Toolbar.prototype.updateToolState=function(){if(!this.getSurface())return void this.emit("updateState",null,null);var a,b,c,d=this.getSurface().getModel().getFragment();a=b=this.surface.getView().documentView.getDirectionFromSelection(d.getSelection())||d.getDocument().getDir(),c=d.getAnnotations(),c.hasAnnotationWithName("meta/language")&&(a=c.getAnnotationsByName("meta/language").get(0).getAttribute("dir")),a!==this.contextDirection.inline&&(this.$element.removeClass("ve-ui-dir-inline-rtl ve-ui-dir-inline-ltr"),this.$element.addClass("ve-ui-dir-inline-"+a),this.contextDirection.inline=a),b!==this.contextDirection.block&&(this.$element.removeClass("ve-ui-dir-block-rtl ve-ui-dir-block-ltr"),this.$element.addClass("ve-ui-dir-block-"+b),this.contextDirection.block=b),this.emit("updateState",d,this.contextDirection)},ve.ui.Toolbar.prototype.getTriggers=function(a){return this.getSurface().triggerListener.getTriggers(a)},ve.ui.Toolbar.prototype.getCommands=function(){return this.getSurface().triggerListener.getCommands()},ve.ui.Toolbar.prototype.getToolAccelerator=function(a){var b=ve.ui.triggerRegistry.getMessages(a);return b?b.join(", "):void 0},ve.ui.Toolbar.prototype.getSurface=function(){return this.surface},ve.ui.Toolbar.prototype.initialize=function(){OO.ui.Toolbar.prototype.initialize.call(this),this.$window=this.$(this.getElementWindow()),this.calculateOffset(),this.updateToolState(),this.floatable&&(this.$window.on(this.windowEvents),this.onWindowScroll())},ve.ui.Toolbar.prototype.calculateOffset=function(){this.elementOffset=this.$element.offset(),this.elementOffset.right=this.$window.width()-this.$element.outerWidth()-this.elementOffset.left},ve.ui.Toolbar.prototype.detach=function(){this.unfloat(),this.$window&&this.$window.off(this.windowEvents),this.getSurface()&&(this.getSurface().getModel().disconnect(this),this.getSurface().getToolbarDialogs().disconnect(this),this.getSurface().getToolbarDialogs().clearWindows(),this.surface=null)},ve.ui.Toolbar.prototype.destroy=function(){OO.ui.Toolbar.prototype.destroy.call(this),this.detach()},ve.ui.Toolbar.prototype["float"]=function(){if(!this.floating){var a=this.$element.height();this.$element.css("height",a).addClass("ve-ui-toolbar-floating"),this.$bar.css({left:this.elementOffset.left,right:this.elementOffset.right}),this.floating=!0,this.surface.setToolbarHeight(a)}},ve.ui.Toolbar.prototype.unfloat=function(){this.floating&&(this.$element.css("height","").removeClass("ve-ui-toolbar-floating"),this.$bar.css({left:"",right:""}),this.floating=!1,this.surface.setToolbarHeight(0))},ve.ui.TargetToolbar=function(a,b){ve.ui.TargetToolbar["super"].call(this,b),this.target=a},OO.inheritClass(ve.ui.TargetToolbar,ve.ui.Toolbar),ve.ui.TargetToolbar.prototype.getTarget=function(){return this.target},ve.ui.TargetToolbar.prototype.getTriggers=function(a){var b=ve.ui.TargetToolbar["super"].prototype.getTriggers.apply(this,arguments);return b||this.getTarget().targetTriggerListener.getTriggers(a)||this.getTarget().documentTriggerListener.getTriggers(a)},ve.ui.TargetToolbar.prototype.getCommands=function(){return ve.ui.TargetToolbar["super"].prototype.getCommands.apply(this,arguments).concat(this.getTarget().targetTriggerListener.getCommands(),this.getTarget().documentTriggerListener.getCommands())},ve.ui.ToolFactory=function(){OO.ui.ToolFactory.call(this)},OO.inheritClass(ve.ui.ToolFactory,OO.ui.ToolFactory),ve.ui.ToolFactory.prototype.getToolsForFragment=function(a){var b,c,d,e,f,g,h,i=a.getSelectedModels(),j={},k=[];for(b=0,c=i.length;c>b;b++)for(h=i[b],g=this.collectCompatibleTools(h),d=0,e=g.length;e>d;d++)f=g[d]["static"].name,j[f]||k.push({tool:g[d],model:h}),j[f]=!0;return k},ve.ui.ToolFactory.prototype.collectCompatibleTools=function(a){var b,c,d,e,f,g=[];for(d in this.registry)if(e=this.registry[d],e["static"].isCompatibleWith(a)){for(f=!0,b=0,c=g.length;c>b;b++){if(e.prototype instanceof g[b]){g.splice(b,1,e),f=!1;break}if(g[b].prototype instanceof e){f=!1;break}}f&&g.push(e)}return g},ve.ui.toolFactory=new ve.ui.ToolFactory,ve.ui.toolGroupFactory=new OO.ui.ToolGroupFactory,ve.ui.Command=function(a,b,c,d){d=d||{},this.name=a,this.action=b,this.method=c,this.supportedSelections=d.supportedSelections||null,this.args=d.args||[]},ve.ui.Command.prototype.execute=function(a){return this.isExecutable(a.getModel().getFragment())?a.execute.apply(a,[this.action,this.method].concat(this.args)):!1},ve.ui.Command.prototype.isExecutable=function(a){return!this.supportedSelections||-1!==ve.indexOf(a.getSelection().constructor["static"].name,this.supportedSelections)},ve.ui.Command.prototype.getAction=function(){return this.action},ve.ui.Command.prototype.getMethod=function(){return this.method},ve.ui.Command.prototype.getName=function(){return this.name},ve.ui.Command.prototype.getArgs=function(){return this.args},ve.ui.CommandRegistry=function(){OO.Registry.call(this)},OO.inheritClass(ve.ui.CommandRegistry,OO.Registry),ve.ui.CommandRegistry.prototype.register=function(a){if(!(a instanceof ve.ui.Command))throw new Error("command must be an instance of ve.ui.Command, cannot be a "+typeof a);OO.Registry.prototype.register.call(this,a.getName(),a)},ve.ui.CommandRegistry.prototype.getCommandForNode=function(a){return this.lookup(a.constructor["static"].primaryCommandName)},ve.ui.commandRegistry=new ve.ui.CommandRegistry,ve.ui.commandRegistry.register(new ve.ui.Command("bold","annotation","toggle",{args:["textStyle/bold"],supportedSelections:["linear","table"]})),ve.ui.commandRegistry.register(new ve.ui.Command("italic","annotation","toggle",{args:["textStyle/italic"],supportedSelections:["linear","table"]})),ve.ui.commandRegistry.register(new ve.ui.Command("code","annotation","toggle",{args:["textStyle/code"],supportedSelections:["linear","table"]})),ve.ui.commandRegistry.register(new ve.ui.Command("strikethrough","annotation","toggle",{args:["textStyle/strikethrough"],supportedSelections:["linear","table"]})),ve.ui.commandRegistry.register(new ve.ui.Command("underline","annotation","toggle",{args:["textStyle/underline"],supportedSelections:["linear","table"]})),ve.ui.commandRegistry.register(new ve.ui.Command("subscript","annotation","toggle",{args:["textStyle/subscript"],supportedSelections:["linear","table"]})),ve.ui.commandRegistry.register(new ve.ui.Command("superscript","annotation","toggle",{args:["textStyle/superscript"],supportedSelections:["linear","table"]})),ve.ui.commandRegistry.register(new ve.ui.Command("link","window","open",{args:["link"],supportedSelections:["linear"]})),ve.ui.commandRegistry.register(new ve.ui.Command("specialcharacter","window","open",{args:["specialcharacter"],supportedSelections:["linear"]})),ve.ui.commandRegistry.register(new ve.ui.Command("number","list","toggle",{args:["number"],supportedSelections:["linear"]})),ve.ui.commandRegistry.register(new ve.ui.Command("bullet","list","toggle",{args:["bullet"],supportedSelections:["linear"]})),ve.ui.commandRegistry.register(new ve.ui.Command("numberWrapOnce","list","wrapOnce",{args:["number",!0],supportedSelections:["linear"]})),ve.ui.commandRegistry.register(new ve.ui.Command("bulletWrapOnce","list","wrapOnce",{args:["bullet",!0],supportedSelections:["linear"]})),ve.ui.commandRegistry.register(new ve.ui.Command("commandHelp","window","open",{args:["commandHelp"]})),ve.ui.commandRegistry.register(new ve.ui.Command("findAndReplace","window","toggle",{args:["findAndReplace"]})),ve.ui.commandRegistry.register(new ve.ui.Command("findNext","window","open",{args:["findAndReplace",null,"findNext"]})),ve.ui.commandRegistry.register(new ve.ui.Command("findPrevious","window","open",{args:["findAndReplace",null,"findPrevious"]})),ve.ui.commandRegistry.register(new ve.ui.Command("code","annotation","toggle",{args:["textStyle/code"],supportedSelections:["linear","table"]})),ve.ui.commandRegistry.register(new ve.ui.Command("strikethrough","annotation","toggle",{args:["textStyle/strikethrough"],supportedSelections:["linear","table"]})),ve.ui.commandRegistry.register(new ve.ui.Command("language","window","open",{args:["language"],supportedSelections:["linear"]})),ve.ui.commandRegistry.register(new ve.ui.Command("paragraph","format","convert",{args:["paragraph"],supportedSelections:["linear"]})),ve.ui.commandRegistry.register(new ve.ui.Command("heading1","format","convert",{args:["heading",{level:1}],supportedSelections:["linear"]})),ve.ui.commandRegistry.register(new ve.ui.Command("heading2","format","convert",{args:["heading",{level:2}],supportedSelections:["linear"]})),ve.ui.commandRegistry.register(new ve.ui.Command("heading3","format","convert",{args:["heading",{level:3}],supportedSelections:["linear"]})),ve.ui.commandRegistry.register(new ve.ui.Command("heading4","format","convert",{args:["heading",{level:4}],supportedSelections:["linear"]})),ve.ui.commandRegistry.register(new ve.ui.Command("heading5","format","convert",{args:["heading",{level:5}],supportedSelections:["linear"]})),ve.ui.commandRegistry.register(new ve.ui.Command("heading6","format","convert",{args:["heading",{level:6}],supportedSelections:["linear"]})),ve.ui.commandRegistry.register(new ve.ui.Command("preformatted","format","convert",{args:["preformatted"],supportedSelections:["linear"]})),ve.ui.commandRegistry.register(new ve.ui.Command("blockquote","format","convert",{args:["blockquote"],supportedSelections:["linear"]})),ve.ui.commandRegistry.register(new ve.ui.Command("pasteSpecial","content","pasteSpecial",{supportedSelections:["linear","table"]})),ve.ui.commandRegistry.register(new ve.ui.Command("selectAll","content","selectAll",{supportedSelections:["linear","table"]})),ve.ui.commandRegistry.register(new ve.ui.Command("comment","window","open",{args:["comment"],supportedSelections:["linear"]})),ve.ui.commandRegistry.register(new ve.ui.Command("insertTable","table","create",{args:[{header:!0,rows:3,cols:4}],supportedSelections:["linear"]})),ve.ui.commandRegistry.register(new ve.ui.Command("deleteTable","table","delete",{args:["table"],supportedSelections:["table"]})),ve.ui.commandRegistry.register(new ve.ui.Command("insertRowBefore","table","insert",{args:["row","before"],supportedSelections:["table"]})),ve.ui.commandRegistry.register(new ve.ui.Command("insertRowAfter","table","insert",{args:["row","after"],supportedSelections:["table"]})),ve.ui.commandRegistry.register(new ve.ui.Command("deleteRow","table","delete",{args:["row"],supportedSelections:["table"]})),ve.ui.commandRegistry.register(new ve.ui.Command("insertColumnBefore","table","insert",{args:["col","before"],supportedSelections:["table"]})),ve.ui.commandRegistry.register(new ve.ui.Command("insertColumnAfter","table","insert",{args:["col","after"],supportedSelections:["table"]})),ve.ui.commandRegistry.register(new ve.ui.Command("deleteColumn","table","delete",{args:["col"],supportedSelections:["table"]})),ve.ui.commandRegistry.register(new ve.ui.Command("tableCellHeader","table","changeCellStyle",{args:["header"],supportedSelections:["table"]})),ve.ui.commandRegistry.register(new ve.ui.Command("tableCellData","table","changeCellStyle",{args:["data"],supportedSelections:["table"]})),ve.ui.Trigger=function(a,b){this.modifiers={meta:!1,ctrl:!1,alt:!1,shift:!1},this.primary=!1;var c,d,e,f,g=ve.ui.Trigger["static"].keyAliases,h=ve.ui.Trigger["static"].primaryKeys,i=ve.ui.Trigger["static"].primaryKeyMap;if(a instanceof jQuery.Event)this.modifiers.meta=a.metaKey||!1,this.modifiers.ctrl=a.ctrlKey||!1,this.modifiers.alt=a.altKey||!1,this.modifiers.shift=a.shiftKey||!1,this.primary=i[a.which]||!1;else if("string"==typeof a)for(f=a.replace(/\s*/g,"").toLowerCase().split("+"),c=0,d=f.length;d>c;c++)e=f[c],Object.prototype.hasOwnProperty.call(g,e)&&(e=g[e]),Object.prototype.hasOwnProperty.call(this.modifiers,e)?this.modifiers[e]=!0:(-1!==h.indexOf(e)||b)&&(this.primary=e)},ve.ui.Trigger["static"]={},ve.ui.Trigger["static"].modifierKeys=["meta","ctrl","alt","shift"],ve.ui.Trigger["static"].primaryKeys=["backspace","tab","enter","escape","page-up","page-down","end","home","left","up","right","down","delete","clear","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","multiply","add","subtract","decimal","divide","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12",";","=",",","-",".","/","`","[","\\","]","'"],ve.ui.Trigger["static"].platformFilters={mac:function(){var a={meta:"⌘",shift:"⇧",backspace:"⌫",ctrl:"^",alt:"⎇",escape:"⎋"};return function(b){var c,d;for(c=0,d=b.length;d>c;c++)b[c]=a[b[c]]||b[c];return b.join("").toUpperCase()}}()},ve.ui.Trigger["static"].keyAliases={command:"meta",apple:"meta",windows:"meta",option:"alt","return":"enter",esc:"escape",cmd:"meta",del:"delete",control:"ctrl",alternate:"alt","⌘":"meta","⎇":"alt","⇧":"shift","⏎":"enter","⌫":"backspace","⎋":"escape"},ve.ui.Trigger["static"].primaryKeyMap={8:"backspace",9:"tab",12:"clear",13:"enter",27:"escape",33:"page-up",34:"page-down",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"multiply",107:"add",109:"subtract",110:"decimal",111:"divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},ve.ui.Trigger.prototype.isComplete=function(){return this.primary!==!1},ve.ui.Trigger.prototype.toString=function(){var a,b,c=ve.ui.Trigger["static"].modifierKeys,d=[];for(a=0,b=c.length;b>a;a++)this.modifiers[c[a]]&&d.push(c[a]);return this.primary?(d.push(this.primary),d.join("+")):""},ve.ui.Trigger.prototype.getMessage=function(){var a,b=ve.ui.Trigger["static"].platformFilters,c=ve.getSystemPlatform();return a=this.toString().split("+"),Object.prototype.hasOwnProperty.call(b,c)?b[c](a):a.map(function(a){return a[0].toUpperCase()+a.slice(1).toLowerCase()}).join("+")},ve.ui.TriggerRegistry=function(){ve.ui.TriggerRegistry["super"].call(this)},OO.inheritClass(ve.ui.TriggerRegistry,OO.Registry),ve.ui.TriggerRegistry.prototype.register=function(a,b){var c,d,e,f=ve.getSystemPlatform(),g="mac"===f?"mac":"pc";if(ve.isPlainObject(b)){if(!Object.prototype.hasOwnProperty.call(b,g))return;e=Array.isArray(b[g])?b[g]:[b[g]]}else e=Array.isArray(b)?b:[b];for(c=0,d=e.length;d>c;c++){if(!(e[c]instanceof ve.ui.Trigger))throw new Error("Trigger must be an instance of ve.ui.Trigger");if(!e[c].isComplete())throw new Error("Incomplete trigger")}ve.ui.TriggerRegistry["super"].prototype.register.call(this,a,e)},ve.ui.TriggerRegistry.prototype.getMessages=function(a){return(this.lookup(a)||[]).map(function(a){return a.getMessage()})},ve.ui.triggerRegistry=new ve.ui.TriggerRegistry,ve.ui.triggerRegistry.register("undo",{mac:new ve.ui.Trigger("cmd+z"),pc:new ve.ui.Trigger("ctrl+z")}),ve.ui.triggerRegistry.register("redo",{mac:[new ve.ui.Trigger("cmd+shift+z"),new ve.ui.Trigger("cmd+y")],pc:[new ve.ui.Trigger("ctrl+shift+z"),new ve.ui.Trigger("ctrl+y")]}),ve.ui.triggerRegistry.register("bold",{mac:new ve.ui.Trigger("cmd+b"),pc:new ve.ui.Trigger("ctrl+b")}),ve.ui.triggerRegistry.register("italic",{mac:new ve.ui.Trigger("cmd+i"),pc:new ve.ui.Trigger("ctrl+i")}),ve.ui.triggerRegistry.register("link",{mac:new ve.ui.Trigger("cmd+k"),pc:new ve.ui.Trigger("ctrl+k")}),ve.ui.triggerRegistry.register("clear",{mac:[new ve.ui.Trigger("cmd+\\"),new ve.ui.Trigger("cmd+m")],pc:[new ve.ui.Trigger("ctrl+\\"),new ve.ui.Trigger("ctrl+m")]}),ve.ui.triggerRegistry.register("underline",{mac:new ve.ui.Trigger("cmd+u"),pc:new ve.ui.Trigger("ctrl+u")}),ve.ui.triggerRegistry.register("code",{mac:new ve.ui.Trigger("cmd+shift+6"),pc:new ve.ui.Trigger("ctrl+shift+6")}),ve.ui.triggerRegistry.register("strikethrough",{mac:new ve.ui.Trigger("cmd+shift+5"),pc:new ve.ui.Trigger("ctrl+shift+5")}),ve.ui.triggerRegistry.register("subscript",{mac:new ve.ui.Trigger("cmd+,"),pc:new ve.ui.Trigger("ctrl+,")}),ve.ui.triggerRegistry.register("superscript",{mac:new ve.ui.Trigger("cmd+."),pc:new ve.ui.Trigger("ctrl+.")}),ve.ui.triggerRegistry.register("indent",new ve.ui.Trigger("tab")),ve.ui.triggerRegistry.register("outdent",new ve.ui.Trigger("shift+tab")),ve.ui.triggerRegistry.register("commandHelp",{mac:[new ve.ui.Trigger("cmd+/"),new ve.ui.Trigger("cmd+shift+/")],pc:[new ve.ui.Trigger("ctrl+/"),new ve.ui.Trigger("ctrl+shift+/")]}),ve.ui.triggerRegistry.register("paragraph",new ve.ui.Trigger("ctrl+0")),ve.ui.triggerRegistry.register("heading1",new ve.ui.Trigger("ctrl+1")),ve.ui.triggerRegistry.register("heading2",new ve.ui.Trigger("ctrl+2")),ve.ui.triggerRegistry.register("heading3",new ve.ui.Trigger("ctrl+3")),ve.ui.triggerRegistry.register("heading4",new ve.ui.Trigger("ctrl+4")),ve.ui.triggerRegistry.register("heading5",new ve.ui.Trigger("ctrl+5")),ve.ui.triggerRegistry.register("heading6",new ve.ui.Trigger("ctrl+6")),ve.ui.triggerRegistry.register("preformatted",new ve.ui.Trigger("ctrl+7")),ve.ui.triggerRegistry.register("blockquote",new ve.ui.Trigger("ctrl+8")),ve.ui.triggerRegistry.register("selectAll",{mac:new ve.ui.Trigger("cmd+a"),pc:new ve.ui.Trigger("ctrl+a")}),ve.ui.triggerRegistry.register("pasteSpecial",{mac:new ve.ui.Trigger("cmd+shift+v"),pc:new ve.ui.Trigger("ctrl+shift+v")}),ve.ui.triggerRegistry.register("findAndReplace",{mac:new ve.ui.Trigger("cmd+f"),pc:new ve.ui.Trigger("ctrl+f")}),ve.ui.triggerRegistry.register("findNext",{mac:new ve.ui.Trigger("cmd+g"),pc:[new ve.ui.Trigger("ctrl+g"),new ve.ui.Trigger("f3")]}),ve.ui.triggerRegistry.register("findPrevious",{mac:new ve.ui.Trigger("cmd+shift+g"),pc:[new ve.ui.Trigger("shift+ctrl+g"),new ve.ui.Trigger("shift+f3")]}),ve.ui.Sequence=function(a,b,c,d){this.name=a,this.commandName=b,this.data=c,this.strip=d},OO.initClass(ve.ui.Sequence),ve.ui.Sequence.prototype.match=function(a,b){var c,d=b-1;for(c=this.data.length-1;c>=0;c--,d--)if("string"==typeof this.data[c]){if(this.data[c]!==a.getCharacterData(d))return!1}else if(!ve.compare(this.data[c],a.getData(d),!0))return!1;return!0},ve.ui.Sequence.prototype.execute=function(a){var b,c,d,e=a.getModel(),f=ve.ui.commandRegistry.lookup(this.getCommandName());if(!f)throw new Error("Command not found: "+this.getCommandName());return this.strip&&(b=e.getSelection().getRange(),d=e.getLinearFragment(new ve.Range(b.end,b.end-this.strip))),e.breakpoint(),c=f.execute(a),c&&d&&d.removeContent(),c},ve.ui.Sequence.prototype.getName=function(){return this.name},ve.ui.Sequence.prototype.getCommandName=function(){return this.commandName},ve.ui.SequenceRegistry=function(){ve.ui.SequenceRegistry["super"].call(this)},OO.inheritClass(ve.ui.SequenceRegistry,OO.Registry),ve.ui.SequenceRegistry.prototype.register=function(a){if(!(a instanceof ve.ui.Sequence))throw new Error("sequence must be an instance of ve.ui.Sequence, cannot be a "+typeof a);ve.ui.SequenceRegistry["super"].prototype.register.call(this,a.getName(),a)},ve.ui.SequenceRegistry.prototype.findMatching=function(a,b){var c,d=[];for(c in this.registry)this.registry[c].match(a,b)&&d.push(this.registry[c]);return d},ve.ui.sequenceRegistry=new ve.ui.SequenceRegistry,ve.ui.sequenceRegistry.register(new ve.ui.Sequence("bulletStar","bulletWrapOnce",[{type:"paragraph"},"*"," "],2)),ve.ui.sequenceRegistry.register(new ve.ui.Sequence("numberDot","numberWrapOnce",[{type:"paragraph"},"1","."," "],3)),ve.ui.Action=function(a){this.surface=a},ve.ui.Action["static"]={},ve.ui.Action["static"].methods=[],ve.ui.ActionFactory=function(){OO.Factory.call(this)},OO.inheritClass(ve.ui.ActionFactory,OO.Factory),ve.ui.ActionFactory.prototype.doesActionSupportMethod=function(a,b){if(Object.prototype.hasOwnProperty.call(this.registry,a))return-1!==this.registry[a]["static"].methods.indexOf(b);throw new Error("Unknown action: "+a)},ve.ui.actionFactory=new ve.ui.ActionFactory,ve.ui.DataTransferHandler=function(a,b){this.surface=a,this.file=b,this.insertableDataDeferred=$.Deferred(),this.reader=new FileReader,this.progress=!1,this.progressBar=null,this.reader.addEventListener("progress",this.onFileProgress.bind(this)),this.reader.addEventListener("load",this.onFileLoad.bind(this)),this.reader.addEventListener("loadend",this.onFileLoadEnd.bind(this))},OO.initClass(ve.ui.DataTransferHandler),ve.ui.DataTransferHandler["static"].name=null,ve.ui.DataTransferHandler["static"].types=[],ve.ui.DataTransferHandler.prototype.process=function(){throw new Error("ve.ui.DataTransferHandler subclass must implement process")},ve.ui.DataTransferHandler.prototype.getInsertableData=function(){return this.process(),this.insertableDataDeferred.promise()},ve.ui.DataTransferHandler.prototype.onFileProgress=function(){},ve.ui.DataTransferHandler.prototype.onFileLoad=function(){},ve.ui.DataTransferHandler.prototype.onFileLoadEnd=function(){},ve.ui.DataTransferHandler.prototype.abort=function(){this.insertableDataDeferred.reject()},ve.ui.DataTransferHandler.prototype.createProgress=function(a,b){var c=this;this.surface.createProgress(a,b||this.file.name).done(function(a,b){a.setProgress(c.progress),c.progressBar=a,b.fail(c.abort.bind(c))})},ve.ui.DataTransferHandler.prototype.setProgress=function(a){this.progress=a,this.progressBar&&this.progressBar.setProgress(this.progress)},ve.ui.DataTransferHandlerFactory=function(){ve.ui.DataTransferHandlerFactory["super"].apply(this,arguments),this.handlerNamesByType={}},OO.inheritClass(ve.ui.DataTransferHandlerFactory,OO.Factory),ve.ui.DataTransferHandlerFactory.prototype.register=function(a){ve.ui.DataTransferHandlerFactory["super"].prototype.register.call(this,a);var b,c,d=a["static"].types;for(b=0,c=d.length;c>b;b++)this.handlerNamesByType[d[b]]=a["static"].name},ve.ui.DataTransferHandlerFactory.prototype.getHandlerNameForType=function(a){return this.handlerNamesByType[a]},ve.ui.dataTransferHandlerFactory=new ve.ui.DataTransferHandlerFactory,ve.ui.WindowManager=function(a){a=a||{},ve.ui.WindowManager["super"].call(this,a),this.overlay=a.overlay||null},OO.inheritClass(ve.ui.WindowManager,OO.ui.WindowManager),ve.ui.WindowManager.prototype.getOverlay=function(){return this.overlay},ve.ui.WindowManager.prototype.getReadyDelay=function(){return 250},ve.ui.AnnotationAction=function(a){ve.ui.Action.call(this,a)},OO.inheritClass(ve.ui.AnnotationAction,ve.ui.Action),ve.ui.AnnotationAction["static"].name="annotation",ve.ui.AnnotationAction["static"].methods=["set","clear","toggle","clearAll"],ve.ui.AnnotationAction.prototype.set=function(a,b){var c,d,e=this.surface.getModel().getFragment(),f=ve.dm.annotationFactory.lookup(a),g=f["static"].removes;for(e.getSelection()instanceof ve.dm.LinearSelection&&(d=e.trimLinearSelection(),d.getSelection().isCollapsed()||(e=d)),c=g.length-1;c>=0;c--)e.annotateContent("clear",g[c]);return e.annotateContent("set",a,b),!0},ve.ui.AnnotationAction.prototype.clear=function(a,b){return this.surface.getModel().getFragment().annotateContent("clear",a,b),!0},ve.ui.AnnotationAction.prototype.toggle=function(a,b){var c,d,e,f=this.surface.getModel(),g=f.getFragment(),h=ve.dm.annotationFactory.create(a,b),i=h.constructor["static"].removes;return g.getSelection().isCollapsed()?(d=f.getInsertionAnnotations(),c=d.getAnnotationsByName(h.name),c.isEmpty()?(e=d.filter(function(a){return-1!==ve.indexOf(a.name,i)}),f.removeInsertionAnnotations(e),f.addInsertionAnnotations(h)):f.removeInsertionAnnotations(c)):g.getAnnotations().containsComparable(h)?g.annotateContent("clear",a):this.set(a,b),!0},ve.ui.AnnotationAction.prototype.clearAll=function(){var a,b,c,d=this.surface.getModel(),e=d.getFragment(),f=e.getAnnotations(!0);for(c=f.get(),a=0,b=c.length;b>a;a++)e.annotateContent("clear",c[a].name,c[a].data);return d.setInsertionAnnotations(null),!0},ve.ui.actionFactory.register(ve.ui.AnnotationAction),ve.ui.ContentAction=function(a){ve.ui.Action.call(this,a)},OO.inheritClass(ve.ui.ContentAction,ve.ui.Action),ve.ui.ContentAction["static"].name="content",ve.ui.ContentAction["static"].methods=["insert","remove","select","pasteSpecial","selectAll"],ve.ui.ContentAction.prototype.insert=function(a,b){return this.surface.getModel().getFragment().insertContent(a,b),!0},ve.ui.ContentAction.prototype.remove=function(){return this.surface.getModel().getFragment().removeContent(),!0},ve.ui.ContentAction.prototype.select=function(a){return this.surface.getModel().setSelection(a),!0},ve.ui.ContentAction.prototype.selectAll=function(){return this.surface.getView().selectAll(),!0},ve.ui.ContentAction.prototype.pasteSpecial=function(){return this.surface.getView().pasteSpecial=!0,!1},ve.ui.actionFactory.register(ve.ui.ContentAction),ve.ui.FormatAction=function(a){ve.ui.Action.call(this,a)},OO.inheritClass(ve.ui.FormatAction,ve.ui.Action),ve.ui.FormatAction["static"].name="format",ve.ui.FormatAction["static"].methods=["convert"],ve.ui.FormatAction.prototype.convert=function(a,b){var c,d,e,f,g,h=this.surface.getModel(),i=h.getSelection(),j=h.getFragment(i,!0),k=h.getDocument(),l=[];if(i instanceof ve.dm.LinearSelection){for(c=k.selectNodes(i.getRange(),"leaves"),d=0,e=c.length;e>d;d++)f=c[d].node.isContent()?c[d].node.getParent():c[d].node,l.push(h.getLinearFragment(f.getOuterRange(),!0));for(d=0,e=l.length;e>d;d++)l[d].isolateAndUnwrap(a);return i=j.getSelection(),g=ve.dm.Transaction.newFromContentBranchConversion(k,i.getRange(),a,b),h.change(g,i),this.surface.getView().focus(),!0}},ve.ui.actionFactory.register(ve.ui.FormatAction),ve.ui.HistoryAction=function(a){ve.ui.Action.call(this,a)},OO.inheritClass(ve.ui.HistoryAction,ve.ui.Action),ve.ui.HistoryAction["static"].name="history",ve.ui.HistoryAction["static"].methods=["undo","redo"],ve.ui.HistoryAction.prototype.undo=function(){return this.surface.getModel().undo(),!0},ve.ui.HistoryAction.prototype.redo=function(){return this.surface.getModel().redo(),!0},ve.ui.actionFactory.register(ve.ui.HistoryAction),ve.ui.IndentationAction=function(a){ve.ui.Action.call(this,a)},OO.inheritClass(ve.ui.IndentationAction,ve.ui.Action),ve.ui.IndentationAction["static"].name="indentation",ve.ui.IndentationAction["static"].methods=["increase","decrease"],ve.ui.IndentationAction.prototype.increase=function(){var a,b,c,d=[],e=!1,f=this.surface.getModel(),g=f.getDocument(),h=f.getFragment();if(h.getSelection()instanceof ve.dm.LinearSelection){for(c=g.getCoveredSiblingGroups(h.getSelection().getRange()),a=0;a<c.length;a++)b=c[a],b.grandparent&&"list"===b.grandparent.getType()&&(d.push(f.getLinearFragment(b.parent.getRange(),!0)),e=!0);for(a=0;a<d.length;a++)this.indentListItem(g.getBranchNodeFromOffset(d[a].getSelection().getRange().start));return h.select(),e}},ve.ui.IndentationAction.prototype.decrease=function(){var a,b,c,d=[],e=!1,f=this.surface.getModel(),g=f.getDocument(),h=f.getFragment();if(h.getSelection()instanceof ve.dm.LinearSelection){for(c=g.getCoveredSiblingGroups(h.getSelection().getRange()),a=0;a<c.length;a++)b=c[a],b.grandparent&&"list"===b.grandparent.getType()?(d.push(f.getLinearFragment(b.parent.getRange(),!0)),e=!0):b.parent&&"list"===b.parent.getType()&&(d.push(f.getLinearFragment(b.nodes[0].getRange(),!0)),e=!0);for(a=0;a<d.length;a++)this.unindentListItem(g.getBranchNodeFromOffset(d[a].getSelection().getRange().start));return h.select(),e}},ve.ui.IndentationAction.prototype.indentListItem=function(a){if(!(a instanceof ve.dm.ListItemNode))throw new Error("listItem must be a ve.dm.ListItemNode");var b,c,d,e,f,g,h=this.surface.getModel(),i=h.getDocument(),j=h.getSelection(),k=a.getParent().getAttribute("style"),l=a.getOuterRange();j instanceof ve.dm.LinearSelection&&(c=j.getRange(),b=ve.dm.Transaction.newFromWrap(i,l,[],[{type:"listItem"},{type:"list",attributes:{style:k}}],[],[]),h.change(b),c=b.translateRange(c),d=l.translate(2),e=new ve.Range(l.start,l.end+2),"listItem"===i.data.getData(l.start).type&&"/listItem"===i.data.getData(l.start-1).type&&(f=l.start-1,g=l.start+1,"list"===i.data.getData(g).type&&"/list"===i.data.getData(f-1).type&&(f--,g++),b=ve.dm.Transaction.newFromRemoval(i,new ve.Range(f,g)),h.change(b),c=b.translateRange(c),d=b.translateRange(d),e=b.translateRange(e)),h.setLinearSelection(c))},ve.ui.IndentationAction.prototype.unindentListItem=function(a){if(!(a instanceof ve.dm.ListItemNode))throw new Error("listItem must be a ve.dm.ListItemNode");var b,c,d,e,f,g,h=this.surface.getModel(),i=h.getDocument(),j=h.getLinearFragment(a.getOuterRange(),!0),k=a.getParent(),l=k.getClonedElement(),m=k.getParent().getType(),n=a.getOuterRange();if("list"!==i.data.getData(n.start-1).type&&(b=ve.dm.Transaction.newFromInsertion(i,n.start,[{type:"/list"},l]),h.change(b),n=n.translate(2)),"/list"!==i.data.getData(n.end).type&&(b=ve.dm.Transaction.newFromInsertion(i,n.end,[{type:"/list"},l]),h.change(b)),g=new ve.Range(n.start-1,n.end+1),"listItem"!==m)for(b=ve.dm.Transaction.newFromWrap(i,new ve.Range(n.start+1,n.end-1),[{type:"list"},{type:"listItem"}],[],[],[]),h.change(b),e=j.getSiblingNodes(),c=0,d=e.length;d>c;c++)f=e[c].node,"paragraph"===f.type&&f.element.internal&&"wrapper"===f.element.internal.generated&&(delete f.element.internal.generated,ve.isEmptyObject(f.element.internal)&&delete f.element.internal);else"listItem"!==i.data.getData(g.start-1).type&&(b=ve.dm.Transaction.newFromInsertion(i,g.start,[{type:"/listItem"},{type:"listItem"}]),h.change(b),g=g.translate(2)),"/listItem"!==i.data.getData(g.end).type&&(b=ve.dm.Transaction.newFromInsertion(i,g.end,[{type:"/listItem"},{type:"listItem"}]),h.change(b)),b=ve.dm.Transaction.newFromWrap(i,new ve.Range(g.start+1,g.end-1),[{type:"listItem"},{type:"list"}],[],[],[]),h.change(b)},ve.ui.actionFactory.register(ve.ui.IndentationAction),ve.ui.ListAction=function(a){ve.ui.Action.call(this,a)},OO.inheritClass(ve.ui.ListAction,ve.ui.Action),ve.ui.ListAction["static"].name="list",ve.ui.ListAction["static"].methods=["wrap","unwrap","toggle","wrapOnce"],ve.ui.ListAction.prototype.allWrapped=function(a){var b,c,d=a?{style:a}:void 0,e=this.surface.getModel().getFragment().getLeafNodes(),f=!!e.length;
for(b=0,c=e.length;c>b;b++)if((1===c||!e[b].range||e[b].range.getLength())&&!e[b].node.hasMatchingAncestor("list",d)){f=!1;break}return f},ve.ui.ListAction.prototype.toggle=function(a,b){return this[this.allWrapped(a)?"unwrap":"wrap"](a,b)},ve.ui.ListAction.prototype.wrapOnce=function(a,b){return this.allWrapped()?!1:this.wrap(a,b)},ve.ui.ListAction.prototype.wrap=function(a,b){var c,d,e,f,g,h,i,j=this.surface.getModel(),k=j.getDocument(),l=j.getSelection();if(!(l instanceof ve.dm.LinearSelection))return!1;if(h=l.getRange(),b||j.breakpoint(),h.isCollapsed()&&!k.data.isContentOffset(h.to)&&k.hasSlugAtOffset(h.to))j.change(ve.dm.Transaction.newFromInsertion(k,h.from,[{type:"list",attributes:{style:a}},{type:"listItem"},{type:"paragraph"},{type:"/paragraph"},{type:"/listItem"},{type:"/list"}]),new ve.dm.LinearSelection(k,new ve.Range(h.to+3)));else for(i=k.getCoveredSiblingGroups(h),d=0;d<i.length;d++)g=i[d],g.grandparent&&"list"===g.grandparent.getType()?g.grandparent!==e&&(j.change(ve.dm.Transaction.newFromAttributeChanges(k,g.grandparent.getOffset(),{style:a}),l),e=g.grandparent):(f=new ve.Range(g.nodes[0].getOuterRange().start,g.nodes[g.nodes.length-1].getOuterRange().end),j.change(ve.dm.Transaction.newFromContentBranchConversion(k,f,"paragraph"),l),c=ve.dm.Transaction.newFromWrap(k,f,[],[{type:"list",attributes:{style:a}}],[],[{type:"listItem"}]),j.change(c,new ve.dm.LinearSelection(k,c.translateRange(h))));return b||j.breakpoint(),this.surface.getView().focus(),!0},ve.ui.ListAction.prototype.unwrap=function(a){var b,c=this.surface.getModel(),d=c.getDocument();if(!(c.getSelection()instanceof ve.dm.LinearSelection))return!1;a||c.breakpoint();do b=d.getBranchNodeFromOffset(c.getSelection().getRange().start);while(b.hasMatchingAncestor("list")&&this.surface.execute("indentation","decrease"));return a||c.breakpoint(),this.surface.getView().focus(),!0},ve.ui.actionFactory.register(ve.ui.ListAction),ve.ui.TableAction=function(a){ve.ui.Action.call(this,a)},OO.inheritClass(ve.ui.TableAction,ve.ui.Action),ve.ui.TableAction["static"].name="table",ve.ui.TableAction["static"].methods=["create","insert","delete","changeCellStyle","mergeCells","caption"],ve.ui.TableAction.prototype.create=function(a){a=a||{};var b,c=a.type||"table",d={type:c},e=this.surface.getModel(),f=e.getFragment(),g=[],h=a.cols||4,i=a.rows||3;if(!(f.getSelection()instanceof ve.dm.LinearSelection))return!1;for(a.attributes&&(d.attributes=ve.copy(a.attributes)),g.push(d),g.push({type:"tableSection",attributes:{style:"body"}}),a.header&&(g=g.concat(ve.dm.TableRowNode["static"].createData({style:"header",cellCount:h}))),b=0;i>b;b++)g=g.concat(ve.dm.TableRowNode["static"].createData({style:"data",cellCount:h}));return g.push({type:"/tableSection"}),g.push({type:"/"+c}),f.insertContent(g,!1),e.setSelection(new ve.dm.TableSelection(f.getDocument(),f.getSelection().getRange(),0,0,0,0)),!0},ve.ui.TableAction.prototype.insert=function(a,b){var c,d=this.surface.getModel(),e=d.getSelection();return e instanceof ve.dm.TableSelection?(c="col"===a?"before"===b?e.startCol:e.endCol:"before"===b?e.startRow:e.endRow,"before"===b&&(e="col"===a?e.newFromAdjustment(1,0):e.newFromAdjustment(0,1),d.setSelection(e)),this.insertRowOrCol(e.getTableNode(),a,c,b,e),!0):!1},ve.ui.TableAction.prototype["delete"]=function(a){var b,c,d,e,f=this.surface.getModel().getSelection();return f instanceof ve.dm.TableSelection?(b=f.getTableNode(),"table"===a?this.deleteTable(b):("col"===a?(c=f.startCol,d=f.endCol,e=f.isFullRow()):(c=f.startRow,d=f.endRow,e=f.isFullCol()),e?this.deleteTable(b):this.deleteRowsOrColumns(b.matrix,a,c,d)),!0):!1},ve.ui.TableAction.prototype.changeCellStyle=function(a){var b,c,d=[],e=this.surface.getModel(),f=e.getSelection();if(!(f instanceof ve.dm.TableSelection))return!1;for(c=f.getOuterRanges(),b=c.length-1;b>=0;b--)d.push(ve.dm.Transaction.newFromAttributeChanges(e.getDocument(),c[b].start,{style:a}));return e.change(d),!0},ve.ui.TableAction.prototype.mergeCells=function(){var a,b,c,d,e,f,g=[],h=this.surface.getModel(),i=h.getSelection(),j=i.getTableNode().getMatrix();if(!(i instanceof ve.dm.TableSelection))return!1;if(i.isSingleCell()){for(e=i.getMatrixCells(!0),g.push(ve.dm.Transaction.newFromAttributeChanges(h.getDocument(),e[0].node.getOuterRange().start,{colspan:1,rowspan:1})),a=e.length-1;a>=1;a--)g.push(this.replacePlaceholder(j,e[a],{style:e[0].node.getStyle()}));h.change(g)}else{for(e=i.getMatrixCells(),g.push(ve.dm.Transaction.newFromAttributeChanges(h.getDocument(),e[0].node.getOuterRange().start,{colspan:1+i.endCol-i.startCol,rowspan:1+i.endRow-i.startRow})),a=e.length-1;a>=1;a--)g.push(ve.dm.Transaction.newFromRemoval(h.getDocument(),e[a].node.getOuterRange()));for(h.change(g),b=i.endRow;b>=i.startRow;b--){for(f=!1,c=0;void 0!==(d=j.getCell(b,c));c++)if(d&&!d.isPlaceholder()){f=!0;break}f||this.deleteRowsOrColumns(j,"row",b,b)}for(c=i.endCol;c>=i.startCol;c--){for(f=!1,b=0;void 0!==(d=j.getCell(b,c));b++)if(d&&!d.isPlaceholder()){f=!0;break}f||this.deleteRowsOrColumns(j,"col",c,c)}}return!0},ve.ui.TableAction.prototype.caption=function(){var a,b,c,d,e,f=this.surface.getModel(),g=f.getSelection();if(g instanceof ve.dm.TableSelection)b=g.getTableNode().getCaptionNode();else{if(!(g instanceof ve.dm.LinearSelection))return!1;for(c=f.getFragment().getSelectedLeafNodes(),d=c[0];d;){if(d instanceof ve.dm.TableCaptionNode){b=d;break}d=d.getParent()}if(!b)return;e=f.getFragment(new ve.dm.TableSelection(f.getDocument(),b.getParent().getOuterRange(),0,0,0,0,!0))}return b?(a=f.getLinearFragment(b.getOuterRange(),!0),a.removeContent(),e&&e.select()):(a=f.getLinearFragment(new ve.Range(g.tableRange.start+1),!0),a.insertContent([{type:"tableCaption"},{type:"paragraph",internal:{generated:"wrapper"}},{type:"/paragraph"},{type:"/tableCaption"}],!1),a.collapseToStart().adjustLinearSelection(2,2).select()),!0},ve.ui.TableAction.prototype.deleteTable=function(a){this.surface.getModel().getLinearFragment(a.getOuterRange())["delete"]()},ve.ui.TableAction.prototype.insertRowOrCol=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r=a.matrix,s=[],t={},u=[],v=this.surface.getModel();for(i="before"===d,f=c+(i?-1:1),"row"===b?(g=r.getRow(c)||[],h=r.getRow(f)||[]):(g=r.getColumn(c)||[],h=r.getColumn(f)||[]),l=0,m=g.length;m>l;l++)n=g[l],n&&(o=h[l],o&&(n.isPlaceholder()||o.isPlaceholder())&&n.node===o.node?(n=n.owner||n,t[n.key]||(s.push(this.incrementSpan(n,b)),t[n.key]=!0)):u.push(n));if("row"===b)p=ve.dm.TableRowNode["static"].createData({cellCount:u.length,style:g[0].node.getStyle()}),k=r.getRowNode(c).getOuterRange(),j=i?k.start:k.end,s.push(ve.dm.Transaction.newFromInsertion(v.getDocument(),j,p));else for(u.sort(ve.dm.TableMatrixCell["static"].sortDescending),l=0;l<u.length;l++)n=u[l],n&&(o=r.findClosestCell(n),o?(k=o.node.getOuterRange(),j=o.col<n.col||o.col===n.col&&!i?k.end:k.start,q=o.node.getStyle()):(k=r.getRowNode(n.row).getRange(),j=i?k.start:k.end,q=g[0].node.getStyle()),p=ve.dm.TableCellNode["static"].createData({style:q}),s.push(ve.dm.Transaction.newFromInsertion(v.getDocument(),j,p)));v.change(s,e.translateByTransactions(s))},ve.ui.TableAction.prototype.incrementSpan=function(a,b){var c,d=this.surface.getModel();return c="row"===b?{rowspan:a.node.getRowspan()+1}:{colspan:a.node.getColspan()+1},ve.dm.Transaction.newFromAttributeChanges(d.getDocument(),a.node.getOuterRange().start,c)},ve.ui.TableAction.prototype.decrementSpan=function(a,b,c,d){var e,f,g=this.surface.getModel();return e=c-a[b]+Math.max(0,a[b]+a.node.getSpans()[b]-1-d),f="row"===b?{rowspan:e}:{colspan:e},ve.dm.Transaction.newFromAttributeChanges(g.getDocument(),a.node.getOuterRange().start,f)},ve.ui.TableAction.prototype.deleteRowsOrColumns=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q=[],r=[],s={},t=[],u=this.surface.getModel();if("row"===b)for(e=c;d>=e;e++)q=q.concat(a.getRow(e));else for(f=c;d>=f;f++)q=q.concat(a.getColumn(f));for(g=0,h=q.length;h>g;g++)i=q[g],i&&(i.isPlaceholder()?(j=i.owner.key,s[j]||(r.push(this.decrementSpan(i.owner,b,c,d)),s[j]=!0)):(k=i.node.getSpans()[b],i[b]+k-1>d&&("col"===b?(l=i.row,m=d+1):(l=d+1,m=i.col),n=i.row+i.node.getRowspan()-1,o=i.col+i.node.getColspan()-1,t.push({action:"insert",cell:a.getCell(l,m),colspan:1+o-m,rowspan:1+n-l,style:i.node.getStyle(),content:u.getDocument().getData(i.node.getRange())})),"col"===b&&t.push({action:"delete",cell:i})));if(t.sort(function(a,b){return ve.dm.TableMatrixCell["static"].sortDescending(a.cell,b.cell)}),"row"===b){for(g=0;g<t.length;g++)r.push(this.replacePlaceholder(a,t[g].cell,t[g]));for(e=d;e>=c;e--)p=a.getRowNode(e),r.push(ve.dm.Transaction.newFromRemoval(u.getDocument(),p.getOuterRange()))}else for(g=0;g<t.length;g++)r.push("insert"===t[g].action?this.replacePlaceholder(a,t[g].cell,t[g]):ve.dm.Transaction.newFromRemoval(u.getDocument(),t[g].cell.node.getOuterRange()));u.change(r,new ve.dm.NullSelection(u.getDocument()))},ve.ui.TableAction.prototype.replacePlaceholder=function(a,b,c){var d,e,f,g=a.findClosestCell(b),h=this.surface.getModel();return g?(d=g.node.getOuterRange(),e=b.col<g.col?d.start:d.end):(d=a.getRowNode(b.row).getRange(),e=d.start),f=ve.dm.TableCellNode["static"].createData(c),ve.dm.Transaction.newFromInsertion(h.getDocument(),e,f)},ve.ui.actionFactory.register(ve.ui.TableAction),ve.ui.WindowAction=function(a){ve.ui.Action.call(this,a)},OO.inheritClass(ve.ui.WindowAction,ve.ui.Action),ve.ui.WindowAction["static"].name="window",ve.ui.WindowAction["static"].methods=["open","close","toggle"],ve.ui.WindowAction.prototype.open=function(a,b,c){var d=this.getWindowType(a),e=d&&this.getWindowManager(d),f=this.surface,g=f.getModel().getFragment(void 0,!0),h=f.getView().getDocument().getDirectionFromSelection(g.getSelection())||f.getModel().getDocument().getDir();return e?(b=ve.extendObject({dir:h},b,{fragment:g}),f.getView().deactivate(),"toolbar"===d&&(b=ve.extendObject(b,{surface:f})),e.getWindow(a).then(function(a){var d=e.openWindow(a,b);f.getView().emit("position"),d.then(function(a){a.then(function(a){f.getView().activate(),a.then(function(){f.getView().emit("position")})})}).always(function(){c&&a.executeAction(c)})}),!0):!1},ve.ui.WindowAction.prototype.close=function(a,b){var c=this.getWindowType(a),d=c&&this.getWindowManager(c);return d?(d.closeWindow(a,b),!0):!1},ve.ui.WindowAction.prototype.toggle=function(a,b){var c,d=this.getWindowType(a),e=d&&this.getWindowManager(d);return e?(c=e.getCurrentWindow(),c&&c.constructor["static"].name===a?this.close(a,b):this.open(a,b),!0):!1},ve.ui.WindowAction.prototype.getWindowType=function(a){var b=ve.ui.windowFactory.lookup(a);return b.prototype instanceof ve.ui.FragmentInspector?"inspector":b.prototype instanceof ve.ui.ToolbarDialog?"toolbar":b.prototype instanceof OO.ui.Dialog?"dialog":null},ve.ui.WindowAction.prototype.getWindowManager=function(a){switch(a){case"inspector":return this.surface.getContext().getInspectors();case"toolbar":return this.surface.getToolbarDialogs();case"dialog":return this.surface.getDialogs()}return null},ve.ui.actionFactory.register(ve.ui.WindowAction),ve.ui.ClearAnnotationCommand=function(){ve.ui.ClearAnnotationCommand["super"].call(this,"clear","annotation","clearAll",{supportedSelections:["linear","table"]})},OO.inheritClass(ve.ui.ClearAnnotationCommand,ve.ui.Command),ve.ui.ClearAnnotationCommand.prototype.isExecutable=function(a){return ve.ui.ClearAnnotationCommand["super"].prototype.isExecutable.apply(this,arguments)&&a.hasAnnotations()},ve.ui.commandRegistry.register(new ve.ui.ClearAnnotationCommand),ve.ui.HistoryCommand=function(a,b){ve.ui.HistoryCommand["super"].call(this,a,"history",b),this.check={undo:"canUndo",redo:"canRedo"}[b]},OO.inheritClass(ve.ui.HistoryCommand,ve.ui.Command),ve.ui.HistoryCommand.prototype.isExecutable=function(a){var b=a.getSurface();return ve.ui.HistoryCommand["super"].prototype.isExecutable.apply(this,arguments)&&b[this.check].call(b)},ve.ui.commandRegistry.register(new ve.ui.HistoryCommand("undo","undo")),ve.ui.commandRegistry.register(new ve.ui.HistoryCommand("redo","redo")),ve.ui.IndentationCommand=function(a,b){ve.ui.IndentationCommand["super"].call(this,a,"indentation",b,{supportedSelections:["linear"]})},OO.inheritClass(ve.ui.IndentationCommand,ve.ui.Command),ve.ui.IndentationCommand.prototype.isExecutable=function(a){if(!ve.ui.IndentationCommand["super"].prototype.isExecutable.apply(this,arguments))return!1;var b,c,d=a.getSelectedLeafNodes(),e=!1;for(b=0,c=d.length;c>b;b++)if(d[b].hasMatchingAncestor("listItem")){e=!0;break}return e},ve.ui.commandRegistry.register(new ve.ui.IndentationCommand("indent","increase")),ve.ui.commandRegistry.register(new ve.ui.IndentationCommand("outdent","decrease")),ve.ui.MergeCellsCommand=function(){ve.ui.MergeCellsCommand["super"].call(this,"mergeCells","table","mergeCells",{supportedSelections:["table"]})},OO.inheritClass(ve.ui.MergeCellsCommand,ve.ui.Command),ve.ui.MergeCellsCommand.prototype.isExecutable=function(a){return ve.ui.MergeCellsCommand["super"].prototype.isExecutable.apply(this,arguments)&&a.getSelection().getMatrixCells(!0).length>1},ve.ui.commandRegistry.register(new ve.ui.MergeCellsCommand),ve.ui.TableCaptionCommand=function(){ve.ui.TableCaptionCommand["super"].call(this,"tableCaption","table","caption",{supportedSelections:["linear","table"]})},OO.inheritClass(ve.ui.TableCaptionCommand,ve.ui.Command),ve.ui.TableCaptionCommand.prototype.isExecutable=function(a){if(!ve.ui.TableCaptionCommand["super"].prototype.isExecutable.apply(this,arguments))return!1;var b,c,d,e,f=a.getSelection();if(f instanceof ve.dm.TableSelection)return!0;for(d=a.getSelectedLeafNodes(),e=!!d.length,b=0,c=d.length;c>b;b++)if(!d[b].hasMatchingAncestor("tableCaption")){e=!1;break}return e},ve.ui.commandRegistry.register(new ve.ui.TableCaptionCommand),ve.ui.FragmentDialog=function(a){ve.ui.FragmentDialog["super"].call(this,a),this.fragment=null},OO.inheritClass(ve.ui.FragmentDialog,OO.ui.ProcessDialog),ve.ui.FragmentDialog.prototype.getSetupProcess=function(a){return a=a||{},ve.ui.FragmentDialog["super"].prototype.getSetupProcess.apply(this,a).next(function(){if(!(a.fragment instanceof ve.dm.SurfaceFragment))throw new Error("Cannot open dialog: opening data must contain a fragment");this.fragment=a.fragment},this)},ve.ui.FragmentDialog.prototype.getTeardownProcess=function(a){return ve.ui.FragmentDialog["super"].prototype.getTeardownProcess.apply(this,a).first(function(){this.fragment.select(),this.fragment=null},this)},ve.ui.FragmentDialog.prototype.getFragment=function(){return this.fragment},ve.ui.NodeDialog=function(a){ve.ui.NodeDialog["super"].call(this,a),this.selectedNode=null},OO.inheritClass(ve.ui.NodeDialog,ve.ui.FragmentDialog),ve.ui.NodeDialog["static"].modelClasses=[],ve.ui.NodeDialog.prototype.getSelectedNode=function(){var a,b,c=this.constructor["static"].modelClasses,d=this.getFragment().getSelectedNode();for(a=0,b=c.length;b>a;a++)if(d instanceof c[a])return d;return null},ve.ui.NodeDialog.prototype.initialize=function(a){ve.ui.NodeDialog["super"].prototype.initialize.call(this,a),this.$content.addClass("ve-ui-nodeDialog")},ve.ui.NodeDialog.prototype.getSetupProcess=function(a){return ve.ui.NodeDialog["super"].prototype.getSetupProcess.call(this,a).next(function(){this.selectedNode=this.getSelectedNode(a)},this)},ve.ui.NodeDialog.prototype.getTeardownProcess=function(a){return ve.ui.NodeDialog["super"].prototype.getTeardownProcess.call(this,a).first(function(){this.selectedNode=null},this)},ve.ui.ToolbarDialog=function(a){ve.ui.ToolbarDialog["super"].call(this,a),this.$element.addClass("ve-ui-toolbarDialog")},OO.inheritClass(ve.ui.ToolbarDialog,OO.ui.Dialog),ve.ui.ToolbarDialog["static"].size="full",ve.ui.ToolbarDialog.prototype.initialize=function(){ve.ui.ToolbarDialog["super"].prototype.initialize.call(this),this.$content.addClass("ve-ui-toolbarDialog-content")},ve.ui.CommandHelpDialog=function(a){ve.ui.CommandHelpDialog["super"].call(this,a)},OO.inheritClass(ve.ui.CommandHelpDialog,OO.ui.ProcessDialog),ve.ui.CommandHelpDialog["static"].name="commandHelp",ve.ui.CommandHelpDialog["static"].size="large",ve.ui.CommandHelpDialog["static"].title=OO.ui.deferMsg("visualeditor-dialog-command-help-title"),ve.ui.CommandHelpDialog["static"].actions=[{label:OO.ui.deferMsg("visualeditor-dialog-action-done"),flags:"safe"}],ve.ui.CommandHelpDialog.prototype.getBodyHeight=function(){return Math.round(this.contentLayout.$element[0].scrollHeight)},ve.ui.CommandHelpDialog.prototype.initialize=function(){ve.ui.CommandHelpDialog["super"].prototype.initialize.call(this);var a,b,c,d,e,f,g,h,i,j,k=ve.getSystemPlatform(),l="mac"===k?"mac":"pc",m=this.constructor["static"].getCommandGroups();this.contentLayout=new OO.ui.PanelLayout({$:this.$,scrollable:!0,padded:!0,expanded:!1}),this.$container=this.$("<div>").addClass("ve-ui-commandHelpDialog-container");for(a in m){for(g=m[a].commands,i=this.$("<dl>").addClass("ve-ui-commandHelpDialog-list"),b=0,c=g.length;c>b;b++){if(g[b].trigger)f=ve.ui.triggerRegistry.lookup(g[b].trigger);else for(f=[],d=0,e=g[b].shortcuts.length;e>d;d++)h=g[b].shortcuts[d],f.push(new ve.ui.Trigger(ve.isPlainObject(h)?h[l]:h,!0));for(j=this.$("<dt>"),d=0,e=f.length;e>d;d++)j.append(this.$("<kbd>").text(f[d].getMessage().replace(/\+/g," + ")));i.append(j,this.$("<dd>").text(ve.msg(g[b].msg)))}this.$container.append(this.$("<div>").addClass("ve-ui-commandHelpDialog-section").append(this.$("<h3>").text(ve.msg(m[a].title)),i))}this.contentLayout.$element.append(this.$container),this.$body.append(this.contentLayout.$element)},ve.ui.CommandHelpDialog["static"].getCommandGroups=function(){return{textStyle:{title:"visualeditor-shortcuts-text-style",commands:[{trigger:"bold",msg:"visualeditor-annotationbutton-bold-tooltip"},{trigger:"italic",msg:"visualeditor-annotationbutton-italic-tooltip"},{trigger:"link",msg:"visualeditor-annotationbutton-link-tooltip"},{trigger:"superscript",msg:"visualeditor-annotationbutton-superscript-tooltip"},{trigger:"subscript",msg:"visualeditor-annotationbutton-subscript-tooltip"},{trigger:"underline",msg:"visualeditor-annotationbutton-underline-tooltip"},{trigger:"code",msg:"visualeditor-annotationbutton-code-tooltip"},{trigger:"strikethrough",msg:"visualeditor-annotationbutton-strikethrough-tooltip"},{trigger:"clear",msg:"visualeditor-clearbutton-tooltip"}]},clipboard:{title:"visualeditor-shortcuts-clipboard",commands:[{shortcuts:[{mac:"cmd+x",pc:"ctrl+x"}],msg:"visualeditor-clipboard-cut"},{shortcuts:[{mac:"cmd+c",pc:"ctrl+c"}],msg:"visualeditor-clipboard-copy"},{shortcuts:[{mac:"cmd+v",pc:"ctrl+v"}],msg:"visualeditor-clipboard-paste"},{trigger:"pasteSpecial",msg:"visualeditor-clipboard-paste-special"}]},formatting:{title:"visualeditor-shortcuts-formatting",commands:[{trigger:"paragraph",msg:"visualeditor-formatdropdown-format-paragraph"},{shortcuts:["ctrl+(1-6)"],msg:"visualeditor-formatdropdown-format-heading-label"},{trigger:"preformatted",msg:"visualeditor-formatdropdown-format-preformatted"},{trigger:"blockquote",msg:"visualeditor-formatdropdown-format-blockquote"},{trigger:"indent",msg:"visualeditor-indentationbutton-indent-tooltip"},{trigger:"outdent",msg:"visualeditor-indentationbutton-outdent-tooltip"}]},history:{title:"visualeditor-shortcuts-history",commands:[{trigger:"undo",msg:"visualeditor-historybutton-undo-tooltip"},{trigger:"redo",msg:"visualeditor-historybutton-redo-tooltip"}]},other:{title:"visualeditor-shortcuts-other",commands:[{trigger:"findAndReplace",msg:"visualeditor-find-and-replace-title"},{trigger:"findNext",msg:"visualeditor-find-and-replace-next-button"},{trigger:"findPrevious",msg:"visualeditor-find-and-replace-previous-button"},{trigger:"selectAll",msg:"visualeditor-content-select-all"},{trigger:"commandHelp",msg:"visualeditor-dialog-command-help-title"}]}}},ve.ui.windowFactory.register(ve.ui.CommandHelpDialog),ve.ui.FindAndReplaceDialog=function(a){ve.ui.FindAndReplaceDialog["super"].call(this,a),this.surface=null,this.invalidRegex=!1,this.$element.addClass("ve-ui-findAndReplaceDialog")},OO.inheritClass(ve.ui.FindAndReplaceDialog,ve.ui.ToolbarDialog),ve.ui.FindAndReplaceDialog["static"].name="findAndReplace",ve.ui.FindAndReplaceDialog["static"].title=OO.ui.deferMsg("visualeditor-find-and-replace-title"),ve.ui.FindAndReplaceDialog["static"].maxRenderedResults=100,ve.ui.FindAndReplaceDialog.prototype.initialize=function(){ve.ui.FindAndReplaceDialog["super"].prototype.initialize.call(this),this.$findResults=this.$("<div>").addClass("ve-ui-findAndReplaceDialog-findResults"),this.fragments=[],this.results=0,this.renderedFragments=null,this.replacing=!1,this.focusedIndex=0,this.query=null,this.findText=new OO.ui.TextInputWidget({$:this.$,placeholder:ve.msg("visualeditor-find-and-replace-find-text")}),this.matchCaseToggle=new OO.ui.ToggleButtonWidget({$:this.$,icon:"case-sensitive",iconTitle:ve.msg("visualeditor-find-and-replace-match-case")}),this.regexToggle=new OO.ui.ToggleButtonWidget({$:this.$,icon:"regular-expression",iconTitle:ve.msg("visualeditor-find-and-replace-regular-expression")}),this.previousButton=new OO.ui.ButtonWidget({$:this.$,icon:"previous",iconTitle:ve.msg("visualeditor-find-and-replace-previous-button")+" "+ve.ui.triggerRegistry.getMessages("findPrevious").join(", ")}),this.nextButton=new OO.ui.ButtonWidget({$:this.$,icon:"next",iconTitle:ve.msg("visualeditor-find-and-replace-next-button")+" "+ve.ui.triggerRegistry.getMessages("findNext").join(", ")}),this.replaceText=new OO.ui.TextInputWidget({$:this.$,placeholder:ve.msg("visualeditor-find-and-replace-replace-text")}),this.replaceButton=new OO.ui.ButtonWidget({$:this.$,label:ve.msg("visualeditor-find-and-replace-replace-button")}),this.replaceAllButton=new OO.ui.ButtonWidget({$:this.$,label:ve.msg("visualeditor-find-and-replace-replace-all-button")});var a=new OO.ui.ButtonGroupWidget({$:this.$,classes:["ve-ui-findAndReplaceDialog-cell"],items:[this.matchCaseToggle,this.regexToggle]}),b=new OO.ui.ButtonGroupWidget({$:this.$,classes:["ve-ui-findAndReplaceDialog-cell"],items:[this.previousButton,this.nextButton]}),c=new OO.ui.ButtonGroupWidget({$:this.$,classes:["ve-ui-findAndReplaceDialog-cell"],items:[this.replaceButton,this.replaceAllButton]}),d=new OO.ui.ButtonWidget({$:this.$,classes:["ve-ui-findAndReplaceDialog-cell"],label:ve.msg("visualeditor-find-and-replace-done")}),e=this.$("<div>").addClass("ve-ui-findAndReplaceDialog-row"),f=this.$("<div>").addClass("ve-ui-findAndReplaceDialog-row");this.onWindowScrollDebounced=ve.debounce(this.onWindowScroll.bind(this),250),this.updateFragmentsDebounced=ve.debounce(this.updateFragments.bind(this)),this.renderFragmentsDebounced=ve.debounce(this.renderFragments.bind(this)),this.findText.connect(this,{change:"onFindChange",enter:"onFindTextEnter"}),this.matchCaseToggle.connect(this,{change:"onFindChange"}),this.regexToggle.connect(this,{change:"onFindChange"}),this.nextButton.connect(this,{click:"findNext"}),this.previousButton.connect(this,{click:"findPrevious"}),this.replaceButton.connect(this,{click:"onReplaceButtonClick"}),this.replaceAllButton.connect(this,{click:"onReplaceAllButtonClick"}),d.connect(this,{click:"close"}),this.findText.$input.prop("tabIndex",1),this.replaceText.$input.prop("tabIndex",2),this.$content.addClass("ve-ui-findAndReplaceDialog-content"),this.$body.append(e.append(this.$("<div>").addClass("ve-ui-findAndReplaceDialog-cell ve-ui-findAndReplaceDialog-cell-input").append(this.findText.$element),b.$element,a.$element),f.append(this.$("<div>").addClass("ve-ui-findAndReplaceDialog-cell ve-ui-findAndReplaceDialog-cell-input").append(this.replaceText.$element),c.$element,d.$element))},ve.ui.FindAndReplaceDialog.prototype.getSetupProcess=function(a){return a=a||{},ve.ui.FindAndReplaceDialog["super"].prototype.getSetupProcess.call(this,a).first(function(){this.surface=a.surface,this.surface.$selections.append(this.$findResults),this.surface.getModel().connect(this,{documentUpdate:this.updateFragmentsDebounced}),this.surface.getView().connect(this,{position:this.renderFragmentsDebounced}),this.surface.getView().$window.on("scroll",this.onWindowScrollDebounced);var b=a.fragment.getText();b&&b!==this.findText.getValue()?this.findText.setValue(b):this.onFindChange()},this)},ve.ui.FindAndReplaceDialog.prototype.getReadyProcess=function(a){return ve.ui.FindAndReplaceDialog["super"].prototype.getReadyProcess.call(this,a).next(function(){this.findText.focus().select()},this)},ve.ui.FindAndReplaceDialog.prototype.getTeardownProcess=function(a){return ve.ui.FindAndReplaceDialog["super"].prototype.getTeardownProcess.call(this,a).next(function(){var a=this.surface.getView();this.surface.getModel().disconnect(this),a.disconnect(this),this.surface.getView().$window.off("scroll",this.onWindowScrollDebounced),a.focus(),this.$findResults.empty().detach(),this.fragments=[],this.surface=null},this)},ve.ui.FindAndReplaceDialog.prototype.onWindowScroll=function(){this.renderedFragments.getLength()<this.results&&this.renderFragments()},ve.ui.FindAndReplaceDialog.prototype.onFindChange=function(){this.updateFragments(),this.renderFragments(),this.highlightFocused(!0)},ve.ui.FindAndReplaceDialog.prototype.onFindTextEnter=function(a){this.results&&(a.shiftKey?this.findPrevious():this.findNext())},ve.ui.FindAndReplaceDialog.prototype.updateFragments=function(){var a,b,c=this.surface.getModel(),d=c.getDocument(),e=[],f=this.matchCaseToggle.getValue(),g=this.regexToggle.getValue(),h=this.findText.getValue();if(this.invalidRegex=!1,g&&h)try{this.query=new RegExp(h)}catch(i){this.invalidRegex=!0}else this.query=h;if(this.findText.$element.toggleClass("ve-ui-findAndReplaceDialog-findText-error",this.invalidRegex),this.fragments=[],this.query)for(e=d.findText(this.query,f,!0),a=0,b=e.length;b>a;a++)this.fragments.push(c.getLinearFragment(e[a],!0,!0));this.results=this.fragments.length,this.focusedIndex=Math.min(this.focusedIndex,this.results?this.results-1:0),this.nextButton.setDisabled(!this.results),this.previousButton.setDisabled(!this.results),this.replaceButton.setDisabled(!this.results),this.replaceAllButton.setDisabled(!this.results)},ve.ui.FindAndReplaceDialog.prototype.renderFragments=function(){if(!this.replacing){var a,b,c,d=0,e=this.results;if(this.results>50)for(c=this.surface.getView().getViewportRange(),a=0;a<this.results;a++)if(b=this.fragments[a].getSelection(),c&&b.getRange().start<c.start)d=a+1;else if(c&&b.getRange().end>c.end){e=a;break}this.renderRangeOfFragments(e-d<=this.constructor["static"].maxRenderedResults?new ve.Range(d,e):new ve.Range(this.focusedIndex,this.focusedIndex+1))}},ve.ui.FindAndReplaceDialog.prototype.renderRangeOfFragments=function(a){var b,c,d,e,f,g;for(this.$findResults.empty(),b=a.start;b<a.end;b++){for(e=this.surface.getView().getSelectionRects(this.fragments[b].getSelection()),f=this.$("<div>").addClass("ve-ui-findAndReplaceDialog-findResult"),g=1/0,c=0,d=e.length;d>c;c++)g=Math.min(g,e[c].top),f.append(this.$("<div>").css({top:e[c].top,left:e[c].left,width:e[c].width,height:e[c].height}));f.data("top",g),this.$findResults.append(f)}this.renderedFragments=a,this.highlightFocused()},ve.ui.FindAndReplaceDialog.prototype.highlightFocused=function(a){var b,c,d,e,f,g,h=this.surface.getView();return this.results?(this.findText.setLabel(ve.msg("visualeditor-find-and-replace-results",this.focusedIndex+1,this.results)),this.$findResults.find(".ve-ui-findAndReplaceDialog-findResult-focused").removeClass("ve-ui-findAndReplaceDialog-findResult-focused"),this.renderedFragments.containsOffset(this.focusedIndex)?(b=this.$findResults.children().eq(this.focusedIndex-this.renderedFragments.start).addClass("ve-ui-findAndReplaceDialog-findResult-focused"),d=b.data("top")):(c=h.getSelectionBoundingRect(this.fragments[this.focusedIndex].getSelection()),d=c.top,this.renderRangeOfFragments(new ve.Range(this.focusedIndex,this.focusedIndex+1))),void(a&&(h=this.surface.getView(),e=d+h.$element.offset().top,f=h.$window.scrollTop()+this.surface.toolbarHeight,g=h.$window.height()-this.surface.toolbarHeight,(f>e||e>f+g)&&h.$("body, html").animate({scrollTop:e-g/2},"fast")))):void this.findText.setLabel(this.invalidRegex?ve.msg("visualeditor-find-and-replace-invalid-regex"):"")},ve.ui.FindAndReplaceDialog.prototype.findNext=function(){this.focusedIndex=(this.focusedIndex+1)%this.results,this.highlightFocused(!0)},ve.ui.FindAndReplaceDialog.prototype.findPrevious=function(){this.focusedIndex=(this.focusedIndex+this.results-1)%this.results,this.highlightFocused(!0)},ve.ui.FindAndReplaceDialog.prototype.onReplaceButtonClick=function(){var a;if(this.results){if(this.replace(this.focusedIndex),a=this.fragments[this.focusedIndex].getSelection().getRange().end,this.updateFragments(),!this.results)return void(this.focusedIndex=0);for(;this.fragments[this.focusedIndex]&&this.fragments[this.focusedIndex].getSelection().getRange().end<=a;)this.focusedIndex++;this.focusedIndex=this.focusedIndex%this.results}},ve.ui.FindAndReplaceDialog.prototype.onReplaceAllButtonClick=function(){var a,b;for(a=0,b=this.results;b>a;a++)this.replace(a)},ve.ui.FindAndReplaceDialog.prototype.replace=function(a){var b=this.replaceText.getValue();this.query instanceof RegExp?this.fragments[a].insertContent(this.fragments[a].getText().replace(this.query,b),!0):this.fragments[a].insertContent(b,!0)},ve.ui.FindAndReplaceDialog.prototype.getActionProcess=function(a){return"findNext"===a||"findPrevious"===a?new OO.ui.Process(this[a],this):ve.ui.FindAndReplaceDialog["super"].prototype.getActionProcess.call(this,a)},ve.ui.windowFactory.register(ve.ui.FindAndReplaceDialog),ve.ui.ProgressDialog=function(a){ve.ui.ProgressDialog["super"].call(this,a)},OO.inheritClass(ve.ui.ProgressDialog,OO.ui.MessageDialog),ve.ui.ProgressDialog["static"].name="progress",ve.ui.ProgressDialog["static"].size="medium",ve.ui.ProgressDialog["static"].actions=[{action:"cancel",label:OO.ui.deferMsg("visualeditor-dialog-action-cancel"),flags:"destructive"}],ve.ui.ProgressDialog.prototype.initialize=function(){ve.ui.ProgressDialog["super"].prototype.initialize.call(this),this.inProgress=0,this.cancelDeferreds=[]},ve.ui.ProgressDialog.prototype.getSetupProcess=function(a){return a=a||{},ve.ui.ProgressDialog["super"].prototype.getSetupProcess.call(this,a).next(function(){var b,c,d,e,f,g,h,i=a.progresses;for(this.inProgress=i.length,this.text.$element.empty(),this.cancelDeferreds=[],b=0,c=i.length;c>b;b++)h=$.Deferred(),d=this.$("<div>").addClass("ve-ui-progressDialog-row"),e=new OO.ui.ProgressBarWidget({$:this.$}),f=new OO.ui.FieldLayout(e,{$:this.$,label:i[b].label,align:"top"}),g=new OO.ui.ButtonWidget({$:this.$,framed:!1,icon:"clear",iconTitle:OO.ui.deferMsg("visualeditor-dialog-action-cancel")}).on("click",h.reject.bind(h)),this.text.$element.append(d.append(f.$element,g.$element)),i[b].progressBarDeferred.resolve(e,h.promise()),i[b].progressCompletePromise.then(this.progressComplete.bind(this,d,!1),this.progressComplete.bind(this,d,!0)),this.cancelDeferreds.push(h)},this)},ve.ui.ProgressDialog.prototype.getActionProcess=function(a){return new OO.ui.Process(function(){var b,c;if("cancel"===a)for(b=0,c=this.cancelDeferreds.length;c>b;b++)this.cancelDeferreds[b].reject();this.close({action:a})},this)},ve.ui.ProgressDialog.prototype.progressComplete=function(a,b){this.inProgress--,this.inProgress||this.close(),b&&(a.remove(),this.updateSize())},ve.ui.windowFactory.register(ve.ui.ProgressDialog),ve.ui.DSVFileTransferHandler=function(){ve.ui.DSVFileTransferHandler["super"].apply(this,arguments)},OO.inheritClass(ve.ui.DSVFileTransferHandler,ve.ui.DataTransferHandler),ve.ui.DSVFileTransferHandler["static"].name="dsv",ve.ui.DSVFileTransferHandler["static"].types=["text/csv","text/tab-separated-values"],ve.ui.DSVFileTransferHandler.prototype.process=function(){this.createProgress(this.insertableDataDeferred.promise()),this.reader.readAsText(this.file)},ve.ui.DSVFileTransferHandler.prototype.onFileProgress=function(a){this.setProgress(a.lengthComputable?100*a.loaded/a.total:!1)},ve.ui.DSVFileTransferHandler.prototype.onFileLoad=function(){var a,b,c,d=[],e=Papa.parse(this.reader.result);
if(e.meta.aborted||e.data.length<=0)return void this.insertableDataDeffered.reject();for(d.push({type:"table"}),d.push({type:"tableSection",attributes:{style:"body"}}),a=0;a<e.data.length;a++){for(d.push({type:"tableRow"}),c=e.data[a],b=0;b<c.length;b++)d.push({type:"tableCell",attributes:{style:0===a?"header":"data"}}),d.push({type:"paragraph",internal:{generated:"wrapper"}}),d=d.concat(c[b].split("")),d.push({type:"/paragraph"}),d.push({type:"/tableCell"});d.push({type:"/tableRow"})}d.push({type:"/tableSection"}),d.push({type:"/table"}),this.insertableDataDeferred.resolve(d),this.setProgress(100)},ve.ui.DSVFileTransferHandler.prototype.onFileLoadEnd=function(){this.insertableDataDeferred.reject()},ve.ui.DSVFileTransferHandler.prototype.abort=function(){ve.ui.DSVFileTransferHandler["super"].prototype.abort.call(this),this.reader.abort()},ve.ui.dataTransferHandlerFactory.register(ve.ui.DSVFileTransferHandler),ve.ui.PlainTextFileTransferHandler=function(){ve.ui.PlainTextFileTransferHandler["super"].apply(this,arguments)},OO.inheritClass(ve.ui.PlainTextFileTransferHandler,ve.ui.DataTransferHandler),ve.ui.PlainTextFileTransferHandler["static"].name="plainText",ve.ui.PlainTextFileTransferHandler["static"].types=["text/plain"],ve.ui.PlainTextFileTransferHandler.prototype.process=function(){this.createProgress(this.insertableDataDeferred.promise()),this.reader.readAsText(this.file)},ve.ui.PlainTextFileTransferHandler.prototype.onFileProgress=function(a){this.setProgress(a.lengthComputable?100*a.loaded/a.total:!1)},ve.ui.PlainTextFileTransferHandler.prototype.onFileLoad=function(){var a,b,c=[],d=this.reader.result.split(/[\r\n]+/);for(a=0,b=d.length;b>a;a++)d[a].length&&(c.push({type:"paragraph"}),c=c.concat(d[a].split("")),c.push({type:"/paragraph"}));this.insertableDataDeferred.resolve(c),this.setProgress(100)},ve.ui.PlainTextFileTransferHandler.prototype.onFileLoadEnd=function(){this.insertableDataDeferred.reject()},ve.ui.PlainTextFileTransferHandler.prototype.abort=function(){ve.ui.PlainTextFileTransferHandler["super"].prototype.abort.call(this),this.reader.abort()},ve.ui.dataTransferHandlerFactory.register(ve.ui.PlainTextFileTransferHandler),ve.ui.HTMLFileTransferHandler=function(){ve.ui.HTMLFileTransferHandler["super"].apply(this,arguments)},OO.inheritClass(ve.ui.HTMLFileTransferHandler,ve.ui.DataTransferHandler),ve.ui.HTMLFileTransferHandler["static"].name="html",ve.ui.HTMLFileTransferHandler["static"].types=["text/html","application/xhtml+xml"],ve.ui.HTMLFileTransferHandler.prototype.process=function(){this.createProgress(this.insertableDataDeferred.promise()),this.reader.readAsText(this.file)},ve.ui.HTMLFileTransferHandler.prototype.onFileProgress=function(a){this.setProgress(a.lengthComputable?100*a.loaded/a.total:!1)},ve.ui.HTMLFileTransferHandler.prototype.onFileLoad=function(){this.insertableDataDeferred.resolve(this.surface.getModel().getDocument().newFromHtml(this.reader.result)),this.setProgress(100)},ve.ui.HTMLFileTransferHandler.prototype.onFileLoadEnd=function(){this.insertableDataDeferred.reject()},ve.ui.HTMLFileTransferHandler.prototype.abort=function(){ve.ui.HTMLFileTransferHandler["super"].prototype.abort.call(this),this.reader.abort()},ve.ui.dataTransferHandlerFactory.register(ve.ui.HTMLFileTransferHandler),ve.ui.ToolbarDialogWindowManager=function(a){ve.ui.ToolbarDialogWindowManager["super"].call(this,a)},OO.inheritClass(ve.ui.ToolbarDialogWindowManager,ve.ui.WindowManager),ve.ui.ToolbarDialogWindowManager["static"].sizes=ve.copy(ve.ui.ToolbarDialogWindowManager["super"]["static"].sizes),ve.ui.ToolbarDialogWindowManager["static"].sizes.full={width:"100%",maxHeight:"100%"},ve.ui.ToolbarDialogWindowManager.prototype.getTeardownDelay=function(){return 250},ve.ui.AlignWidget=function(a){ve.ui.AlignWidget["super"].call(this,a);var b=[new OO.ui.ButtonOptionWidget({$:this.$,data:"left",icon:"align-float-left",label:ve.msg("visualeditor-align-widget-left")}),new OO.ui.ButtonOptionWidget({$:this.$,data:"center",icon:"align-center",label:ve.msg("visualeditor-align-widget-center")}),new OO.ui.ButtonOptionWidget({$:this.$,data:"right",icon:"align-float-right",label:ve.msg("visualeditor-align-widget-right")})];"rtl"===a.dir&&(b=b.reverse()),this.addItems(b,0)},OO.inheritClass(ve.ui.AlignWidget,OO.ui.ButtonSelectWidget),ve.ui.LanguageSearchWidget=function(a){a=ve.extendObject({placeholder:ve.msg("visualeditor-language-search-input-placeholder")},a),OO.ui.SearchWidget.call(this,a),this.languageResultWidgets=[],this.filteredLanguageResultWidgets=[];var b,c,d,e=ve.init.platform.getLanguageCodes().sort();for(b=0,c=e.length;c>b;b++)d=e[b],this.languageResultWidgets.push(new ve.ui.LanguageResultWidget({$:this.$,data:{code:d,name:ve.init.platform.getLanguageName(d),autonym:ve.init.platform.getLanguageAutonym(d)}}));this.setAvailableLanguages(),this.$element.addClass("ve-ui-languageSearchWidget")},OO.inheritClass(ve.ui.LanguageSearchWidget,OO.ui.SearchWidget),ve.ui.LanguageSearchWidget.prototype.onQueryChange=function(){OO.ui.SearchWidget.prototype.onQueryChange.call(this),this.addResults()},ve.ui.LanguageSearchWidget.prototype.setAvailableLanguages=function(a){if(!a)return void(this.filteredLanguageResultWidgets=this.languageResultWidgets.slice());var b,c,d,e;for(this.filteredLanguageResultWidgets=[],b=0,c=this.languageResultWidgets.length;c>b;b++)d=this.languageResultWidgets[b],e=d.getData(),-1!==ve.indexOf(e.code,a)&&this.filteredLanguageResultWidgets.push(d)},ve.ui.LanguageSearchWidget.prototype.addResults=function(){var a,b,c,d,e,f,g,h=["name","autonym","code"],i=this.query.getValue().trim(),j=new RegExp("^"+this.constructor["static"].escapeRegex(i),"i"),k=!!i.length,l=[];for(this.results.clearItems(),a=0,b=this.filteredLanguageResultWidgets.length;b>a;a++){for(e=this.filteredLanguageResultWidgets[a],f=e.getData(),g=null,c=0,d=h.length;d>c;c++)if(j.test(f[h[c]])){g=h[c];break}(""===i||g)&&l.push(e.updateLabel(i,g).setSelected(!1).setHighlighted(!1))}this.results.addItems(l),k&&this.results.highlightItem(this.results.getFirstSelectableItem())},ve.ui.LanguageSearchWidget["static"].escapeRegex=function(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$\|#\s]/g,"\\$&")},ve.ui.LanguageResultWidget=function(a){OO.ui.OptionWidget.call(this,a),this.$element.addClass("ve-ui-languageResultWidget"),this.$name=this.$("<div>").addClass("ve-ui-languageResultWidget-name"),this.$otherMatch=this.$("<div>").addClass("ve-ui-languageResultWidget-otherMatch"),this.setLabel(this.$otherMatch.add(this.$name))},OO.inheritClass(ve.ui.LanguageResultWidget,OO.ui.OptionWidget),ve.ui.LanguageResultWidget.prototype.updateLabel=function(a,b){var c,d=this.getData();return this.$name.text(d.name),this.$otherMatch.text(d.code),b&&(c=this.highlightQuery(d[b],a),"name"===b?this.$name.empty().append(c):this.$otherMatch.empty().append(c)),this},ve.ui.LanguageResultWidget.prototype.highlightQuery=function(a,b){var c=this.$("<span>"),d=a.toLowerCase().indexOf(b.toLowerCase());return b.length&&-1!==d?(c.append(document.createTextNode(a.slice(0,d)),this.$("<span>").addClass("ve-ui-languageResultWidget-highlight").text(a.slice(d,d+b.length)),document.createTextNode(a.slice(d+b.length))),c.contents()):c.text(a)},ve.ui.LanguageSearchDialog=function(a){ve.ui.LanguageSearchDialog["super"].call(this,a)},OO.inheritClass(ve.ui.LanguageSearchDialog,OO.ui.ProcessDialog),ve.ui.LanguageSearchDialog["static"].name="languageSearch",ve.ui.LanguageSearchDialog["static"].size="medium",ve.ui.LanguageSearchDialog["static"].title=OO.ui.deferMsg("visualeditor-dialog-language-search-title"),ve.ui.LanguageSearchDialog["static"].actions=[{label:OO.ui.deferMsg("visualeditor-dialog-action-cancel")}],ve.ui.LanguageSearchDialog["static"].languageSearchWidget=ve.ui.LanguageSearchWidget,ve.ui.LanguageSearchDialog.prototype.initialize=function(){ve.ui.LanguageSearchDialog["super"].prototype.initialize.apply(this,arguments),this.searchWidget=new this.constructor["static"].languageSearchWidget({$:this.$}).on("select",this.onSearchWidgetSelect.bind(this)),this.$body.append(this.searchWidget.$element)},ve.ui.LanguageSearchDialog.prototype.onSearchWidgetSelect=function(a){this.close({action:"apply",lang:a.code,dir:ve.init.platform.getLanguageDirection(a.code)})},ve.ui.LanguageSearchDialog.prototype.getSetupProcess=function(a){return ve.ui.LanguageSearchDialog["super"].prototype.getSetupProcess.call(this,a).next(function(){this.searchWidget.setAvailableLanguages(a.availableLanguages),this.searchWidget.addResults()},this)},ve.ui.LanguageSearchDialog.prototype.getReadyProcess=function(a){return ve.ui.LanguageSearchDialog["super"].prototype.getReadyProcess.call(this,a).next(function(){this.searchWidget.getQuery().focus()},this)},ve.ui.LanguageSearchDialog.prototype.getTeardownProcess=function(a){return ve.ui.LanguageSearchDialog["super"].prototype.getTeardownProcess.call(this,a).first(function(){this.searchWidget.getQuery().setValue("")},this)},ve.ui.LanguageSearchDialog.prototype.getBodyHeight=function(){return 300},ve.ui.windowFactory.register(ve.ui.LanguageSearchDialog),ve.ui.LanguageInputWidget=function(a){a=a||{},OO.ui.Widget.call(this,a),this.lang=null,this.dir=null,this.overlay=new ve.ui.Overlay({classes:["ve-ui-overlay-global"]}),this.dialogs=a.dialogManager||new ve.ui.WindowManager({factory:ve.ui.windowFactory,isolate:!0}),this.availableLanguages=a.availableLanguages,this.findLanguageButton=new OO.ui.ButtonWidget({$:this.$,classes:["ve-ui-languageInputWidget-findLanguageButton"],label:ve.msg("visualeditor-languageinspector-widget-changelang"),indicator:"next"}),this.languageCodeTextInput=new OO.ui.TextInputWidget({$:this.$,classes:["ve-ui-languageInputWidget-languageCodeTextInput"]}),this.directionSelect=new OO.ui.ButtonSelectWidget({$:this.$,classes:["ve-ui-languageInputWidget-directionSelect"]}),this.findLanguageField=new OO.ui.FieldLayout(this.findLanguageButton,{$:this.$,align:"left",label:ve.msg("visualeditor-languageinspector-widget-label-language")}),this.languageCodeField=new OO.ui.FieldLayout(this.languageCodeTextInput,{$:this.$,align:"left",label:ve.msg("visualeditor-languageinspector-widget-label-langcode")}),this.directionField=new OO.ui.FieldLayout(this.directionSelect,{$:this.$,align:"left",label:ve.msg("visualeditor-languageinspector-widget-label-direction")}),this.findLanguageButton.connect(this,{click:"onFindLanguageButtonClick"}),this.languageCodeTextInput.connect(this,{change:"onChange"}),this.directionSelect.connect(this,{select:"onChange"});var b=[new OO.ui.ButtonOptionWidget({$:this.$,data:"rtl",icon:"text-dir-rtl"}),new OO.ui.ButtonOptionWidget({$:this.$,data:"ltr",icon:"text-dir-ltr"})];a.requireDir||b.splice(1,0,new OO.ui.ButtonOptionWidget({$:this.$,data:null,label:ve.msg("visualeditor-dialog-language-auto-direction")})),this.directionSelect.addItems(b),this.overlay.$element.append(this.dialogs.$element),$("body").append(this.overlay.$element),this.$element.addClass("ve-ui-languageInputWidget").append(this.findLanguageField.$element,this.languageCodeField.$element,this.directionField.$element)},OO.inheritClass(ve.ui.LanguageInputWidget,OO.ui.Widget),ve.ui.LanguageInputWidget.prototype.onFindLanguageButtonClick=function(){var a=this;this.dialogs.openWindow("languageSearch",{availableLanguages:this.availableLanguages}).then(function(b){b.then(function(b){b.then(function(b){b=b||{},"apply"===b.action&&a.setLangAndDir(b.lang,b.dir)})})})},ve.ui.LanguageInputWidget.prototype.onChange=function(){if(!this.updating){var a=this.directionSelect.getSelectedItem();this.setLangAndDir(this.languageCodeTextInput.getValue(),a?a.getData():null)}},ve.ui.LanguageInputWidget.prototype.setLangAndDir=function(a,b){(a!==this.lang||b!==this.dir)&&(this.updating=!0,a||b?(a=a||"",this.languageCodeTextInput.setValue(a),this.findLanguageButton.setLabel(ve.init.platform.getLanguageName(a.toLowerCase())||ve.msg("visualeditor-languageinspector-widget-changelang")),this.directionSelect.selectItem(this.directionSelect.getItemFromData(b||null))):(this.languageCodeTextInput.setValue(""),this.findLanguageButton.setLabel(ve.msg("visualeditor-languageinspector-widget-changelang")),this.directionSelect.selectItem(this.directionSelect.getItemFromData(null))),this.updating=!1,this.emit("change",a,b),this.lang=a,this.dir=b)},ve.ui.LanguageInputWidget.prototype.getLang=function(){return this.lang},ve.ui.LanguageInputWidget.prototype.getDir=function(){return this.dir},ve.ui.SurfaceWidget=function(a,b){b=b||{},OO.ui.Widget.call(this,b),this.surface=ve.init.target.createSurface(a,{$:this.$,excludeCommands:b.excludeCommands,importRules:b.importRules}),this.toolbar=new ve.ui.Toolbar(this.surface,{$:this.$}),this.surface.$element.addClass("ve-ui-surfaceWidget-surface"),this.toolbar.$element.addClass("ve-ui-surfaceWidget-toolbar"),this.$element.addClass("ve-ui-surfaceWidget").append(this.toolbar.$element,this.surface.$element),b.tools&&this.toolbar.setup(b.tools,this.surface)},OO.inheritClass(ve.ui.SurfaceWidget,OO.ui.Widget),ve.ui.SurfaceWidget.prototype.getSurface=function(){return this.surface},ve.ui.SurfaceWidget.prototype.getToolbar=function(){return this.toolbar},ve.ui.SurfaceWidget.prototype.getContent=function(){return this.surface.getModel().getDocument().getData()},ve.ui.SurfaceWidget.prototype.initialize=function(){this.toolbar.initialize(),this.surface.initialize()},ve.ui.SurfaceWidget.prototype.destroy=function(){this.surface&&this.surface.destroy(),this.toolbar&&this.toolbar.destroy(),this.$element.remove()},ve.ui.SurfaceWidget.prototype.focus=function(){this.surface.getView().focus()},ve.ui.LinkTargetInputWidget=function(a){OO.ui.TextInputWidget.call(this,$.extend({validate:/^(https?:\/\/)?[\w-]+(\.[\w-]+)+\.?(:\d+)?(\/\S*)?/gi},a)),this.annotation=null,this.$element.addClass("ve-ui-linkTargetInputWidget"),$("body").hasClass("rtl")&&this.$input.addClass("oo-ui-rtl")},OO.inheritClass(ve.ui.LinkTargetInputWidget,OO.ui.TextInputWidget),ve.ui.LinkTargetInputWidget.prototype.onEdit=function(){var a=this;this.disabled||setTimeout(function(){if($("body").hasClass("rtl")){var b=ve.init.platform.getExternalLinkUrlProtocolsRegExp().test(a.$input.val());a.setRTL(!b)}a.setValue(a.$input.val())})},ve.ui.LinkTargetInputWidget.prototype.setValue=function(a){a=this.cleanUpValue(a),""===a?this.annotation=null:this.setAnnotation(new ve.dm.LinkAnnotation({type:"link",attributes:{href:a}})),OO.ui.TextInputWidget.prototype.setValue.call(this,a)},ve.ui.LinkTargetInputWidget.prototype.setAnnotation=function(a){return this.annotation=a,OO.ui.TextInputWidget.prototype.setValue.call(this,this.getTargetFromAnnotation(a)),this},ve.ui.LinkTargetInputWidget.prototype.getAnnotation=function(){return this.annotation},ve.ui.LinkTargetInputWidget.prototype.getHref=function(){return this.getValue()},ve.ui.LinkTargetInputWidget.prototype.getTargetFromAnnotation=function(a){return a instanceof ve.dm.LinkAnnotation?a.getAttribute("href"):""},ve.ui.ContextSelectWidget=function(a){a=a||{},ve.ui.ContextSelectWidget["super"].call(this,a),this.connect(this,{choose:"onChooseItem"}),this.$element.addClass("ve-ui-contextSelectWidget")},OO.inheritClass(ve.ui.ContextSelectWidget,OO.ui.SelectWidget),ve.ui.ContextSelectWidget.prototype.onChooseItem=function(){this.selectItem(null)},ve.ui.ContextOptionWidget=function(a,b,c){c=c||{},ve.ui.ContextOptionWidget["super"].call(this,c),this.tool=a,this.model=b,this.$element.addClass("ve-ui-contextOptionWidget"),this.setIcon(this.tool["static"].icon),this.setLabel(this.getDescription())},OO.inheritClass(ve.ui.ContextOptionWidget,OO.ui.DecoratedOptionWidget),ve.ui.ContextOptionWidget.prototype.getDescription=function(){var a;return this.model instanceof ve.dm.Annotation?a=ve.ce.annotationFactory.getDescription(this.model):this.model instanceof ve.dm.Node&&(a=ve.ce.nodeFactory.getDescription(this.model)),a||(a=this.tool["static"].title),a},ve.ui.ContextOptionWidget.prototype.getCommand=function(){return ve.ui.commandRegistry.lookup(this.tool["static"].commandName)},ve.ui.DimensionsWidget=function(a){var b,c;a=a||{},OO.ui.Widget.call(this,a),this.widthInput=new OO.ui.TextInputWidget({$:this.$}),this.heightInput=new OO.ui.TextInputWidget({$:this.$}),this.defaults=a.defaults||{width:"",height:""},this.renderDefaults(),b=new OO.ui.LabelWidget({$:this.$,label:ve.msg("visualeditor-dimensionswidget-times")}),c=new OO.ui.LabelWidget({$:this.$,label:ve.msg("visualeditor-dimensionswidget-px")}),this.widthInput.connect(this,{change:"onWidthChange"}),this.heightInput.connect(this,{change:"onHeightChange"}),this.$element.addClass("ve-ui-dimensionsWidget").append(this.widthInput.$element,b.$element.addClass("ve-ui-dimensionsWidget-label-times"),this.heightInput.$element,c.$element.addClass("ve-ui-dimensionsWidget-label-px"))},OO.inheritClass(ve.ui.DimensionsWidget,OO.ui.Widget),ve.ui.DimensionsWidget.prototype.onWidthChange=function(a){this.emit("widthChange",a)},ve.ui.DimensionsWidget.prototype.onHeightChange=function(a){this.emit("heightChange",a)},ve.ui.DimensionsWidget.prototype.setDefaults=function(a){a.width&&a.height&&(this.defaults=ve.copy(a),this.renderDefaults())},ve.ui.DimensionsWidget.prototype.renderDefaults=function(){this.widthInput.$input.prop("placeholder",this.getDefaults().width),this.heightInput.$input.prop("placeholder",this.getDefaults().height)},ve.ui.DimensionsWidget.prototype.getDefaults=function(){return this.defaults},ve.ui.DimensionsWidget.prototype.removeDefaults=function(){this.defaults={width:"",height:""},this.renderDefaults()},ve.ui.DimensionsWidget.prototype.isEmpty=function(){return""===this.widthInput.getValue()&&""===this.heightInput.getValue()},ve.ui.DimensionsWidget.prototype.clear=function(){this.widthInput.setValue(""),this.heightInput.setValue("")},ve.ui.DimensionsWidget.prototype.reset=function(){this.setDimensions(this.getDefaults())},ve.ui.DimensionsWidget.prototype.setDimensions=function(a){a.width&&this.setWidth(a.width),a.height&&this.setHeight(a.height)},ve.ui.DimensionsWidget.prototype.getDimensions=function(){return{width:this.widthInput.getValue(),height:this.heightInput.getValue()}},ve.ui.DimensionsWidget.prototype.setDisabled=function(a){this.widthInput&&this.widthInput.setDisabled(a),this.heightInput&&this.heightInput.setDisabled(a)},ve.ui.DimensionsWidget.prototype.getWidth=function(){return this.widthInput.getValue()},ve.ui.DimensionsWidget.prototype.getHeight=function(){return this.heightInput.getValue()},ve.ui.DimensionsWidget.prototype.setWidth=function(a){this.widthInput.setValue(a)},ve.ui.DimensionsWidget.prototype.setHeight=function(a){this.heightInput.setValue(a)},ve.ui.MediaSizeWidget=function(a,b){var c,d,e;b=b||{},this.scalable=a||{},OO.ui.Widget.call(this,b),this.ratio={},this.currentDimensions={},this.maxDimensions={},this.valid=null,this.sizeTypeSelectWidget=new OO.ui.ButtonSelectWidget({$:this.$,classes:["ve-ui-mediaSizeWidget-section-sizetype"]}),this.sizeTypeSelectWidget.addItems([new OO.ui.ButtonOptionWidget({$:this.$,data:"default",label:ve.msg("visualeditor-mediasizewidget-sizeoptions-default")}),new OO.ui.ButtonOptionWidget({$:this.$,data:"custom",label:ve.msg("visualeditor-mediasizewidget-sizeoptions-custom")})]),this.scaleInput=new OO.ui.TextInputWidget({$:this.$}),e=new OO.ui.LabelWidget({$:this.$,input:this.scaleInput,label:ve.msg("visualeditor-mediasizewidget-label-scale-percent")}),this.dimensionsWidget=new ve.ui.DimensionsWidget({$:this.$}),this.errorLabel=new OO.ui.LabelWidget({$:this.$,label:ve.msg("visualeditor-mediasizewidget-label-defaulterror")}),c=new OO.ui.FieldLayout(this.scaleInput,{$:this.$,align:"right",label:ve.msg("visualeditor-mediasizewidget-label-scale")}),d=new OO.ui.FieldLayout(this.dimensionsWidget,{$:this.$,align:"right",label:ve.msg("visualeditor-mediasizewidget-label-custom"),classes:["ve-ui-mediaSizeWidget-section-custom"]}),this.fullSizeButton=new OO.ui.ButtonWidget({$:this.$,label:ve.msg("visualeditor-mediasizewidget-button-originaldimensions"),classes:["ve-ui-mediaSizeWidget-button-fullsize"]}),this.$element.addClass("ve-ui-mediaSizeWidget").append(this.sizeTypeSelectWidget.$element,d.$element,this.fullSizeButton.$element,this.$("<div>").addClass("ve-ui-mediaSizeWidget-label-error").append(this.errorLabel.$element)),this.dimensionsWidget.connect(this,{widthChange:["onDimensionsChange","width"],heightChange:["onDimensionsChange","height"]}),this.sizeTypeSelectWidget.connect(this,{choose:"onSizeTypeChoose"}),this.fullSizeButton.connect(this,{click:"onFullSizeButtonClick"})},OO.inheritClass(ve.ui.MediaSizeWidget,OO.ui.Widget),ve.ui.MediaSizeWidget.prototype.onScalableOriginalSizeChange=function(a){var b=!a||$.isEmptyObject(a);this.fullSizeButton.setDisabled(b),this.sizeTypeSelectWidget.getItemFromData("default").setDisabled(b),this.validateDimensions()},ve.ui.MediaSizeWidget.prototype.onScalableCurrentSizeChange=function(a){$.isEmptyObject(a)||(this.setCurrentDimensions(a),this.validateDimensions())},ve.ui.MediaSizeWidget.prototype.onScalableDefaultSizeChange=function(a){this.updateDefaultDimensions(),this.setSizeType(a?"default":"custom"),this.validateDimensions()},ve.ui.MediaSizeWidget.prototype.onDimensionsChange=function(a,b){var c={};0===Number(b)?this.setSizeType("default"):(this.setSizeType("custom"),$.isNumeric(b)?(c[a]=Number(b),this.setCurrentDimensions(c)):this.validateDimensions())},ve.ui.MediaSizeWidget.prototype.onScaleChange=function(){this.sizeTypeSelectWidget.selectItem(this.dimensionsWidget.isEmpty()?this.sizeTypeSelectWidget.getItemFromData("default"):this.sizeTypeSelectWidget.getItemFromData("scale"))},ve.ui.MediaSizeWidget.prototype.onSizeTypeChoose=function(a){var b=a&&a.getData(),c=this.scalable.isDefault();this.scalable.toggleDefault("default"===b),"default"===b?(this.scaleInput.setDisabled(!0),$.isEmptyObject(this.dimensionsWidget.getDefaults())||this.dimensionsWidget.clear()):"scale"===b?(this.dimensionsWidget.setDisabled(!0),this.scaleInput.setDisabled(!1)):"custom"===b&&(this.dimensionsWidget.setDisabled(!1),this.scaleInput.setDisabled(!0),c&&!$.isEmptyObject(this.dimensionsWidget.getDefaults())&&this.setCurrentDimensions(this.dimensionsWidget.getDefaults()),this.validateDimensions()),this.emit("changeSizeType",b),this.validateDimensions()},ve.ui.MediaSizeWidget.prototype.setScalePlaceholder=function(a){this.scaleInput.$element.prop("placeholder",a)},ve.ui.MediaSizeWidget.prototype.getScalePlaceholder=function(){return this.scaleInput.$element.prop("placeholder")},ve.ui.MediaSizeWidget.prototype.setSizeType=function(a){(this.getSizeType()!==a||0===Number(this.dimensionsWidget.getWidth())||0===Number(this.dimensionsWidget.getHeight()))&&this.sizeTypeSelectWidget.chooseItem(this.sizeTypeSelectWidget.getItemFromData(a))},ve.ui.MediaSizeWidget.prototype.getSizeType=function(){return this.sizeTypeSelectWidget.getSelectedItem()?this.sizeTypeSelectWidget.getSelectedItem().getData():""},ve.ui.MediaSizeWidget.prototype.setScalable=function(a){this.scalable instanceof ve.dm.Scalable&&this.scalable.disconnect(this),this.scalable=a,this.scalable.connect(this,{defaultSizeChange:"onScalableDefaultSizeChange",originalSizeChange:"onScalableOriginalSizeChange",currentSizeChange:"onScalableCurrentSizeChange"}),this.updateDefaultDimensions(),this.scalable.isDefault()||this.setCurrentDimensions(this.scalable.getCurrentDimensions()),this.scalable.getOriginalDimensions()?(this.fullSizeButton.setDisabled(!1),this.sizeTypeSelectWidget.getItemFromData("default").setDisabled(!1),this.setSizeType(this.scalable.isDefault()?"default":"custom")):(this.fullSizeButton.setDisabled(!0),this.sizeTypeSelectWidget.getItemFromData("default").setDisabled(!0)),this.validateDimensions()},ve.ui.MediaSizeWidget.prototype.getScalable=function(){return this.scalable},ve.ui.MediaSizeWidget.prototype.onFullSizeButtonClick=function(){this.sizeTypeSelectWidget.chooseItem(this.sizeTypeSelectWidget.getItemFromData("custom")),this.setCurrentDimensions(this.scalable.getOriginalDimensions()),this.dimensionsWidget.setDisabled(!1)},ve.ui.MediaSizeWidget.prototype.setRatio=function(a){this.scalable.setRatio(a)},ve.ui.MediaSizeWidget.prototype.getRatio=function(){return this.scalable.getRatio()},ve.ui.MediaSizeWidget.prototype.setMaxDimensions=function(a){var b=ve.dm.Scalable["static"].getDimensionsFromValue(a,this.scalable.getRatio());this.scalable.setMaxDimensions(b)},ve.ui.MediaSizeWidget.prototype.getMaxDimensions=function(){return this.scalable.getMaxDimensions()},ve.ui.MediaSizeWidget.prototype.getCurrentDimensions=function(){return this.currentDimensions},ve.ui.MediaSizeWidget.prototype.setDisabled=function(a){this.sizeTypeSelectWidget&&this.dimensionsWidget&&this.scalable&&this.fullSizeButton&&(this.sizeTypeSelectWidget.setDisabled(a),this.dimensionsWidget.setDisabled(a),this.fullSizeButton.setDisabled(a||!this.scalable.getOriginalDimensions()))},ve.ui.MediaSizeWidget.prototype.setCurrentDimensions=function(a){var b;this.preventChangeRecursion||(this.preventChangeRecursion=!0,b=ve.dm.Scalable["static"].getDimensionsFromValue(a,this.scalable.getRatio()),this.scalable.isDimensionsObjectValid(b)&&!this.scalable.isDefault()&&(this.currentDimensions=b,this.dimensionsWidget.setWidth(this.currentDimensions.width),this.dimensionsWidget.setHeight(this.currentDimensions.height),this.scalable.setCurrentDimensions(this.currentDimensions),this.validateDimensions(),this.emit("change",this.currentDimensions)),this.preventChangeRecursion=!1)},ve.ui.MediaSizeWidget.prototype.validateDimensions=function(){var a=this.isValid();return this.valid!==a&&(this.valid=a,this.errorLabel.toggle(!a),this.$element.toggleClass("ve-ui-mediaSizeWidget-input-hasError",!a),this.emit("valid",this.valid)),a},ve.ui.MediaSizeWidget.prototype.updateDefaultDimensions=function(){var a=this.scalable.getDefaultDimensions();$.isEmptyObject(a)?this.dimensionsWidget.removeDefaults():this.dimensionsWidget.setDefaults(a),this.sizeTypeSelectWidget.getItemFromData("default").setDisabled($.isEmptyObject(a)),this.validateDimensions()},ve.ui.MediaSizeWidget.prototype.isCustomEmpty=function(){return this.dimensionsWidget.isEmpty()},ve.ui.MediaSizeWidget.prototype.toggleFullSizeButtonDisabled=function(a){this.fullSizeButton.setDisabled(a)},ve.ui.MediaSizeWidget.prototype.isScaleEmpty=function(){return""===this.scaleInput.getValue()},ve.ui.MediaSizeWidget.prototype.isEmpty=function(){return this.isCustomEmpty()&&this.isScaleEmpty()},ve.ui.MediaSizeWidget.prototype.isValid=function(){var a=this.sizeTypeSelectWidget.getSelectedItem()?this.sizeTypeSelectWidget.getSelectedItem().getData():"custom";return"custom"===a?this.dimensionsWidget.getDefaults()&&this.dimensionsWidget.isEmpty()?!0:$.isNumeric(this.dimensionsWidget.getWidth())&&$.isNumeric(this.dimensionsWidget.getHeight())?this.scalable.isCurrentDimensionsValid():!1:!0},ve.ui.WhitespacePreservingTextInputWidget=function(a){a=a||{},ve.ui.WhitespacePreservingTextInputWidget["super"].call(this,a),this.limit=a.limit,this.whitespace=["",""],this.setValueAndWhitespace(a.valueAndWhitespace||""),this.$element.addClass("ve-ui-WhitespacePreservingTextInputWidget")},OO.inheritClass(ve.ui.WhitespacePreservingTextInputWidget,OO.ui.TextInputWidget),ve.ui.WhitespacePreservingTextInputWidget.prototype.setValueAndWhitespace=function(a){var b,c;b=this.limit?a.slice(0,this.limit):a,this.whitespace[0]=b.match(/^\s*/)[0],a=a.slice(this.whitespace[0].length),c=this.limit?a.slice(-this.limit):a,this.whitespace[1]=c.match(/\s*$/)[0],a=a.slice(0,a.length-this.whitespace[1].length),this.setValue(a)},ve.ui.WhitespacePreservingTextInputWidget.prototype.setWhitespace=function(a){this.whitespace=a},ve.ui.WhitespacePreservingTextInputWidget.prototype.getValue=function(){return this.whitespace?this.whitespace[0]+this.value+this.whitespace[1]:this.value},ve.ui.WhitespacePreservingTextInputWidget.prototype.getInnerValue=function(){return this.value},ve.ui.AnnotationTool=function(a,b){ve.ui.Tool.call(this,a,b)},OO.inheritClass(ve.ui.AnnotationTool,ve.ui.Tool),ve.ui.AnnotationTool["static"].annotation={name:""},ve.ui.AnnotationTool["static"].deactivateOnSelect=!1,ve.ui.AnnotationTool.prototype.onUpdateState=function(a){ve.ui.Tool.prototype.onUpdateState.apply(this,arguments),this.setActive(a&&a.getAnnotations().hasAnnotationWithName(this.constructor["static"].annotation.name))},ve.ui.BoldAnnotationTool=function(a,b){ve.ui.AnnotationTool.call(this,a,b)},OO.inheritClass(ve.ui.BoldAnnotationTool,ve.ui.AnnotationTool),ve.ui.BoldAnnotationTool["static"].name="bold",ve.ui.BoldAnnotationTool["static"].group="textStyle",ve.ui.BoldAnnotationTool["static"].icon={"default":"bold-a",ar:"bold-arab-ain",be:"bold-cyrl-te",cs:"bold-b",da:"bold-f",de:"bold-f",en:"bold-b",es:"bold-n",eu:"bold-l",fa:"bold-arab-dad",fi:"bold-l",fr:"bold-g",gl:"bold-n",he:"bold-b",hu:"bold-f",hy:"bold-armn-to",it:"bold-g",ka:"bold-geor-man",ksh:"bold-f",ky:"bold-cyrl-zhe",ml:"bold-b",nl:"bold-v",nn:"bold-f",no:"bold-f",os:"bold-cyrl-be",pl:"bold-b",pt:"bold-n",ru:"bold-cyrl-zhe",sv:"bold-f"},ve.ui.BoldAnnotationTool["static"].title=OO.ui.deferMsg("visualeditor-annotationbutton-bold-tooltip"),ve.ui.BoldAnnotationTool["static"].annotation={name:"textStyle/bold"},ve.ui.BoldAnnotationTool["static"].commandName="bold",ve.ui.toolFactory.register(ve.ui.BoldAnnotationTool),ve.ui.ItalicAnnotationTool=function(a,b){ve.ui.AnnotationTool.call(this,a,b)},OO.inheritClass(ve.ui.ItalicAnnotationTool,ve.ui.AnnotationTool),ve.ui.ItalicAnnotationTool["static"].name="italic",ve.ui.ItalicAnnotationTool["static"].group="textStyle",ve.ui.ItalicAnnotationTool["static"].icon={"default":"italic-a",ar:"italic-arab-meem",be:"italic-cyrl-ka",cs:"italic-i",da:"italic-k",de:"italic-k",en:"italic-i",es:"italic-c",eu:"italic-e",fa:"italic-arab-keheh-jeem",fi:"italic-k",fr:"italic-i",gl:"italic-c",he:"italic-i",hu:"italic-d",hy:"italic-armn-sha",it:"italic-c",ka:"italic-geor-kan",ksh:"italic-s",ky:"italic-cyrl-ka",ml:"italic-i",nl:"italic-c",nn:"italic-k",no:"italic-k",os:"italic-cyrl-ka",pl:"italic-i",pt:"italic-i",ru:"italic-cyrl-ka",sv:"italic-k"},ve.ui.ItalicAnnotationTool["static"].title=OO.ui.deferMsg("visualeditor-annotationbutton-italic-tooltip"),ve.ui.ItalicAnnotationTool["static"].annotation={name:"textStyle/italic"},ve.ui.ItalicAnnotationTool["static"].commandName="italic",ve.ui.toolFactory.register(ve.ui.ItalicAnnotationTool),ve.ui.CodeAnnotationTool=function(a,b){ve.ui.AnnotationTool.call(this,a,b)},OO.inheritClass(ve.ui.CodeAnnotationTool,ve.ui.AnnotationTool),ve.ui.CodeAnnotationTool["static"].name="code",ve.ui.CodeAnnotationTool["static"].group="textStyle",ve.ui.CodeAnnotationTool["static"].icon="code",ve.ui.CodeAnnotationTool["static"].title=OO.ui.deferMsg("visualeditor-annotationbutton-code-tooltip"),ve.ui.CodeAnnotationTool["static"].annotation={name:"textStyle/code"},ve.ui.CodeAnnotationTool["static"].commandName="code",ve.ui.toolFactory.register(ve.ui.CodeAnnotationTool),ve.ui.StrikethroughAnnotationTool=function(a,b){ve.ui.AnnotationTool.call(this,a,b)},OO.inheritClass(ve.ui.StrikethroughAnnotationTool,ve.ui.AnnotationTool),ve.ui.StrikethroughAnnotationTool["static"].name="strikethrough",ve.ui.StrikethroughAnnotationTool["static"].group="textStyle",ve.ui.StrikethroughAnnotationTool["static"].icon={"default":"strikethrough-a",en:"strikethrough-s",fi:"strikethrough-y"},ve.ui.StrikethroughAnnotationTool["static"].title=OO.ui.deferMsg("visualeditor-annotationbutton-strikethrough-tooltip"),ve.ui.StrikethroughAnnotationTool["static"].annotation={name:"textStyle/strikethrough"},ve.ui.StrikethroughAnnotationTool["static"].commandName="strikethrough",ve.ui.toolFactory.register(ve.ui.StrikethroughAnnotationTool),ve.ui.UnderlineAnnotationTool=function(a,b){ve.ui.AnnotationTool.call(this,a,b)},OO.inheritClass(ve.ui.UnderlineAnnotationTool,ve.ui.AnnotationTool),ve.ui.UnderlineAnnotationTool["static"].name="underline",ve.ui.UnderlineAnnotationTool["static"].group="textStyle",ve.ui.UnderlineAnnotationTool["static"].icon={"default":"underline-a",en:"underline-u"},ve.ui.UnderlineAnnotationTool["static"].title=OO.ui.deferMsg("visualeditor-annotationbutton-underline-tooltip"),ve.ui.UnderlineAnnotationTool["static"].annotation={name:"textStyle/underline"},ve.ui.UnderlineAnnotationTool["static"].commandName="underline",ve.ui.toolFactory.register(ve.ui.UnderlineAnnotationTool),ve.ui.SuperscriptAnnotationTool=function(a,b){ve.ui.AnnotationTool.call(this,a,b)
},OO.inheritClass(ve.ui.SuperscriptAnnotationTool,ve.ui.AnnotationTool),ve.ui.SuperscriptAnnotationTool["static"].name="superscript",ve.ui.SuperscriptAnnotationTool["static"].group="textStyle",ve.ui.SuperscriptAnnotationTool["static"].icon="superscript",ve.ui.SuperscriptAnnotationTool["static"].title=OO.ui.deferMsg("visualeditor-annotationbutton-superscript-tooltip"),ve.ui.SuperscriptAnnotationTool["static"].annotation={name:"textStyle/superscript"},ve.ui.SuperscriptAnnotationTool["static"].commandName="superscript",ve.ui.toolFactory.register(ve.ui.SuperscriptAnnotationTool),ve.ui.SubscriptAnnotationTool=function(a,b){ve.ui.AnnotationTool.call(this,a,b)},OO.inheritClass(ve.ui.SubscriptAnnotationTool,ve.ui.AnnotationTool),ve.ui.SubscriptAnnotationTool["static"].name="subscript",ve.ui.SubscriptAnnotationTool["static"].group="textStyle",ve.ui.SubscriptAnnotationTool["static"].icon="subscript",ve.ui.SubscriptAnnotationTool["static"].title=OO.ui.deferMsg("visualeditor-annotationbutton-subscript-tooltip"),ve.ui.SubscriptAnnotationTool["static"].annotation={name:"textStyle/subscript"},ve.ui.SubscriptAnnotationTool["static"].commandName="subscript",ve.ui.toolFactory.register(ve.ui.SubscriptAnnotationTool),ve.ui.ClearAnnotationTool=function(a,b){ve.ui.Tool.call(this,a,b),this.setDisabled(!0)},OO.inheritClass(ve.ui.ClearAnnotationTool,ve.ui.Tool),ve.ui.ClearAnnotationTool["static"].name="clear",ve.ui.ClearAnnotationTool["static"].group="utility",ve.ui.ClearAnnotationTool["static"].icon="clear",ve.ui.ClearAnnotationTool["static"].title=OO.ui.deferMsg("visualeditor-clearbutton-tooltip"),ve.ui.ClearAnnotationTool["static"].commandName="clear",ve.ui.toolFactory.register(ve.ui.ClearAnnotationTool),ve.ui.DialogTool=function(a,b){ve.ui.Tool.call(this,a,b)},OO.inheritClass(ve.ui.DialogTool,ve.ui.Tool),ve.ui.DialogTool["static"].modelClasses=[],ve.ui.DialogTool["static"].isCompatibleWith=function(a){return ve.isInstanceOfAny(a,this.modelClasses)},ve.ui.DialogTool.prototype.onUpdateState=function(){ve.ui.Tool.prototype.onUpdateState.apply(this,arguments),this.setActive(!1)},ve.ui.CommandHelpDialogTool=function(a,b){ve.ui.DialogTool.call(this,a,b)},OO.inheritClass(ve.ui.CommandHelpDialogTool,ve.ui.DialogTool),ve.ui.CommandHelpDialogTool["static"].name="commandHelp",ve.ui.CommandHelpDialogTool["static"].group="dialog",ve.ui.CommandHelpDialogTool["static"].icon="help",ve.ui.CommandHelpDialogTool["static"].title=OO.ui.deferMsg("visualeditor-dialog-command-help-title"),ve.ui.CommandHelpDialogTool["static"].autoAddToCatchall=!1,ve.ui.CommandHelpDialogTool["static"].autoAddToGroup=!1,ve.ui.CommandHelpDialogTool["static"].commandName="commandHelp",ve.ui.toolFactory.register(ve.ui.CommandHelpDialogTool),ve.ui.FindAndReplaceTool=function(a,b){ve.ui.Tool.call(this,a,b)},OO.inheritClass(ve.ui.FindAndReplaceTool,ve.ui.Tool),ve.ui.FindAndReplaceTool["static"].name="findAndReplace",ve.ui.FindAndReplaceTool["static"].group="dialog",ve.ui.FindAndReplaceTool["static"].icon="find",ve.ui.FindAndReplaceTool["static"].title=OO.ui.deferMsg("visualeditor-find-and-replace-title"),ve.ui.FindAndReplaceTool["static"].autoAddToCatchall=!1,ve.ui.FindAndReplaceTool["static"].autoAddToGroup=!1,ve.ui.FindAndReplaceTool["static"].commandName="findAndReplace",ve.ui.toolFactory.register(ve.ui.FindAndReplaceTool),ve.ui.FormatTool=function(a,b){ve.ui.Tool.call(this,a,b),this.convertible=!1},OO.inheritClass(ve.ui.FormatTool,ve.ui.Tool),ve.ui.FormatTool["static"].format=null,ve.ui.FormatTool.prototype.onUpdateState=function(a){if(ve.ui.FormatTool["super"].prototype.onUpdateState.apply(this,arguments),this.isDisabled())return this.toggle(!1),void this.setActive(!1);this.toggle(!0);var b,c,d,e,f,g=a.getSelection(),h=this.constructor["static"].format;if(g instanceof ve.dm.LinearSelection){for(d=a.getSelectedLeafNodes(),e=!!d.length,b=0,c=d.length;c>b;b++)if(!d[b].hasMatchingAncestor(h.type,h.attributes)){e=!1;break}}else if(g instanceof ve.dm.TableSelection)for(f=g.getMatrixCells(),e=!0,b=f.length-1;b>=0;b--)if(!f[b].node.matches(h.type,h.attributes)){e=!1;break}this.convertible=!e,this.setActive(e)},ve.ui.ParagraphFormatTool=function(a,b){ve.ui.FormatTool.call(this,a,b)},OO.inheritClass(ve.ui.ParagraphFormatTool,ve.ui.FormatTool),ve.ui.ParagraphFormatTool["static"].name="paragraph",ve.ui.ParagraphFormatTool["static"].group="format",ve.ui.ParagraphFormatTool["static"].title=OO.ui.deferMsg("visualeditor-formatdropdown-format-paragraph"),ve.ui.ParagraphFormatTool["static"].format={type:"paragraph"},ve.ui.ParagraphFormatTool["static"].commandName="paragraph",ve.ui.toolFactory.register(ve.ui.ParagraphFormatTool),ve.ui.Heading1FormatTool=function(a,b){ve.ui.FormatTool.call(this,a,b)},OO.inheritClass(ve.ui.Heading1FormatTool,ve.ui.FormatTool),ve.ui.Heading1FormatTool["static"].name="heading1",ve.ui.Heading1FormatTool["static"].group="format",ve.ui.Heading1FormatTool["static"].title=OO.ui.deferMsg("visualeditor-formatdropdown-format-heading1"),ve.ui.Heading1FormatTool["static"].format={type:"heading",attributes:{level:1}},ve.ui.Heading1FormatTool["static"].commandName="heading1",ve.ui.toolFactory.register(ve.ui.Heading1FormatTool),ve.ui.Heading2FormatTool=function(a,b){ve.ui.FormatTool.call(this,a,b)},OO.inheritClass(ve.ui.Heading2FormatTool,ve.ui.FormatTool),ve.ui.Heading2FormatTool["static"].name="heading2",ve.ui.Heading2FormatTool["static"].group="format",ve.ui.Heading2FormatTool["static"].title=OO.ui.deferMsg("visualeditor-formatdropdown-format-heading2"),ve.ui.Heading2FormatTool["static"].format={type:"heading",attributes:{level:2}},ve.ui.Heading2FormatTool["static"].commandName="heading2",ve.ui.toolFactory.register(ve.ui.Heading2FormatTool),ve.ui.Heading3FormatTool=function(a,b){ve.ui.FormatTool.call(this,a,b)},OO.inheritClass(ve.ui.Heading3FormatTool,ve.ui.FormatTool),ve.ui.Heading3FormatTool["static"].name="heading3",ve.ui.Heading3FormatTool["static"].group="format",ve.ui.Heading3FormatTool["static"].title=OO.ui.deferMsg("visualeditor-formatdropdown-format-heading3"),ve.ui.Heading3FormatTool["static"].format={type:"heading",attributes:{level:3}},ve.ui.Heading3FormatTool["static"].commandName="heading3",ve.ui.toolFactory.register(ve.ui.Heading3FormatTool),ve.ui.Heading4FormatTool=function(a,b){ve.ui.FormatTool.call(this,a,b)},OO.inheritClass(ve.ui.Heading4FormatTool,ve.ui.FormatTool),ve.ui.Heading4FormatTool["static"].name="heading4",ve.ui.Heading4FormatTool["static"].group="format",ve.ui.Heading4FormatTool["static"].title=OO.ui.deferMsg("visualeditor-formatdropdown-format-heading4"),ve.ui.Heading4FormatTool["static"].format={type:"heading",attributes:{level:4}},ve.ui.Heading4FormatTool["static"].commandName="heading4",ve.ui.toolFactory.register(ve.ui.Heading4FormatTool),ve.ui.Heading5FormatTool=function(a,b){ve.ui.FormatTool.call(this,a,b)},OO.inheritClass(ve.ui.Heading5FormatTool,ve.ui.FormatTool),ve.ui.Heading5FormatTool["static"].name="heading5",ve.ui.Heading5FormatTool["static"].group="format",ve.ui.Heading5FormatTool["static"].title=OO.ui.deferMsg("visualeditor-formatdropdown-format-heading5"),ve.ui.Heading5FormatTool["static"].format={type:"heading",attributes:{level:5}},ve.ui.Heading5FormatTool["static"].commandName="heading5",ve.ui.toolFactory.register(ve.ui.Heading5FormatTool),ve.ui.Heading6FormatTool=function(a,b){ve.ui.FormatTool.call(this,a,b)},OO.inheritClass(ve.ui.Heading6FormatTool,ve.ui.FormatTool),ve.ui.Heading6FormatTool["static"].name="heading6",ve.ui.Heading6FormatTool["static"].group="format",ve.ui.Heading6FormatTool["static"].title=OO.ui.deferMsg("visualeditor-formatdropdown-format-heading6"),ve.ui.Heading6FormatTool["static"].format={type:"heading",attributes:{level:6}},ve.ui.Heading6FormatTool["static"].commandName="heading6",ve.ui.toolFactory.register(ve.ui.Heading6FormatTool),ve.ui.PreformattedFormatTool=function(a,b){ve.ui.FormatTool.call(this,a,b)},OO.inheritClass(ve.ui.PreformattedFormatTool,ve.ui.FormatTool),ve.ui.PreformattedFormatTool["static"].name="preformatted",ve.ui.PreformattedFormatTool["static"].group="format",ve.ui.PreformattedFormatTool["static"].title=OO.ui.deferMsg("visualeditor-formatdropdown-format-preformatted"),ve.ui.PreformattedFormatTool["static"].format={type:"preformatted"},ve.ui.PreformattedFormatTool["static"].commandName="preformatted",ve.ui.toolFactory.register(ve.ui.PreformattedFormatTool),ve.ui.BlockquoteFormatTool=function(a,b){ve.ui.FormatTool.call(this,a,b)},OO.inheritClass(ve.ui.BlockquoteFormatTool,ve.ui.FormatTool),ve.ui.BlockquoteFormatTool["static"].name="blockquote",ve.ui.BlockquoteFormatTool["static"].group="format",ve.ui.BlockquoteFormatTool["static"].title=OO.ui.deferMsg("visualeditor-formatdropdown-format-blockquote"),ve.ui.BlockquoteFormatTool["static"].format={type:"blockquote"},ve.ui.BlockquoteFormatTool["static"].commandName="blockquote",ve.ui.toolFactory.register(ve.ui.BlockquoteFormatTool),ve.ui.TableCellHeaderFormatTool=function(a,b){ve.ui.FormatTool.call(this,a,b)},OO.inheritClass(ve.ui.TableCellHeaderFormatTool,ve.ui.FormatTool),ve.ui.TableCellHeaderFormatTool["static"].name="tableCellHeader",ve.ui.TableCellHeaderFormatTool["static"].group="format",ve.ui.TableCellHeaderFormatTool["static"].title=OO.ui.deferMsg("visualeditor-table-format-header"),ve.ui.TableCellHeaderFormatTool["static"].format={type:"tableCell",attributes:{style:"header"}},ve.ui.TableCellHeaderFormatTool["static"].commandName="tableCellHeader",ve.ui.toolFactory.register(ve.ui.TableCellHeaderFormatTool),ve.ui.TableCellDataFormatTool=function(a,b){ve.ui.FormatTool.call(this,a,b)},OO.inheritClass(ve.ui.TableCellDataFormatTool,ve.ui.FormatTool),ve.ui.TableCellDataFormatTool["static"].name="tableCellData",ve.ui.TableCellDataFormatTool["static"].group="format",ve.ui.TableCellDataFormatTool["static"].title=OO.ui.deferMsg("visualeditor-table-format-data"),ve.ui.TableCellDataFormatTool["static"].format={type:"tableCell",attributes:{style:"data"}},ve.ui.TableCellDataFormatTool["static"].commandName="tableCellData",ve.ui.toolFactory.register(ve.ui.TableCellDataFormatTool),ve.ui.HistoryTool=function(a,b){ve.ui.Tool.call(this,a,b),this.toolbar.getSurface().getModel().connect(this,{history:"onHistory"}),this.setDisabled(!0)},OO.inheritClass(ve.ui.HistoryTool,ve.ui.Tool),ve.ui.HistoryTool.prototype.onHistory=function(){this.onUpdateState(this.toolbar.getSurface().getModel().getFragment())},ve.ui.HistoryTool.prototype.destroy=function(){this.toolbar.getSurface().getModel().disconnect(this),ve.ui.HistoryTool["super"].prototype.destroy.call(this)},ve.ui.UndoHistoryTool=function(a,b){ve.ui.HistoryTool.call(this,a,b)},OO.inheritClass(ve.ui.UndoHistoryTool,ve.ui.HistoryTool),ve.ui.UndoHistoryTool["static"].name="undo",ve.ui.UndoHistoryTool["static"].group="history",ve.ui.UndoHistoryTool["static"].icon="undo",ve.ui.UndoHistoryTool["static"].title=OO.ui.deferMsg("visualeditor-historybutton-undo-tooltip"),ve.ui.UndoHistoryTool["static"].commandName="undo",ve.ui.toolFactory.register(ve.ui.UndoHistoryTool),ve.ui.RedoHistoryTool=function(a,b){ve.ui.HistoryTool.call(this,a,b)},OO.inheritClass(ve.ui.RedoHistoryTool,ve.ui.HistoryTool),ve.ui.RedoHistoryTool["static"].name="redo",ve.ui.RedoHistoryTool["static"].group="history",ve.ui.RedoHistoryTool["static"].icon="redo",ve.ui.RedoHistoryTool["static"].title=OO.ui.deferMsg("visualeditor-historybutton-redo-tooltip"),ve.ui.RedoHistoryTool["static"].commandName="redo",ve.ui.toolFactory.register(ve.ui.RedoHistoryTool),ve.ui.IndentationTool=function(a,b){ve.ui.Tool.call(this,a,b)},OO.inheritClass(ve.ui.IndentationTool,ve.ui.Tool),ve.ui.IncreaseIndentationTool=function(a,b){ve.ui.IndentationTool.call(this,a,b)},OO.inheritClass(ve.ui.IncreaseIndentationTool,ve.ui.IndentationTool),ve.ui.IncreaseIndentationTool["static"].name="indent",ve.ui.IncreaseIndentationTool["static"].group="structure",ve.ui.IncreaseIndentationTool["static"].icon="indent-list",ve.ui.IncreaseIndentationTool["static"].title=OO.ui.deferMsg("visualeditor-indentationbutton-indent-tooltip"),ve.ui.IncreaseIndentationTool["static"].commandName="indent",ve.ui.toolFactory.register(ve.ui.IncreaseIndentationTool),ve.ui.DecreaseIndentationTool=function(a,b){ve.ui.IndentationTool.call(this,a,b)},OO.inheritClass(ve.ui.DecreaseIndentationTool,ve.ui.IndentationTool),ve.ui.DecreaseIndentationTool["static"].name="outdent",ve.ui.DecreaseIndentationTool["static"].group="structure",ve.ui.DecreaseIndentationTool["static"].icon="outdent-list",ve.ui.DecreaseIndentationTool["static"].title=OO.ui.deferMsg("visualeditor-indentationbutton-outdent-tooltip"),ve.ui.DecreaseIndentationTool["static"].commandName="outdent",ve.ui.toolFactory.register(ve.ui.DecreaseIndentationTool),ve.ui.InspectorTool=function(a,b){ve.ui.Tool.call(this,a,b)},OO.inheritClass(ve.ui.InspectorTool,ve.ui.Tool),ve.ui.InspectorTool["static"].modelClasses=[],ve.ui.InspectorTool["static"].deactivateOnSelect=!1,ve.ui.InspectorTool["static"].isCompatibleWith=function(a){return ve.isInstanceOfAny(a,this.modelClasses)},ve.ui.InspectorTool.prototype.onUpdateState=function(a){var b,c,d,e=!1;for(ve.ui.Tool.prototype.onUpdateState.apply(this,arguments),d=a?a.getSelectedModels():[],b=0,c=d.length;c>b;b++)if(this.constructor["static"].isCompatibleWith(d[b])){e=!0;break}this.setActive(e)},ve.ui.LinkInspectorTool=function(a,b){ve.ui.InspectorTool.call(this,a,b)},OO.inheritClass(ve.ui.LinkInspectorTool,ve.ui.InspectorTool),ve.ui.LinkInspectorTool["static"].name="link",ve.ui.LinkInspectorTool["static"].group="meta",ve.ui.LinkInspectorTool["static"].icon="link",ve.ui.LinkInspectorTool["static"].title=OO.ui.deferMsg("visualeditor-annotationbutton-link-tooltip"),ve.ui.LinkInspectorTool["static"].modelClasses=[ve.dm.LinkAnnotation],ve.ui.LinkInspectorTool["static"].commandName="link",ve.ui.toolFactory.register(ve.ui.LinkInspectorTool),ve.ui.InsertCharacterInspectorTool=function(a,b){ve.ui.InspectorTool.call(this,a,b)},OO.inheritClass(ve.ui.InsertCharacterInspectorTool,ve.ui.InspectorTool),ve.ui.InsertCharacterInspectorTool["static"].name="specialcharacter",ve.ui.InsertCharacterInspectorTool["static"].group="insert",ve.ui.InsertCharacterInspectorTool["static"].icon="special-character",ve.ui.InsertCharacterInspectorTool["static"].title=OO.ui.deferMsg("visualeditor-specialcharacter-button-tooltip"),ve.ui.InsertCharacterInspectorTool["static"].commandName="specialcharacter",ve.ui.InsertCharacterInspectorTool["static"].deactivateOnSelect=!0,ve.ui.toolFactory.register(ve.ui.InsertCharacterInspectorTool),ve.ui.CommentInspectorTool=function(a,b){ve.ui.InspectorTool.call(this,a,b)},OO.inheritClass(ve.ui.CommentInspectorTool,ve.ui.InspectorTool),ve.ui.CommentInspectorTool["static"].name="comment",ve.ui.CommentInspectorTool["static"].group="meta",ve.ui.CommentInspectorTool["static"].icon="comment",ve.ui.CommentInspectorTool["static"].title=OO.ui.deferMsg("visualeditor-commentinspector-tooltip"),ve.ui.CommentInspectorTool["static"].modelClasses=[ve.dm.CommentNode],ve.ui.CommentInspectorTool["static"].commandName="comment",ve.ui.CommentInspectorTool["static"].deactivateOnSelect=!0,ve.ui.toolFactory.register(ve.ui.CommentInspectorTool),ve.ui.LanguageInspectorTool=function(a,b){ve.ui.InspectorTool.call(this,a,b)},OO.inheritClass(ve.ui.LanguageInspectorTool,ve.ui.InspectorTool),ve.ui.LanguageInspectorTool["static"].name="language",ve.ui.LanguageInspectorTool["static"].group="meta",ve.ui.LanguageInspectorTool["static"].icon="language",ve.ui.LanguageInspectorTool["static"].title=OO.ui.deferMsg("visualeditor-annotationbutton-language-tooltip"),ve.ui.LanguageInspectorTool["static"].modelClasses=[ve.dm.LanguageAnnotation],ve.ui.LanguageInspectorTool["static"].commandName="language",ve.ui.toolFactory.register(ve.ui.LanguageInspectorTool),ve.ui.ListTool=function(a,b){ve.ui.Tool.call(this,a,b),this.method=null},OO.inheritClass(ve.ui.ListTool,ve.ui.Tool),ve.ui.ListTool["static"].style="",ve.ui.ListTool["static"].deactivateOnSelect=!1,ve.ui.ListTool.prototype.onUpdateState=function(a){ve.ui.Tool.prototype.onUpdateState.apply(this,arguments);var b,c,d=a?a.getSelectedLeafNodes():[],e=this.constructor["static"].style,f=!!d.length;for(b=0,c=d.length;c>b;b++)if(!d[b].hasMatchingAncestor("list",{style:e})){f=!1;break}this.setActive(f)},ve.ui.BulletListTool=function(a,b){ve.ui.ListTool.call(this,a,b)},OO.inheritClass(ve.ui.BulletListTool,ve.ui.ListTool),ve.ui.BulletListTool["static"].name="bullet",ve.ui.BulletListTool["static"].group="structure",ve.ui.BulletListTool["static"].icon="bullet-list",ve.ui.BulletListTool["static"].title=OO.ui.deferMsg("visualeditor-listbutton-bullet-tooltip"),ve.ui.BulletListTool["static"].style="bullet",ve.ui.BulletListTool["static"].commandName="bullet",ve.ui.toolFactory.register(ve.ui.BulletListTool),ve.ui.NumberListTool=function(a,b){ve.ui.ListTool.call(this,a,b)},OO.inheritClass(ve.ui.NumberListTool,ve.ui.ListTool),ve.ui.NumberListTool["static"].name="number",ve.ui.NumberListTool["static"].group="structure",ve.ui.NumberListTool["static"].icon="number-list",ve.ui.NumberListTool["static"].title=OO.ui.deferMsg("visualeditor-listbutton-number-tooltip"),ve.ui.NumberListTool["static"].style="number",ve.ui.NumberListTool["static"].commandName="number",ve.ui.toolFactory.register(ve.ui.NumberListTool),ve.ui.InsertTableTool=function(a,b){ve.ui.Tool.call(this,a,b)},OO.inheritClass(ve.ui.InsertTableTool,ve.ui.Tool),ve.ui.InsertTableTool["static"].name="insertTable",ve.ui.InsertTableTool["static"].group="insert",ve.ui.InsertTableTool["static"].icon="table-insert",ve.ui.InsertTableTool["static"].title=OO.ui.deferMsg("visualeditor-table-insert-table"),ve.ui.InsertTableTool["static"].commandName="insertTable",ve.ui.toolFactory.register(ve.ui.InsertTableTool),ve.ui.DeleteTableTool=function(a,b){ve.ui.Tool.call(this,a,b)},OO.inheritClass(ve.ui.DeleteTableTool,ve.ui.Tool),ve.ui.DeleteTableTool["static"].name="deleteTable",ve.ui.DeleteTableTool["static"].group="table",ve.ui.DeleteTableTool["static"].autoAddToCatchall=!1,ve.ui.DeleteTableTool["static"].icon="remove",ve.ui.DeleteTableTool["static"].title=OO.ui.deferMsg("visualeditor-table-delete-table"),ve.ui.DeleteTableTool["static"].commandName="deleteTable",ve.ui.toolFactory.register(ve.ui.DeleteTableTool),ve.ui.InsertRowBeforeTool=function(a,b){ve.ui.Tool.call(this,a,b)},OO.inheritClass(ve.ui.InsertRowBeforeTool,ve.ui.Tool),ve.ui.InsertRowBeforeTool["static"].name="insertRowBefore",ve.ui.InsertRowBeforeTool["static"].group="table-row",ve.ui.InsertRowBeforeTool["static"].autoAddToCatchall=!1,ve.ui.InsertRowBeforeTool["static"].icon="table-insert-row-before",ve.ui.InsertRowBeforeTool["static"].title=OO.ui.deferMsg("visualeditor-table-insert-row-before"),ve.ui.InsertRowBeforeTool["static"].commandName="insertRowBefore",ve.ui.toolFactory.register(ve.ui.InsertRowBeforeTool),ve.ui.InsertRowAfterTool=function(a,b){ve.ui.Tool.call(this,a,b)},OO.inheritClass(ve.ui.InsertRowAfterTool,ve.ui.Tool),ve.ui.InsertRowAfterTool["static"].name="insertRowAfter",ve.ui.InsertRowAfterTool["static"].group="table-row",ve.ui.InsertRowAfterTool["static"].autoAddToCatchall=!1,ve.ui.InsertRowAfterTool["static"].icon="table-insert-row-after",ve.ui.InsertRowAfterTool["static"].title=OO.ui.deferMsg("visualeditor-table-insert-row-after"),ve.ui.InsertRowAfterTool["static"].commandName="insertRowAfter",ve.ui.toolFactory.register(ve.ui.InsertRowAfterTool),ve.ui.DeleteRowTool=function(a,b){ve.ui.Tool.call(this,a,b)},OO.inheritClass(ve.ui.DeleteRowTool,ve.ui.Tool),ve.ui.DeleteRowTool["static"].name="deleteRow",ve.ui.DeleteRowTool["static"].group="table-row",ve.ui.DeleteRowTool["static"].autoAddToCatchall=!1,ve.ui.DeleteRowTool["static"].icon="remove",ve.ui.DeleteRowTool["static"].title=OO.ui.deferMsg("visualeditor-table-delete-row"),ve.ui.DeleteRowTool["static"].commandName="deleteRow",ve.ui.toolFactory.register(ve.ui.DeleteRowTool),ve.ui.InsertColumnBeforeTool=function(a,b){ve.ui.Tool.call(this,a,b)},OO.inheritClass(ve.ui.InsertColumnBeforeTool,ve.ui.Tool),ve.ui.InsertColumnBeforeTool["static"].name="insertColumnBefore",ve.ui.InsertColumnBeforeTool["static"].group="table-col",ve.ui.InsertColumnBeforeTool["static"].autoAddToCatchall=!1,ve.ui.InsertColumnBeforeTool["static"].icon="table-insert-column-before",ve.ui.InsertColumnBeforeTool["static"].title=OO.ui.deferMsg("visualeditor-table-insert-col-before"),ve.ui.InsertColumnBeforeTool["static"].commandName="insertColumnBefore",ve.ui.toolFactory.register(ve.ui.InsertColumnBeforeTool),ve.ui.InsertColumnAfterTool=function(a,b){ve.ui.Tool.call(this,a,b)},OO.inheritClass(ve.ui.InsertColumnAfterTool,ve.ui.Tool),ve.ui.InsertColumnAfterTool["static"].name="insertColumnAfter",ve.ui.InsertColumnAfterTool["static"].group="table-col",ve.ui.InsertColumnAfterTool["static"].autoAddToCatchall=!1,ve.ui.InsertColumnAfterTool["static"].icon="table-insert-column-after",ve.ui.InsertColumnAfterTool["static"].title=OO.ui.deferMsg("visualeditor-table-insert-col-after"),ve.ui.InsertColumnAfterTool["static"].commandName="insertColumnAfter",ve.ui.toolFactory.register(ve.ui.InsertColumnAfterTool),ve.ui.DeleteColumnTool=function(a,b){ve.ui.Tool.call(this,a,b)},OO.inheritClass(ve.ui.DeleteColumnTool,ve.ui.Tool),ve.ui.DeleteColumnTool["static"].name="deleteColumn",ve.ui.DeleteColumnTool["static"].group="table-col",ve.ui.DeleteColumnTool["static"].autoAddToCatchall=!1,ve.ui.DeleteColumnTool["static"].icon="remove",ve.ui.DeleteColumnTool["static"].title=OO.ui.deferMsg("visualeditor-table-delete-col"),ve.ui.DeleteColumnTool["static"].commandName="deleteColumn",ve.ui.toolFactory.register(ve.ui.DeleteColumnTool),ve.ui.MergeCellsTool=function(a,b){ve.ui.Tool.call(this,a,b)},OO.inheritClass(ve.ui.MergeCellsTool,ve.ui.Tool),ve.ui.MergeCellsTool["static"].name="mergeCells",ve.ui.MergeCellsTool["static"].group="table",ve.ui.MergeCellsTool["static"].autoAddToCatchall=!1,ve.ui.MergeCellsTool["static"].icon="table-merge-cells",ve.ui.MergeCellsTool["static"].title=OO.ui.deferMsg("visualeditor-table-merge-cells"),ve.ui.MergeCellsTool["static"].commandName="mergeCells",ve.ui.MergeCellsTool["static"].deactivateOnSelect=!1,ve.ui.MergeCellsTool.prototype.onUpdateState=function(a){return ve.ui.MergeCellsTool["super"].prototype.onUpdateState.apply(this,arguments),this.isDisabled()?void this.setActive(!1):void this.setActive(a.getSelection().isSingleCell())},ve.ui.toolFactory.register(ve.ui.MergeCellsTool),ve.ui.TableCaptionTool=function(a,b){ve.ui.Tool.call(this,a,b)},OO.inheritClass(ve.ui.TableCaptionTool,ve.ui.Tool),ve.ui.TableCaptionTool["static"].name="tableCaption",ve.ui.TableCaptionTool["static"].group="table",ve.ui.TableCaptionTool["static"].autoAddToCatchall=!1,ve.ui.TableCaptionTool["static"].icon="table-caption",ve.ui.TableCaptionTool["static"].title=OO.ui.deferMsg("visualeditor-table-caption"),ve.ui.TableCaptionTool["static"].commandName="tableCaption",ve.ui.TableCaptionTool["static"].deactivateOnSelect=!1,ve.ui.TableCaptionTool.prototype.onUpdateState=function(a){if(ve.ui.TableCaptionTool["super"].prototype.onUpdateState.apply(this,arguments),this.isDisabled())return void this.setActive(!1);var b,c=a.getSelection();b=c instanceof ve.dm.TableSelection?!!c.getTableNode().getCaptionNode():!0,this.setActive(b)},ve.ui.toolFactory.register(ve.ui.TableCaptionTool),ve.ui.FragmentInspector=function(a){ve.ui.FragmentInspector["super"].call(this,a),this.fragment=null},OO.inheritClass(ve.ui.FragmentInspector,OO.ui.ProcessDialog),ve.ui.FragmentInspector["static"].actions=ve.ui.FragmentInspector["super"]["static"].actions.concat([{action:"done",label:OO.ui.deferMsg("visualeditor-dialog-action-done"),flags:["progressive","primary"]}]),ve.ui.FragmentInspector.prototype.onFormSubmit=function(){this.close({action:"done"})},ve.ui.FragmentInspector.prototype.getFragment=function(){return this.fragment},ve.ui.FragmentInspector.prototype.initialize=function(){ve.ui.FragmentInspector["super"].prototype.initialize.call(this),this.container=new OO.ui.PanelLayout({$:this.$,scrollable:!0,classes:["ve-ui-fragmentInspector-container"]}),this.form=new OO.ui.FormLayout({$:this.$,classes:["ve-ui-fragmentInspector-form"]}),this.form.connect(this,{submit:"onFormSubmit"}),this.$element.addClass("ve-ui-fragmentInspector"),this.$content.addClass("ve-ui-fragmentInspector-content"),this.container.$element.append(this.form.$element,this.$otherActions),this.$body.append(this.container.$element)},ve.ui.FragmentInspector.prototype.getActionProcess=function(a){return"done"===a?new OO.ui.Process(function(){this.close({action:"done"})},this):ve.ui.FragmentInspector["super"].prototype.getActionProcess.call(this,a)},ve.ui.FragmentInspector.prototype.getSetupProcess=function(a){return a=a||{},ve.ui.FragmentInspector["super"].prototype.getSetupProcess.call(this,a).first(function(){if(!(a.fragment instanceof ve.dm.SurfaceFragment))throw new Error("Cannot open inspector: opening data must contain a fragment");this.fragment=a.fragment},this)},ve.ui.FragmentInspector.prototype.getTeardownProcess=function(a){return ve.ui.FragmentDialog["super"].prototype.getTeardownProcess.apply(this,a).next(function(){this.fragment=null},this)},ve.ui.FragmentInspector.prototype.getReadyProcess=function(a){return ve.ui.FragmentInspector["super"].prototype.getReadyProcess.call(this,a).first(0)},ve.ui.FragmentInspector.prototype.getBodyHeight=function(){return Math.ceil(this.container.$element[0].scrollHeight)+1},ve.ui.AnnotationInspector=function(a){ve.ui.FragmentInspector.call(this,a),this.previousSelection=null,this.initialSelection=null,this.initialAnnotation=null,this.initialAnnotationIsCovering=!1},OO.inheritClass(ve.ui.AnnotationInspector,ve.ui.FragmentInspector),ve.ui.AnnotationInspector["static"].modelClasses=[],ve.ui.AnnotationInspector["static"].actions=[{action:"remove",label:OO.ui.deferMsg("visualeditor-inspector-remove-tooltip"),flags:"destructive"}].concat(ve.ui.FragmentInspector["static"].actions),ve.ui.AnnotationInspector.prototype.shouldRemoveAnnotation=function(){return!1},ve.ui.AnnotationInspector.prototype.getInsertionData=function(){return this.getInsertionText().split("")},ve.ui.AnnotationInspector.prototype.getInsertionText=function(){return""},ve.ui.AnnotationInspector.prototype.getAnnotation=function(){throw new Error("ve.ui.AnnotationInspector.getAnnotation not implemented in subclass")},ve.ui.AnnotationInspector.prototype.getAnnotationFromFragment=function(){throw new Error("ve.ui.AnnotationInspector.getAnnotationFromFragment not implemented in subclass")},ve.ui.AnnotationInspector.prototype.getMatchingAnnotations=function(a,b){var c=this.constructor["static"].modelClasses;return a.getAnnotations(b).filter(function(a){return ve.isInstanceOfAny(a,c)})},ve.ui.AnnotationInspector.prototype.getActionProcess=function(a){return"remove"===a?new OO.ui.Process(function(){this.close({action:"remove"})},this):ve.ui.AnnotationInspector["super"].prototype.getActionProcess.call(this,a)},ve.ui.AnnotationInspector.prototype.getSetupProcess=function(a){return ve.ui.AnnotationInspector["super"].prototype.getSetupProcess.call(this,a).next(function(){var a,b,c,d=this.getFragment(),e=d.getSurface(),f=this.getMatchingAnnotations(d,!0).get(0);this.previousSelection=d.getSelection(),e.pushStaging(),this.previousSelection instanceof ve.dm.LinearSelection&&!f?(d.getSelection().isCollapsed()&&d.getDocument().data.isContentOffset(d.getSelection().getRange().start)?(a=d.expandLinearSelection("word"),d=a):(b=d.trimLinearSelection(),d=b),d.getSelection().isCollapsed()||(f=this.getAnnotationFromFragment(d),f&&d.annotateContent("set",f))):(a=d.expandLinearSelection("annotation",f),d=a),d.select(),this.initialSelection=d.getSelection(),this.initialAnnotation=this.getMatchingAnnotations(d,!0).get(0),c=this.getMatchingAnnotations(d).get(0),this.initialAnnotation?c&&c.compareTo(this.initialAnnotation)&&(this.initialAnnotationIsCovering=!0):this.initialAnnotation=this.getAnnotationFromFragment(d)},this)},ve.ui.AnnotationInspector.prototype.getTeardownProcess=function(a){return a=a||{},ve.ui.AnnotationInspector["super"].prototype.getTeardownProcess.call(this,a).first(function(){var b,c,d,e,f=!1,g=!1,h=!1,i=this.getAnnotation(),j=this.shouldRemoveAnnotation()||"remove"===a.action,k=this.getFragment().getSurface(),l=k.getFragment(this.initialSelection,!1),m=this.getFragment().getSelection();if(m instanceof ve.dm.LinearSelection){if(j||(this.initialSelection.isCollapsed()&&(g=!0),i&&(this.initialAnnotationIsCovering&&this.initialAnnotation&&this.initialAnnotation.compareTo(i)||(h=!0))),h?k.popStaging():k.applyStaging(),g&&(e=this.getInsertionData(),e.length&&(l.insertContent(e,!0),l.adjustLinearSelection(-e.length,0),this.previousSelection=new ve.dm.LinearSelection(l.getDocument(),new ve.Range(this.initialSelection.getRange().start+e.length)))),j||h)for(d=this.getMatchingAnnotations(l,!0).get(),b=0,c=d.length;c>b;b++)l.annotateContent("clear",d[b]);h&&(l.getSelection().isCollapsed()?f=!0:l.annotateContent("set",i)),(!a.action||g)&&(m=this.previousSelection),a.action&&k.setSelection(m),f&&k.addInsertionAnnotations(i)}},this).next(function(){this.previousSelection=null,this.initialSelection=null,this.initialAnnotation=null,this.initialAnnotationIsCovering=!1},this)},ve.ui.NodeInspector=function(a){ve.ui.FragmentInspector.call(this,a),this.selectedNode=null},OO.inheritClass(ve.ui.NodeInspector,ve.ui.FragmentInspector),ve.ui.NodeInspector["static"].modelClasses=[],ve.ui.NodeInspector.prototype.getSelectedNode=function(){var a,b,c=this.constructor["static"].modelClasses,d=this.getFragment().getSelectedNode();for(a=0,b=c.length;b>a;a++)if(d instanceof c[a])return d;return null},ve.ui.NodeInspector.prototype.initialize=function(a){ve.ui.NodeInspector["super"].prototype.initialize.call(this,a),this.$content.addClass("ve-ui-nodeInspector")},ve.ui.NodeInspector.prototype.getSetupProcess=function(a){return ve.ui.NodeInspector["super"].prototype.getSetupProcess.call(this,a).next(function(){this.selectedNode=this.getSelectedNode(a)},this)},ve.ui.NodeInspector.prototype.getTeardownProcess=function(a){return ve.ui.NodeInspector["super"].prototype.getTeardownProcess.call(this,a).next(function(){this.selectedNode=null},this)},ve.ui.LinkInspector=function(a){ve.ui.AnnotationInspector.call(this,a)},OO.inheritClass(ve.ui.LinkInspector,ve.ui.AnnotationInspector),ve.ui.LinkInspector["static"].name="link",ve.ui.LinkInspector["static"].title=OO.ui.deferMsg("visualeditor-linkinspector-title"),ve.ui.LinkInspector["static"].linkTargetInputWidget=ve.ui.LinkTargetInputWidget,ve.ui.LinkInspector["static"].modelClasses=[ve.dm.LinkAnnotation],ve.ui.LinkInspector["static"].actions=ve.ui.LinkInspector["super"]["static"].actions.concat([{action:"open",label:OO.ui.deferMsg("visualeditor-linkinspector-open")}]),ve.ui.LinkInspector.prototype.onTargetInputChange=function(){var a=this.targetInput.getHref(),b=this;this.targetInput.isValid().done(function(c){b.actions.forEach({actions:"open"},function(b){b.setHref(a).setTarget("_blank").setDisabled(!c),b.$element.hide().fadeIn(0)})})},ve.ui.LinkInspector.prototype.shouldRemoveAnnotation=function(){return!this.targetInput.getValue().length},ve.ui.LinkInspector.prototype.getInsertionText=function(){return this.targetInput.getValue()},ve.ui.LinkInspector.prototype.getAnnotation=function(){return this.targetInput.getAnnotation()},ve.ui.LinkInspector.prototype.getAnnotationFromFragment=function(a){return new ve.dm.LinkAnnotation({type:"link",attributes:{href:a.getText()}})},ve.ui.LinkInspector.prototype.initialize=function(){var a=this.manager.getOverlay();ve.ui.LinkInspector["super"].prototype.initialize.call(this),this.targetInput=new this.constructor["static"].linkTargetInputWidget({$:this.$,$overlay:a?a.$element:this.$frame,disabled:!0,classes:["ve-ui-linkInspector-target"]}),this.targetInput.connect(this,{change:"onTargetInputChange"}),this.$content.addClass("ve-ui-linkInspector-content"),this.form.$element.append(this.targetInput.$element)},ve.ui.LinkInspector.prototype.getSetupProcess=function(a){return ve.ui.LinkInspector["super"].prototype.getSetupProcess.call(this,a).next(function(){this.getFragment().getSurface().disable(),this.targetInput.setAnnotation(this.initialAnnotation)
},this)},ve.ui.LinkInspector.prototype.getReadyProcess=function(a){return ve.ui.LinkInspector["super"].prototype.getReadyProcess.call(this,a).next(function(){this.targetInput.setDisabled(!1).focus().select(),this.getFragment().getSurface().enable(),this.onTargetInputChange()},this)},ve.ui.LinkInspector.prototype.getHoldProcess=function(a){return ve.ui.LinkInspector["super"].prototype.getHoldProcess.call(this,a).next(function(){this.targetInput.setDisabled(!0).blur()},this)},ve.ui.LinkInspector.prototype.getTeardownProcess=function(a){return ve.ui.LinkInspector["super"].prototype.getTeardownProcess.call(this,a).next(function(){this.targetInput.setAnnotation(null)},this)},ve.ui.windowFactory.register(ve.ui.LinkInspector),ve.ui.CommentInspector=function(a){ve.ui.NodeInspector.call(this,a)},OO.inheritClass(ve.ui.CommentInspector,ve.ui.NodeInspector),ve.ui.CommentInspector["static"].name="comment",ve.ui.CommentInspector["static"].icon="comment",ve.ui.CommentInspector["static"].title=OO.ui.deferMsg("visualeditor-commentinspector-title"),ve.ui.CommentInspector["static"].modelClasses=[ve.dm.CommentNode],ve.ui.CommentInspector["static"].size="large",ve.ui.CommentInspector["static"].actions=[{action:"done",label:OO.ui.deferMsg("visualeditor-dialog-action-done"),flags:["progressive","primary"],modes:"edit"},{action:"insert",label:OO.ui.deferMsg("visualeditor-dialog-action-insert"),flags:["constructive","primary"],modes:"insert"},{action:"remove",label:OO.ui.deferMsg("visualeditor-inspector-remove-tooltip"),flags:"destructive",modes:"edit"}],ve.ui.CommentInspector.prototype.initialize=function(){ve.ui.CommentInspector["super"].prototype.initialize.call(this),this.textWidget=new ve.ui.WhitespacePreservingTextInputWidget({$:this.$,multiline:!0,autosize:!0}),this.previousTextWidgetHeight=0,this.textWidget.connect(this,{change:"onTextInputWidgetChange"}),this.$content.addClass("ve-ui-commentInspector-content"),this.form.$element.append(this.textWidget.$element)},ve.ui.CommentInspector.prototype.onTextInputWidgetChange=function(){var a=this.textWidget.$element.height();a!==this.previousTextWidgetHeight&&(this.updateSize(),this.previousTextWidgetHeight=a)},ve.ui.CommentInspector.prototype.getActionProcess=function(a){return"remove"===a||"insert"===a?new OO.ui.Process(function(){this.close({action:a})},this):ve.ui.CommentInspector["super"].prototype.getActionProcess.call(this,a)},ve.ui.CommentInspector.prototype.getSetupProcess=function(a){return ve.ui.CommentInspector["super"].prototype.getSetupProcess.call(this,a).next(function(){this.getFragment().getSurface().pushStaging(),this.commentNode=this.getSelectedNode(),this.commentNode?(this.textWidget.setValueAndWhitespace(this.commentNode.getAttribute("text")||""),this.actions.setMode("edit")):(this.textWidget.setWhitespace([" "," "]),this.actions.setMode("insert"),this.getFragment().insertContent([{type:"comment",attributes:{text:""}},{type:"/comment"}]),this.commentNode=this.getSelectedNode())},this)},ve.ui.CommentInspector.prototype.getReadyProcess=function(a){return ve.ui.CommentInspector["super"].prototype.getReadyProcess.call(this,a).next(function(){this.getFragment().getSurface().enable(),this.textWidget.focus()},this)},ve.ui.CommentInspector.prototype.getTeardownProcess=function(a){return a=a||{},ve.ui.CommentInspector["super"].prototype.getTeardownProcess.call(this,a).first(function(){var b=this.getFragment().getSurface(),c=this.textWidget.getValue(),d=this.textWidget.getInnerValue();"remove"===a.action||""===d?(b.popStaging(),this.getFragment().removeContent()):(this.getFragment().changeAttributes({text:c}),b.applyStaging()),this.textWidget.setValueAndWhitespace("")},this)},ve.ui.windowFactory.register(ve.ui.CommentInspector),ve.ui.LanguageInspector=function(a){ve.ui.AnnotationInspector.call(this,a)},OO.inheritClass(ve.ui.LanguageInspector,ve.ui.AnnotationInspector),ve.ui.LanguageInspector["static"].name="language",ve.ui.LanguageInspector["static"].title=OO.ui.deferMsg("visualeditor-languageinspector-title"),ve.ui.LanguageInspector["static"].modelClasses=[ve.dm.LanguageAnnotation],ve.ui.LanguageInspector.prototype.getAnnotation=function(){var a=this.languageInput.getLang(),b=this.languageInput.getDir();return a||b?new ve.dm.LanguageAnnotation({type:"meta/language",attributes:{lang:a,dir:b}}):null},ve.ui.LanguageInspector.prototype.getAnnotationFromFragment=function(a){return new ve.dm.LanguageAnnotation({type:"meta/language",attributes:{lang:a.getDocument().getLang(),dir:a.getDocument().getDir()}})},ve.ui.LanguageInspector.prototype.initialize=function(){ve.ui.LanguageInspector["super"].prototype.initialize.call(this),this.languageInput=new ve.ui.LanguageInputWidget({$:this.$}),this.form.$element.append(this.languageInput.$element)},ve.ui.LanguageInspector.prototype.getSetupProcess=function(a){return ve.ui.LanguageInspector["super"].prototype.getSetupProcess.call(this,a).next(function(){this.languageInput.setLangAndDir(this.initialAnnotation.getAttribute("lang"),this.initialAnnotation.getAttribute("dir"))},this)},ve.ui.windowFactory.register(ve.ui.LanguageInspector),ve.ui.SpecialCharacterInspector=function(a){ve.ui.FragmentInspector.call(this,a),this.characters=null,this.$buttonDomList=null,this.categories=null,this.$element.addClass("ve-ui-specialCharacterInspector")},OO.inheritClass(ve.ui.SpecialCharacterInspector,ve.ui.FragmentInspector),ve.ui.SpecialCharacterInspector["static"].name="specialcharacter",ve.ui.SpecialCharacterInspector["static"].title=OO.ui.deferMsg("visualeditor-specialcharacterinspector-title"),ve.ui.SpecialCharacterInspector["static"].size="large",ve.ui.SpecialCharacterInspector["static"].actions=[{action:"cancel",label:OO.ui.deferMsg("visualeditor-dialog-action-cancel"),flags:"safe"}],ve.ui.SpecialCharacterInspector.prototype.initialize=function(){ve.ui.SpecialCharacterInspector["super"].prototype.initialize.call(this),this.$spinner=this.$("<div>").addClass("ve-ui-specialCharacterInspector-spinner"),this.form.$element.append(this.$spinner)},ve.ui.SpecialCharacterInspector.prototype.getSetupProcess=function(a){return ve.ui.SpecialCharacterInspector["super"].prototype.getSetupProcess.call(this,a).next(function(){var a=this;this.getFragment().getSurface().pushStaging(),this.getFragment().insertContent(" "),this.characters||(this.$spinner.removeClass("oo-ui-element-hidden"),this.fetchCharList().done(function(){a.buildButtonList()}).always(function(){a.$spinner.addClass("oo-ui-element-hidden")}))},this)},ve.ui.SpecialCharacterInspector.prototype.getTeardownProcess=function(a){return a=a||{},ve.ui.SpecialCharacterInspector["super"].prototype.getTeardownProcess.call(this,a).first(function(){this.getFragment().getSurface().popStaging(),a.character&&this.getFragment().insertContent(a.character,!0).collapseToEnd().select()},this)},ve.ui.SpecialCharacterInspector.prototype.getActionProcess=function(a){return new OO.ui.Process(function(){this.close({action:a})},this)},ve.ui.SpecialCharacterInspector.prototype.fetchCharList=function(){var a,b={};a=ve.msg("visualeditor-specialcharinspector-characterlist-insert");try{b=$.parseJSON(a)}catch(c){ve.log("ve.ui.SpecialCharacterInspector: Could not parse the Special Character list."),ve.log(c.message)}finally{this.characters=b}return $.Deferred().resolve().promise()},ve.ui.SpecialCharacterInspector.prototype.buildButtonList=function(){var a,b,c,d,e=this.$("<div>").addClass("ve-ui-specialCharacterInspector-list");for(a in this.characters){c=this.characters[a],d=$("<div>").addClass("ve-ui-specialCharacterInspector-list-group");for(b in c)d.append($("<div>").addClass("ve-ui-specialCharacterInspector-list-character").data("character",c[b]).text(b));e.append(this.$("<h3>").text(a)).append(d)}e.on("click",this.onListClick.bind(this)),this.form.$element.append(e)},ve.ui.SpecialCharacterInspector.prototype.onListClick=function(a){this.close({character:$(a.target).data("character")})},ve.ui.windowFactory.register(ve.ui.SpecialCharacterInspector),ve.ui.DesktopSurface=function(){ve.ui.Surface.apply(this,arguments)},OO.inheritClass(ve.ui.DesktopSurface,ve.ui.Surface),ve.ui.DesktopSurface.prototype.createContext=function(){return new ve.ui.DesktopContext(this,{$:this.$})},ve.ui.DesktopSurface.prototype.createDialogWindowManager=function(){return new ve.ui.WindowManager({factory:ve.ui.windowFactory})},ve.ui.DesktopContext=function(a,b){ve.ui.DesktopContext["super"].call(this,a,b),this.popup=new OO.ui.PopupWidget({$:this.$,$container:this.surface.$element}),this.transitioning=null,this.suppressed=!1,this.onWindowResizeHandler=this.onPosition.bind(this),this.$window=this.$(this.getElementWindow()),this.surface.getView().connect(this,{relocationStart:"onSuppress",relocationEnd:"onUnsuppress",blur:"onSuppress",focus:"onUnsuppress",position:"onPosition"}),this.surface.getModel().connect(this,{select:"onModelSelect"}),this.inspectors.connect(this,{resize:"setPopupSize"}),this.$window.on("resize",this.onWindowResizeHandler),this.$element.addClass("ve-ui-desktopContext").append(this.popup.$element),this.menu.$element.addClass("ve-ui-desktopContext-menu"),this.inspectors.$element.addClass("ve-ui-desktopContext-inspectors"),this.popup.$body.append(this.menu.$element,this.inspectors.$element),this.popup.$element.css({visibility:"hidden"}).removeClass("oo-ui-element-hidden")},OO.inheritClass(ve.ui.DesktopContext,ve.ui.Context),ve.ui.DesktopContext.prototype.afterContextChange=function(){ve.ui.DesktopContext["super"].prototype.afterContextChange.call(this),this.suppressed},ve.ui.DesktopContext.prototype.onSuppress=function(){this.suppressed=!0,this.isVisible()&&(this.menu.isVisible()?(this.menu.toggle(!1),this.toggle(!1)):this.inspector&&this.inspector.close())},ve.ui.DesktopContext.prototype.onUnsuppress=function(){var a=!!this.getAvailableTools().length;this.suppressed=!1,a&&(this.menu.toggle(!0),this.populateMenu(),this.toggle(!0))},ve.ui.DesktopContext.prototype.onModelSelect=function(){this.isVisible()&&(this.inspector&&this.inspector.isOpened()&&this.inspector.close(),this.updateDimensionsDebounced())},ve.ui.DesktopContext.prototype.onPosition=function(){this.isVisible()&&this.updateDimensionsDebounced()},ve.ui.DesktopContext.prototype.createInspectorWindowManager=function(){return new ve.ui.DesktopInspectorWindowManager({$:this.$,factory:ve.ui.windowFactory,overlay:this.surface.getLocalOverlay(),modal:!1})},ve.ui.DesktopContext.prototype.onInspectorOpening=function(){ve.ui.DesktopContext["super"].prototype.onInspectorOpening.apply(this,arguments),this.setPopupSize()},ve.ui.DesktopContext.prototype.toggle=function(a){var b;return this.transitioning?this.transitioning:(a=void 0===a?!this.visible:!!a,a===this.visible?$.Deferred().resolve().promise():(this.visible=a,this.transitioning=$.Deferred(),b=this.transitioning.promise(),this.popup.toggle(a),this.$element.add(this.popup.$element).removeClass("oo-ui-element-hidden").css({visibility:a?"visible":"hidden"}),this.transitioning.resolve(),this.transitioning=null,this.visible=a,a?(this.inspector&&this.inspector.updateSize(),this.updateDimensions()):this.inspector&&this.inspector.close(),b))},ve.ui.DesktopContext.prototype.updateDimensions=function(){var a,b,c,d,e="rtl"===this.surface.getModel().getDocument().getDir(),f=this.surface.getView(),g=f.getFocusedNode(),h=f.getSelectionBoundingRect();return h?g&&!g.isContent()?(c=!this.hasInspector()&&h.height>this.menu.$element.outerHeight()+5&&h.width>this.menu.$element.outerWidth()+10,this.popup.toggleAnchor(!c),c?(b={x:e?h.left:h.right,y:h.top},this.popup.align=e?"left":"right"):(d=(h.left+h.right)/2,b={x:d,y:h.bottom},this.popup.align="center")):(a=f.getSelectionStartAndEndRects(),a&&(d=(h.left+h.right)/2,b=!e&&a.end.right>d||e&&a.end.left<d?{x:d,y:h.bottom}:{x:e?a.end.left:a.end.right,y:a.end.bottom}),this.popup.toggleAnchor(!0),this.popup.align="center"):(this.popup.toggleAnchor(!0),this.popup.align="center"),b&&this.$element.css({left:b.x,top:b.y}),this.setPopupSize(),this},ve.ui.DesktopContext.prototype.setPopupSize=function(){var a=this.inspector?this.inspector.$frame:this.menu.$element;this.popup.toggleClipping(!1),this.popup.setSize(a.outerWidth(!0),a.outerHeight(!0)),this.popup.scrollElementIntoView()},ve.ui.DesktopContext.prototype.destroy=function(){return this.surface.getView().disconnect(this),this.surface.getModel().disconnect(this),this.$window.off("resize",this.onWindowResizeHandler),ve.ui.DesktopContext["super"].prototype.destroy.call(this)},ve.ui.DesktopInspectorWindowManager=function(a){ve.ui.DesktopInspectorWindowManager["super"].call(this,a)},OO.inheritClass(ve.ui.DesktopInspectorWindowManager,ve.ui.WindowManager),ve.ui.DesktopInspectorWindowManager["static"].sizes={small:{width:200,maxHeight:"100%"},medium:{width:300,maxHeight:"100%"},large:{width:400,maxHeight:"100%"},full:{width:"100%",height:"100%"}},ve.ui.DesktopInspectorWindowManager.prototype.getSetupDelay=function(){return 0},ve.ui.DesktopInspectorWindowManager.prototype.getReadyDelay=function(){return 0},ve.ui.DesktopInspectorWindowManager.prototype.getHoldDelay=function(){return 0},ve.ui.DesktopInspectorWindowManager.prototype.getTeardownDelay=function(){return 0},ve.ui.MobileSurface=function(){ve.ui.Surface.apply(this,arguments),this.scrollPosition=null,this.dialogs.connect(this,{opening:"onWindowOpening"}),this.context.getInspectors().connect(this,{opening:"onWindowOpening"}),this.localOverlay.$element.addClass("ve-ui-mobileSurface-overlay ve-ui-mobileSurface-overlay-local"),this.globalOverlay.$element.addClass("ve-ui-mobileSurface-overlay ve-ui-mobileSurface-overlay-global")},OO.inheritClass(ve.ui.MobileSurface,ve.ui.Surface),ve.ui.MobileSurface.prototype.onWindowOpening=function(a,b){var c=this;b.progress(function(a){"setup"===a.state&&c.toggleGlobalOverlay(!0)}).always(function(a){a.always(function(a){a.always(function(){c.toggleGlobalOverlay(!1)})})})},ve.ui.MobileSurface.prototype.createContext=function(){return new ve.ui.MobileContext(this,{$:this.$})},ve.ui.MobileSurface.prototype.createDialogWindowManager=function(){return new ve.ui.MobileWindowManager({factory:ve.ui.windowFactory,overlay:this.globalOverlay})},ve.ui.MobileSurface.prototype.toggleGlobalOverlay=function(a){var b=$("body");a&&(this.scrollPosition=b.scrollTop()),$("html, body").toggleClass("ve-ui-mobileSurface-overlay-global-enabled",a),this.globalOverlay.$element.toggleClass("ve-ui-mobileSurface-overlay-global-visible",a),a||b.scrollTop(this.scrollPosition)},ve.ui.MobileSurface.prototype.destroy=function(){ve.ui.MobileSurface["super"].prototype.destroy.call(this),this.toggleGlobalOverlay(!1)},ve.ui.MobileContext=function(a,b){ve.ui.MobileContext["super"].call(this,a,b),this.transitioning=null,this.inspectors.connect(this,{setup:["toggle",!0],teardown:["toggle",!1]}),this.$element.addClass("ve-ui-mobileContext").append(this.menu.$element),this.toggle(!0),this.menu.$element.addClass("ve-ui-mobileContext-menu"),this.inspectors.$element.addClass("ve-ui-mobileContext-inspectors"),this.surface.getGlobalOverlay().$element.append(this.inspectors.$element)},OO.inheritClass(ve.ui.MobileContext,ve.ui.Context),ve.ui.MobileContext.prototype.createInspectorWindowManager=function(){return new ve.ui.MobileWindowManager({factory:ve.ui.windowFactory,overlay:this.surface.getGlobalOverlay()})},ve.ui.MobileContext.prototype.createItem=function(a){return new ve.ui.MobileContextOptionWidget(a.tool,a.model,{$:this.$,data:a.tool["static"].name})},ve.ui.MobileContext.prototype.toggle=function(a){var b=$.Deferred();return a=void 0===a?!this.visible:!!a,a!==this.visible?(this.visible=a,this.$element.toggleClass("oo-ui-element-hidden",!a),setTimeout(function(){b.resolve()},300)):b.resolve(),b.promise()},ve.ui.MobileWindowManager=function(a){ve.ui.MobileWindowManager["super"].call(this,a)},OO.inheritClass(ve.ui.MobileWindowManager,ve.ui.WindowManager),ve.ui.MobileWindowManager["static"].sizes={full:{width:"100%",height:"100%"}},ve.ui.MobileWindowManager["static"].defaultSize="full",ve.ui.MobileWindowManager.prototype.getSetupDelay=function(){return 0},ve.ui.MobileWindowManager.prototype.getReadyDelay=function(){return 0},ve.ui.MobileWindowManager.prototype.getHoldDelay=function(){return 0},ve.ui.MobileWindowManager.prototype.getTeardownDelay=function(){return 300},ve.ui.MobileContextOptionWidget=function(){ve.ui.MobileContextOptionWidget["super"].apply(this,arguments),this.$element.addClass("ve-ui-mobileContextOptionWidget"),this.setLabel(this.$("<span>").addClass("ve-ui-mobileContextOptionWidget-label-secondary").text(ve.msg("visualeditor-contextitemwidget-label-secondary")).add(this.$("<span>").addClass("ve-ui-mobileContextOptionWidget-label-primary").text(this.getDescription())))},OO.inheritClass(ve.ui.MobileContextOptionWidget,ve.ui.ContextOptionWidget);