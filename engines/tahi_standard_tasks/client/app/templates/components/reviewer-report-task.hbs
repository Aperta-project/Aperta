{{partial "task-completed-section"}}

<div class="task-main-content reviewer-form">
  <div class="reviewer-report-wrapper">
    {{#if task.completed}}
      {{reviewer-report-questions model=currentReviewerReport decision=currentReviewerReport.decision readOnly=true}}
      <div class="reviewer-report-feedback">
        {{fa-icon icon="check-circle"}}
        This report has been submitted
      </div>
    {{else}}
      <p><strong>Please refer to our 
        <a href="http://journals.plos.org/plosbiology/s/reviewer-guidelines#loc-criteria-for-publication">referee</a>
        guidelines for detailed instructions.</strong>
      </p>
      {{reviewer-report-questions model=currentReviewerReport decision=currentReviewerReport.decision readOnly=isNotEditable}}

      <div class="reviewer-report-confirmation">
        {{#if submissionConfirmed}}
          <h4>Once you submit the report, you will no longer be able to edit it. Are you sure?</h4>

          <button class="button-primary button--green reviewer-report-confirm-submit-button" {{action "submitReport"}}>Yes, Iâ€™m sure</button>
          <button class="button-secondary button--green reviewer-report-cancel-submit-button" {{action "cancelSubmission"}}>Nope</button>
        {{else}}
          <button class="button-primary button--green reviewer-report-submit-button" {{action "confirmSubmission"}}>Submit this Report</button>
        {{/if}}
      </div>
    {{/if}}

    {{#if previousDecisions}}
      <hr>

      <h3>Review History</h3>

      <div class="previous-decisions review-history">
        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
          {{#each previousDecisions as |decision|}}
          <div class="panel panel-default decision">
            <div class="panel-heading" role="tab" id="decision-{{unbound decision.id}}" >
              <h4 class="panel-title">
                <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapse-{{unbound decision.id}}" aria-expanded="false" aria-controls="collapse-{{unbound decision.id}}">
                  Revision {{decision.majorVersion}}
                </a>
              </h4>
            </div>
            <div id="collapse-{{unbound decision.id}}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="decision-{{unbound decision.id}}">
              <div class="panel-body">
                {{reviewer-report-questions model=decision.reviewerReports.firstObject decision=decision readOnly=true}}
              </div>
            </div>
          </div>
          {{/each}}
        </div>
      </div>
    {{/if}}
  </div>
</div>
