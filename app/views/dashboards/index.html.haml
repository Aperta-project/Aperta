%header
  %h1.large
    - if @paper_tasks.present?
      Welcome back, #{current_user.first_name}.
    - else
      Welcome to TAHI, #{current_user.first_name}.
%hr

%main
  %section#my-submissions
    %h2 Your Submissions
    - if @papers.empty?
      %p.info-text
        Your scientific paper submissions will
        %br
        appear here.
    - else
      %ul.submitted
        - @papers.each do |paper|
          %li.paper-title= link_to (paper.title || paper.short_title), paper_path(paper)
    = link_to 'Create new submission', new_paper_path, class: 'primary-button wide-button'

  - if @paper_tasks.present?
    %section#my-tasks
      %h2 Your Tasks
      - @paper_tasks.each do |paper, tasks|
        %p.paper-title= link_to paper.title || paper.short_title, paper_path(paper)
        %ul.cards
          - tasks.each do |task|
            - case task.title
            - when 'Enter Declarations'
              %li= card task
            - when 'Upload Figures'
              %li= card task
            - when 'Upload Manuscript'
              %li= card task
            - when 'Add Authors'
              %li= card task
            - when 'Register Decision'
              %li= card task
            - when 'Tech Check'
              %li= card task
            - when 'Reviewer Report'
              %li= card task
            - when 'Assign Admin'
              %li= card task
            - when 'Assign Editor'
              %li= card task
            - when 'Assign Reviewers'
              %li= card task
            - else
              %li
                = link_to '#', class: "card #{'completed' if task.completed?}", data: { 'overlay-name' => "card-#{task.id}", 'overlay-title' => truncated_title(task.paper), 'paper-id' => task.paper.to_param, 'task-id' => task.to_param, 'task-completed' => task.completed? } do
                  %span.glyphicon.glyphicon-ok
                  = task.title
              .hidden{id: "card-#{task.id}-content"}
                = render task, paper: task.paper

- if Rails.env.test?
  - if @all_submitted_papers
    %h3 All Submitted Papers
    %ul.all_submitted
      - @all_submitted_papers.each do |paper|
        %li= link_to paper.short_title, paper_path(paper)
