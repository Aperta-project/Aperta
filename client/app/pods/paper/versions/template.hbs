{{paper-control-bar paper=model
                    showActivity="showActivityOverlay"
                    addContributors="showCollaboratorsOverlay"
                    exportDocument="exportDocument"
                    showWithdrawOverlay="showWithdrawOverlay"
                    topicsIndexPath=topicsIndexPath
                    canViewManuscriptManager=canViewManuscriptManager
                    supportedDownloadFormats=supportedDownloadFormats
                    versionsVisible=true}}

{{withdrawal-banner paper=model staff=currentUser.siteAdmin}}

<div id="paper-container" class="clearfix paper-container-html">
  <div id="versioning-bar">
    <div class="bar-item">
      <i class="fa fa-files-o"></i>
    </div>
    <div class="bar-item">
      Now viewing:
      {{select-native
        name="view_version"
        content=model.versionedTexts
        optionValuePath="id"
        optionLabelPath="versionString"
        selection=viewingVersion
        action=(action "setViewingVersion")}}
    </div>
    <div class="bar-item">
      Compare With:
      {{select-native
        name="compare_version"
        prompt="-"
        content=model.versionedTexts
        optionValuePath="id"
        optionLabelPath="versionString"
        action=(action "setComparisonVersion")}}
    </div>
    <div class="bar-item exit-versions" {{action "exitVersions"}}>
      &times;
    </div>
  </div>

  <div class="sidebar">
    <div class="task-list">
      {{#if model.doi}}
      <div class="task-list-doi"><strong>Manuscript ID:</strong> {{model.manuscript_id}}</div>
      <hr />
      {{/if}}
      <div id="paper-metadata-tasks">
        {{#each model.sortedMetadataTasks as |task|}}
        {{card-preview task=task action="viewCard"}}
        {{/each}}
      </div>
    </div>
  </div>

  <div class="manuscript-container">
    <main>
      {{flash-messages}}
      <article class="manuscript">
      <div id="paper-body">
        <h2 id="paper-title">{{{model.title}}}</h2>


        {{html-diff
          default=model.body
          comparisonText=comparisonVersion.text
          viewingText=viewingVersion.text}}
        </div>
      </article>
    </main>
  </div>
</div>

{{outlet}}

{{#overlay-fullscreen visible=showActivityOverlay
                      outAnimationComplete=(action "hideActivityOverlay")
                      title="Recent Activity"
                      overlayClass="activity-overlay"
                      as |overlay|}}
    {{paper-activity isLoading=activityIsLoading
                     model=activityFeed
                     close=(action overlay.animateOut)}}
{{/overlay-fullscreen}}


{{#overlay-fullscreen visible=showCollaboratorsOverlay
                      outAnimationComplete=(action "hideCollaboratorsOverlay")
                      title="Who can collaborate on this manuscript?"
                      overlayClass="show-collaborators-overlay"
                      as |overlay|}}
    {{paper-collaborators paper=model
                          close=(action overlay.animateOut)}}
{{/overlay-fullscreen}}


{{#overlay-fullscreen visible=showWithdrawOverlay
                      outAnimationComplete=(action "hideWithdrawOverlay")
                      overlayClass="overlay--grey paper-withdraw-overlay"
                      as |overlay|}}
    {{paper-withdraw model=model
                     close=(action overlay.animateOut)}}
{{/overlay-fullscreen}}
