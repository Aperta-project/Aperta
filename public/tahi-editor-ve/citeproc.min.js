Array.indexOf||(Array.prototype.indexOf=function(a){var b,c;for(b=0,c=this.length;c>b;b+=1)if(this[b]===a)return b;return-1});var CSL={PROCESSOR_VERSION:"1.0.552",CONDITION_LEVEL_TOP:1,CONDITION_LEVEL_BOTTOM:2,PLAIN_HYPHEN_REGEX:/(?:[^\\]-|\u2013)/,LOCATOR_LABELS_REGEXP:new RegExp("^((art|ch|Ch|subch|col|fig|l|n|no|op|p|pp|para|subpara|pt|r|sec|subsec|Sec|sv|sch|tit|vrs|vol)\\.)\\s+(.*)"),STATUTE_SUBDIV_GROUPED_REGEX:/((?:^| )(?:art|ch|Ch|subch|p|pp|para|subpara|pt|r|sec|subsec|Sec|sch|tit)\.)/g,STATUTE_SUBDIV_PLAIN_REGEX:/(?:(?:^| )(?:art|ch|Ch|subch|p|pp|para|subpara|pt|r|sec|subsec|Sec|sch|tit)\.)/,STATUTE_SUBDIV_STRINGS:{"art.":"article","bk.":"book","ch.":"chapter","Ch.":"Chapter","subch.":"subchapter","p.":"page","pp.":"page","para.":"paragraph","subpara.":"subparagraph","pt.":"part","r.":"rule","sec.":"section","subsec.":"subsection","Sec.":"Section","sch.":"schedule","tit.":"title","col.":"column","fig.":"figure","fol.":"folio","l.":"line","n.":"note","no.":"issue","op.":"opus","sv.":"sub-verbo","vrs.":"verse","vol.":"volume"},STATUTE_SUBDIV_STRINGS_REVERSE:{article:"art.",book:"bk.",chapter:"ch.",Chapter:"Ch.",subchapter:"subch.",page:"p.",paragraph:"para.",subparagraph:"subpara.",part:"pt.",rule:"r.",section:"sec.",subsection:"subsec.",Section:"Sec.",schedule:"sch.",title:"tit.",column:"col.",figure:"fig.",folio:"fol.",line:"l.",note:"n.",issue:"no.",opus:"op.","sub-verbo":"sv.","sub verbo":"sv.",verse:"vrs.",volume:"vol."},LOCATOR_LABELS_MAP:{art:"article",bk:"book",ch:"chapter",Ch:"Chapter",subch:"subchapter",col:"column",fig:"figure",fol:"folio",l:"line",n:"note",no:"issue",op:"opus",p:"page",pp:"page",para:"paragraph",subpara:"subparagraph",pt:"part",r:"rule",sec:"section",subsec:"subsection",Sec:"Section",sv:"sub-verbo",sch:"schedule",tit:"title",vrs:"verse",vol:"volume"},NestedBraces:[["(","["],[")","]"]],checkNestedBraceOpen:new RegExp(".*\\("),checkNestedBraceClose:new RegExp(".*\\)"),LangPrefsMap:{title:"titles","title-short":"titles","container-title":"journals","collection-title":"journals",publisher:"publishers",authority:"publishers","publisher-place":"places","event-place":"places",number:"number",edition:"number",issue:"number",volume:"number"},AbbreviationSegments:function(){this["container-title"]={},this["collection-title"]={},this["institution-entire"]={},this["institution-part"]={},this.nickname={},this.number={},this.title={},this.place={},this.hereinafter={},this.classic={},this["container-phrase"]={},this["title-phrase"]={}},GENDERS:["masculine","feminine"],ERROR_NO_RENDERED_FORM:1,PREVIEW:"Just for laughs.",ASSUME_ALL_ITEMS_REGISTERED:2,START:0,END:1,SINGLETON:2,SEEN:6,SUCCESSOR:3,SUCCESSOR_OF_SUCCESSOR:4,SUPPRESS:5,SINGULAR:0,PLURAL:1,LITERAL:!0,BEFORE:1,AFTER:2,DESCENDING:1,ASCENDING:2,ONLY_FIRST:1,ALWAYS:2,ONLY_LAST:3,FINISH:1,POSITION_FIRST:0,POSITION_SUBSEQUENT:1,POSITION_IBID:2,POSITION_IBID_WITH_LOCATOR:3,MARK_TRAILING_NAMES:!0,POSITION_TEST_VARS:["position","first-reference-note-number","near-note"],AREAS:["citation","citation_sort","bibliography","bibliography_sort"],MULTI_FIELDS:["event","publisher","publisher-place","event-place","title","container-title","collection-title","authority","edition","genre","title-short","medium","jurisdiction","archive","archive-place"],CITE_FIELDS:["first-reference-note-number","locator","locator-revision"],MINIMAL_NAME_FIELDS:["literal","family"],SWAPPING_PUNCTUATION:[".","!","?",":",","],TERMINAL_PUNCTUATION:[":",".",";","!","?"," "],NONE:0,NUMERIC:1,POSITION:2,COLLAPSE_VALUES:["citation-number","year","year-suffix"],DATE_PARTS:["year","month","day"],DATE_PARTS_ALL:["year","month","day","season"],DATE_PARTS_INTERNAL:["year","month","day","year_end","month_end","day_end"],NAME_PARTS:["family","given","dropping-particle","non-dropping-particle","suffix","literal"],DECORABLE_NAME_PARTS:["given","family","suffix"],DISAMBIGUATE_OPTIONS:["disambiguate-add-names","disambiguate-add-givenname","disambiguate-add-year-suffix"],GIVENNAME_DISAMBIGUATION_RULES:["all-names","all-names-with-initials","primary-name","primary-name-with-initials","by-cite"],NAME_ATTRIBUTES:["and","delimiter-precedes-last","delimiter-precedes-et-al","initialize-with","initialize","name-as-sort-order","sort-separator","et-al-min","et-al-use-first","et-al-subsequent-min","et-al-subsequent-use-first","form","prefix","suffix","delimiter"],PARALLEL_MATCH_VARS:["container-title"],PARALLEL_TYPES:["bill","gazette","regulation","legislation","legal_case","treaty","article-magazine","article-journal"],PARALLEL_COLLAPSING_MID_VARSET:["volume","issue","container-title","section","collection-number"],LOOSE:0,STRICT:1,TOLERANT:2,PREFIX_PUNCTUATION:/[.;:]\s*$/,SUFFIX_PUNCTUATION:/^\s*[.;:,\(\)]/,NUMBER_REGEXP:/(?:^\d+|\d+$)/,NAME_INITIAL_REGEXP:/^([A-Z\u0590-\u05ff\u0080-\u017f\u0400-\u042f\u0600-\u06ff\u0370\u0372\u0376\u0386\u0388-\u03ab\u03e2\u03e4\u03e6\u03e8\u03ea\u03ec\u03ee\u03f4\u03f7\u03fd-\u03ff])([a-zA-Z\u0080-\u017f\u0400-\u052f\u0600-\u06ff\u0370-\u03ff\u1f00-\u1fff]*|)/,ROMANESQUE_REGEXP:/[-0-9a-zA-Z\u0590-\u05d4\u05d6-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/,ROMANESQUE_NOT_REGEXP:/[^a-zA-Z\u0590-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/g,STARTSWITH_ROMANESQUE_REGEXP:/^[&a-zA-Z\u0590-\u05d4\u05d6-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/,ENDSWITH_ROMANESQUE_REGEXP:/[.;:&a-zA-Z\u0590-\u05d4\u05d6-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]$/,ALL_ROMANESQUE_REGEXP:/^[a-zA-Z\u0590-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]+$/,VIETNAMESE_SPECIALS:/[\u00c0-\u00c3\u00c8-\u00ca\u00cc\u00cd\u00d2-\u00d5\u00d9\u00da\u00dd\u00e0-\u00e3\u00e8-\u00ea\u00ec\u00ed\u00f2-\u00f5\u00f9\u00fa\u00fd\u0101\u0103\u0110\u0111\u0128\u0129\u0168\u0169\u01a0\u01a1\u01af\u01b0\u1ea0-\u1ef9]/,VIETNAMESE_NAMES:/^(?:(?:[.AaBbCcDdEeGgHhIiKkLlMmNnOoPpQqRrSsTtUuVvXxYy \u00c0-\u00c3\u00c8-\u00ca\u00cc\u00cd\u00d2-\u00d5\u00d9\u00da\u00dd\u00e0-\u00e3\u00e8-\u00ea\u00ec\u00ed\u00f2-\u00f5\u00f9\u00fa\u00fd\u0101\u0103\u0110\u0111\u0128\u0129\u0168\u0169\u01a0\u01a1\u01af\u01b0\u1ea0-\u1ef9]{2,6})(\s+|$))+$/,NOTE_FIELDS_REGEXP:/\{:(?:[\-_a-z]+|[A-Z]+):[^\}]+\}/g,NOTE_FIELD_REGEXP:/\{:([\-_a-z]+|[A-Z]+):\s*([^\}]+)\}/,DISPLAY_CLASSES:["block","left-margin","right-inline","indent"],NAME_VARIABLES:["author","editor","translator","contributor","collection-editor","composer","container-author","director","editorial-director","interviewer","original-author","recipient"],NUMERIC_VARIABLES:["call-number","chapter-number","collection-number","edition","page","issue","locator","number","number-of-pages","number-of-volumes","volume","citation-number"],DATE_VARIABLES:["locator-date","issued","event-date","accessed","container","original-date","publication-date","original-date","available-date","submitted"],TAG_ESCAPE:function(a){var b,c,d,e,k;for(b=a.match(/((?:\"|\')|(?:(?:<span\s+class=\"no(?:case|decor)\">).*?(?:<\/span>|<\/?(?:i|sc|b)>)))/g),c=a.split(/(?:(?:\"|\')|(?:(?:<span\s+class=\"no(?:case|decor)\">).*?(?:<\/span>|<\/?(?:i|sc|b)>)))/g),k=[c[0]],e=1,d=c.length;d>e;e+=1)k.push(b[e-1]),k.push(c[e]);return c=k.slice()},TAG_USEALL:function(a){var b,c,d,e;for(b=[""],c=a.indexOf("<"),d=a.indexOf(">");c>-1&&d>-1;)e=c>d?c+1:d+1,d>c&&-1===a.slice(c+1,d).indexOf("<")?(b[b.length-1]+=a.slice(0,c),b.push(a.slice(c,d+1)),b.push(""),a=a.slice(e)):(b[b.length-1]+=a.slice(0,d+1),a=a.slice(e)),c=a.indexOf("<"),d=a.indexOf(">");return b[b.length-1]+=a,b},SKIP_WORDS:["about","above","across","afore","after","against","along","alongside","amid","amidst","among","amongst","anenst","apropos","apud","around","as","aside","astride","at","athwart","atop","barring","before","behind","below","beneath","beside","besides","between","beyond","but","by","circa","despite","down","during","except","for","forenenst","from","given","in","inside","into","lest","like","modulo","near","next","notwithstanding","of","off","on","onto","out","over","per","plus","pro","qua","sans","since","than","through"," thru","throughout","thruout","till","to","toward","towards","under","underneath","until","unto","up","upon","versus","vs.","v.","vs","v","via","vis-\xe0-vis","with","within","without","according to","ahead of","apart from","as for","as of","as per","as regards","aside from","back to","because of","close to","due to","except for","far from","inside of","instead of","near to","next to","on to","out from","out of","outside of","prior to","pursuant to","rather than","regardless of","such as","that of","up to","where as","or","yet","so","for","and","nor","a","an","the","de","d'","von","van","c","et","ca"],FORMAT_KEY_SEQUENCE:["@strip-periods","@font-style","@font-variant","@font-weight","@text-decoration","@vertical-align","@quotes"],INSTITUTION_KEYS:["font-style","font-variant","font-weight","text-decoration","text-case"],SUFFIX_CHARS:"a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z",ROMAN_NUMERALS:[["","i","ii","iii","iv","v","vi","vii","viii","ix"],["","x","xx","xxx","xl","l","lx","lxx","lxxx","xc"],["","c","cc","ccc","cd","d","dc","dcc","dccc","cm"],["","m","mm","mmm","mmmm","mmmmm"]],CREATORS:["author","editor","contributor","translator","recipient","interviewer","composer","original-author","container-author","collection-editor"],LANGS:{"af-ZA":"Afrikaans","ar-AR":"Arabic","bg-BG":"Bulgarian","ca-AD":"Catalan","cs-CZ":"Czech","da-DK":"Danish","de-AT":"Austrian","de-CH":"German (CH)","de-DE":"German (DE)","el-GR":"Greek","en-GB":"English (GB)","en-US":"English (US)","es-ES":"Spanish","et-EE":"Estonian",eu:"European","fa-IR":"Persian","fi-FI":"Finnish","fr-CA":"French (CA)","fr-FR":"French (FR)","he-IL":"Hebrew","hr-HR":"Croatian","hu-HU":"Hungarian","is-IS":"Icelandic","it-IT":"Italian","ja-JP":"Japanese","km-KH":"Khmer","ko-KR":"Korean","lt-LT":"Lithuanian","lv-LV":"Latvian","mn-MN":"Mongolian","nb-NO":"Norwegian (Bokm\xe5l)","nl-NL":"Dutch","nn-NO":"Norwegian (Nynorsk)","pl-PL":"Polish","pt-BR":"Portuguese (BR)","pt-PT":"Portuguese (PT)","ro-RO":"Romanian","ru-RU":"Russian","sk-SK":"Slovak","sl-SI":"Slovenian","sr-RS":"Serbian","sv-SE":"Swedish","th-TH":"Thai","tr-TR":"Turkish","uk-UA":"Ukranian","vi-VN":"Vietnamese","zh-CN":"Chinese (CN)","zh-TW":"Chinese (TW)"},LANG_BASES:{af:"af_ZA",ar:"ar_AR",bg:"bg_BG",ca:"ca_AD",cs:"cs_CZ",da:"da_DK",de:"de_DE",el:"el_GR",en:"en_US",es:"es_ES",et:"et_EE",eu:"eu",fa:"fa_IR",fi:"fi_FI",fr:"fr_FR",he:"he_IL",hu:"hu_HU",is:"is_IS",it:"it_IT",ja:"ja_JP",km:"km_KH",ko:"ko_KR",lt:"lt_LT",mn:"mn_MN",nb:"nb_NO",nl:"nl_NL",nn:"nn-NO",pl:"pl_PL",pt:"pt_PT",ro:"ro_RO",ru:"ru_RU",sk:"sk_SK",sl:"sl_SI",sr:"sr_RS",sv:"sv_SE",th:"th_TH",tr:"tr_TR",uk:"uk_UA",vi:"vi_VN",zh:"zh_CN"},SUPERSCRIPTS:{"\xaa":"a","\xb2":"2","\xb3":"3","\xb9":"1","\xba":"o","\u02b0":"h","\u02b1":"\u0266","\u02b2":"j","\u02b3":"r","\u02b4":"\u0279","\u02b5":"\u027b","\u02b6":"\u0281","\u02b7":"w","\u02b8":"y","\u02e0":"\u0263","\u02e1":"l","\u02e2":"s","\u02e3":"x","\u02e4":"\u0295","\u1d2c":"A","\u1d2d":"\xc6","\u1d2e":"B","\u1d30":"D","\u1d31":"E","\u1d32":"\u018e","\u1d33":"G","\u1d34":"H","\u1d35":"I","\u1d36":"J","\u1d37":"K","\u1d38":"L","\u1d39":"M","\u1d3a":"N","\u1d3c":"O","\u1d3d":"\u0222","\u1d3e":"P","\u1d3f":"R","\u1d40":"T","\u1d41":"U","\u1d42":"W","\u1d43":"a","\u1d44":"\u0250","\u1d45":"\u0251","\u1d46":"\u1d02","\u1d47":"b","\u1d48":"d","\u1d49":"e","\u1d4a":"\u0259","\u1d4b":"\u025b","\u1d4c":"\u025c","\u1d4d":"g","\u1d4f":"k","\u1d50":"m","\u1d51":"\u014b","\u1d52":"o","\u1d53":"\u0254","\u1d54":"\u1d16","\u1d55":"\u1d17","\u1d56":"p","\u1d57":"t","\u1d58":"u","\u1d59":"\u1d1d","\u1d5a":"\u026f","\u1d5b":"v","\u1d5c":"\u1d25","\u1d5d":"\u03b2","\u1d5e":"\u03b3","\u1d5f":"\u03b4","\u1d60":"\u03c6","\u1d61":"\u03c7","\u2070":"0","\u2071":"i","\u2074":"4","\u2075":"5","\u2076":"6","\u2077":"7","\u2078":"8","\u2079":"9","\u207a":"+","\u207b":"\u2212","\u207c":"=","\u207d":"(","\u207e":")","\u207f":"n","\u2120":"SM","\u2122":"TM","\u3192":"\u4e00","\u3193":"\u4e8c","\u3194":"\u4e09","\u3195":"\u56db","\u3196":"\u4e0a","\u3197":"\u4e2d","\u3198":"\u4e0b","\u3199":"\u7532","\u319a":"\u4e59","\u319b":"\u4e19","\u319c":"\u4e01","\u319d":"\u5929","\u319e":"\u5730","\u319f":"\u4eba","\u02c0":"\u0294","\u02c1":"\u0295","\u06e5":"\u0648","\u06e6":"\u064a"},SUPERSCRIPTS_REGEXP:new RegExp("[\xaa\xb2\xb3\xb9\xba\u02b0\u02b1\u02b2\u02b3\u02b4\u02b5\u02b6\u02b7\u02b8\u02e0\u02e1\u02e2\u02e3\u02e4\u1d2c\u1d2d\u1d2e\u1d30\u1d31\u1d32\u1d33\u1d34\u1d35\u1d36\u1d37\u1d38\u1d39\u1d3a\u1d3c\u1d3d\u1d3e\u1d3f\u1d40\u1d41\u1d42\u1d43\u1d44\u1d45\u1d46\u1d47\u1d48\u1d49\u1d4a\u1d4b\u1d4c\u1d4d\u1d4f\u1d50\u1d51\u1d52\u1d53\u1d54\u1d55\u1d56\u1d57\u1d58\u1d59\u1d5a\u1d5b\u1d5c\u1d5d\u1d5e\u1d5f\u1d60\u1d61\u2070\u2071\u2074\u2075\u2076\u2077\u2078\u2079\u207a\u207b\u207c\u207d\u207e\u207f\u2120\u2122\u3192\u3193\u3194\u3195\u3196\u3197\u3198\u3199\u319a\u319b\u319c\u319d\u319e\u319f\u02c0\u02c1\u06e5\u06e6]","g"),locale:{},locale_opts:{},locale_dates:{}};if("undefined"!=typeof require&&"undefined"!=typeof module&&"exports"in module){var CSL_IS_NODEJS=!0,CSL_NODEJS=require("./csl_nodejs_jsdom").CSL_NODEJS_JSDOM;exports.CSL=CSL}CSL.TERMINAL_PUNCTUATION_REGEXP=new RegExp("^(["+CSL.TERMINAL_PUNCTUATION.slice(0,-1).join("")+"])(.*)"),CSL.CLOSURES=new RegExp(".*[\\]\\)]"),"object"==typeof console&&"function"==typeof console.log?(CSL.debug=function(a){console.log("CSL: "+a)},CSL.error=function(a){console.log("CSL error: "+a)}):(CSL.debug=function(){},CSL.error=function(a){throw"CSL error: "+a});var XML_PARSING;XML_PARSING="undefined"!=typeof CSL_IS_NODEJS?CSL_NODEJS:"undefined"!=typeof CSL_E4X?CSL_E4X:"undefined"!=typeof CSL_JSON?CSL_JSON:CSL_CHROME,CSL.System={},CSL.System.Xml={Parsing:XML_PARSING},CSL.getSortCompare=function(a){if(CSL.stringCompare)return CSL.stringCompare;var b,c={sensitivity:"base",ignorePunctuation:!0,numeric:!0};a||(a="en-US"),b=function(b,d){return b.toLocaleLowerCase().localeCompare(d.toLocaleLowerCase(),a,c)};var d=function(a){return a.replace(/^[\[\]\'\"]*/g,"")},e=function(){return b("[x","x")?function(a,c){return b(d(a),d(c))}:!1},f=e(),g=function(a,c){return f?f(a,c):b(a,c)};return g},CSL.ambigConfigDiff=function(a,b){var d,e,f,g;if(a.names.length!==b.names.length)return 1;for(d=0,e=a.names.length;e>d;d+=1){if(a.names[d]!==b.names[d])return 1;for(f=0,g=a.givens[d];g>f;f+=1)if(a.givens[d][f]!==b.givens[d][f])return 1}return a.disambiguate!=b.disambiguate?1:a.year_suffix!==b.year_suffix?1:0},CSL.cloneAmbigConfig=function(a,b){var d,e,f,g,j,k={};for(k.names=[],k.givens=[],k.year_suffix=!1,k.disambiguate=!1,d=0,e=a.names.length;e>d;d+=1)j=a.names[d],k.names[d]=j;for(d=0,e=a.givens.length;e>d;d+=1){for(j=[],f=0,g=a.givens[d].length;g>f;f+=1)j.push(a.givens[d][f]);k.givens.push(j)}return b?(k.year_suffix=b.year_suffix,k.disambiguate=b.disambiguate):(k.year_suffix=a.year_suffix,k.disambiguate=a.disambiguate),k},CSL.getAmbigConfig=function(){var a,b;return a=this.tmp.disambig_request,a||(a=this.tmp.disambig_settings),b=CSL.cloneAmbigConfig(a)},CSL.getMaxVals=function(){return this.tmp.names_max.mystack.slice()},CSL.getMinVal=function(){return this.tmp["et-al-min"]},CSL.tokenExec=function(a,b,c){var d,e,f,g,h,i;i=!1,d=a.next,e=!1;var j=function(b){return b?(this.tmp.jump.replace("succeed"),a.succeed):(this.tmp.jump.replace("fail"),a.fail)};for(a.test&&(d=j.call(this,a.test(b,c))),h=a.execs.length,g=0;h>g;g+=1)f=a.execs[g],e=f.call(a,this,b,c),e&&(d=e);return d},CSL.expandMacro=function(a){var b,g,j,k;if(b=a.postponed_macro,this.build.macro_stack.indexOf(b)>-1)throw'CSL processor error: call to macro "'+b+'" would cause an infinite loop';this.build.macro_stack.push(b);var l=!1,m=!1;if(g=this.sys.xml.getNodesByName(this.cslXml,"macro",b),g.length&&(m=this.sys.xml.getAttributeValue(g[0],"cslid"),l=this.sys.xml.getAttributeValue(g[0],"macro-has-date")),l&&(k=function(a){a.tmp.extension&&(a.tmp["doing-macro-with-date"]=!0)},a.execs.push(k)),a.tokentype=CSL.START,a.cslid=m,CSL.Node.group.build.call(a,this,this[this.build.area].tokens,!0),!this.sys.xml.getNodeValue(g))throw'CSL style error: undefined macro "'+b+'"';var n=CSL.makeBuilder(this);n(g[0]),j=new CSL.Token("group",CSL.END),a.decorations&&(j.decorations=a.decorations.slice()),l&&(k=function(a){a.tmp.extension&&(a.tmp["doing-macro-with-date"]=!1)},j.execs.push(k)),CSL.Node.group.build.call(j,this,this[this.build.area].tokens,!0),this.build.macro_stack.pop()},CSL.XmlToToken=function(a,b){var c,d,e,f,g,h,i,j;if(c=a.sys.xml.nodename(this),!a.build.skip||a.build.skip===c){if(!c)return d=a.sys.xml.content(this),d&&(a.build.text=d),void 0;if(!CSL.Node[a.sys.xml.nodename(this)])throw'Undefined node name "'+c+'".';if(e=[],f=a.sys.xml.attributes(this),g=CSL.setDecorations.call(this,a,f),h=new CSL.Token(c,b),b!==CSL.END||"if"===c||"else-if"===c||"layout"===c){for(i in f)if(f.hasOwnProperty(i)){if(b===CSL.END&&"@language"!==i&&"@locale"!==i)continue;if(f.hasOwnProperty(i))if(CSL.Attributes[i])try{CSL.Attributes[i].call(h,a,""+f[i])}catch(k){throw CSL.error(k),"CSL processor error, "+i+" attribute: "+k}else CSL.debug('warning: undefined attribute "'+i+'" in style')}h.decorations=g}else b===CSL.END&&f["@variable"]&&(h.hasVariable=!0);j=a[a.build.area].tokens,CSL.Node[c].build.call(h,a,j)}},CSL.DateParser=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,z,A,B,C;for(a=[["\u660e\u6cbb",1867],["\u5927\u6b63",1911],["\u662d\u548c",1925],["\u5e73\u6210",1988]],b={},A=a.length,g=0;A>g;g+=1)h=a[g][0],i=a[g][1],b[h]=i;for(B=[],g=0;A>g;g+=1)i=a[g][0],B.push(i);for(B=B.join("|"),c="(?:"+B+")(?:[0-9]+)",c=new RegExp(c),C="(?:"+B+")(?:[0-9]+)",C=new RegExp(C,"g"),e=/(\u6708|\u5E74)/g,d=/\u65E5/,f=/\u301c/g,j="(?:[?0-9]{1,2}%%NUMD%%){0,2}[?0-9]{4}(?![0-9])",k="[?0-9]{4}(?:%%NUMD%%[?0-9]{1,2}){0,2}(?![0-9])",l="[?0-9]{1,3}",m="[%%DATED%%]",n="[?~]",o="[a-zA-Z]+",p="("+k+"|"+j+"|"+l+"|"+m+"|"+n+"|"+o+")",q=new RegExp(p.replace(/%%NUMD%%/g,"-").replace(/%%DATED%%/g,"-")),r=new RegExp(p.replace(/%%NUMD%%/g,"-").replace(/%%DATED%%/g,"/")),s=new RegExp(p.replace(/%%NUMD%%/g,"/").replace(/%%DATED%%/g,"-")),t=[],u=[],A=t.length,g=0;A>g;g+=1)z=new RegExp(t[g]+".*"),u.push(z);this.mstrings="january february march april may june july august september october november december spring summer fall winter spring summer",this.mstrings=this.mstrings.split(" "),this.setOrderDayMonth=function(){this.monthguess=1,this.dayguess=0},this.setOrderMonthDay=function(){this.monthguess=0,this.dayguess=1},this.setOrderMonthDay(),this.resetMonths=function(){var a,b,c,d;for(this.msets=[],a=0,b=this.mstrings.length;b>a;a+=1)this.msets.push([this.mstrings[a]]);for(this.mabbrevs=[],a=0,b=this.msets.length;b>a;a+=1)for(this.mabbrevs.push([]),c=0,d=this.msets[a].length;d>c;c+=1)this.mabbrevs[a].push(this.msets[a][0].slice(0,3));for(this.mrexes=[],a=0,b=this.mabbrevs.length;b>a;a+=1)this.mrexes.push(new RegExp("(?:"+this.mabbrevs[a].join("|")+")"))},this.resetMonths(),this.addMonths=function(a){var b,c,d,e,f,g,h,i;if("string"==typeof a&&(a=a.split(/\s+/)),12!==a.length&&16!==a.length)return CSL.debug("month [+season] list of "+a.length+", expected 12 or 16. Ignoring."),void 0;for(b=0,c=a.length;c>b;b+=1){var l=!1,m=!1,n=3,o={};for(d=0,e=this.mabbrevs.length;e>d;d+=1){if(o[d]={},d===b){for(f=0,g=this.mabbrevs[b].length;g>f;f+=1)if(this.mabbrevs[b][f]===a[b].slice(0,this.mabbrevs[b][f].length)){m=!0;break}}else for(f=0,g=this.mabbrevs[d].length;g>f;f+=1)if(l=this.mabbrevs[d][f].length,this.mabbrevs[d][f]===a[b].slice(0,l)){for(;this.msets[d][f].slice(0,l)===a[b].slice(0,l);){if(l>a[b].length||l>this.msets[d][f].length){CSL.debug("unable to disambiguate month string in date parser: "+a[b]);break}l+=1}n=l,o[d][f]=l}for(h in o)if(o.hasOwnProperty(h))for(i in o[h])o[h].hasOwnProperty(i)&&(l=o[h][i],h=parseInt(h,10),i=parseInt(i,10),this.mabbrevs[h][i]=this.msets[h][i].slice(0,l))}m||(this.msets[b].push(a[b]),this.mabbrevs[b].push(a[b].slice(0,n)))}for(this.mrexes=[],b=0,c=this.mabbrevs.length;c>b;b+=1)this.mrexes.push(new RegExp("(?:"+this.mabbrevs[b].join("|")+")"))},this.parse=function(a){var h,i,j,k,l,m,n,o,p,t,v,w,x,y,z,B,D,E,F,G,H,I,J,K,L,M,N,O,P,Q;if(a&&(a=""+a,a=a.replace(/\s*[0-9]{2}:[0-9]{2}(?::[0-9]+)/,""),l=a.match(e))){if(a=a.replace(/\s+/,"","g"),a=a.replace(d,"","g"),a=a.replace(e,"-","g"),a=a.replace(f,"/","g"),a=a.replace("-/","/","g"),a=a.replace(/-$/,"","g"),J=a.split(c),j=[],I=a.match(C)){var R=[];for(g=0,A=I.length;A>g;g+=1)R=R.concat(I[g].match(/([^0-9]+)([0-9]+)/).slice(1));for(g=0,A=J.length;A>g;g+=1)j.push(J[g]),g!==A-1&&(K=2*g,j.push(R[K]),j.push(R[K+1]))}else j=J;for(k=j.length,g=1;k>g;g+=3)j[g+1]=b[j[g]]+parseInt(j[g+1],10),j[g]="";a=j.join(""),a=a.replace(/\s*-\s*$/,"").replace(/\s*-\s*\//,"/"),a=a.replace(/\.\s*$/,""),a=a.replace(/\.(?! )/,""),h=a.indexOf("/"),i=a.indexOf("-")}if(a=a.replace(/([A-Za-z])\./g,"$1"),m="",n="",o={},'"'===a.slice(0,1)&&'"'===a.slice(-1))return o.literal=a.slice(1,-1),o;for(h>-1&&i>-1?(p=a.split("/"),p.length>3?(t="-",v="/",j=a.split(s)):(t="/",v="-",j=a.split(r))):(a=a.replace("/","-"),t="-",v="-",j=a.split(q)),w=[],A=j.length,g=0;A>g;g+=1)F=j[g],l=F.match(/^\s*([\-\/]|[a-zA-Z]+|[\-~?0-9]+)\s*$/),l&&w.push(l[1]);for(x=w.indexOf(t),y=[],z=!1,x>-1?(y.push([0,x]),y.push([x+1,w.length]),z=!0):y.push([0,w.length]),B="",L=0,M=y.length;M>L;L+=1){for(G=y[L],D=w.slice(G[0],G[1]),N=0,O=D.length;O>N;N+=1)if(H=D[N],H.indexOf(v)>-1)this.parseNumericDate(o,v,B,H);else if(H.match(/[0-9]{4}/))o["year"+B]=H.replace(/^0*/,"");else{for(E=!1,P=0,Q=this.mrexes.length;Q>P;P+=1){if(H.toLocaleLowerCase().match(this.mrexes[P])){o["month"+B]=""+(parseInt(P,10)+1),E=!0;break}E||(H.match(/^[0-9]+$/)&&(m=parseInt(H,10)),H.toLocaleLowerCase().match(/^bc/)&&m?(o["year"+B]=""+-1*m,m=""):H.toLocaleLowerCase().match(/^ad/)&&m&&(o["year"+B]=""+m,m=""))}for(E=!1,P=0,Q=u.length;Q>P;P+=1)if(H.toLocaleLowerCase().match(u[P])){o["season"+B]=""+(parseInt(P,10)+1),E=!0;break}E||("~"===H||"?"===H||"c"===H||H.match(/^cir/)?o.circa="1":!H.toLocaleLowerCase().match(/(?:mic|tri|hil|eas)/)||o["season"+B]||(n=H))}m&&(o["day"+B]=m,m=""),n&&!o["season"+B]&&(o["season"+B]=n,n=""),B="_end"}if(z)for(N=0,O=CSL.DATE_PARTS_ALL.length;O>N;N+=1)F=CSL.DATE_PARTS_ALL[N],o[F]&&!o[F+"_end"]?o[F+"_end"]=o[F]:!o[F]&&o[F+"_end"]&&(o[F]=o[F+"_end"]);return o.year||(o={literal:a}),this.use_array&&this.toArray(o),o},this.returnAsArray=function(){this.use_array=!0},this.returnAsKeys=function(){this.use_array=!1},this.toArray=function(a){var b,c,d;a["date-parts"]=[],a["date-parts"].push([]);var e=0;for(b=0,c=3;c>b&&(d=["year","month","day"][b],a[d]);b+=1)e+=1,a["date-parts"][0].push(a[d]),delete a[d];for(a["date-parts"].push([]),b=0,c=e;c>b&&(d=["year_end","month_end","day_end"][b],a[d]);b+=1)a["date-parts"][1].push(a[d]),delete a[d];a["date-parts"][0].length!==a["date-parts"][1].length&&a["date-parts"].pop()},this.parseNumericDate=function(a,b,c,d){var e,f,g;for(e=d.split(b),f=0,g=e.length;g>f;f+=1)if(4===e[f].length){a["year"+c]=e[f].replace(/^0*/,""),e=f?e.slice(0,f):e.slice(1);break}for(f=0,g=e.length;g>f;f+=1)e[f]=parseInt(e[f],10);1===e.length||2===e.length&&!e[1]?a["month"+c]=""+e[0]:2===e.length&&(e[this.monthguess]>12?(a["month"+c]=""+e[this.dayguess],a["day"+c]=""+e[this.monthguess]):(a["month"+c]=""+e[this.monthguess],a["day"+c]=""+e[this.dayguess]))}},CSL.Engine=function(a,b,c,d){function i(a){var a=a.slice(),b=new RegExp("((?:[?!:]*\\s+|-|^)(?:"+a.join("|")+")(?=[!?:]*\\s+|-|$))");return b}var e,f;this.processor_version=CSL.PROCESSOR_VERSION,this.csl_version="1.0",this.sys=a,a.variableWrapper&&(CSL.VARIABLE_WRAPPER_PREPUNCT_REX=new RegExp("^(["+[" "].concat(CSL.SWAPPING_PUNCTUATION).join("")+"]*)(.*)")),this.sys.xml=new CSL.System.Xml.Parsing,"undefined"==typeof CSL_JSON&&"string"!=typeof b&&(b=""),CSL.getAbbreviation&&(this.sys.getAbbreviation=CSL.getAbbreviation),this.sys.stringCompare&&(CSL.stringCompare=this.sys.stringCompare),this.sys.AbbreviationSegments=CSL.AbbreviationSegments,this.parallel=new CSL.Parallel(this),this.transform=new CSL.Transform(this),this.setParseNames=function(a){this.opt["parse-names"]=a},this.opt=new CSL.Engine.Opt,this.tmp=new CSL.Engine.Tmp,this.build=new CSL.Engine.Build,this.fun=new CSL.Engine.Fun(this),this.configure=new CSL.Engine.Configure,this.citation_sort=new CSL.Engine.CitationSort,this.bibliography_sort=new CSL.Engine.BibliographySort,this.citation=new CSL.Engine.Citation(this),this.bibliography=new CSL.Engine.Bibliography,this.output=new CSL.Output.Queue(this),this.dateput=new CSL.Output.Queue(this),this.cslXml=this.sys.xml.makeXml(b),(this.opt.development_extensions.csl_reverse_lookup_support||this.sys.csl_reverse_lookup_support)&&(this.build.cslNodeId=0,this.setCslNodeIds=function(a,b){var c=this.sys.xml.children(a);this.sys.xml.setAttribute(a,"cslid",this.build.cslNodeId),this.opt.nodenames.push(b),this.build.cslNodeId+=1;for(var d=0,e=this.sys.xml.numberofnodes(c);e>d;d+=1)b=this.sys.xml.nodename(c[d]),b&&this.setCslNodeIds(c[d],b)},this.setCslNodeIds(this.cslXml,"style")),this.sys.xml.addMissingNameNodes(this.cslXml),this.sys.xml.addInstitutionNodes(this.cslXml),this.sys.xml.insertPublisherAndPlace(this.cslXml),this.sys.xml.flagDateMacros(this.cslXml),e=this.sys.xml.attributes(this.cslXml),"undefined"==typeof e["@sort-separator"]&&this.sys.xml.setAttribute(this.cslXml,"sort-separator",", "),this.opt["initialize-with-hyphen"]=!0,this.setStyleAttributes(),this.opt.xclass=a.xml.getAttributeValue(this.cslXml,"class"),this.opt.class=this.opt.xclass,this.opt.styleID=this.sys.xml.getStyleId(this.cslXml),this.opt.styleName=this.sys.xml.getStyleId(this.cslXml,!0),CSL.getSuppressJurisdictions&&(this.opt.suppressJurisdictions=CSL.getSuppressJurisdictions(this.opt.styleID)),"1.1m"===this.opt.version.slice(0,4)&&(this.opt.development_extensions.static_statute_locator=!0,this.opt.development_extensions.handle_parallel_articles=!0,this.opt.development_extensions.main_title_from_short_title=!0,this.opt.development_extensions.strict_page_numbers=!0,this.opt.development_extensions.rtl_support=!0,this.opt.development_extensions.expect_and_symbol_form=!0,this.opt.development_extensions.require_explicit_legal_case_title_short=!0),c&&(c=c.replace("_","-")),this.opt["default-locale"][0]&&(this.opt["default-locale"][0]=this.opt["default-locale"][0].replace("_","-")),c&&d&&(this.opt["default-locale"]=[c]),c&&!d&&this.opt["default-locale"][0]&&(c=this.opt["default-locale"][0]),0===this.opt["default-locale"].length&&(c||(c="en-US"),this.opt["default-locale"].push("en-US")),c||(c=this.opt["default-locale"][0]),f=CSL.localeResolve(c),this.opt.lang=f.best,this.opt["default-locale"][0]=f.best,this.locale={},this.opt["default-locale-sort"]||(this.opt["default-locale-sort"]=this.opt["default-locale"][0]),this.localeConfigure(f),this.locale[this.opt.lang].opts["skip-words-regexp"]=i(this.locale[this.opt.lang].opts["skip-words"]),this.output.adjust=new CSL.Output.Queue.adjust(this.getOpt("punctuation-in-quote")),this.registry=new CSL.Registry(this),this.buildTokenLists("citation"),this.buildTokenLists("bibliography"),this.configureTokenLists(),this.disambiguate=new CSL.Disambiguation(this),this.splice_delimiter=!1,this.fun.dateparser=new CSL.DateParser,this.fun.flipflopper=new CSL.Util.FlipFlopper(this),this.setCloseQuotesArray(),this.fun.ordinalizer.init(this),this.fun.long_ordinalizer.init(this),this.fun.page_mangler=CSL.Util.PageRangeMangler.getFunction(this,"page"),this.fun.year_mangler=CSL.Util.PageRangeMangler.getFunction(this,"year"),this.setOutputFormat("html")},CSL.Engine.prototype.setCloseQuotesArray=function(){var a;a=[],a.push(this.getTerm("close-quote")),a.push(this.getTerm("close-inner-quote")),a.push('"'),a.push("'"),this.opt.close_quotes_array=a},CSL.makeBuilder=function(a){function b(b){CSL.XmlToToken.call(b,a,CSL.START)}function c(b){CSL.XmlToToken.call(b,a,CSL.END)}function d(b){CSL.XmlToToken.call(b,a,CSL.SINGLETON)}function e(f){var h;if(a.sys.xml.numberofnodes(a.sys.xml.children(f))){h=f,b(h);for(var i=0;i<a.sys.xml.numberofnodes(a.sys.xml.children(h));i+=1)f=a.sys.xml.children(h)[i],null!==a.sys.xml.nodename(f)&&("date"===a.sys.xml.nodename(f)&&(CSL.Util.fixDateNode.call(a,h,i,f),f=a.sys.xml.children(h)[i]),e(f,b,c,d));c(h)}else d(f)}return e},CSL.Engine.prototype.buildTokenLists=function(a){var c,b=CSL.makeBuilder(this);if(c=this.sys.xml.getNodesByName(this.cslXml,a),this.sys.xml.getNodeValue(c)){this.build.area=a;var d=c[0];b(d)}},CSL.Engine.prototype.setStyleAttributes=function(){var a,d,e;a={};var f=this.cslXml,g=this.cslXml.tagName?(""+this.cslXml.tagName).toLowerCase():"";if("style"!==g&&"cslstyle"!==g&&this.cslXml.getElementsByTagName)var f=this.cslXml.getElementsByTagName("style")[0];a.name=this.sys.xml.nodename(f),d=this.sys.xml.attributes(f);for(e in d)d.hasOwnProperty(e)&&CSL.Attributes[e].call(a,this,d[e])},CSL.Engine.prototype.getTerm=function(a,b,c,d,e,f){a&&a.match(/[A-Z]/)&&a===a.toUpperCase()&&(CSL.debug("Warning: term key is in uppercase form: "+a),a=a.toLowerCase());var g;g=f?this.opt["default-locale"][0]:this.opt.lang;var h=CSL.Engine.getField(CSL.LOOSE,this.locale[g].terms,a,b,c,d);if(h||"range-delimiter"!==a||(h="\u2013"),"undefined"==typeof h){if(e===CSL.STRICT)throw'Error in getTerm: term "'+a+'" does not exist.';e===CSL.TOLERANT&&(h="")}return h&&(this.tmp.cite_renders_content=!0),h},CSL.Engine.prototype.getDate=function(a,b){var c;return c=b?this.opt["default-locale"]:this.opt.lang,this.locale[c].dates[a]?this.locale[c].dates[a]:!1},CSL.Engine.prototype.getOpt=function(a){return"undefined"!=typeof this.locale[this.opt.lang].opts[a]?this.locale[this.opt.lang].opts[a]:!1},CSL.Engine.prototype.getVariable=function(a,b,c,d){return CSL.Engine.getField(CSL.LOOSE,a,b,c,d)},CSL.Engine.prototype.getDateNum=function(a,b){return"undefined"==typeof a?0:a[b]},CSL.Engine.getField=function(a,b,c,d,e,f){var g,h,i,j,k,l;if(g="","undefined"==typeof b[c]){if(a===CSL.STRICT)throw'Error in getField: term "'+c+'" does not exist.';return void 0}for(l=f&&b[c][f]?b[c][f]:b[c],h=[],"symbol"===d?h=["symbol","short"]:"verb-short"===d?h=["verb-short","verb"]:"long"!==d&&(h=[d]),h=h.concat(["long"]),k=h.length,j=0;k>j;j+=1)if(i=h[j],"string"==typeof l||"number"==typeof l)g=l;else if("undefined"!=typeof l[i]){g="string"==typeof l[i]||"number"==typeof l[i]?l[i]:"number"==typeof e?l[i][e]:l[i][0];break}return g},CSL.Engine.prototype.configureTokenLists=function(){var a,b,c,d,e,f,g,h,i,j,k;for(a=["year","month","day"],i=CSL.AREAS.length,c=0;i>c;c+=1)for(b=CSL.AREAS[c],j=this[b].tokens.length-1,g=j;g>-1;g+=-1){if(d=this[b].tokens[g],"date"===d.name&&CSL.END===d.tokentype&&(e=[]),"date-part"===d.name&&d.strings.name)for(k=a.length,h=0;k>h;h+=1)f=a[h],f===d.strings.name&&e.push(d.strings.name);"date"===d.name&&CSL.START===d.tokentype&&(e.reverse(),d.dateparts=e),d.next=g+1,d.name&&CSL.Node[d.name].configure&&CSL.Node[d.name].configure.call(d,this,g)}return this.version=CSL.version,this.state},CSL.Engine.prototype.retrieveItems=function(a){var b;b=[];for(var e=0,f=a.length;f>e;e+=1)b.push(this.retrieveItem(""+a[e]));return b},CSL.ITERATION=0,CSL.Engine.prototype.retrieveItem=function(a){var b,c,d,e,f;if(this.opt.development_extensions.normalize_lang_keys_to_lowercase&&"boolean"==typeof this.opt.development_extensions.normalize_lang_keys_to_lowercase){for(var g=0,h=this.opt["default-locale"].length;h>g;g+=1)this.opt["default-locale"][g]=this.opt["default-locale"][g].toLowerCase();for(var g=0,h=this.opt["locale-translit"].length;h>g;g+=1)this.opt["locale-translit"][g]=this.opt["locale-translit"][g].toLowerCase();for(var g=0,h=this.opt["locale-translat"].length;h>g;g+=1)this.opt["locale-translat"][g]=this.opt["locale-translat"][g].toLowerCase();this.opt.development_extensions.normalize_lang_keys_to_lowercase=100
}if(CSL.ITERATION+=1,b=this.sys.retrieveItem(""+a),this.opt.development_extensions.normalize_lang_keys_to_lowercase){if(b.multi){if(b.multi._keys)for(var i in b.multi._keys)for(var j in b.multi._keys[i])j!==j.toLowerCase()&&(b.multi._keys[i][j.toLowerCase()]=b.multi._keys[i][j],delete b.multi._keys[i][j]);if(b.multi.main)for(var i in b.multi.main)b.multi.main[i]=b.multi.main[i].toLowerCase()}for(var g=0,h=CSL.CREATORS.length;g>h;g+=1){var k=CSL.CREATORS[g];if(b[k]&&b[k].multi)for(var l=0,m=b[k].length;m>l;l+=1){var n=b[k][l];if(n.multi){if(n.multi._key)for(var j in n.multi._key)j!==j.toLowerCase()&&(n.multi._key[j.toLowerCase()]=n.multi._key[j],delete n.multi._key[j]);n.multi.main&&(n.multi.main=n.multi.main.toLowerCase())}}}}if(b.page){b["page-first"]=b.page;var o=""+b.page;c=o.split(/\s*(?:&|,|-|\u2013)\s*/),"\\"!==c[0].slice(-1)&&(b["page-first"]=c[0])}if(this.opt.development_extensions.field_hack&&b.note&&(c=b.note.match(CSL.NOTE_FIELDS_REGEXP)))for(d=0,e=c.length;e>d;d+=1){if(f=c[d].match(CSL.NOTE_FIELD_REGEXP),!b[f[1]]&&CSL.DATE_VARIABLES.indexOf(f[1])>-1)b[f[1]]={raw:f[2]};else if(!b[f[1]]&&CSL.NAME_VARIABLES.indexOf(f[1])>-1){b[f[1]]||(b[f[1]]=[]);var q=f[2].split(/\s*\|\|\s*/);1===q.length?b[f[1]].push({family:q[0],isInstitution:!0}):2===q.length&&b[f[1]].push({family:q[0],given:q[1]})}else b[f[1]]&&"type"!==f[1]||(b[f[1]]=f[2].replace(/^\s+/,"").replace(/\s+$/,""));b.note.replace(CSL.NOTE_FIELD_REGEXP,"")}for(var g=1,h=CSL.DATE_VARIABLES.length;h>g;g+=1){var r=b[CSL.DATE_VARIABLES[g]];r&&(this.opt.development_extensions.raw_date_parsing&&r.raw&&(r=this.fun.dateparser.parse(r.raw)),b[CSL.DATE_VARIABLES[g]]=this.dateParseArray(r))}if(this.opt.development_extensions.static_statute_locator&&b.type&&["bill","gazette","legislation","treaty"].indexOf(b.type)>-1){var s,t=["type","title","jurisdiction","genre","volume","container-title"],u=[];for(g=0,h=t.length;h>g;g+=1)s=t[g],b[s]&&u.push(b[s]);for(t=["original-date","issued"],g=0,t.length;h>g;g+=1)if(s=t[g],b[s]&&b[s].year){var v=b[s].year;u.push(v);break}b.legislation_id=u.join("::")}if(b["title-short"]||(b["title-short"]=b.shortTitle),this.opt.development_extensions.main_title_from_short_title&&(b["title-main"]=b.title,b["title-sub"]=!1,b.title&&b["title-short"])){var w=b["title-short"];if(offset=w.length,b.title.slice(0,offset)===w&&b.title.slice(offset).match(/^\s*:/)){if(b["title-main"]=b.title.slice(0,offset).replace(/\s+$/,""),b["title-sub"]=b.title.slice(offset).replace(/^\s*:\s*/,""),this.opt.development_extensions.uppercase_subtitles&&b["title-sub"])for(var x=b["title-sub"],g=0,h=x.length;h>g;g++)if(x.charAt(g).toLowerCase()!==x.charAt(g).toUpperCase()){b["title-sub"]=x.slice(0,g)+x.charAt(g).toUpperCase()+x.slice(g+1);break}var y=offset+b.title.length-b["title-main"].length-b["title-sub"].length;b.title=b.title.slice(0,y)+b["title-sub"]}}var z=["legal_case","legislation","gazette","regulation"].indexOf(b.type)>-1;if(!z&&b.title&&this.sys.getAbbreviation){var A=!1;b.jurisdiction||(A=!0);var B=this.transform.loadAbbreviation(b.jurisdiction,"title",b.title,b.type,!0);this.transform.abbrevs[B].title&&this.transform.abbrevs[B].title[b.title]&&(b["title-short"]=this.transform.abbrevs[B].title[b.title])}if(b["container-title-short"]=b.journalAbbreviation,b["container-title"]&&this.sys.getAbbreviation){var B=this.transform.loadAbbreviation(b.jurisdiction,"container-title",b["container-title"]);this.transform.abbrevs[B]["container-title"]&&this.transform.abbrevs[B]["container-title"][b["container-title"]]&&(b["container-title-short"]=this.transform.abbrevs[B]["container-title"][b["container-title"]])}return b},CSL.Engine.prototype.setOpt=function(a,b,c){"style"===a.name||"cslstyle"===a.name?this.opt[b]=c:["citation","bibliography"].indexOf(a.name)>-1?this[a.name].opt[b]=c:-1===["name-form","name-delimiter","names-delimiter"].indexOf(b)&&(a.strings[b]=c)},CSL.Engine.prototype.fixOpt=function(a,b,c){["citation","bibliography"].indexOf(a.name)>-1&&(this[a.name].opt[b]||"undefined"==typeof this.opt[b]||(this[a.name].opt[b]=this.opt[b])),("name"===a.name||"names"===a.name)&&"undefined"==typeof a.strings[c]&&"undefined"!=typeof this[this.build.root].opt[b]&&(a.strings[c]=this[this.build.root].opt[b])},CSL.Engine.prototype.remapSectionVariable=function(a){for(var b=0,c=a.length;c>b;b+=1){var d=a[b][0],e=a[b][1],h=!1;if(["bill","gazette","legislation","treaty"].indexOf(d.type)>-1){e.force_pluralism=0,e.label||(e.label="page");var i=["section","","",""];if(this.opt.development_extensions.static_statute_locator&&d.section?(k=d.section.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/),CSL.STATUTE_SUBDIV_STRINGS[k[0]]?(i[0]=" "+k[0]+" ",i[1]=k.slice(1).join(" ")):(i[0]=" sec. ",i[1]=k.slice(0).join(" "))):this.opt.development_extensions.clobber_locator_if_no_statute_section&&(e.locator=void 0,e.label=void 0),e.locator){var k=e.locator.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/);CSL.STATUTE_SUBDIV_STRINGS[k[0]]?(i[2]=" "+k[0]+" ",i[3]=k.slice(1).join(" ")):e.label?(i[2]=" "+CSL.STATUTE_SUBDIV_STRINGS_REVERSE[e.label]+" ",i[3]=k.slice(0).join(" ")):i[3]=k.join(" "),i[3]&&"&"===i[3].slice(0,1)&&(i[3]=" "+i[3])}if(i[2]||(i[2]=i[0]),i[3]){if(i[3].match(/^[^0-9a-zA-Z]/)){var l=i[3].split(/\s+/);i[0]===i[2]&&l[1]&&!CSL.STATUTE_SUBDIV_STRINGS[l[1].replace(/\s+/,"").replace(/\s+/,"")]&&(e.force_pluralism=1),i[2]=""}}else i[2]="";i[1]||(i[0]="");var h=i.join("");if(h=h.replace(/^\s+/,"").replace(/\s+$/,""))if(k=h.split(/\s+/),CSL.STATUTE_SUBDIV_STRINGS[k[0]]){for(var n=k.length-2;n>0;n+=-2)k[n]===k[0]&&(e.force_pluralism=1,k=k.slice(0,n).concat(k.slice(n+1)));e.label=CSL.STATUTE_SUBDIV_STRINGS[k[0]],e.locator=k.slice(1).join(" "),0===e.force_pluralism&&delete e.force_pluralism}else e.locator=k.slice(0).join(" ")}}},CSL.Engine.prototype.setNumberLabels=function(a){if(a.number&&["bill","gazette","legislation","treaty"].indexOf(a.type)>-1&&this.opt.development_extensions.static_statute_locator&&!this.tmp.shadow_numbers.number){this.tmp.shadow_numbers.number={},this.tmp.shadow_numbers.number.values=[],this.tmp.shadow_numbers.number.plural=0,this.tmp.shadow_numbers.number.numeric=!1,this.tmp.shadow_numbers.number.label=!1;var b=""+a.number;b=b.replace("\\","","g");var c=b.split(/\s/)[0],d=CSL.STATUTE_SUBDIV_STRINGS[c];if(d){var e=b.match(CSL.STATUTE_SUBDIV_GROUPED_REGEX),f=b.split(CSL.STATUTE_SUBDIV_PLAIN_REGEX);if(f.length>1){for(var g=[],h=1,i=f.length;i>h;h+=1){var j=e[h-1].replace(/^\s*/,"");g.push(j.replace("sec.","Sec.").replace("ch.","Ch.")),g.push(f[h].replace(/\s*$/,"").replace(/^\s*/,""))}b=g.join(" ")}else b=f[0];this.tmp.shadow_numbers.number.values.push(["Blob",b,!1]),this.tmp.shadow_numbers.number.numeric=!1}else this.tmp.shadow_numbers.number.values.push(["Blob",b,!1]),this.tmp.shadow_numbers.number.numeric=!0}},CSL.substituteOne=function(a){return function(b,c){return c?a.replace("%%STRING%%",c):""}},CSL.substituteTwo=function(a){return function(b){var c=a.replace("%%PARAM%%",b);return function(a,b){return b?c.replace("%%STRING%%",b):""}}},CSL.Mode=function(a){var b,c,d,e,f,g;b={},c=CSL.Output.Formats[a];for(d in c)if("@"===d.slice(0,1)){if(e=!1,f=c[d],g=d.split("/"),"string"==typeof f&&f.indexOf("%%STRING%%")>-1)e=f.indexOf("%%PARAM%%")>-1?CSL.substituteTwo(f):CSL.substituteOne(f);else if("boolean"!=typeof f||f){if("function"!=typeof f)throw"CSL.Compiler: Bad "+a+" config entry for "+d+": "+f;e=f}else e=CSL.Output.Formatters.passthrough;1===g.length?b[g[0]]=e:2===g.length&&(b[g[0]]||(b[g[0]]={}),b[g[0]][g[1]]=e)}else b[d]=c[d];return b},CSL.setDecorations=function(a,b){var c,d,e;c=[];for(e in CSL.FORMAT_KEY_SEQUENCE)d=CSL.FORMAT_KEY_SEQUENCE[e],b[d]&&(c.push([d,b[d]]),delete b[d]);return c},CSL.Engine.prototype.normalDecorIsOrphan=function(a,b){if("normal"===b[1]){var d,c=!1;d="citation"===this.tmp.area?[this.citation.opt.layout_decorations].concat(a.alldecor):a.alldecor;for(var e=d.length-1;e>-1;e+=-1)for(var f=d[e].length-1;f>-1;f+=-1)d[e][f][0]===b[0]&&"normal"!==d[e][f][1]&&(c=!0);if(!c)return!0}return!1},CSL.Engine.prototype.getCitationLabel=function(a){var b="",c=this.getTrigraphParams(),d=c[0],e=this.getTerm("reference","short",0);"undefined"==typeof e&&(e="reference"),e=e.replace(".",""),e=e.slice(0,1).toUpperCase()+e.slice(1);for(var f=0,g=CSL.CREATORS.length;g>f;f+=1){var h=CSL.CREATORS[f];if(a[h]){var i=a[h];d=i.length>c.length?c[c.length-1]:c[i.length-1];for(var j=0,k=i.length;k>j&&j!==d.authors.length;j+=1){var l=this.nameOutput.getName(i[j],"locale-translit",!0),m=l.name;m&&m.family?(e=m.family,e=e.replace(/^([ \'\u2019a-z]+\s+)/,"")):m&&m.literal&&(e=m.literal);var n=e.toLowerCase().match(/^(a\s+|the\s+|an\s+)/);if(n&&(e=e.slice(n[1].length)),e=e.replace(CSL.ROMANESQUE_NOT_REGEXP,"","g"),!e)break;e=e.slice(0,d.authors[j]),e.length>1?e=e.slice(0,1).toUpperCase()+e.slice(1).toLowerCase():1===e.length&&(e=e.toUpperCase()),b+=e}break}}var o="0000";return a.issued&&a.issued.year&&(o=""+a.issued.year),o=o.slice(-1*d.year),b+=o},CSL.Engine.prototype.getTrigraphParams=function(){var a=[],b=this.opt.trigraph.split(":");if(!this.opt.trigraph||"A"!==this.opt.trigraph.slice(0,1))throw"Bad trigraph definition: "+this.opt.trigraph;for(var c=0,d=b.length;d>c;c+=1){for(var e=b[c],f={authors:[],year:0},g=0,h=e.length;h>g;g+=1)switch(e.slice(g,g+1)){case"A":f.authors.push(1);break;case"a":f.authors[f.authors.length-1]+=1;break;case"0":f.year+=1;break;default:throw"Invalid character in trigraph definition: "+this.opt.trigraph}a.push(f)}return a},CSL.Engine.prototype.setOutputFormat=function(a){this.opt.mode=a,this.fun.decorate=CSL.Mode(a),this.output[a]||(this.output[a]={},this.output[a].tmp={})},CSL.Engine.prototype.getSortFunc=function(){return function(a,b){return a=a.split("-"),b=b.split("-"),a.length<b.length?1:a.length>b.length?-1:(a=a.slice(-1)[0],b=b.slice(-1)[0],a.length<b.length?1:a.length>b.length?-1:0)}},CSL.Engine.prototype.setLangTagsForCslSort=function(a){var b,c;if(a)for(this.opt["locale-sort"]=[],b=0,c=a.length;c>b;b+=1)this.opt["locale-sort"].push(a[b]);this.opt["locale-sort"].sort(this.getSortFunc())},CSL.Engine.prototype.setLangTagsForCslTransliteration=function(a){var b,c;if(this.opt["locale-translit"]=[],a)for(b=0,c=a.length;c>b;b+=1)this.opt["locale-translit"].push(a[b]);this.opt["locale-translit"].sort(this.getSortFunc())},CSL.Engine.prototype.setLangTagsForCslTranslation=function(a){var b,c;if(this.opt["locale-translat"]=[],a)for(b=0,c=a.length;c>b;b+=1)this.opt["locale-translat"].push(a[b]);this.opt["locale-translat"].sort(this.getSortFunc())},CSL.Engine.prototype.setLangPrefsForCites=function(a,b){var c=this.opt["cite-lang-prefs"];b||(b=function(a){return a.toLowerCase()});for(var d=["Persons","Institutions","Titles","Journals","Publishers","Places"],e=0,f=d.length;f>e;e+=1){var g=b(d[e]),h=d[e].toLowerCase();if(a[g]){for(var i=[];a[g].length>1;)i.push(a[g].pop());var j={orig:1,translit:2,translat:3};for(2===i.length&&j[i[0]]<j[i[1]]&&i.reverse();i.length;)a[g].push(i.pop());for(var k=c[h];k.length;)k.pop();for(var l=0,m=a[g].length;m>l;l+=1)k.push(a[g][l])}}},CSL.Engine.prototype.setLangPrefsForCiteAffixes=function(a){if(a&&48===a.length){for(var f,b=this.opt.citeAffixes,c=0,d=["persons","institutions","titles","journals","publishers","places"],e=["translit","orig","translit","translat"],g=0,h=d.length;h>g;g+=1)for(var i=0,j=e.length;j>i;i+=1)f="",4===c%8?b[d[g]]["locale-"+e[i]].prefix||b[d[g]]["locale-"+e[i]].suffix||(f=a[c]?a[c]:"",b[d[g]]["locale-"+e[i]].prefix=f,f=a[c]?a[c+1]:"",b[d[g]]["locale-"+e[i]].suffix=f):(f=a[c]?a[c]:"",b[d[g]]["locale-"+e[i]].prefix=f,f=a[c]?a[c+1]:"",b[d[g]]["locale-"+e[i]].suffix=f),c+=2;this.opt.citeAffixes=b}},CSL.Engine.prototype.setAutoVietnameseNamesOption=function(a){this.opt["auto-vietnamese-names"]=a?!0:!1},CSL.Engine.prototype.setAbbreviations=function(a){this.sys.setAbbreviations&&this.sys.setAbbreviations(a)},CSL.Engine.prototype.setSuppressTrailingPunctuation=function(a){this.citation.opt.suppressTrailingPunctuation=!!a},CSL.Output={},CSL.Output.Queue=function(a){this.levelname=["top"],this.state=a,this.queue=[],this.empty=new CSL.Token("empty");var b={};b.empty=this.empty,this.formats=new CSL.Stack(b),this.current=new CSL.Stack(this.queue)},CSL.Output.Queue.prototype.pop=function(){var a=this.current.value();return a.length?a.pop():a.blobs.pop()},CSL.Output.Queue.prototype.getToken=function(a){var b=this.formats.value()[a];return b},CSL.Output.Queue.prototype.mergeTokenStrings=function(a,b){var c,d,e,f;if(c=this.formats.value()[a],d=this.formats.value()[b],e=c,d){c||(c=new CSL.Token(a,CSL.SINGLETON),c.decorations=[]),e=new CSL.Token(a,CSL.SINGLETON),f="";for(f in c.strings)c.strings.hasOwnProperty(f)&&(e.strings[f]=c.strings[f]);for(f in d.strings)d.strings.hasOwnProperty(f)&&(e.strings[f]=d.strings[f]);e.decorations=c.decorations.concat(d.decorations)}return e},CSL.Output.Queue.prototype.addToken=function(a,b,c){var d,e;if(d=new CSL.Token("output"),"string"==typeof c&&(c=this.formats.value()[c]),c&&c.strings){for(e in c.strings)c.strings.hasOwnProperty(e)&&(d.strings[e]=c.strings[e]);d.decorations=c.decorations}"string"==typeof b&&(d.strings.delimiter=b),this.formats.value()[a]=d},CSL.Output.Queue.prototype.pushFormats=function(a){a||(a={}),a.empty=this.empty,this.formats.push(a)},CSL.Output.Queue.prototype.popFormats=function(){this.formats.pop()},CSL.Output.Queue.prototype.startTag=function(a,b){var c={};this.state.tmp["doing-macro-with-date"]&&this.state.tmp.extension&&(b=this.empty,a="empty"),c[a]=b,this.pushFormats(c),this.openLevel(a)},CSL.Output.Queue.prototype.endTag=function(){this.closeLevel(),this.popFormats()},CSL.Output.Queue.prototype.openLevel=function(a){var c,d;if("object"==typeof a)c=new CSL.Blob(void 0,a);else if("undefined"==typeof a)c=new CSL.Blob(void 0,this.formats.value().empty,"empty");else{if(!this.formats.value()||!this.formats.value()[a])throw'CSL processor error: call to nonexistent format token "'+a+'"';c=new CSL.Blob(void 0,this.formats.value()[a],a)}this.nestedBraces&&(c.strings.prefix=c.strings.prefix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),c.strings.prefix=c.strings.prefix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1]),c.strings.suffix=c.strings.suffix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),c.strings.suffix=c.strings.suffix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1])),d=this.current.value(),d.push(c),this.current.push(c)},CSL.Output.Queue.prototype.closeLevel=function(a){a&&a!==this.current.value().levelname&&CSL.error("Level mismatch error:  wanted "+a+" but found "+this.current.value().levelname),this.current.pop()},CSL.Output.Queue.prototype.append=function(a,b,c,d,e){var f,g,h,i=!0;if(c&&(d=!0),this.state.tmp["doing-macro-with-date"]&&!c){if("macro-with-date"!==b)return!1;"macro-with-date"===b&&(b="empty")}if("undefined"==typeof a)return!1;if("number"==typeof a&&(a=""+a),!c&&this.state.tmp.element_trace&&"suppress-me"===this.state.tmp.element_trace.value())return!1;if(g=!1,b?"literal"===b?(f=!0,i=!1):f="string"==typeof b?this.formats.value()[b]:b:f=this.formats.value().empty,!f)throw"CSL processor error: unknown format token name: "+b;if(f.strings&&"undefined"==typeof f.strings.delimiter&&(f.strings.delimiter=""),"string"==typeof a&&a.length&&(a=a.replace(/ ([:;?!\u00bb])/g,"\u202f$1").replace(/\u00ab /g,"\xab\u202f"),this.last_char_rendered=a.slice(-1),a=a.replace(/\s+'/g,"  '").replace(/^'/g," '"),d?c&&(this.state.tmp.term_predecessor_name=!0):this.state.tmp.term_predecessor=!0),g=new CSL.Blob(a,f),this.nestedBraces&&(g.strings.prefix=g.strings.prefix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),g.strings.prefix=g.strings.prefix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1]),g.strings.suffix=g.strings.suffix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),g.strings.suffix=g.strings.suffix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1])),h=this.current.value(),"undefined"==typeof h&&0===this.current.mystack.length&&(this.current.mystack.push([]),h=this.current.value()),"string"==typeof g.blobs&&(d?c&&(this.state.tmp.term_predecessor_name=!0):this.state.tmp.term_predecessor=!0),c||this.state.parallel.AppendBlobPointer(h),"string"==typeof a){h.push(g),g.strings["text-case"]&&(g.blobs=CSL.Output.Formatters[g.strings["text-case"]](this.state,a)),this.state.tmp.strip_periods&&!e&&(g.blobs=g.blobs.replace(/\.([^a-z]|$)/g,"$1"));for(var j=g.decorations.length-1;j>-1;j+=-1)"@quotes"===g.decorations[j][0]&&"true"===g.decorations[j][1]&&(g.punctuation_in_quote=this.state.getOpt("punctuation-in-quote")),g.blobs.match(CSL.ROMANESQUE_REGEXP)||"@font-style"===g.decorations[j][0]&&(g.decorations=g.decorations.slice(0,j).concat(g.decorations.slice(j+1)));this.state.fun.flipflopper.init(a,g),this.state.fun.flipflopper.processTags()}else i?h.push(g):h.push(a);return!0},CSL.Output.Queue.prototype.string=function(a,b,c){var d,e,f,g,h,i=CSL.getSafeEscape(this.state),j=b.slice(),k=[];if(0===j.length)return k;var l="";c?l=c.strings.delimiter:(a.tmp.count_offset_characters=!1,a.tmp.offset_characters=0),c&&c.new_locale&&(c.old_locale=a.opt.lang,a.opt.lang=c.new_locale);var m,n,o,p;for(d=0,e=j.length;e>d;d+=1){if(m=j[d],m.strings.first_blob&&(a.tmp.count_offset_characters=m.strings.first_blob),"string"==typeof m.blobs){if("number"==typeof m.num)k.push(m);else if(m.blobs){h=i(m.blobs);var q=h.length;if(!a.tmp.suppress_decorations)for(f=0,g=m.decorations.length;g>f;f+=1)p=m.decorations[f],"@showid"!==p[0]&&(a.normalDecorIsOrphan(m,p)||(h=a.fun.decorate[p[0]][p[1]].call(m,a,h,p[2])));if(h&&h.length){if(h=i(m.strings.prefix,a.tmp.nestedBraces)+h+i(m.strings.suffix,a.tmp.nestedBraces),(a.opt.development_extensions.csl_reverse_lookup_support||a.sys.csl_reverse_lookup_support)&&!a.tmp.suppress_decorations)for(f=0,g=m.decorations.length;g>f;f+=1)p=m.decorations[f],"@showid"===p[0]&&(h=a.fun.decorate[p[0]][p[1]].call(m,a,h,p[2]));k.push(h),a.tmp.count_offset_characters&&(a.tmp.offset_characters+=q+m.strings.suffix.length+m.strings.prefix.length)}}}else if(m.blobs.length){var r=a.output.string(a,m.blobs,m);k=k.concat(r)}m.strings.first_blob&&(a.registry.registry[m.strings.first_blob].offset=a.tmp.offset_characters,a.tmp.count_offset_characters=!1)}for(d=0,e=k.length-1;e>d;d+=1)"number"!=typeof k[d].num||"number"!=typeof k[d+1].num||k[d+1].UGLY_DELIMITER_SUPPRESS_HACK||(k[d].strings.suffix=k[d].strings.suffix+(l?l:""),k[d+1].successor_prefix="",k[d+1].UGLY_DELIMITER_SUPPRESS_HACK=!0);var s=0;for(d=0,e=k.length;e>d;d+=1)"string"==typeof k[d]&&(s=parseInt(d,10)+1,d<k.length-1&&"object"==typeof k[d+1]&&(l&&!k[d+1].UGLY_DELIMITER_SUPPRESS_HACK&&(k[d]+=i(l)),k[d+1].UGLY_DELIMITER_SUPPRESS_HACK=!0));c&&(c.decorations.length||c.strings.suffix||c.strings.prefix)&&(s=k.length);var t=a.output.renderBlobs(k.slice(0,s),l,!0,c);if(t&&c&&(c.decorations.length||c.strings.suffix||c.strings.prefix)){if(!a.tmp.suppress_decorations)for(d=0,e=c.decorations.length;e>d;d+=1)p=c.decorations[d],["@cite","@bibliography","@display","@showid"].indexOf(p[0])>-1||a.normalDecorIsOrphan(m,p)||"string"==typeof t&&(t=a.fun.decorate[p[0]][p[1]].call(c,a,t,p[2]));if(h=t,n=c.strings.suffix,h&&h.length&&(o=c.strings.prefix,h=i(o,a.tmp.nestedBraces)+h+i(n,a.tmp.nestedBraces),a.tmp.count_offset_characters&&(a.tmp.offset_characters+=o.length+n.length)),t=h,!a.tmp.suppress_decorations)for(d=0,e=c.decorations.length;e>d;d+=1)p=c.decorations[d],-1!==["@cite","@bibliography","@display","@showid"].indexOf(p[0])&&"string"==typeof t&&(t=a.fun.decorate[p[0]][p[1]].call(c,a,t,p[2]))}var u=k.slice(s,k.length);return!u.length&&t?k=[t]:u.length&&!t?k=u:t&&u.length&&(k=[t].concat(u)),"undefined"==typeof c?(this.queue=[],this.current.mystack=[],this.current.mystack.push(this.queue),a.tmp.suppress_decorations&&(k=a.output.renderBlobs(k,void 0,!0))):"boolean"==typeof c&&(k=a.output.renderBlobs(k,void 0,!0)),c&&c.new_locale&&(a.opt.lang=c.old_locale),k},CSL.Output.Queue.prototype.clearlevel=function(){var a,b,c;for(a=this.current.value(),c=a.blobs.length,b=0;c>b;b+=1)a.blobs.pop()},CSL.Output.Queue.prototype.renderBlobs=function(a,b,c,d){var e,f,g,h,j,k,l,m,n,r,s,t;if(t=CSL.getSafeEscape(this.state),b||(b=""),e=this.state,f="",g=[],h="",l=a.length,"citation"===this.state.tmp.area&&!this.state.tmp.just_looking&&1===l&&"object"==typeof a[0]&&d)return a[0].strings.prefix=d.strings.prefix+a[0].strings.prefix,a[0].strings.suffix=a[0].strings.suffix+d.strings.suffix,a[0].decorations=a[0].decorations.concat(d.decorations),a[0].params=d.params,a[0];var u=!0;for(k=0;l>k;k+=1)a[k].checkNext?(a[k].checkNext(a[k+1],u),u=!1):u=!0;var v=!0;for(k=a.length-1;k>0;k+=-1)a[k].checkLast?v&&a[k].checkLast(a[k-1])&&(v=!1):v=!0;for(l=a.length,k=0;l>k;k+=1)if(j=a[k],f&&(h=b),"string"==typeof j)f+=t(h),f+=j,e.tmp.count_offset_characters&&(e.tmp.offset_characters+=h.length);else if(j.status!==CSL.SUPPRESS){r=j.formatter.format(j.num,j.gender);var w=r.replace(/<[^>]*>/g,"").length;this.append(r,"empty",!0);var x=this.pop(),y=e.tmp.count_offset_characters;if(r=this.string(e,[x],!1),e.tmp.count_offset_characters=y,j.strings["text-case"]&&(r=CSL.Output.Formatters[j.strings["text-case"]](this.state,r)),r&&this.state.tmp.strip_periods&&(r=r.replace(/\.([^a-z]|$)/g,"$1")),!e.tmp.suppress_decorations)for(n=j.decorations.length,m=0;n>m;m+=1)s=j.decorations[m],e.normalDecorIsOrphan(j,s)||(r=e.fun.decorate[s[0]][s[1]].call(j,e,r,s[2]));r=t(j.strings.prefix)+r+t(j.strings.suffix);var z="";j.status===CSL.END?z=t(j.range_prefix):j.status===CSL.SUCCESSOR?z=t(j.successor_prefix):j.status===CSL.START?z="":j.status===CSL.SEEN&&(z=t(j.splice_prefix)),f+=z,f+=r,e.tmp.count_offset_characters&&(e.tmp.offset_characters+=z.length+j.strings.prefix.length+w+j.strings.suffix.length)}return f},CSL.Output.Queue.purgeEmptyBlobs=function(a){if("object"==typeof a&&"object"==typeof a.blobs&&a.blobs.length)for(var b=a.blobs.length-1;b>-1;b--){CSL.Output.Queue.purgeEmptyBlobs(a.blobs[b]);var c=a.blobs[b];if(!c||!c.blobs||!c.blobs.length){for(var d=[];a.blobs.length-1>b;)d.push(a.blobs.pop());for(a.blobs.pop();d.length;)a.blobs.push(d.pop())}}},CSL.Output.Queue.adjust=function(a){function l(a){return"number"==typeof a.num||a.blobs&&1===a.blobs.length&&"number"==typeof a.blobs[0].num}function m(a){return"number"==typeof a.num?!0:a.blobs&&"object"==typeof a.blobs?m(a.blobs[a.blobs.length-1])?!0:void 0:!1}function n(a,b){var c=!1,d=["@font-style","@font-variant","@font-weight","@text-decoration","@vertical-align"];if(b&&d.push("@quotes"),a.decorations)for(var e=0,f=a.decorations.length;f>e;e++)if(d.indexOf(a.decorations[e][0])>-1){c=!0;break}return c}function o(a){if(a.decorations)for(var b=0,c=a.decorations.length;c>b;b++)if("@quotes"===a.decorations[b][0])return!0;return"object"!=typeof a.blobs?!1:o(a.blobs[a.blobs.length-1])?!0:!1}function p(a,b){var c=b.strings.suffix.slice(-1);c||"string"!=typeof b.blobs||(c=b.blobs.slice(-1));var d=j[a][c];return d&&1===d.length?!0:"object"!=typeof b.blobs?!1:p(a,b.blobs[b.blobs.length-1])?!0:!1}function q(a,b){if(!g[b])return!1;if("string"==typeof a.blobs)return a.blobs.slice(-1)===b?!0:!1;var c=a.blobs[a.blobs.length-1];if(c){var d=c.strings.suffix.slice(-1);return d?c.strings.suffix.slice(-1)==b?!0:!1:q(c,b)}return!1}function r(a,b,c,e,f){function i(){SecondStrings[e]=SecondStrings[e].slice(1)}function k(){FirstStrings[b]=FirstStrings[b].slice(0,-1)}function l(a){SecondStrings[e]=a+SecondStrings[e]}function m(a){FirstStrings[b]+=a}function o(){return j[h]}function p(){return d[g]}function r(){var a=d[g][h];"string"==typeof a?(k(),i(),l(a)):(l(g),k())}function s(){var a=j[h][g];"string"==typeof a?(k(),i(),m(a)):(m(h),i())}FirstStrings="blobs"===b?a:a.strings,SecondStrings="blobs"===e?c:c.strings;var g=FirstStrings[b].slice(-1),h=SecondStrings[e].slice(0,1),n=f?k:i,q=f?p:o,t=f?r:s,u=g===h;u?n():q()&&t()}function s(a){if(a.blobs&&"string"==typeof a.blobs)return g[a.strings.suffix.slice(0,1)]&&a.strings.suffix.slice(0,1)===a.blobs.slice(-1)&&(a.strings.suffix=a.strings.suffix.slice(1)),void 0;if("object"==typeof a&&"object"==typeof a.blobs&&a.blobs.length)for(var b=n(a,!0),c=a.blobs.length-1;c>-1;c--){c===a.blobs.length-1,this.upward(a.blobs[c]);var e=a.strings,f=a.blobs[c].strings;if(0===c){" "===e.prefix.slice(-1)&&" "===f.prefix.slice(0,1)&&(f.prefix=f.prefix.slice(1));var i=f.prefix.slice(0,1);b||!h[i]||e.prefix||(e.prefix+=i,f.prefix=f.prefix.slice(1))}if(c===a.blobs.length-1){var i=f.suffix.slice(-1);!b&&[" "].indexOf(i)>-1&&(e.suffix.slice(0,1)!==i&&(e.suffix=i+e.suffix),f.suffix=f.suffix.slice(0,-1))}e.delimiter&&c>0&&h[e.delimiter.slice(-1)]&&e.delimiter.slice(-1)===f.prefix.slice(0,1)&&(f.prefix=f.prefix.slice(1))}}function t(a){if("object"==typeof a&&"object"==typeof a.blobs&&a.blobs.length)for(var b=a.blobs.length-1;b>-1;b--)if(this.leftward(a.blobs[b]),b<a.blobs.length-1&&!a.strings.delimiter){var c=a.blobs[b],d=c.strings.suffix.slice(-1),e=a.blobs[b+1],f=e.strings.prefix.slice(0,1),h=n(c)||n(e),i="number"==typeof d||"number"==typeof f;if(!h&&!i&&g[f]&&!i){var j=f===c.strings.suffix.slice(-1),k=!c.strings.suffix&&"string"==typeof c.blobs&&c.blobs.slice(-1)===f;j||k?e.strings.prefix=e.strings.prefix.slice(1):r(c,"suffix",e,"prefix")}}}function u(a){if(a.blobs&&"string"==typeof a.blobs)return g[a.strings.suffix.slice(0,1)]&&a.strings.suffix.slice(0,1)===a.blobs.slice(-1)&&(a.strings.suffix=a.strings.suffix.slice(1)),void 0;if("object"==typeof a&&"object"==typeof a.blobs&&a.blobs.length){for(var c=a.strings,d=!1,e=0,f=a.blobs.length;f>e;e++)if(l(a.blobs[e])){d=!0;break}if(!d&&c.delimiter&&g[c.delimiter.slice(0,1)]){for(var i=c.delimiter.slice(0,1),e=a.blobs.length-2;e>-1;e--){var j=a.blobs[e].strings;j.suffix.slice(-1)!==i&&(j.suffix+=i)}c.delimiter=c.delimiter.slice(1)}n(a,!0),l(a);for(var e=a.blobs.length-1;e>-1;e--){var t=a.blobs[e],j=a.blobs[e].strings,u=n(t,!0),v=l(t);if(e===a.blobs.length-1){var w=c.suffix.slice(0,1),x=o(t);!x&&g[w]&&(x=p(w,t)),x&&g[w]&&(m(t)||("string"==typeof t.blobs?r(t,"blobs",a,"suffix"):r(t,"suffix",a,"suffix"),"."===c.suffix.slice(0,1)&&(j.suffix+=c.suffix.slice(0,1),c.suffix=c.suffix.slice(1)))),"\xa0"===j.suffix.slice(-1)&&" "===c.suffix.slice(0,1)&&(c.suffix=c.suffix.slice(1)),h[j.suffix.slice(0,1)]&&("string"==typeof t.blobs&&t.blobs.slice(-1)===j.suffix.slice(0,1)&&(j.suffix=j.suffix.slice(1)),j.suffix.slice(-1)===c.suffix.slice(0,1)&&(c.suffix=c.suffix.slice(0,-1))),q(a,a.strings.suffix.slice(0,1))&&(a.strings.suffix=a.strings.suffix.slice(1))}else if(c.delimiter)h[c.delimiter.slice(0,1)]&&c.delimiter.slice(0,1)===j.suffix.slice(-1)&&(a.blobs[e].strings.suffix=a.blobs[e].strings.suffix.slice(0,-1));else{var y=a.blobs[e+1].strings;l(t)||u||!h[j.suffix.slice(-1)]||j.suffix.slice(-1)!==y.prefix.slice(0,1)||(y.prefix=y.prefix.slice(1))}v||u||!g[j.suffix.slice(0,1)]||"string"!=typeof t.blobs||r(t,"blobs",t,"suffix"),this.downward(a.blobs[e])}}}function v(a){var b=a.strings.suffix.slice(0,1);if("string"==typeof a.blobs)for(;e[b];)r(a,"blobs",a,"suffix"),b=a.strings.suffix.slice(0,1);else for(;e[b];)r(a.blobs[a.blobs.length-1],"suffix",a,"suffix"),b=a.strings.suffix.slice(0,1)}function w(a){if("string"==typeof a.blobs)for(var b=a.blobs.slice(-1);f[b];)r(a,"blobs",a,"suffix",!0),b=a.blobs.slice(-1);else for(var b=a.blobs[a.blobs.length-1].strings.suffix.slice(-1);f[b];)r(a.blobs[a.blobs.length-1],"suffix",a,"suffix",!0),b=a.blobs[a.blobs.length-1].strings.suffix.slice(-1)}function x(b){if("object"==typeof b&&"object"==typeof b.blobs&&b.blobs.length){for(var c,d=0,e=b.blobs.length;e>d;d++){for(var f=b.blobs[d],g=!1,h=0,i=f.decorations.length;i>h;h++){var j=f.decorations[h];"@quotes"===j[0]&&(g=!0)}g&&(a?v(f):w(f)),c=this.fix(b.blobs[d]),f.blobs&&"string"==typeof f.blobs&&(c=f.blobs.slice(-1))}return c}}var b={";":!0,":":!0},c={".":!0,"!":!0,"?":!0};this.upward=s,this.leftward=t,this.downward=u,this.fix=x;var d={"!":{".":"!","?":"!?",":":"!",",":"!,",";":"!;"},"?":{"!":"?!",".":"?",":":"?",",":"?,",";":"?;"},".":{"!":".!","?":".?",":":".:",",":".,",";":".;"},":":{"!":"!","?":"?",".":":",",":":,",";":":;"},",":{"!":",!","?":",?",":":",:",".":",.",";":",;"},";":{"!":"!","?":"?",":":";",",":";,",".":";"}},e={},f={},g={},h={};for(var i in d)g[i]=!0,h[i]=!0,b[i]||(e[i]=!0),c[i]||(f[i]=!0);h[" "]=!0,h["\xa0"]=!0;var j={};for(var i in d)for(var k in d[i])j[k]||(j[k]={}),j[k][i]=d[i][k]},CSL.Engine.Opt=function(){this.has_disambiguate=!1,this.mode="html",this.dates={},this["locale-sort"]=[],this["locale-translit"]=[],this["locale-translat"]=[],this.citeAffixes={persons:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},institutions:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},titles:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},journals:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},publishers:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},places:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}}},this["default-locale"]=[],this.update_mode=CSL.NONE,this.bib_mode=CSL.NONE,this.sort_citations=!1,this["et-al-min"]=0,this["et-al-use-first"]=1,this["et-al-use-last"]=!1,this["et-al-subsequent-min"]=!1,this["et-al-subsequent-use-first"]=!1,this["demote-non-dropping-particle"]="display-and-sort",this["parse-names"]=!0,this.citation_number_slug=!1,this.trigraph="Aaaa00:AaAa00:AaAA00:AAAA00",this.nodenames=[],this.gender={},this["cite-lang-prefs"]={persons:["orig"],institutions:["orig"],titles:["orig","translat"],journals:["translit"],publishers:["orig"],places:["orig"],number:["translat"]},this.has_layout_locale=!1,this.development_extensions={},this.development_extensions.field_hack=!0,this.development_extensions.locator_date_and_revision=!0,this.development_extensions.locator_parsing_for_plurals=!0,this.development_extensions.locator_label_parse=!0,this.development_extensions.raw_date_parsing=!0,this.development_extensions.clean_up_csl_flaws=!0,this.development_extensions.flip_parentheses_to_braces=!0,this.development_extensions.jurisdiction_subfield=!0,this.development_extensions.static_statute_locator=!1,this.development_extensions.csl_reverse_lookup_support=!1,this.development_extensions.clobber_locator_if_no_statute_section=!1,this.development_extensions.wrap_url_and_doi=!1,this.development_extensions.allow_force_lowercase=!1,this.development_extensions.handle_parallel_articles=!1,this.development_extensions.thin_non_breaking_space_html_hack=!1,this.development_extensions.apply_citation_wrapper=!1,this.development_extensions.main_title_from_short_title=!1,this.development_extensions.uppercase_subtitles=!1,this.development_extensions.normalize_lang_keys_to_lowercase=!1,this.development_extensions.strict_text_case_locales=!1,this.development_extensions.rtl_support=!1,this.development_extensions.strict_page_numbers=!1,this.development_extensions.expect_and_symbol_form=!1,this.development_extensions.require_explicit_legal_case_title_short=!1},CSL.Engine.Tmp=function(){this.names_max=new CSL.Stack,this.names_base=new CSL.Stack,this.givens_base=new CSL.Stack,this.value=[],this.namepart_decorations={},this.namepart_type=!1,this.area="citation",this.root="citation",this.extension="",this.can_substitute=new CSL.Stack(0,CSL.LITERAL),this.element_rendered_ok=!1,this.element_trace=new CSL.Stack("style"),this.nameset_counter=0,this.group_context=new CSL.Stack([!1,!1,!1],CSL.LITERAL),this.term_predecessor=!1,this.jump=new CSL.Stack(0,CSL.LITERAL),this.decorations=new CSL.Stack,this.tokenstore_stack=new CSL.Stack,this.last_suffix_used="",this.last_names_used=[],this.last_years_used=[],this.years_used=[],this.names_used=[],this.taintedItemIDs={},this.taintedCitationIDs={},this.initialize_with=new CSL.Stack,this.disambig_request=!1,this["name-as-sort-order"]=!1,this.suppress_decorations=!1,this.disambig_settings=new CSL.AmbigConfig,this.bib_sort_keys=[],this.prefix=new CSL.Stack("",CSL.LITERAL),this.suffix=new CSL.Stack("",CSL.LITERAL),this.delimiter=new CSL.Stack("",CSL.LITERAL),this.cite_locales=[],this.cite_affixes={citation:!1,bibliography:!1,citation_sort:!1,bibliography_sort:!1},this.strip_periods=0,this.shadow_numbers={}
},CSL.Engine.Fun=function(a){this.match=new CSL.Util.Match,this.suffixator=new CSL.Util.Suffixator(CSL.SUFFIX_CHARS),this.romanizer=new CSL.Util.Romanizer,this.ordinalizer=new CSL.Util.Ordinalizer(a),this.long_ordinalizer=new CSL.Util.LongOrdinalizer},CSL.Engine.Build=function(){this["alternate-term"]=!1,this.in_bibliography=!1,this.in_style=!1,this.skip=!1,this.postponed_macro=!1,this.layout_flag=!1,this.name=!1,this.form=!1,this.term=!1,this.macro={},this.macro_stack=[],this.text=!1,this.lang=!1,this.area="citation",this.root="citation",this.extension="",this.substitute_level=new CSL.Stack(0,CSL.LITERAL),this.names_level=0,this.render_nesting_level=0,this.render_seen=!1},CSL.Engine.Configure=function(){this.fail=[],this.succeed=[]},CSL.Engine.Citation=function(a){this.opt={},this.tokens=[],this.srt=new CSL.Registry.Comparifier(a,"citation_sort"),this.opt.collapse=[],this.opt["disambiguate-add-names"]=!1,this.opt["disambiguate-add-givenname"]=!1,this.opt["disambiguate-add-year-suffix"]=!1,this.opt["givenname-disambiguation-rule"]="by-cite",this.opt["near-note-distance"]=5,this.opt.topdecor=[],this.opt.layout_decorations=[],this.opt.layout_prefix="",this.opt.layout_suffix="",this.opt.layout_delimiter="",this.opt.sort_locales=[],this.opt.max_number_of_names=0,this.root="citation"},CSL.Engine.Bibliography=function(){this.opt={},this.tokens=[],this.opt.collapse=[],this.opt.topdecor=[],this.opt.layout_decorations=[],this.opt.layout_prefix="",this.opt.layout_suffix="",this.opt.layout_delimiter="",this.opt["line-spacing"]=1,this.opt["entry-spacing"]=1,this.opt.sort_locales=[],this.opt.max_number_of_names=0,this.root="bibliography"},CSL.Engine.BibliographySort=function(){this.tokens=[],this.opt={},this.opt.sort_directions=[],this.keys=[],this.opt.topdecor=[],this.root="bibliography"},CSL.Engine.CitationSort=function(){this.tokens=[],this.opt={},this.opt.sort_directions=[],this.keys=[],this.opt.topdecor=[],this.root="citation"},CSL.Engine.prototype.previewCitationCluster=function(a,b,c,d){var e=this.opt.mode;this.setOutputFormat(d);var f=this.processCitationCluster(a,b,c,CSL.PREVIEW);return this.setOutputFormat(e),f[1]},CSL.Engine.prototype.appendCitationCluster=function(a){for(var b=[],c=this.registry.citationreg.citationByIndex.length,d=0;c>d;d+=1){var e=this.registry.citationreg.citationByIndex[d];b.push([""+e.citationID,e.properties.noteIndex])}return this.processCitationCluster(a,b,[])[1]},CSL.Engine.prototype.processCitationCluster=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;this.debug=!1,this.tmp.citation_errors=[];var u={bibchange:!1};this.setCitationId(a);var v,w,x;if(d===CSL.PREVIEW){v=this.registry.citationreg.citationByIndex.slice(),w=this.registry.reflist.slice();var y=b.concat([[""+a.citationID,a.properties.noteIndex]]).concat(c),z={},A=[];for(f=0,g=y.length;g>f;f+=1)for(e=this.registry.citationreg.citationById[y[f][0]],h=0,i=e.citationItems.length;i>h;h+=1)z[e.citationItems[h].id]=!0,A.push(""+e.citationItems[h].id);for(x={},f=0,g=w.length;g>f;f+=1)if(!z[w[f].id]){var B=this.registry.registry[w[f].id].ambig,C=this.registry.ambigcites[B];if(C)for(h=0,i=C.length;i>h;h+=1)x[C[h]]=CSL.cloneAmbigConfig(this.registry.registry[C[h]].disambig)}}this.tmp.taintedCitationIDs={};var D=[],E={};for(f=0,g=a.citationItems.length;g>f;f+=1){p={};for(n in a.citationItems[f])p[n]=a.citationItems[f][n];if(o=this.retrieveItem(""+p.id),o.id&&this.transform.loadAbbreviation("default","hereinafter",o.id),this.remapSectionVariable([[o,p]]),this.opt.development_extensions.locator_date_and_revision&&p.locator){p.locator=""+p.locator;var F=p.locator.indexOf("|");if(F>-1){var G=p.locator;p.locator=G.slice(0,F),G=G.slice(F+1),s=G.match(/^([0-9]{4}-[0-9]{2}-[0-9]{2}).*/),s&&(p["locator-date"]=this.fun.dateparser.parse(s[1]),G=G.slice(s[1].length)),p["locator-revision"]=G.replace(/^\s+/,"").replace(/\s+$/,"")}}this.opt.development_extensions.locator_label_parse&&(!p.locator||-1!==["bill","gazette","legislation","treaty"].indexOf(o.type)||p.label&&"page"!==p.label||(s=CSL.LOCATOR_LABELS_REGEXP.exec(p.locator),s&&(p.label=CSL.LOCATOR_LABELS_MAP[s[2]],p.locator=s[3])));var H=[o,p];D.push(H),a.citationItems[f].item=o}a.sortedItems=D;var I=[];for(f=0,g=b.length;g>f;f+=1)e=b[f],this.registry.citationreg.citationById[e[0]].properties.noteIndex=e[1],I.push(this.registry.citationreg.citationById[e[0]]);for(I.push(a),f=0,g=c.length;g>f;f+=1)e=c[f],this.registry.citationreg.citationById[e[0]].properties.noteIndex=e[1],I.push(this.registry.citationreg.citationById[e[0]]);this.registry.citationreg.citationByIndex=I,this.registry.citationreg.citationsByItemId={},this.opt.update_mode===CSL.POSITION&&(r=[],q=[],t={});var J=[];for(f=0,g=I.length;g>f;f+=1){for(I[f].properties.index=f,h=0,i=I[f].sortedItems.length;i>h;h+=1)p=I[f].sortedItems[h],this.registry.citationreg.citationsByItemId[p[1].id]||(this.registry.citationreg.citationsByItemId[p[1].id]=[],J.push(""+p[1].id)),-1===this.registry.citationreg.citationsByItemId[p[1].id].indexOf(I[f])&&this.registry.citationreg.citationsByItemId[p[1].id].push(I[f]);this.opt.update_mode===CSL.POSITION&&(I[f].properties.noteIndex?q.push(I[f]):(I[f].properties.noteIndex=0,r.push(I[f])))}if(d!==CSL.ASSUME_ALL_ITEMS_REGISTERED&&this.updateItems(J),!this.opt.citation_number_sort&&D&&D.length>1&&this.citation_sort.tokens.length>0){for(f=0,g=D.length;g>f;f+=1)D[f][1].sortkeys=CSL.getSortKeys.call(this,D[f][0],"citation_sort");if(this.opt.grouped_sort&&!a.properties.unsorted){for(f=0,g=D.length;g>f;f+=1){var K=D[f][1].sortkeys;this.tmp.authorstring_request=!0;var L=this.registry.registry[D[f][0].id].disambig;this.tmp.authorstring_request=!0,CSL.getAmbiguousCite.call(this,D[f][0],L);var M=this.registry.authorstrings[D[f][0].id];this.tmp.authorstring_request=!1,D[f][1].sortkeys=[M].concat(K)}D.sort(this.citation.srt.compareCompositeKeys);var N=!1,O=!1,P=!1;for(f=0,g=D.length;g>f;f+=1)D[f][1].sortkeys[0]!==N&&(P=D[f][1].sortkeys[0],O=D[f][1].sortkeys[1]),D[f][1].sortkeys[0]=""+O+f,N=P}a.properties.unsorted||D.sort(this.citation.srt.compareCompositeKeys)}var Q;if(this.opt.update_mode===CSL.POSITION)for(f=0;2>f;f+=1){Q=[r,q][f];var R={},S={};for(h=0,i=Q.length;i>h;h+=1){var T=Q[h];for(Q[h].properties.noteIndex||(Q[h].properties.noteIndex=0),Q[h].properties.noteIndex=parseInt(Q[h].properties.noteIndex,10),h>0&&Q[h-1].properties.noteIndex>Q[h].properties.noteIndex&&(t={},R={},S={}),j=0,k=T.sortedItems.length;k>j;j+=1)this.registry.registry[T.sortedItems[j][1].id].parallel||(t[T.properties.noteIndex]?t[T.properties.noteIndex]+=1:t[T.properties.noteIndex]=1);for(j=0,k=Q[h].sortedItems.length;k>j;j+=1){p=Q[h].sortedItems[j];var U=p[0].id,V=p[1].locator,W=p[1].label;p[0].legislation_id&&(U=p[0].legislation_id);var X;if(j>0&&(X=T.sortedItems[j-1][0].legislation_id?T.sortedItems[j-1][0].legislation_id:T.sortedItems[j-1][1].id),d!==CSL.PREVIEW||T.citationID==a.citationID){var Y={};if(Y.position=p[1].position,Y["first-reference-note-number"]=p[1]["first-reference-note-number"],Y["near-note"]=p[1]["near-note"],p[1]["first-reference-note-number"]=0,p[1]["near-note"]=!1,this.registry.citationreg.citationsByItemId[U]&&"note"===this.opt.xclass&&this.opt.has_disambiguate){var Z=this.registry.registry[U]["citation-count"],$=this.registry.citationreg.citationsByItemId[U].length;if(this.registry.registry[U]["citation-count"]=this.registry.citationreg.citationsByItemId[U].length,"number"==typeof Z){var _=2>Z,ab=2>$;if(_!==ab)for(var bb=0,cb=this.registry.citationreg.citationsByItemId[U].length;cb>bb;bb++)E[this.registry.registry[U].ambig]=!0,this.tmp.taintedCitationIDs[this.registry.citationreg.citationsByItemId[U][bb].citationID]=!0}else for(var bb=0,cb=this.registry.citationreg.citationsByItemId[U].length;cb>bb;bb++)E[this.registry.registry[U].ambig]=!0,this.tmp.taintedCitationIDs[this.registry.citationreg.citationsByItemId[U][bb].citationID]=!0}var db;if("undefined"==typeof R[U])R[U]=T.properties.noteIndex,this.registry.registry[U]&&(this.registry.registry[U]["first-reference-note-number"]=T.properties.noteIndex),S[U]=T.properties.noteIndex,p[1].position=CSL.POSITION_FIRST;else{var eb=!1,fb=!1;if(h>0&&(db=Q[h-1].sortedItems.slice(-1)[0][1].id,Q[h-1].sortedItems[0].slice(-1)[0].legislation_id&&(db=Q[h-1].sortedItems[0].slice(-1)[0].legislation_id)),h>0&&0===parseInt(j,10)&&Q[h-1].properties.noteIndex!==Q[h].properties.noteIndex){var gb=Q[h-1].sortedItems,hb=!1,ib=Q[h-1].sortedItems[0][0].id;for(Q[h-1].sortedItems[0][0].legislation_id&&(ib=Q[h-1].sortedItems[0][0].legislation_id),(ib==U&&Q[h-1].properties.noteIndex>=Q[h].properties.noteIndex-1||Q[h-1].sortedItems[0][1].id==this.registry.registry[p[1].id].parallel)&&(1===t[Q[h-1].properties.noteIndex]||0===Q[h-1].properties.noteIndex)&&(hb=!0),l=0,m=gb.slice(1).length;m>l;l+=1){var jb=gb.slice(1)[l];this.registry.registry[jb[1].id].parallel&&this.registry.registry[jb[1].id].parallel!=this.registry.registry[jb[1].id]||(hb=!1)}hb?eb=!0:fb=!0}else j>0&&X==U?eb=!0:0===j&&Q[h-1].properties.noteIndex==Q[h].properties.noteIndex&&Q[h-1].sortedItems.length&&db==U?eb=!0:fb=!0;var kb,lb,mb,nb,ob;if(eb&&(kb=j>0?T.sortedItems[j-1][1]:Q[h-1].sortedItems[0][1],kb.locator?(mb=kb.label?kb.label:"",lb=""+kb.locator+mb):lb=kb.locator,V?(ob=W?W:"",nb=""+V+ob):nb=V),eb&&lb&&!nb&&(eb=!1,fb=!0),eb&&(!lb&&nb?p[1].position=CSL.POSITION_IBID_WITH_LOCATOR:lb||nb?lb&&nb===lb?p[1].position=CSL.POSITION_IBID:lb&&nb&&nb!==lb?p[1].position=CSL.POSITION_IBID_WITH_LOCATOR:(eb=!1,fb=!0):p[1].position=CSL.POSITION_IBID),fb&&(p[1].position=CSL.POSITION_SUBSEQUENT),(fb||eb)&&R[U]!=T.properties.noteIndex&&(p[1]["first-reference-note-number"]=R[U],this.registry.registry[U])){var pb=this.registry.citationreg.citationsByItemId[U][0].properties.noteIndex,qb=T.properties.noteIndex;this.registry.registry[U]["first-reference-note-number"]=pb>qb?qb:pb}}if(T.properties.noteIndex){var rb=parseInt(T.properties.noteIndex,10)-parseInt(S[U],10);p[1].position!==CSL.POSITION_FIRST&&rb<=this.citation.opt["near-note-distance"]&&(p[1]["near-note"]=!0),S[U]=T.properties.noteIndex}if(T.citationID!=a.citationID)for(l=0,m=CSL.POSITION_TEST_VARS.length;m>l;l+=1){var sb=CSL.POSITION_TEST_VARS[l];p[1][sb]!==Y[sb]&&("first-reference-note-number"===sb&&(E[this.registry.registry[U].ambig]=!0),this.tmp.taintedCitationIDs[T.citationID]=!0,"first-reference-note-number"===sb&&(this.tmp.taintedItemIDs[U]=!0))}this.sys.variableWrapper&&(p[1].index=T.properties.index,p[1].noteIndex=T.properties.noteIndex)}else"undefined"==typeof R[p[1].id]?(R[U]=T.properties.noteIndex,S[U]=T.properties.noteIndex):S[U]=T.properties.noteIndex}}}if(this.opt.citation_number_sort&&D&&D.length>1&&this.citation_sort.tokens.length>0){for(f=0,g=D.length;g>f;f+=1)D[f][1].sortkeys=CSL.getSortKeys.call(this,D[f][0],"citation_sort");a.properties.unsorted||D.sort(this.citation.srt.compareCompositeKeys)}for(n in this.tmp.taintedItemIDs)if(this.tmp.taintedItemIDs.hasOwnProperty(n)&&(Q=this.registry.citationreg.citationsByItemId[n]))for(f=0,g=Q.length;g>f;f+=1)this.tmp.taintedCitationIDs[Q[f].citationID]=!0;var tb=[];if(d===CSL.PREVIEW){try{tb=this.process_CitationCluster.call(this,a.sortedItems,a.citationID)}catch(ub){CSL.error("Error running CSL processor for preview: "+ub)}for(this.registry.citationreg.citationByIndex=v,this.registry.citationreg.citationById={},f=0,g=v.length;g>f;f+=1)this.registry.citationreg.citationById[v[f].citationID]=v[f];var vb=[];for(f=0,g=w.length;g>f;f+=1)vb.push(""+w[f].id);this.updateItems(vb);for(n in x)x.hasOwnProperty(n)&&(this.registry.registry[n].disambig=x[n])}else{for(var wb in E)this.disambiguate.run(wb,a);var xb;for(n in this.tmp.taintedCitationIDs)if(n!=a.citationID){var yb=this.registry.citationreg.citationById[n];this.tmp.citation_pos=yb.properties.index,this.tmp.citation_note_index=yb.properties.noteIndex,this.tmp.citation_id=""+yb.citationID,xb=[],xb.push(yb.properties.index),xb.push(this.process_CitationCluster.call(this,yb.sortedItems,yb.citationID)),tb.push(xb)}this.tmp.taintedItemIDs={},this.tmp.taintedCitationIDs={},this.tmp.citation_pos=a.properties.index,this.tmp.citation_note_index=a.properties.noteIndex,this.tmp.citation_id=""+a.citationID,xb=[],xb.push(b.length),xb.push(this.process_CitationCluster.call(this,D,a.citationID)),tb.push(xb),tb.sort(function(a,b){return a[0]>b[0]?1:a[0]<b[0]?-1:0})}return u.citation_errors=this.tmp.citation_errors.slice(),[u,tb]},CSL.Engine.prototype.process_CitationCluster=function(a,b){var c;return this.parallel.StartCitation(a),c=CSL.getCitationCluster.call(this,a,b)},CSL.Engine.prototype.makeCitationCluster=function(a){var b,c,d,e,f,g,h;for(b=[],f=a.length,e=0;f>e;e+=1){g={};for(var i in a[e])g[i]=a[e][i];if(h=this.retrieveItem(""+g.id),this.opt.development_extensions.locator_label_parse&&g.locator&&-1===["bill","gazette","legislation","treaty"].indexOf(h.type)&&(!g.label||"page"===g.label)){var j=CSL.LOCATOR_LABELS_REGEXP.exec(g.locator);j&&(g.label=CSL.LOCATOR_LABELS_MAP[j[2]],g.locator=j[3])}c=[h,g],b.push(c)}if(this.remapSectionVariable(b),b&&b.length>1&&this.citation_sort.tokens.length>0){for(f=b.length,e=0;f>e;e+=1)b[e][1].sortkeys=CSL.getSortKeys.call(this,b[e][0],"citation_sort");b.sort(this.citation.srt.compareCompositeKeys)}return this.tmp.citation_errors=[],this.parallel.StartCitation(b),d=CSL.getCitationCluster.call(this,b)},CSL.getAmbiguousCite=function(a,b,c){var d,e,f=this.tmp.group_context.value().slice();this.tmp.disambig_request=b?b:!1;var g={position:1};this.registry.registry[a.id]&&this.registry.citationreg.citationsByItemId&&this.registry.citationreg.citationsByItemId[a.id]&&this.registry.citationreg.citationsByItemId[a.id].length&&c&&"by-cite"===this.citation.opt["givenname-disambiguation-rule"]&&(g["first-reference-note-number"]=this.registry.registry[a.id]["first-reference-note-number"]),this.tmp.area="citation",d=this.parallel.use_parallels,this.parallel.use_parallels=!1,this.tmp.suppress_decorations=!0,this.tmp.just_looking=!0,CSL.getCite.call(this,a,g);for(var h=0,i=this.output.queue.length;i>h;h+=1)CSL.Output.Queue.purgeEmptyBlobs(this.output.queue[h]);if(this.opt.development_extensions.clean_up_csl_flaws)for(var j=0,k=this.output.queue.length;k>j;j+=1)this.output.adjust.upward(this.output.queue[j]),this.output.adjust.leftward(this.output.queue[j]),this.output.adjust.downward(this.output.queue[j]),this.output.adjust.fix(this.output.queue[j]);return e=this.output.string(this,this.output.queue),this.tmp.just_looking=!1,this.tmp.suppress_decorations=!1,this.parallel.use_parallels=d,this.tmp.group_context.replace(f,"literal"),e},CSL.getSpliceDelimiter=function(a,b){if(a&&!this.tmp.have_collapsed&&"string"==typeof this.citation.opt["after-collapse-delimiter"])this.tmp.splice_delimiter=this.citation.opt["after-collapse-delimiter"];else if(this.tmp.have_collapsed&&"in-text"===this.opt.xclass&&this.opt.update_mode!==CSL.NUMERIC)this.tmp.splice_delimiter=", ";else if(this.tmp.use_cite_group_delimiter)this.tmp.splice_delimiter=this.citation.opt.cite_group_delimiter;else if(this.tmp.cite_locales[b-1]){var c=this.tmp.cite_affixes[this.tmp.area][this.tmp.cite_locales[b-1]];c&&c.delimiter&&(this.tmp.splice_delimiter=c.delimiter)}return this.tmp.splice_delimiter||(this.tmp.splice_delimiter=""),this.tmp.splice_delimiter},CSL.getCitationCluster=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;this.tmp.last_primary_names_string=!1,this.tmp.nestedBraces=!1,t=CSL.getSafeEscape(this),this.tmp.area="citation",c="",d=[],this.tmp.last_suffix_used="",this.tmp.last_names_used=[],this.tmp.last_years_used=[],this.tmp.backref_index=[],this.tmp.cite_locales=[];var v=!1;if("note"===this.opt.xclass&&this.citation.opt.suppressTrailingPunctuation&&(v=!0),b&&this.registry.citationreg.citationById[b].properties["suppress-trailing-punctuation"]&&(v=!0),"note"===this.opt.xclass){for(var w=[],x=!1,y=!1,z=!1,A=[],B=0,C=a.length;C>B;B+=1){var D=a[B][0].type,E=a[B][0].title,F=a[B][1].position,G=a[B][0].id;E&&"legal_case"===D&&G!==z&&F&&((E!==x||0===w.length)&&(A=[],w.push(A)),A.push(a[B][1])),x=E,y=F,z=G}for(B=0,C=w.length;C>B;B+=1)if(A=w[B],!(A.length<2)){var H=A.slice(-1)[0].locator;if(H)for(var I=0,J=A.length-1;J>I;I+=1)A[I].locator&&(H=!1);H&&(A[0].locator=H,delete A.slice(-1)[0].locator,A[0].label=A.slice(-1)[0].label,A.slice(-1)[0].label&&delete A.slice(-1)[0].label)}}for(e=[],f=a.length,g=0;f>g;g+=1){if(o=a[g][0],h=a[g][1],i=this.tmp.have_collapsed,j={},g>0?CSL.getCite.call(this,o,h,""+a[g-1][0].id):(this.tmp.term_predecessor=!1,CSL.getCite.call(this,o,h)),this.tmp.cite_renders_content||(u={citationID:""+this.tmp.citation_id,index:this.tmp.citation_pos,noteIndex:this.tmp.citation_note_index,itemID:""+o.id,citationItems_pos:g,error_code:CSL.ERROR_NO_RENDERED_FORM},this.tmp.citation_errors.push(u)),g===a.length-1&&this.parallel.ComposeSet(),j.splice_delimiter=CSL.getSpliceDelimiter.call(this,i,g),h&&h["author-only"]&&(this.tmp.suppress_decorations=!0),g>0){s=a[g-1][1];var K=s.suffix&&"."===s.suffix.slice(-1),L=!s.suffix&&h.prefix&&"."===h.prefix.slice(0,1);if(K||L){var M=j.splice_delimiter.indexOf(" ");j.splice_delimiter=M>-1&&!L?j.splice_delimiter.slice(M):""}}j.suppress_decorations=this.tmp.suppress_decorations,j.have_collapsed=this.tmp.have_collapsed,e.push(j)}this.tmp.has_purged_parallel=!1,this.parallel.PruneOutputQueue(this),k=0,n=this.output.queue.slice(),{strings:{suffix:this.citation.opt.layout_suffix,delimiter:this.citation.opt.layout_delimiter}};var O=this.citation.opt.layout_suffix,P=this.tmp.cite_locales[this.tmp.cite_locales.length-1];P&&this.tmp.cite_affixes[this.tmp.area][P]&&this.tmp.cite_affixes[this.tmp.area][P].suffix&&(O=this.tmp.cite_affixes[this.tmp.area][P].suffix),CSL.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(O.slice(0,1))>-1&&(O=O.slice(0,1));var Q=this.citation.opt.layout_delimiter;Q||(Q=""),CSL.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(Q.slice(0,1))>-1&&(Q=Q.slice(0,1));for(var R=O,B=0,C=this.output.queue.length;C>B;B+=1)CSL.Output.Queue.purgeEmptyBlobs(this.output.queue[B]);if(!this.tmp.suppress_decorations&&this.output.queue.length&&(this.opt.development_extensions.apply_citation_wrapper&&this.sys.wrapCitationEntry&&!this.tmp.just_looking&&"citation"===this.tmp.area||(v||(this.output.queue[this.output.queue.length-1].strings.suffix=R),this.output.queue[0].strings.prefix=this.citation.opt.layout_prefix)),this.opt.development_extensions.clean_up_csl_flaws)for(var I=0,J=this.output.queue.length;J>I;I+=1)this.output.adjust.upward(this.output.queue[I]),this.output.adjust.leftward(this.output.queue[I]),this.output.adjust.downward(this.output.queue[I]),this.tmp.last_chr=this.output.adjust.fix(this.output.queue[I]);for(g=0,f=n.length;f>g;g+=1){if(this.output.queue=[n[g]],this.tmp.suppress_decorations=e[g].suppress_decorations,this.tmp.splice_delimiter=e[g].splice_delimiter,n[g].parallel_delimiter&&(this.tmp.splice_delimiter=n[g].parallel_delimiter),this.tmp.have_collapsed=e[g].have_collapsed,l=this.output.string(this,this.output.queue),this.tmp.suppress_decorations=!1,"string"==typeof l)return this.tmp.suppress_decorations=!1,l;if("object"==typeof l&&0===l.length&&!h["suppress-author"])if(this.tmp.has_purged_parallel)l.push("");else{var S="[CSL STYLE ERROR: reference with no printed form.]",T=0===g?t(this.citation.opt.layout_prefix):"",U=g===n.length-1?t(this.citation.opt.layout_suffix):"";l.push(T+S+U)}if(d.length&&"string"==typeof l[0]){l.reverse();var V=l.pop();V&&","===V.slice(0,1)?d.push(V):"string"==typeof d.slice(-1)[0]&&","===d.slice(-1)[0].slice(-1)?d.push(" "+V):V&&d.push(t(this.tmp.splice_delimiter)+V)}else l.reverse(),m=l.pop(),"undefined"!=typeof m&&(d.length&&"string"==typeof d[d.length-1]&&(d[d.length-1]+=m.successor_prefix),d.push(m));for(p=l.length,q=0;p>q;q+=1)r=l[q],"string"!=typeof r?(m=l.pop(),"undefined"!=typeof m&&d.push(m)):d.push(t(this.tmp.splice_delimiter)+r);0!==d.length||a[g][1]["suppress-author"]||(k+=1)}if(c+=this.output.renderBlobs(d),c&&(this.output.nestedBraces=!1,!this.tmp.suppress_decorations))for(f=this.citation.opt.layout_decorations.length,g=0;f>g;g+=1)j=this.citation.opt.layout_decorations[g],"normal"!==j[1]&&(c=this.fun.decorate[j[0]][j[1]](this,c));return this.tmp.suppress_decorations=!1,c},CSL.getCite=function(a,b,c){var d,e;for(this.tmp.cite_renders_content=!1,this.parallel.StartCite(a,b,c),CSL.citeStart.call(this,a,b),d=0,this.nameOutput=new CSL.NameOutput(this,a,b);d<this[this.tmp.area].tokens.length;)d=CSL.tokenExec.call(this,this[this.tmp.area].tokens[d],a,b);return CSL.citeEnd.call(this,a,b),this.parallel.CloseCite(this),this.tmp.cite_renders_content||this.tmp.just_looking||"bibliography"===this.tmp.area&&(e={index:this.tmp.bibliography_pos,itemID:""+a.id,error_code:CSL.ERROR_NO_RENDERED_FORM},this.tmp.bibliography_errors.push(e)),""+a.id},CSL.citeStart=function(a,b){if(this.tmp.disambiguate_count=0,this.tmp.disambiguate_maxMax=0,this.tmp.same_author_as_previous_cite=!1,this.tmp.subsequent_author_substitute_ok=this.tmp.suppress_decorations?!1:!0,this.tmp.lastchr="",this.tmp.have_collapsed="citation"===this.tmp.area&&this.citation.opt.collapse&&this.citation.opt.collapse.length?!0:!1,this.tmp.render_seen=!1,this.tmp.disambig_request&&!this.tmp.disambig_override?this.tmp.disambig_settings=this.tmp.disambig_request:this.registry.registry[a.id]&&!this.tmp.disambig_override?(this.tmp.disambig_request=this.registry.registry[a.id].disambig,this.tmp.disambig_settings=this.registry.registry[a.id].disambig):this.tmp.disambig_settings=new CSL.AmbigConfig,"citation"!==this.tmp.area&&this.registry.registry[a.id]&&(this.tmp.disambig_restore=CSL.cloneAmbigConfig(this.registry.registry[a.id].disambig),"bibliography"===this.tmp.area&&this.tmp.disambig_settings&&this.tmp.disambig_override&&(this.opt["disambiguate-add-names"]&&(this.tmp.disambig_settings.names=this.registry.registry[a.id].disambig.names.slice(),this.tmp.disambig_request.names=this.registry.registry[a.id].disambig.names.slice()),this.opt["disambiguate-add-givenname"]))){this.tmp.disambig_request=this.tmp.disambig_settings,this.tmp.disambig_settings.givens=this.registry.registry[a.id].disambig.givens.slice(),this.tmp.disambig_request.givens=this.registry.registry[a.id].disambig.givens.slice();for(var c=0,d=this.tmp.disambig_settings.givens.length;d>c;c+=1)this.tmp.disambig_settings.givens[c]=this.registry.registry[a.id].disambig.givens[c].slice();for(var c=0,d=this.tmp.disambig_request.givens.length;d>c;c+=1)this.tmp.disambig_request.givens[c]=this.registry.registry[a.id].disambig.givens[c].slice()}if(this.tmp.names_used=[],this.tmp.nameset_counter=0,this.tmp.years_used=[],this.tmp.names_max.clear(),this.tmp.splice_delimiter=this[this.tmp.area].opt.layout_delimiter,this.bibliography_sort.keys=[],this.citation_sort.keys=[],this.tmp.has_done_year_suffix=!1,this.tmp.last_cite_locale=!1,!this.tmp.just_looking&&b&&!b.position&&this.registry.registry[a.id]&&(this.tmp.disambig_restore=CSL.cloneAmbigConfig(this.registry.registry[a.id].disambig)),this.tmp.shadow_numbers={},this.setNumberLabels(a),this.tmp.first_name_string=!1,this.opt.development_extensions.flip_parentheses_to_braces&&b&&b.prefix){var e=CSL.checkNestedBraceOpen.exec(b.prefix),f=CSL.checkNestedBraceClose.exec(b.prefix);e?this.output.nestedBraces=f?f[0].length<e[0].length?CSL.NestedBraces:!1:CSL.NestedBraces:f&&(this.output.nestedBraces=!1)}},CSL.citeEnd=function(a,b){if(this.tmp.disambig_restore){this.registry.registry[a.id].disambig.names=this.tmp.disambig_restore.names.slice(),this.registry.registry[a.id].disambig.givens=this.tmp.disambig_restore.givens.slice();for(var c=0,d=this.registry.registry[a.id].disambig.givens.length;d>c;c+=1)this.registry.registry[a.id].disambig.givens[c]=this.tmp.disambig_restore.givens[c].slice()}if(this.tmp.disambig_restore=!1,this.tmp.last_suffix_used=b&&b.suffix?b.suffix:"",this.tmp.last_years_used=this.tmp.years_used.slice(),this.tmp.last_names_used=this.tmp.names_used.slice(),this.tmp.cut_var=!1,this.tmp.disambig_request=!1,this.tmp.cite_locales.push(this.tmp.last_cite_locale),this.tmp.issued_date&&this.tmp.renders_collection_number){for(var e=[],c=this.tmp.issued_date.list.length-1;c>this.tmp.issued_date.pos;c+=-1)e.push(this.tmp.issued_date.list.pop());for(this.tmp.issued_date.list.pop(),c=e.length-1;c>-1;c+=-1)this.tmp.issued_date.list.push(e.pop());this.parallel.use_parallels&&(this.parallel.cite.issued=!1)}if(this.tmp.issued_date=!1,this.tmp.renders_collection_number=!1,this.opt.development_extensions.flip_parentheses_to_braces&&b&&b.suffix){var f=CSL.checkNestedBraceOpen.exec(b.suffix),g=CSL.checkNestedBraceClose.exec(b.suffix);g?this.output.nestedBraces=f?f[0].length<g[0].length?!1:CSL.NestedBraces:!1:f&&(this.output.nestedBraces=CSL.NestedBraces)}},CSL.Engine.prototype.makeBibliography=function(a){var b,c,d,e,f,g,h,l,m;if(b=!1,!this.bibliography.tokens.length)return!1;"string"==typeof a&&(this.opt.citation_number_slug=a,a=!1),c=CSL.getBibliographyEntries.call(this,a),l=c[0],m=c[1];var o=c[2];for(d={maxoffset:0,entryspacing:this.bibliography.opt["entry-spacing"],linespacing:this.bibliography.opt["line-spacing"],"second-field-align":!1,entry_ids:l,bibliography_errors:this.tmp.bibliography_errors.slice(),done:o},this.bibliography.opt["second-field-align"]&&(d["second-field-align"]=this.bibliography.opt["second-field-align"]),e=0,g=this.registry.reflist.length,h=0;g>h;h+=1)f=this.registry.reflist[h],f.offset>d.maxoffset&&(d.maxoffset=f.offset);return this.bibliography.opt.hangingindent&&(d.hangingindent=this.bibliography.opt.hangingindent),d.bibstart=this.fun.decorate.bibstart,d.bibend=this.fun.decorate.bibend,this.opt.citation_number_slug=!1,[d,m]},CSL.getBibliographyEntries=function(a){function I(a,b){return a===b?!0:!1}function J(a,b){for(o=b.length,p=0;o>p;p+=1)if(I(a,b[p]))return!0;return!1}function K(a,b){return"none"!==a&&a||b?"string"==typeof b?I(a,b):b?J(a,b):!1:!0}var b,c,d,e,f,g,h,k,n,o,p,r,t,v,w,x,y,z,A,B,C,D,E,F;b=[],D=[],this.tmp.area="bibliography",this.tmp.last_rendered_name=!1,this.tmp.bibliography_errors=[],this.tmp.bibliography_pos=0,c=a&&a.page_start&&a.page_length?this.registry.getSortedIds():this.retrieveItems(this.registry.getSortedIds()),this.tmp.disambig_override=!0,z={};var L;if(a&&a.page_start&&a.page_length&&(L=0,a.page_start!==!0))for(w=0,x=c.length;x>w&&(z[c[w]]=!0,a.page_start!=c[w]);w+=1);var M=[];for(w=0,x=c.length;x>w;w+=1){if(a&&a.page_start&&a.page_length){if(z[c[w]])continue;if(k=this.retrieveItem(c[w]),L===a.page_length)break}else if(k=c[w],z[k.id])continue;if(a){if(d=!0,a.include){for(d=!1,E=0,F=a.include.length;F>E;E+=1)if(n=a.include[E],K(n.value,k[n.field])){d=!0;break}}else if(a.exclude){for(e=!1,E=0,F=a.exclude.length;F>E;E+=1)if(n=a.exclude[E],K(n.value,k[n.field])){e=!0;break}e&&(d=!1)}else if(a.select){for(d=!1,f=!0,E=0,F=a.select.length;F>E;E+=1)n=a.select[E],K(n.value,k[n.field])||(f=!1);f&&(d=!0)}if(a.quash){for(f=!0,E=0,F=a.quash.length;F>E;E+=1)n=a.quash[E],K(n.value,k[n.field])||(f=!1);f&&(d=!1)}if(!d)continue}if(g=new CSL.Token("group",CSL.START),g.decorations=[["@bibliography","entry"]].concat(this.bibliography.opt.layout_decorations),this.output.startTag("bib_entry",g),k.system_id&&this.sys.embedBibliographyEntry?this.output.current.value().item_id=k.system_id:this.output.current.value().system_id=k.id,A=[[{id:""+k.id},k]],t=[],!this.registry.registry[k.id].master||a&&a.page_start&&a.page_length)this.registry.registry[k.id].siblings||(this.parallel.StartCitation(A),this.tmp.term_predecessor=!1,t.push(""+CSL.getCite.call(this,k)),a&&a.page_start&&a.page_length&&(L+=1));else{for(v=!0,this.parallel.StartCitation(A),this.output.queue[0].strings.delimiter=", ",this.tmp.term_predecessor=!1,t.push(""+CSL.getCite.call(this,k)),z[k.id]=!0,y=this.registry.registry[k.id].siblings,E=0,F=y.length;F>E;E+=1){var N=this.registry.registry[k.id].siblings[E];B=this.retrieveItem(N),t.push(""+CSL.getCite.call(this,B)),z[B.id]=!0}this.parallel.ComposeSet(),this.parallel.PruneOutputQueue()}if(D.push(""),this.tmp.bibliography_pos+=1,M.push(t),this.output.endTag("bib_entry"),this.output.queue[0].blobs.length&&this.output.queue[0].blobs[0].blobs.length){for(v||!this.output.queue[0].blobs[0].blobs[0].strings?(r=this.output.queue[0].blobs,v=!1):r=this.output.queue[0].blobs[0].blobs,E=r.length-1;E>-1;E+=-1)if(r[E].blobs&&0!==r[E].blobs.length){var P,O=this.tmp.cite_locales[this.tmp.cite_locales.length-1];P=this.tmp.cite_affixes[this.tmp.area][O]?this.tmp.cite_affixes[this.tmp.area][O].suffix:this.bibliography.opt.layout_suffix,C=P.slice(0,1),C&&r[E].strings.suffix.slice(-1)===C&&(r[E].strings.suffix=r[E].strings.suffix.slice(0,-1)),r[E].strings.suffix+=P;break}r[0].strings.prefix=this.bibliography.opt.layout_prefix+r[0].strings.prefix}for(var E=0,F=this.output.queue.length;F>E;E+=1)CSL.Output.Queue.purgeEmptyBlobs(this.output.queue[E]);for(var E=0,F=this.output.queue.length;F>E;E+=1)this.output.adjust.upward(this.output.queue[E]),this.output.adjust.leftward(this.output.queue[E]),this.output.adjust.downward(this.output.queue[E],!0),this.output.adjust.fix(this.output.queue[E]);h=this.output.string(this,this.output.queue)[0],h||(h="\n[CSL STYLE ERROR: reference with no printed form.]\n"),b.push(h)}var Q=!1;if(a&&a.page_start&&a.page_length){var R=c.slice(-1)[0],S=M.slice(-1)[0];R&&S&&R!=S||(Q=!0)}return this.tmp.disambig_override=!1,[M,b,Q]},CSL.Engine.prototype.setCitationId=function(a,b){var c,d,e;if(c=!1,!a.citationID||b){for(d=Math.floor(1e14*Math.random());;){if(e=0,!this.registry.citationreg.citationById[d]){a.citationID=d.toString(32);break}e=!e&&5e13>d?1:-1,d+=1===e?1:-1}c=""+d}return this.registry.citationreg.citationById[a.citationID]=a,c},CSL.Engine.prototype.rebuildProcessorState=function(a,b,c){a||(a=[]),b||(b="html");for(var d={},e=[],f=0,g=a.length;g>f;f+=1)for(var h=0,i=a[f].citationItems.length;i>h;h+=1){var j=""+a[f].citationItems[h].id;d[j]||e.push(j),d[j]=!0}this.updateItems(e);var k=[],l=[],m=[],n=this.opt.mode;this.setOutputFormat(b);for(var f=0,g=a.length;g>f;f+=1){var o=this.processCitationCluster(a[f],k,l,CSL.ASSUME_ALL_ITEMS_REGISTERED);k.push([a[f].citationID,a[f].properties.noteIndex]);for(var h=0,i=o[1].length;i>h;h+=1){var p=o[1][h][0];m[p]=[k[p][0],k[p][1],o[1][h][1]]}}return this.updateUncitedItems(c),this.setOutputFormat(n),m},CSL.Engine.prototype.restoreProcessorState=function(a){var b,c,d,e,f,g,h,i,j,k;i=[],j=[],a||(a=[]);var l=[],m={};for(b=0,c=a.length;c>b;b+=1)m[a[b].citationID]&&this.setCitationId(a[b],!0),m[a[b].citationID]=!0,l.push(a[b].properties.index);var n=a.slice();for(n.sort(function(a,b){return a.properties.index<b.properties.index?-1:a.properties.index>b.properties.index?1:0}),b=0,c=n.length;c>b;b+=1)n[b].properties.index=b;for(b=0,c=n.length;c>b;b+=1){for(k=[],d=0,e=n[b].citationItems.length;e>d;d+=1)f=n[b].citationItems[d],"undefined"==typeof f.sortkeys&&(f.sortkeys=[]),g=this.retrieveItem(""+f.id),h=[g,f],k.push(h),n[b].citationItems[d].item=g,j.push(""+f.id);n[b].properties.unsorted||k.sort(this.citation.srt.compareCompositeKeys),n[b].sortedItems=k,this.registry.citationreg.citationById[n[b].citationID]=n[b]}for(this.updateItems(j),b=0,c=a.length;c>b;b+=1)i.push([""+a[b].citationID,a[b].properties.noteIndex]);var o=[];return a&&a.length?o=this.processCitationCluster(a[0],[],i.slice(1)):(this.registry=new CSL.Registry(this),this.tmp=new CSL.Engine.Tmp,this.disambiguate=new CSL.Disambiguation(this)),o},CSL.Engine.prototype.updateItems=function(a,b,c){var e=this.tmp.area;if(this.registry.init(a),c)for(var f in this.registry.ambigcites)this.registry.ambigsTouched[f]=!0;return this.registry.dodeletes(this.registry.myhash),this.registry.doinserts(this.registry.mylist),this.registry.dorefreshes(),this.registry.rebuildlist(),this.registry.setsortkeys(),this.registry.setdisambigs(),b||this.registry.sorttokens(),this.registry.renumber(),this.tmp.area=e,this.registry.getSortedIds()},CSL.Engine.prototype.updateUncitedItems=function(a,b){if(a||(a=[]),"object"==typeof a)if("undefined"==typeof a.length){var d=a;a=[];for(var e in d)a.push(e)}else if("number"==typeof a.length)for(var d={},f=0,g=a.length;g>f;f+=1)d[a[f]]=!0;
    return this.registry.init(a,!0),this.registry.dopurge(d),this.registry.doinserts(this.registry.mylist),this.registry.dorefreshes(),this.registry.rebuildlist(),this.registry.setsortkeys(),this.registry.setdisambigs(),b||this.registry.sorttokens(),this.registry.renumber(),this.registry.getSortedIds()},CSL.localeResolve=function(a,b){var c,d;return b||(b="en-US"),a||(a=b),c={},d=a.split(/[\-_]/),c.base=CSL.LANG_BASES[d[0]],"undefined"==typeof c.base?(CSL.debug("Warning: unknown locale "+a+", setting fallback to "+b),{base:b,best:a,bare:d[0]}):(1===d.length&&(c.generic=!0),c.best=1===d.length||"x"===d[1]?c.base.replace("_","-"):d.slice(0,2).join("-"),c.base=c.base.replace("_","-"),c.bare=d[0],c)},CSL.Engine.prototype.localeConfigure=function(a,b){var c;if(this.opt.development_extensions.normalize_lang_keys_to_lowercase&&(a.best=a.best.toLowerCase(),a.bare=a.bare.toLowerCase(),a.base=a.base.toLowerCase()),(!b||!this.locale[a.best])&&(c=this.sys.xml.makeXml(this.sys.retrieveLocale("en-US")),this.localeSet(c,"en-US",a.best),"en-US"!==a.best&&(a.base!==a.best&&(c=this.sys.xml.makeXml(this.sys.retrieveLocale(a.base)),this.localeSet(c,a.base,a.best)),c=this.sys.xml.makeXml(this.sys.retrieveLocale(a.best)),this.localeSet(c,a.best,a.best)),this.localeSet(this.cslXml,"",a.best),this.localeSet(this.cslXml,a.bare,a.best),a.base!==a.best&&this.localeSet(this.cslXml,a.base,a.best),this.localeSet(this.cslXml,a.best,a.best),"undefined"==typeof this.locale[a.best].terms["page-range-delimiter"]&&(this.locale[a.best].terms["page-range-delimiter"]=["fr","pt"].indexOf(a.best.slice(0,2).toLowerCase())>-1?"-":"\u2013"),"undefined"==typeof this.locale[a.best].terms["year-range-delimiter"]&&(this.locale[a.best].terms["year-range-delimiter"]="\u2013"),"undefined"==typeof this.locale[a.best].terms["citation-range-delimiter"]&&(this.locale[a.best].terms["citation-range-delimiter"]="\u2013"),this.opt.development_extensions.normalize_lang_keys_to_lowercase)){for(var d=["default-locale","locale-sort","locale-translit","locale-translat"],e=0,f=d.length;f>e;e+=1)for(var g=0,h=this.opt[d[e]].length;h>g;g+=1)this.opt[d[e]][g]=this.opt[d[e]][g].toLowerCase();this.opt.lang=this.opt.lang.toLowerCase()}},CSL.Engine.prototype.localeSet=function(a,b,c){var d,e,f,g,h,j,k,l,m,o,p,q,r,s,t,u;if(b=b.replace("_","-"),c=c.replace("_","-"),this.opt.development_extensions.normalize_lang_keys_to_lowercase&&(b=b.toLowerCase(),c=c.toLowerCase()),this.locale[c]||(this.locale[c]={},this.locale[c].terms={},this.locale[c].opts={},this.locale[c].opts["skip-words"]=CSL.SKIP_WORDS,this.locale[c].opts["leading-noise-words"]||(this.locale[c].opts["leading-noise-words"]=[]),this.locale[c].dates={},this.locale[c].ord={"1.0.1":!1,keys:{}},this.locale[c]["noun-genders"]={}),e=this.sys.xml.makeXml(),this.sys.xml.nodeNameIs(a,"locale"))e=a;else for(f=this.sys.xml.getNodesByName(a,"locale"),h=0,q=this.sys.xml.numberofnodes(f);q>h;h+=1)if(d=f[h],this.sys.xml.getAttributeValue(d,"lang","xml")===b){e=d;break}for(f=this.sys.xml.getNodesByName(e,"type"),t=0,u=this.sys.xml.numberofnodes(f);u>t;t+=1){var v=f[t],w=this.sys.xml.getAttributeValue(v,"name"),x=this.sys.xml.getAttributeValue(v,"gender");this.opt.gender[w]=x}var y=this.sys.xml.getNodesByName(e,"term","ordinal").length;if(y){for(var z in this.locale[c].ord.keys)delete this.locale[c].terms[z];this.locale[c].ord={"1.0.1":!1,keys:{}}}f=this.sys.xml.getNodesByName(e,"term");var A={"last-digit":{},"last-two-digits":{},"whole-number":{}},B=!1,C={};for(h=0,q=this.sys.xml.numberofnodes(f);q>h;h+=1){if(j=f[h],l=this.sys.xml.getAttributeValue(j,"name"),"sub verbo"===l&&(l="sub-verbo"),"ordinal"===l.slice(0,7)){if(this.sys.xml.getNodeValue(j),"ordinal"===l)B=!0;else{var E=this.sys.xml.getAttributeValue(j,"match"),F=l.slice(8),r=this.sys.xml.getAttributeValue(j,"gender-form");r||(r="neuter"),E||(E="last-two-digits","0"===F.slice(0,1)&&(E="last-digit")),"0"===F.slice(0,1)&&(F=F.slice(1)),A[E][F]||(A[E][F]={}),A[E][F][r]=l}this.locale[c].ord.keys[l]=!0}"undefined"==typeof this.locale[c].terms[l]&&(this.locale[c].terms[l]={}),k="long",r=!1,this.sys.xml.getAttributeValue(j,"form")&&(k=this.sys.xml.getAttributeValue(j,"form")),this.sys.xml.getAttributeValue(j,"gender-form")&&(r=this.sys.xml.getAttributeValue(j,"gender-form")),this.sys.xml.getAttributeValue(j,"gender")&&(this.locale[c]["noun-genders"][l]=this.sys.xml.getAttributeValue(j,"gender")),r?(this.locale[c].terms[l][r]={},this.locale[c].terms[l][r][k]=[],s=this.locale[c].terms[l][r],C[l]=!0):(this.locale[c].terms[l][k]=[],s=this.locale[c].terms[l]),this.sys.xml.numberofnodes(this.sys.xml.getNodesByName(j,"multiple"))?(s[k][0]=this.sys.xml.getNodeValue(j,"single"),s[k][1]=this.sys.xml.getNodeValue(j,"multiple")):s[k]=this.sys.xml.getNodeValue(j)}if(B){for(var G in C){var H={},I=0;for(var J in this.locale[c].terms[G])["masculine","feminine"].indexOf(J)>-1?H[J]=this.locale[c].terms[G][J]:I+=1;if(!I)if(H.feminine)for(var J in H.feminine)this.locale[c].terms[G][J]=H.feminine[J];else if(H.masculine)for(var J in H.masculine)this.locale[c].terms[G][J]=H.masculine[J]}this.locale[c].ord["1.0.1"]=A}for(l in this.locale[c].terms)for(t=0,u=2;u>t;t+=1)if(r=CSL.GENDERS[t],this.locale[c].terms[l][r])for(k in this.locale[c].terms[l])this.locale[c].terms[l][r][k]||(this.locale[c].terms[l][r][k]=this.locale[c].terms[l][k]);for(f=this.sys.xml.getNodesByName(e,"style-options"),h=0,q=this.sys.xml.numberofnodes(f);q>h;h+=1){m=f[h],g=this.sys.xml.attributes(m);for(p in g)if(g.hasOwnProperty(p))if("@punctuation-in-quote"===p||"@limit-day-ordinals-to-day-1"===p)this.locale[c].opts[p.slice(1)]="true"===g[p]?!0:!1;else if("@skip-words"===p){var K=g[p].split(/\s*,\s*/);this.locale[c].opts[p.slice(1)]=K}else if("@leading-noise-words"===p&&b===c){var L=g[p].split(/\s*,\s*/);this.locale[c].opts["leading-noise-words"]=L}else if("@name-as-sort-order"===p){this.locale[c].opts["name-as-sort-order"]={};for(var M=g[p].split(/\s+/),t=0,u=M.length;u>t;t+=1)this.locale[c].opts["name-as-sort-order"][M[t]]=!0}else if("@name-as-reverse-order"===p){this.locale[c].opts["name-as-reverse-order"]={};for(var M=g[p].split(/\s+/),t=0,u=M.length;u>t;t+=1)this.locale[c].opts["name-as-reverse-order"][M[t]]=!0}else if("@name-never-short"===p){this.locale[c].opts["name-never-short"]={};for(var M=g[p].split(/\s+/),t=0,u=M.length;u>t;t+=1)this.locale[c].opts["name-never-short"][M[t]]=!0}}for(f=this.sys.xml.getNodesByName(e,"date"),h=0,q=this.sys.xml.numberofnodes(f);q>h;h+=1)o=f[h],this.locale[c].dates[this.sys.xml.getAttributeValue(o,"form")]=o},CSL.Node={},CSL.Node.bibliography={build:function(a,b){this.tokentype===CSL.START&&(a.build.area="bibliography",a.build.root="bibliography",a.fixOpt(this,"names-delimiter","delimiter"),a.fixOpt(this,"name-delimiter","delimiter"),a.fixOpt(this,"name-form","form"),a.fixOpt(this,"and","and"),a.fixOpt(this,"delimiter-precedes-last","delimiter-precedes-last"),a.fixOpt(this,"delimiter-precedes-et-al","delimiter-precedes-et-al"),a.fixOpt(this,"initialize-with","initialize-with"),a.fixOpt(this,"initialize","initialize"),a.fixOpt(this,"name-as-sort-order","name-as-sort-order"),a.fixOpt(this,"sort-separator","sort-separator"),a.fixOpt(this,"and","and"),a.fixOpt(this,"et-al-min","et-al-min"),a.fixOpt(this,"et-al-use-first","et-al-use-first"),a.fixOpt(this,"et-al-use-last","et-al-use-last"),a.fixOpt(this,"et-al-subsequent-min","et-al-subsequent-min"),a.fixOpt(this,"et-al-subsequent-use-first","et-al-subsequent-use-first")),b.push(this)}},CSL.Node.choose={build:function(a,b){var c;this.tokentype===CSL.START&&(c=function(a){a.tmp.jump.push(void 0,CSL.LITERAL)}),this.tokentype===CSL.END&&(c=function(a){a.tmp.jump.pop()}),this.execs.push(c),b.push(this)},configure:function(a,b){this.tokentype===CSL.END?(a.configure.fail.push(b),a.configure.succeed.push(b)):(a.configure.fail.pop(),a.configure.succeed.pop())}},CSL.Node.citation={build:function(a){if(this.tokentype===CSL.START&&(a.fixOpt(this,"names-delimiter","delimiter"),a.fixOpt(this,"name-delimiter","delimiter"),a.fixOpt(this,"name-form","form"),a.fixOpt(this,"and","and"),a.fixOpt(this,"delimiter-precedes-last","delimiter-precedes-last"),a.fixOpt(this,"delimiter-precedes-et-al","delimiter-precedes-et-al"),a.fixOpt(this,"initialize-with","initialize-with"),a.fixOpt(this,"initialize","initialize"),a.fixOpt(this,"name-as-sort-order","name-as-sort-order"),a.fixOpt(this,"sort-separator","sort-separator"),a.fixOpt(this,"and","and"),a.fixOpt(this,"et-al-min","et-al-min"),a.fixOpt(this,"et-al-use-first","et-al-use-first"),a.fixOpt(this,"et-al-use-last","et-al-use-last"),a.fixOpt(this,"et-al-subsequent-min","et-al-subsequent-min"),a.fixOpt(this,"et-al-subsequent-use-first","et-al-subsequent-use-first"),a.build.area="citation"),this.tokentype===CSL.END){if(a.opt.grouped_sort="in-text"===a.opt.xclass&&a.citation.opt.collapse&&a.citation.opt.collapse.length||a.citation.opt.cite_group_delimiter&&a.citation.opt.cite_group_delimiter.length&&a.opt.update_mode!==CSL.POSITION&&a.opt.update_mode!==CSL.NUMERIC,a.opt.grouped_sort&&a.citation_sort.opt.sort_directions.length){var c=a.citation_sort.opt.sort_directions[0].slice();a.citation_sort.opt.sort_directions=[c].concat(a.citation_sort.opt.sort_directions)}a.citation.srt=new CSL.Registry.Comparifier(a,"citation_sort")}}},CSL.Node["#comment"]={build:function(){}},CSL.Node.date={build:function(a,b){var c,d,f,g,h,i,j,k,l,m;(this.tokentype===CSL.START||this.tokentype===CSL.SINGLETON)&&(a.build.date_parts=[],a.build.date_variables=this.variables,a.build.extension||CSL.Util.substituteStart.call(this,a,b),c=a.build.extension?CSL.dateMacroAsSortKey:function(a,b,c){var n;if(a.tmp.element_rendered_ok=!1,a.tmp.donesies=[],a.tmp.dateparts=[],n=[],!this.variables.length||a.tmp.just_looking&&"issued"!==this.variables[0])a.tmp.date_object=!1;else{for(a.parallel.StartVariable(this.variables[0]),d=b[this.variables[0]],"undefined"==typeof d&&(d={"date-parts":[[0]]},a.opt.development_extensions.locator_date_and_revision&&c&&"locator-date"===this.variables[0]&&c["locator-date"]&&(d=c["locator-date"])),a.tmp.date_object=d,f=this.dateparts.length,g=0;f>g;g+=1)h=this.dateparts[g],"undefined"!=typeof a.tmp.date_object[h+"_end"]?n.push(h):"month"===h&&"undefined"!=typeof a.tmp.date_object.season_end&&n.push(h);for(i=[],j=["year","month","day"],f=j.length,g=0;f>g;g+=1)n.indexOf(j[g])>-1&&i.push(j[g]);for(n=i.slice(),k=2,f=n.length,g=0;f>g;g+=1)if(h=n[g],l=a.tmp.date_object[h],m=a.tmp.date_object[h+"_end"],l!==m){k=g;break}a.tmp.date_collapse_at=n.slice(k)}},this.execs.push(c),c=function(a,b){if(a.output.startTag("date",this),"issued"===this.variables[0]&&"legal_case"===b.type&&!a.tmp.extension&&""+b["collection-number"]==""+a.tmp.date_object.year&&1===this.dateparts.length&&"year"===this.dateparts[0])for(var c in a.tmp.date_object)if(a.tmp.date_object.hasOwnProperty(c)&&"year"===c.slice(0,4)){a.tmp.issued_date={};var d=a.output.current.mystack.slice(-2)[0].blobs;a.tmp.issued_date.list=d,a.tmp.issued_date.pos=d.length-1}},this.execs.push(c)),a.build.extension||this.tokentype!==CSL.END&&this.tokentype!==CSL.SINGLETON||(c=function(a){a.output.endTag(),a.parallel.CloseVariable("date")},this.execs.push(c)),b.push(this),(this.tokentype===CSL.END||this.tokentype===CSL.SINGLETON)&&(a.build.extension||CSL.Util.substituteEnd.call(this,a,b))}},CSL.Node["date-part"]={build:function(a,b){var c,d,e,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;this.strings.form||(this.strings.form="long"),a.build.date_parts.push(this.strings.name);var B=a.build.date_variables[0];c=function(a,b){if(a.tmp.date_object){if(g=!0,h="",i="",a.tmp.donesies.push(this.strings.name),a.tmp.date_object.literal&&"year"===this.strings.name&&(a.parallel.AppendToVariable(a.tmp.date_object.literal),a.output.append(a.tmp.date_object.literal,this)),a.tmp.date_object&&(h=a.tmp.date_object[this.strings.name],i=a.tmp.date_object[this.strings.name+"_end"]),"year"!==this.strings.name||0!==h||a.tmp.suppress_decorations||(h=!1),j=!a.tmp.suppress_decorations,k=a.tmp.have_collapsed,l="year-suffix"===a[a.tmp.area].opt.collapse||"year-suffix-ranged"===a[a.tmp.area].opt.collapse,m=a.opt["disambiguate-add-year-suffix"],j&&m&&l&&(a.tmp.years_used.push(h),n=a.tmp.last_years_used.length>=a.tmp.years_used.length,n&&k&&a.tmp.last_years_used[a.tmp.years_used.length-1]===h&&(h=!1)),"undefined"!=typeof h){o=!1,p=!1,q=!1,r=!1,"year"===this.strings.name&&(parseInt(h,10)<500&&parseInt(h,10)>0&&(p=a.getTerm("ad")),parseInt(h,10)<0&&(o=a.getTerm("bc"),h=-1*parseInt(h,10)),i&&(parseInt(i,10)<500&&parseInt(i,10)>0&&(r=a.getTerm("ad")),parseInt(i,10)<0&&(q=a.getTerm("bc"),i=-1*parseInt(i,10)))),a.parallel.AppendToVariable(h);for(var c=""+a.tmp.date_object.month;c.length<2;)c="0"+c;c="month-"+c;var f=a.locale[a.opt.lang]["noun-genders"][c];if(this.strings.form){var C=this.strings.form;if("day"===this.strings.name&&"ordinal"===C&&a.locale[a.opt.lang].opts["limit-day-ordinals-to-day-1"]&&"1"!=""+h&&(C="numeric"),h=CSL.Util.Dates[this.strings.name][C](a,h,f,"accessed"===B),"month"===this.strings.name)if(a.tmp.strip_periods)h=h.replace(/\./g,"");else for(z=0,A=this.decorations.length;A>z;z+=1)if("@strip-periods"===this.decorations[z][0]&&"true"===this.decorations[z][1]){h=h.replace(/\./g,"");break}if(i)if(i=CSL.Util.Dates[this.strings.name][C](a,i,f,"accessed"===B,"_end"),a.tmp.strip_periods)i=i.replace(/\./g,"");else for(z=0,A=this.decorations.length;A>z;z+=1)if("@strip-periods"===this.decorations[z][0]&&"true"===this.decorations[z][1]){i=i.replace(/\./g,"");break}}if(a.output.openLevel("empty"),a.tmp.date_collapse_at.length){for(s=!0,e=a.tmp.date_collapse_at.length,d=0;e>d;d+=1)if(y=a.tmp.date_collapse_at[d],-1===a.tmp.donesies.indexOf(y)){s=!1;break}if(s){if("0"!=""+i){if(0===a.dateput.queue.length&&(g=!0),a.opt["year-range-format"]&&"expanded"!==a.opt["year-range-format"]&&!a.tmp.date_object.day&&!a.tmp.date_object.month&&!a.tmp.date_object.season&&"year"===this.strings.name&&h&&i){i=a.fun.year_mangler(h+"-"+i,!0);var D=a.getTerm("year-range-delimiter");i=i.slice(i.indexOf(D)+1)}a.dateput.append(i,this),g&&(a.dateput.current.value()[0].strings.prefix="")}a.output.append(h,this),t=a.output.current.value(),t.blobs[t.blobs.length-1].strings.suffix="",a.output.append(a.getTerm("year-range-delimiter"),"empty"),u=a.dateput.current.value(),t.blobs=t.blobs.concat(u),a.dateput.string(a,a.dateput.queue),a.tmp.date_collapse_at=[]}else a.output.append(h,this),a.tmp.date_collapse_at.indexOf(this.strings.name)>-1&&"0"!=""+i&&(0===a.dateput.queue.length&&(g=!0),a.dateput.openLevel("empty"),a.dateput.append(i,this),g&&(a.dateput.current.value().blobs[0].strings.prefix=""),o&&a.dateput.append(o),p&&a.dateput.append(p),a.dateput.closeLevel())}else a.output.append(h,this);o&&a.output.append(o),p&&a.output.append(p),a.output.closeLevel()}else"month"===this.strings.name&&a.tmp.date_object.season&&(h=""+a.tmp.date_object.season,h&&h.match(/^[1-4]$/)?(a.tmp.group_context.replace([!1,!1,!0]),a.output.append(a.getTerm("season-0"+h),this)):h&&a.output.append(h,this));a.tmp.value=[],!h&&!a.tmp.have_collapsed||a.opt.has_year_suffix||"year"!==this.strings.name||a.tmp.just_looking||a.registry.registry[b.id]&&a.registry.registry[b.id].disambig.year_suffix!==!1&&!a.tmp.has_done_year_suffix&&(a.tmp.has_done_year_suffix=!0,w=parseInt(a.registry.registry[b.id].disambig.year_suffix,10),v=new CSL.NumericBlob(w,this,b.id),this.successor_prefix=a[a.build.area].opt.layout_delimiter,this.splice_prefix=a[a.build.area].opt.layout_delimiter,x=new CSL.Util.Suffixator(CSL.SUFFIX_CHARS),v.setFormatter(x),"year-suffix-ranged"===a[a.tmp.area].opt.collapse&&(v.range_prefix=a.getTerm("citation-range-delimiter")),v.successor_prefix=a[a.tmp.area].opt["year-suffix-delimiter"]?a[a.tmp.area].opt["year-suffix-delimiter"]:a[a.tmp.area].opt.layout_delimiter,v.UGLY_DELIMITER_SUPPRESS_HACK=!0,a.output.append(v,"literal"))}},this.execs.push(c),b.push(this)}},CSL.Node["else-if"]={build:function(a,b){CSL.Conditions.TopNode.call(this,a,b),b.push(this)},configure:function(a,b){CSL.Conditions.Configure.call(this,a,b)}},CSL.Node["else"]={build:function(a,b){b.push(this)},configure:function(a,b){this.tokentype===CSL.START&&(a.configure.fail[a.configure.fail.length-1]=b)}},CSL.Node["et-al"]={build:function(a,b){if("citation"===a.build.area||"bibliography"===a.build.area){var c=function(a){a.tmp.etal_node=this,"string"==typeof this.strings.term&&(a.tmp.etal_term=this.strings.term)};this.execs.push(c)}b.push(this)}},CSL.Node.group={build:function(a,b){var c,d;this.tokentype===CSL.START?(CSL.Util.substituteStart.call(this,a,b),a.build.substitute_level.value()&&a.build.substitute_level.replace(a.build.substitute_level.value()+1),c=function(a){a.output.startTag("group",this),a.tmp.group_context.mystack.length&&(a.output.current.value().parent=a.tmp.group_context.value()[4]);var c=a.tmp.group_context.value()[5];!c&&this.strings.label_form_override&&(c=this.strings.label_form_override),a.tmp.group_context.push([!1,!1,!1,!1,a.output.current.value(),c,this.strings.set_parallel_condition],CSL.LITERAL),this.strings.oops&&(a.tmp.group_context.value()[3]=this.strings.oops)},d=[],d.push(c),this.execs=d.concat(this.execs),this.strings["has-publisher-and-publisher-place"]&&(a.build["publisher-special"]=!0,c=function(a,b){if(this.strings["subgroup-delimiter"]&&b.publisher&&b["publisher-place"]){var c=b.publisher.split(/;\s*/),d=b["publisher-place"].split(/;\s*/);c.length>1&&c.length===d.length&&(a.publisherOutput=new CSL.PublisherOutput(a,this),a.publisherOutput["publisher-list"]=c,a.publisherOutput["publisher-place-list"]=d)}},this.execs.push(c))):(a.build["publisher-special"]&&(a.build["publisher-special"]=!1,"string"==typeof a[a.build.root].opt["name-delimiter"]&&(c=function(a){a.publisherOutput&&(a.publisherOutput.render(),a.publisherOutput=!1)},this.execs.push(c))),c=function(a,b){var c=a.tmp.group_context.pop();if(a.output.endTag(),a.tmp.group_context.value(),c[1]&&(a.tmp.group_context.value()[1]=!0),c[2]||c[0]&&!c[1]){a.tmp.group_context.value()[2]=!0;var e=a.output.current.value().blobs,f=a.output.current.value().blobs.length-1;if(!a.tmp.just_looking&&"undefined"!=typeof c[6]){var g={blobs:e,conditions:c[6],id:b.id,pos:f};a.parallel.parallel_conditional_blobs_list.push(g)}}else a.output.current.value().blobs&&a.output.current.value().blobs.pop(),a.tmp.group_context.value()[3]&&(a.output.current.mystack[a.output.current.mystack.length-2].strings.delimiter=a.tmp.group_context.value()[3])},this.execs.push(c)),b.push(this),this.tokentype===CSL.END&&(a.build.substitute_level.value()&&a.build.substitute_level.replace(a.build.substitute_level.value()-1),CSL.Util.substituteEnd.call(this,a,b))}},CSL.Node["if"]={build:function(a,b){CSL.Conditions.TopNode.call(this,a,b),b.push(this)},configure:function(a,b){CSL.Conditions.Configure.call(this,a,b)}},CSL.Node.conditions={build:function(a){this.tokentype===CSL.START&&a.tmp.conditions.addMatch(this.match),this.tokentype===CSL.END&&a.tmp.conditions.matchCombine()}},CSL.Node.condition={build:function(a){if(this.tokentype===CSL.SINGLETON){var c=a.fun.match[this.match](this,a,this.tests);a.tmp.conditions.addTest(c)}}},CSL.Conditions={},CSL.Conditions.TopNode=function(a){var c;(this.tokentype===CSL.START||this.tokentype===CSL.SINGLETON)&&(this.locale&&(a.opt.lang=this.locale),this.tests&&this.tests.length?this.test=a.fun.match[this.match](this,a,this.tests):a.tmp.conditions=new CSL.Conditions.Engine(a,this)),(this.tokentype===CSL.END||this.tokentype===CSL.SINGLETON)&&(c=function(a){this.locale_default&&(a.output.current.value().old_locale=this.locale_default,a.output.closeLevel("empty"),a.opt.lang=this.locale_default);var c=this[a.tmp.jump.value()];return c},this.execs.push(c),this.locale_default&&(a.opt.lang=this.locale_default))},CSL.Conditions.Configure=function(a,b){this.tokentype===CSL.START?(this.fail=a.configure.fail.slice(-1)[0],this.succeed=this.next,a.configure.fail[a.configure.fail.length-1]=b):this.tokentype===CSL.SINGLETON?(this.fail=this.next,this.succeed=a.configure.succeed.slice(-1)[0],a.configure.fail[a.configure.fail.length-1]=b):(this.succeed=a.configure.succeed.slice(-1)[0],this.fail=this.next)},CSL.Conditions.Engine=function(a,b){this.token=b,this.state=a},CSL.Conditions.Engine.prototype.addTest=function(a){this.token.tests.push(a)},CSL.Conditions.Engine.prototype.addMatch=function(a){this.token.match=a},CSL.Conditions.Engine.prototype.matchCombine=function(){this.token.test=this.state.fun.match[this.token.match](this.token,this.state,this.token.tests)},CSL.Node.info={build:function(a){a.build.skip=this.tokentype===CSL.START?"info":!1}},CSL.Node.institution={build:function(a,b){if([CSL.SINGLETON,CSL.START].indexOf(this.tokentype)>-1){var c=function(a){"string"!=typeof a.build.name_delimiter||this.strings.delimiter||(this.strings.delimiter=a.tmp.name_delimiter),"text"===this.strings.and?this.and_term=a.getTerm("and","long",0):"symbol"===this.strings.and?this.and_term=a.opt.development_extensions.expect_and_symbol_form?a.getTerm("and","symbol",0):"&":"none"===this.strings.and&&(this.and_term=this.strings.delimiter),"undefined"==typeof this.and_term&&a.tmp.and_term&&(this.and_term=a.getTerm("and","long",0)),CSL.STARTSWITH_ROMANESQUE_REGEXP.test(this.and_term)?(this.and_prefix_single=" ",this.and_prefix_multiple=", ","string"==typeof this.strings.delimiter&&(this.and_prefix_multiple=this.strings.delimiter),this.and_suffix=" "):(this.and_prefix_single="",this.and_prefix_multiple="",this.and_suffix=""),"always"===this.strings["delimiter-precedes-last"]?this.and_prefix_single=this.strings.delimiter:"never"===this.strings["delimiter-precedes-last"]&&this.and_prefix_multiple&&(this.and_prefix_multiple=" "),this.and={},"undefined"!=typeof this.and_term?(a.output.append(this.and_term,"empty",!0),this.and.single=a.output.pop(),this.and.single.strings.prefix=this.and_prefix_single,this.and.single.strings.suffix=this.and_suffix,a.output.append(this.and_term,"empty",!0),this.and.multiple=a.output.pop(),this.and.multiple.strings.prefix=this.and_prefix_multiple,this.and.multiple.strings.suffix=this.and_suffix):"undefined"!==this.strings.delimiter&&(this.and.single=new CSL.Blob(this.strings.delimiter),this.and.single.strings.prefix="",this.and.single.strings.suffix="",this.and.multiple=new CSL.Blob(this.strings.delimiter),this.and.multiple.strings.prefix="",this.and.multiple.strings.suffix=""),a.nameOutput.institution=this};this.execs.push(c)}b.push(this)},configure:function(a){[CSL.SINGLETON,CSL.START].indexOf(this.tokentype)>-1&&(a.build.has_institution=!0)}},CSL.Node["institution-part"]={build:function(a,b){var c;"long"===this.strings.name?c=this.strings["if-short"]?function(a){a.nameOutput.institutionpart["long-with-short"]=this}:function(a){a.nameOutput.institutionpart["long"]=this}:"short"===this.strings.name&&(c=function(a){a.nameOutput.institutionpart["short"]=this}),this.execs.push(c),b.push(this)}},CSL.Node.key={build:function(a,b){var c,g=new CSL.Token("key",CSL.START);g.strings["et-al-min"]=this.strings["et-al-min"],g.strings["et-al-use-first"]=this.strings["et-al-use-first"],g.strings["et-al-use-last"]=this.strings["et-al-use-last"],c=function(a){a.tmp.done_vars=[]},g.execs.push(c),a.opt.citation_number_sort_direction=this.strings.sort_direction,c=function(a){a.output.openLevel("empty")},g.execs.push(c);var h=[];if(this.strings.sort_direction===CSL.DESCENDING?(h.push(1),h.push(-1)):(h.push(-1),h.push(1)),a[a.build.area].opt.sort_directions.push(h),CSL.DATE_VARIABLES.indexOf(this.variables[0])>-1&&(a.build.date_key=!0),c=function(a){a.tmp.sort_key_flag=!0,this.strings["et-al-min"]&&(a.tmp["et-al-min"]=this.strings["et-al-min"]),this.strings["et-al-use-first"]&&(a.tmp["et-al-use-first"]=this.strings["et-al-use-first"]),"boolean"==typeof this.strings["et-al-use-last"]&&(a.tmp["et-al-use-last"]=this.strings["et-al-use-last"])},g.execs.push(c),b.push(g),this.variables.length){var i=this.variables[0];if("citation-number"===i&&("citation_sort"===a.build.area&&(a.opt.citation_number_sort=!0),"bibliography_sort"===a.build.area&&(a.opt.citation_number_sort_used=!0)),CSL.CREATORS.indexOf(i)>-1){var j=new CSL.Token("names",CSL.START);j.tokentype=CSL.START,j.variables=this.variables,CSL.Node.names.build.call(j,a,b);var k=new CSL.Token("name",CSL.SINGLETON);k.tokentype=CSL.SINGLETON,k.strings["name-as-sort-order"]="all",k.strings["sort-separator"]=" ",k.strings["et-al-use-last"]=this.strings["et-al-use-last"],k.strings["et-al-min"]=this.strings["et-al-min"],k.strings["et-al-use-first"]=this.strings["et-al-use-first"],CSL.Node.name.build.call(k,a,b);var l=new CSL.Token("institution",CSL.SINGLETON);l.tokentype=CSL.SINGLETON,CSL.Node.institution.build.call(l,a,b);var m=new CSL.Token("names",CSL.END);m.tokentype=CSL.END,CSL.Node.names.build.call(m,a,b)}else{var n=new CSL.Token("text",CSL.SINGLETON);if(n.dateparts=this.dateparts,CSL.NUMERIC_VARIABLES.indexOf(i)>-1)c=function(a,b){var c;c=!1,c="citation-number"===i?a.registry.registry[b.id].seq.toString():b[i],c&&(c=CSL.Util.padding(c)),a.output.append(c,this)};else if("citation-label"===i)c=function(a,b){var c=a.getCitationLabel(b);a.output.append(c,this)};else if(CSL.DATE_VARIABLES.indexOf(i)>-1)c=CSL.dateAsSortKey,n.variables=this.variables;else if("title"===i){var o="title",p=!1,q=!1,r=!0;c=a.transform.getOutputFunction(this.variables,o,p,q,r)}else c=function(a,b){var c=b[i];a.output.append(c,"empty")};n.execs.push(c),b.push(n)}}else{var s=new CSL.Token("text",CSL.SINGLETON);s.postponed_macro=this.postponed_macro,CSL.expandMacro.call(a,s)}var t=new CSL.Token("key",CSL.END);c=function(a){var c=a.output.string(a,a.output.queue);a.sys.normalizeUnicode&&(c=a.sys.normalizeUnicode(c)),""===c&&(c=void 0),("string"!=typeof c||a.tmp.empty_date)&&(c=void 0,a.tmp.empty_date=!1),a[a.tmp.area].keys.push(c),a.tmp.value=[]},t.execs.push(c),a.build.date_key&&("citation_sort"===a.build.area&&(a[a.build.area].opt.sort_directions.push([-1,1]),c=function(a,b){var c=a.registry.registry[b.id].disambig.year_suffix;c||(c=0);var d=CSL.Util.padding(""+c);a[a.tmp.area].keys.push(d)},t.execs.push(c)),a.build.date_key=!1),c=function(a){a.tmp["et-al-min"]=void 0,a.tmp["et-al-use-first"]=void 0,a.tmp["et-al-use-last"]=void 0,a.tmp.sort_key_flag=!1},t.execs.push(c),b.push(t)}},CSL.Node.label={build:function(a,b){if(this.strings.term){this.strings.form||(this.strings.form="long");var e=function(a,b,c){var d=CSL.evaluateLabel(this,a,b,c);c&&"locator"===this.strings.term&&(a.parallel.StartVariable("label"),a.parallel.AppendToVariable(c.label),c.section_form_override=this.strings.form),a.output.append(d,this),c&&"locator"===this.strings.term&&a.parallel.CloseVariable()};this.execs.push(e)}else{var f=a.build.names_variables.slice(-1)[0];a.build.name_label||(a.build.name_label={});for(var g=0,h=f.length;h>g;g+=1)a.build.name_label[f[g]]||(a.build.name_label[f[g]]={});if(a.build.name_flag)for(var g=0,h=f.length;h>g;g+=1)a.build.name_label[f[g]].after=this;else for(var g=0,h=f.length;h>g;g+=1)a.build.name_label[f[g]].before=this}b.push(this)}},CSL.Node.layout={build:function(a,b){var c,d,e,f;this.tokentype===CSL.START&&(c=function(a,b,c){a.opt.development_extensions.apply_citation_wrapper&&a.sys.wrapCitationEntry&&!a.tmp.just_looking&&b.system_id&&"citation"===a.tmp.area&&(cite_entry=new CSL.Token("group",CSL.START),cite_entry.decorations=[["@cite","entry"]],a.output.startTag("cite_entry",cite_entry),a.output.current.value().item_id=b.system_id,c&&(a.output.current.value().locator_txt=c.locator_txt,a.output.current.value().suffix_txt=c.suffix_txt))},this.execs.push(c)),this.tokentype!==CSL.START||a.tmp.cite_affixes[a.build.area]||(c=function(a,b){a.tmp.done_vars=[],!a.tmp.just_looking&&a.registry.registry[b.id].parallel&&a.tmp.done_vars.push("first-reference-note-number"),a.tmp.rendered_name=!1,a.tmp.name_node={}},this.execs.push(c),c=function(a){a.tmp.sort_key_flag=!1},this.execs.push(c),c=function(a){a.tmp.nameset_counter=0},this.execs.push(c),c=function(a,b){var c="empty";a.opt.development_extensions.rtl_support&&["ar","he","fa","ur","yi","ps","syr"].indexOf(b.language)>-1&&(c=new CSL.Token,c.strings.prefix="\u202b",c.strings.suffix="\u202c"),a.output.openLevel(c)},this.execs.push(c),b.push(this),"citation"===a.build.area&&(d=new CSL.Token("text",CSL.SINGLETON),c=function(a,b,c){var d;if(c&&c.prefix){d="";var e=c.prefix.replace(/<[^>]+>/g,"").replace(/["'\u201d\u2019\u00bb\u202f\u00a0 ]+$/g,""),f=e.slice(-1);e.match(CSL.ENDSWITH_ROMANESQUE_REGEXP)?d=" ":CSL.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(f)>-1?d=" ":f.match(/[\)\],0-9]/)&&(d=" ");var g=!1;CSL.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(f)>-1&&c.prefix.indexOf(" ")>-1&&(a.tmp.term_predecessor=!1,g=!0),prefix=(c.prefix+d).replace(/\s+/g," "),a.output.append(prefix,this,!1,g)}},d.execs.push(c),b.push(d)));var g;if(this.locale_raw&&(g=new CSL.Token("dummy",CSL.START),g.locale=this.locale_raw,g.strings.delimiter=this.strings.delimiter,g.strings.suffix=this.strings.suffix,a.tmp.cite_affixes[a.build.area]||(a.tmp.cite_affixes[a.build.area]={})),this.tokentype===CSL.START&&(a.build.layout_flag=!0,this.locale_raw||(a[a.tmp.area].opt.topdecor=[this.decorations],a[a.tmp.area+"_sort"].opt.topdecor=[this.decorations],a[a.build.area].opt.layout_prefix=this.strings.prefix,a[a.build.area].opt.layout_suffix=this.strings.suffix,a[a.build.area].opt.layout_delimiter=this.strings.delimiter,a[a.build.area].opt.layout_decorations=this.decorations,a.tmp.cite_affixes[a.build.area]&&(f=new CSL.Token("else",CSL.START),CSL.Node["else"].build.call(f,a,b))),this.locale_raw)){if(a.build.layout_locale_flag)g.name="else-if",CSL.Attributes["@locale-internal"].call(g,a,this.locale_raw),CSL.Node["else-if"].build.call(g,a,b);else{var h=new CSL.Token("choose",CSL.START);CSL.Node.choose.build.call(h,a,b),g.name="if",CSL.Attributes["@locale-internal"].call(g,a,this.locale_raw),CSL.Node["if"].build.call(g,a,b)}a.tmp.cite_affixes[a.build.area][g.locale]={},a.tmp.cite_affixes[a.build.area][g.locale].delimiter=this.strings.delimiter,a.tmp.cite_affixes[a.build.area][g.locale].suffix=this.strings.suffix}this.tokentype===CSL.END&&(this.locale_raw&&(a.build.layout_locale_flag?(g.name="else-if",g.tokentype=CSL.END,CSL.Attributes["@locale-internal"].call(g,a,this.locale_raw),CSL.Node["else-if"].build.call(g,a,b)):(g.name="if",g.tokentype=CSL.END,CSL.Attributes["@locale-internal"].call(g,a,this.locale_raw),CSL.Node["if"].build.call(g,a,b),a.build.layout_locale_flag=!0)),this.locale_raw||(a.tmp.cite_affixes[a.build.area]&&a.build.layout_locale_flag&&(f=new CSL.Token("else",CSL.END),CSL.Node["else"].build.call(f,a,b),f=new CSL.Token("choose",CSL.END),CSL.Node.choose.build.call(f,a,b)),a.build_layout_locale_flag=!0,"citation"===a.build.area&&(e=new CSL.Token("text",CSL.SINGLETON),c=function(a,b,c){var d;c&&c.suffix&&(d="",(c.suffix.match(CSL.STARTSWITH_ROMANESQUE_REGEXP)||["[","("].indexOf(c.suffix.slice(0,1))>-1)&&(d=" "),a.output.append(d+c.suffix,this))},e.execs.push(c),b.push(e)),c=function(a){"bibliography"===a.tmp.area&&a.bibliography.opt["second-field-align"]&&a.output.endTag(),a.output.closeLevel()},this.execs.push(c),c=function(a,b){a.opt.development_extensions.apply_citation_wrapper&&a.sys.wrapCitationEntry&&!a.tmp.just_looking&&b.system_id&&"citation"===a.tmp.area&&a.output.endTag()},this.execs.push(c),b.push(this),a.build.layout_flag=!1,a.build.layout_locale_flag=!1))}},CSL.Node.macro={build:function(){}},CSL.NameOutput=function(a,b,c){this.debug=!1,this.state=a,this.Item=b,this.item=c,this.nameset_base=0,this.etal_spec={},this._first_creator_variable=!1,this._please_chop=!1},CSL.NameOutput.prototype.init=function(a){this.state.tmp.term_predecessor&&(this.state.tmp.subsequent_author_substitute_ok=!1),this.nameset_offset&&(this.nameset_base=this.nameset_base+this.nameset_offset),this.nameset_offset=0,this.names=a,this.variables=a.variables,this.state.tmp.value=[],this.state.tmp.rendered_name=[],this.state.tmp.label_blob=!1,this.state.tmp.etal_node=!1,this.state.tmp.etal_term=!1;for(var b=0,c=this.variables.length;c>b;b+=1)this.Item[this.variables[b]]&&this.Item[this.variables[b]].length&&(this.state.tmp.value=this.state.tmp.value.concat(this.Item[this.variables[b]]));
    this["et-al"]=void 0,this["with"]=void 0,this.name=void 0,this.institutionpart={},this.state.tmp.group_context.value()[1]=!0,!this.state.tmp.value.length},CSL.NameOutput.prototype.reinit=function(a){if(this.state.tmp.can_substitute.value()){this.nameset_offset=0,this.variables=a.variables;var b=this.state.tmp.value.slice();this.state.tmp.value=[];for(var c=0,d=this.variables.length;d>c;c+=1)this.Item[this.variables[c]]&&this.Item[this.variables[c]].length&&(this.state.tmp.value=this.state.tmp.value.concat(this.Item[this.variables[c]]));this.state.tmp.value.length&&this.state.tmp.can_substitute.replace(!1,CSL.LITERAL),this.state.tmp.value=b}},CSL.NameOutput.prototype.outputNames=function(){var a,b,c=this.variables;if(this.institution.and&&(this.institution.and.single.blobs&&this.institution.and.single.blobs.length||(this.institution.and.single.blobs=this.name.and.single.blobs),this.institution.and.multiple.blobs&&this.institution.and.multiple.blobs.length||(this.institution.and.multiple.blobs=this.name.and.multiple.blobs)),this.variable_offset={},this.family)for(this.family_decor=CSL.Util.cloneToken(this.family),this.family_decor.strings.prefix="",this.family_decor.strings.suffix="",a=0,b=this.family.execs.length;b>a;a+=1)this.family.execs[a].call(this.family_decor,this.state,this.Item);else this.family_decor=!1;if(this.given)for(this.given_decor=CSL.Util.cloneToken(this.given),this.given_decor.strings.prefix="",this.given_decor.strings.suffix="",a=0,b=this.given.execs.length;b>a;a+=1)this.given.execs[a].call(this.given_decor,this.state,this.Item);else this.given_decor=!1;if(this.getEtAlConfig(),this.divideAndTransliterateNames(),this.truncatePersonalNameLists(),this.disambigNames(),this.constrainNames(),"count"===this.name.strings.form)return(this.state.tmp.extension||0!=this.names_count)&&(this.state.output.append(this.names_count,"empty"),this.state.tmp.group_context.value()[2]=!0),void 0;this.setEtAlParameters(),this.setCommonTerm(),this.state.tmp.name_node={},this.state.tmp.name_node.children=[],this.renderAllNames();var d=[];for(a=0,b=c.length;b>a;a+=1){for(var e=c[a],f=[],g=!1,h=0,i=this.institutions[e].length;i>h;h+=1)f.push(this.joinPersonsAndInstitutions([this.persons[e][h],this.institutions[e][h]]));if(this.institutions[e].length){var j=this.nameset_base+this.variable_offset[e];this.freeters[e].length&&(j+=1),g=this.joinInstitutionSets(f,j)}var k=this.joinFreetersAndInstitutionSets([this.freeters[e],g]);if(k&&("_sort"!==this.state.tmp.area.slice(-5)&&(k=this._applyLabels(k,e)),d.push(k)),this.common_term)break}for(this.state.output.openLevel("empty"),this.state.output.current.value().strings.delimiter=this.names.strings.delimiter,a=0,b=d.length;b>a;a+=1)this.state.output.append(d[a],"literal",!0);this.state.output.closeLevel("empty");var l=this.state.output.pop();if(this.state.output.append(l,this.names),this.state.tmp.term_predecessor_name&&(this.state.tmp.term_predecessor=!0),this.state.tmp.name_node.top=this.state.output.current.value(),"authority"!==c[0]){var m=[],n=this.Item[c[0]];if(n)for(var a=0,b=n.length;b>a;a+=1)substring=CSL.Util.Names.getRawName(n[a]),substring&&m.push(substring);m=m.join(", "),m&&(this.state.tmp.name_node.string=m)}if(this.state.tmp.name_node.string&&!this.state.tmp.first_name_string&&(this.state.tmp.first_name_string=this.state.tmp.name_node.string),"classic"===this.Item.type){var o=[];this.state.tmp.first_name_string&&o.push(this.state.tmp.first_name_string),this.Item.title&&o.push(this.Item.title),o=o.join(", "),o&&this.state.sys.getAbbreviation&&(this.state.transform.loadAbbreviation("default","classic",o),this.state.transform.abbrevs["default"].classic[o]&&(this.state.tmp.done_vars.push("title"),this.state.output.append(this.state.transform.abbrevs["default"].classic[o],"empty",!0),l=this.state.output.pop(),this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.top.blobs.push(l)))}this._collapseAuthor(),this.variables=[]},CSL.NameOutput.prototype._applyLabels=function(a,b){var c;if(!this.label||!this.label[b])return a;var d=0,e=this.freeters_count[b]+this.institutions_count[b];if(e>1)d=1;else{for(var f=0,g=this.persons[b].length;g>f;f+=1)e+=this.persons_count[b][f];e>1&&(d=1)}return this.label[b].before&&("number"==typeof this.label[b].before.strings.plural&&(d=this.label[b].before.strings.plural),c=this._buildLabel(b,d,"before",b),this.state.output.openLevel("empty"),this.state.output.append(c,this.label[b].before,!0),this.state.output.append(a,"literal",!0),this.state.output.closeLevel("empty"),a=this.state.output.pop()),this.label[b].after&&("number"==typeof this.label[b].after.strings.plural&&(d=this.label[b].after.strings.plural),c=this._buildLabel(b,d,"after",b),this.state.output.openLevel("empty"),this.state.output.append(a,"literal",!0),this.state.output.append(c,this.label[b].after,!0),this.state.tmp.label_blob=this.state.output.pop(),this.state.output.append(this.state.tmp.label_blob,"literal",!0),this.state.output.closeLevel("empty"),a=this.state.output.pop()),a},CSL.NameOutput.prototype._buildLabel=function(a,b,c,d){this.common_term&&(a=this.common_term);var e=!1,f=this.label[d][c];return f&&(e=CSL.castLabel(this.state,f,a,b,CSL.TOLERANT)),e},CSL.NameOutput.prototype._collapseAuthor=function(){var a,b,c;0===this.nameset_base&&this.Item[this.variables[0]]&&!this._first_creator_variable&&(this._first_creator_variable=this.variables[0]),(this.item&&this.item["suppress-author"]&&this._first_creator_variable==this.variables[0]||this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length||this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter.length)&&(this.state.tmp.authorstring_request?(b="",a=this.state.tmp.name_node.top.blobs.slice(-1)[0].blobs,c=this.state.tmp.offset_characters,a&&(b=this.state.output.string(this.state,a,!1)),this.state.tmp.offset_characters=c,this.state.registry.authorstrings[this.Item.id]=b):this.state.tmp.just_looking||this.state.tmp.suppress_decorations||!(this.item["suppress-author"]||this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length||this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter)||(b="",a=this.state.tmp.name_node.top.blobs.slice(-1)[0].blobs,c=this.state.tmp.offset_characters,a&&(b=this.state.output.string(this.state,a,!1)),b===this.state.tmp.last_primary_names_string?((this.item["suppress-author"]||this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length)&&(this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.children=[],this.state.tmp.offset_characters=c),this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter&&(this.state.tmp.use_cite_group_delimiter=!0)):(this.state.tmp.last_primary_names_string=b,this.variables.indexOf(this._first_creator_variable)>-1&&this.item&&this.item["suppress-author"]&&"legal_case"!==this.Item.type&&(this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.children=[],this.state.tmp.offset_characters=c,this.state.tmp.term_predecessor=!1),this.state.tmp.have_collapsed=!1,this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter&&(this.state.tmp.use_cite_group_delimiter=!1))))},CSL.NameOutput.prototype.isPerson=function(a){return a.literal||!a.given&&a.family&&a.isInstitution?!1:!0},CSL.NameOutput.prototype.truncatePersonalNameLists=function(){var a,b,c,d,e,f,g;this.freeters_count={},this.persons_count={},this.institutions_count={};for(a in this.freeters)this.freeters.hasOwnProperty(a)&&(this.freeters_count[a]=this.freeters[a].length,this.freeters[a]=this._truncateNameList(this.freeters,a));for(a in this.persons)if(this.persons.hasOwnProperty(a))for(this.institutions_count[a]=this.institutions[a].length,this._truncateNameList(this.institutions,a),this.persons[a]=this.persons[a].slice(0,this.institutions[a].length),this.persons_count[a]=[],d=0,e=this.persons[a].length;e>d;d+=1)this.persons_count[a][d]=this.persons[a][d].length,this.persons[a][d]=this._truncateNameList(this.persons,a,d);if(f=1!==this.etal_min||1!==this.etal_use_first||this.state.tmp.extension||this.state.tmp.just_looking?!1:a,f||this._please_chop)for(b=0,c=this.variables.length;c>b;b+=1){for(a=this.variables[b],this.freeters[a].length&&(this._please_chop===a?(this.freeters[a]=this.freeters[a].slice(1),this.freeters_count[a]+=-1,this._please_chop=!1):f&&!this._please_chop&&(this.freeters[a]=this.freeters[a].slice(0,1),this.freeters_count[a]=1,this.institutions[a]=[],this.persons[a]=[],this._please_chop=f)),b=0,c=this.persons[a].length;c>b;b+=1)if(this.persons[a][b].length){if(this._please_chop===a){this.persons[a][b]=this.persons[a][b].slice(1),this.persons_count[a][b]+=-1,this._please_chop=!1;break}if(f&&!this._please_chop){this.freeters[a]=this.persons[a][b].slice(0,1),this.freeters_count[a]=1,this.institutions[a]=[],this.persons[a]=[],g=[],this._please_chop=f;break}}this.institutions[a].length&&(this._please_chop===a?(this.institutions[a]=this.institutions[a].slice(1),this.institutions_count[a]+=-1,this._please_chop=!1):f&&!this._please_chop&&(this.institutions[a]=this.institutions[a].slice(0,1),this.institutions_count[a]=1,g=[],this._please_chop=f))}for(b=0,c=this.variables.length;c>b;b+=1)for(this.institutions[a].length&&(this.nameset_offset+=1),b=0,c=this.persons[a].length;c>b;b+=1)this.persons[a][b].length&&(this.nameset_offset+=1)},CSL.NameOutput.prototype._truncateNameList=function(a,b,c){var d;return d="undefined"==typeof c?a[b]:a[b][c],this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names&&d.length>50&&d.length>this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names+2&&(d=d.slice(0,this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names+2)),d},CSL.NameOutput.prototype.divideAndTransliterateNames=function(){var a,b,c,d,e=this.Item,f=this.variables;for(this.varnames=f.slice(),this.freeters={},this.persons={},this.institutions={},a=0,b=f.length;b>a;a+=1){var g=f[a];this.variable_offset[g]=this.nameset_offset;var h=this._normalizeVariableValue(e,g);if(this.name.strings["suppress-min"]&&h.length>=this.name.strings["suppress-min"]&&(h=[]),this.name.strings["suppress-max"]&&h.length<=this.name.strings["suppress-max"]&&(h=[]),this._getFreeters(g,h),this._getPersonsAndInstitutions(g,h),0===this.name.strings["suppress-min"])for(this.freeters[g]=[],c=0,d=this.persons[g].length;d>c;c+=1)this.persons[g][c]=[];else if(0===this.institution.strings["suppress-min"]){for(this.institutions[g]=[],this.freeters[g]=this.freeters[g].concat(this.persons[g]),c=0,d=this.persons[g].length;d>c;c+=1)for(var i=0,j=this.persons[g][c].length;j>i;i+=1)this.freeters[g].push(this.persons[g][c][i]);this.persons[g]=[]}}},CSL.NameOutput.prototype._normalizeVariableValue=function(a,b){var c;return c="string"==typeof a[b]?[{literal:a[b]}]:a[b]?a[b].slice():[]},CSL.NameOutput.prototype._getFreeters=function(a,b){this.freeters[a]=[];for(var c=b.length-1;c>-1&&this.isPerson(b[c]);c+=-1){var d=this._checkNickname(b.pop());d&&this.freeters[a].push(d)}this.freeters[a].reverse(),this.freeters[a].length&&(this.nameset_offset+=1)},CSL.NameOutput.prototype._getPersonsAndInstitutions=function(a,b){this.persons[a]=[],this.institutions[a]=[];for(var c=[],d=!1,e=!0,f=b.length-1;f>-1;f+=-1)if(this.isPerson(b[f])){var g=this._checkNickname(b[f]);g&&c.push(g)}else d=!0,this.institutions[a].push(b[f]),e||(c.reverse(),this.persons[a].push(c),c=[]),e=!1;d&&(c.reverse(),this.persons[a].push(c),this.persons[a].reverse(),this.institutions[a].reverse())},CSL.NameOutput.prototype._clearValues=function(a){for(var b=a.length-1;b>-1;b+=-1)a.pop()},CSL.NameOutput.prototype._checkNickname=function(a){if(["interview","personal_communication"].indexOf(this.Item.type)>-1){var b="";if(b=CSL.Util.Names.getRawName(a),b&&this.state.sys.getAbbreviation&&(!this.item||!this.item["suppress-author"])){this.state.transform.loadAbbreviation("default","nickname",b);var c=this.state.transform.abbrevs["default"].nickname[b];c&&(a="!here>>>"===c?!1:{family:c,given:""})}}return a},CSL.NameOutput.prototype.joinPersons=function(a,b,c){var d;return d="undefined"==typeof c?1===this.etal_spec[b].freeters?this._joinEtAl(a,"name"):2===this.etal_spec[b].freeters?this._joinEllipsis(a,"name"):this.state.tmp.sort_key_flag?this._join(a," "):this._joinAnd(a,"name"):1===this.etal_spec[b].persons[c]?this._joinEtAl(a,"name"):2===this.etal_spec[b].persons[c]?this._joinEllipsis(a,"name"):this.state.tmp.sort_key_flag?this._join(a," "):this._joinAnd(a,"name")},CSL.NameOutput.prototype.joinInstitutionSets=function(a,b){var c;return c=1===this.etal_spec[b].institutions?this._joinEtAl(a,"institution"):2===this.etal_spec[b].institutions?this._joinEllipsis(a,"institution"):this._joinAnd(a,"institution")},CSL.NameOutput.prototype.joinPersonsAndInstitutions=function(a){return this._join(a,this.name.strings.delimiter)},CSL.NameOutput.prototype.joinFreetersAndInstitutionSets=function(a){var b=this._join(a,"[never here]",this["with"].single,this["with"].multiple);return b},CSL.NameOutput.prototype._joinEtAl=function(a,b){var c=this._join(a,this.name.strings.delimiter);return this.state.output.openLevel(this._getToken(b)),this.state.output.current.value().strings.delimiter="",this.state.output.append(c,"literal",!0),a.length>1?this.state.output.append(this["et-al"].multiple,"literal",!0):1===a.length&&this.state.output.append(this["et-al"].single,"literal",!0),this.state.output.closeLevel(),this.state.output.pop()},CSL.NameOutput.prototype._joinEllipsis=function(a,b){return this._join(a,this.name.strings.delimiter,this.name.ellipsis.single,this.name.ellipsis.multiple,b)},CSL.NameOutput.prototype._joinAnd=function(a,b){return this._join(a,this[b].strings.delimiter,this[b].and.single,this[b].and.multiple,b)},CSL.NameOutput.prototype._join=function(a,b,c,d,e){var f,g;if(!a)return!1;for(f=a.length-1;f>-1;f+=-1)a[f]&&0!==a[f].length&&a[f].blobs.length||(a=a.slice(0,f).concat(a.slice(f+1)));if(!a.length)return!1;if(c&&2===a.length)c&&(c=new CSL.Blob(c.blobs,c)),a=[a[0],c,a[1]];else{var h;for(h=d?2:1,f=0,g=a.length-h;g>f;f+=1)a[f].strings.suffix+=b;if(a.length>1){var i=a.pop();d?(d=new CSL.Blob(d.blobs,d),a.push(d)):(c&&(c=new CSL.Blob(c.blobs,c)),a.push(c)),a.push(i)}}for(this.state.output.openLevel(this._getToken(e)),c&&d&&(this.state.output.current.value().strings.delimiter=""),f=0,g=a.length;g>f;f+=1)this.state.output.append(a[f],!1,!0);return this.state.output.closeLevel(),this.state.output.pop()},CSL.NameOutput.prototype._getToken=function(a){var b=this[a];if("institution"===a){var c=new CSL.Token;return c}return b},CSL.NameOutput.prototype.setCommonTerm=function(){var a=this.variables,b=a.slice();if(b.sort(),this.common_term=b.join(""),!this.common_term)return!1;var c=!1;if(this.label&&this.label[this.variables[0]]&&(this.label[this.variables[0]].before?c=this.state.getTerm(this.common_term,this.label[this.variables[0]].before.strings.form,0):this.label[this.variables[0]].after&&(c=this.state.getTerm(this.common_term,this.label[this.variables[0]].after.strings.form,0))),!this.state.locale[this.state.opt.lang].terms[this.common_term]||!c||this.variables.length<2)return this.common_term=!1,void 0;for(var d=0,e=0,f=this.variables.length-1;f>e;e+=1){var g=this.variables[e],h=this.variables[e+1];if(this.freeters[g].length||this.freeters[h].length){if(this.etal_spec[g].freeters!==this.etal_spec[h].freeters||!this._compareNamesets(this.freeters[g],this.freeters[h]))return this.common_term=!1,void 0;d+=1}if(this.persons[g].length!==this.persons[h].length)return this.common_term=!1,void 0;for(var i=0,j=this.persons[g].length;j>i;i+=1)if(this.etal_spec[g].persons[i]!==this.etal_spec[h].persons[i]||!this._compareNamesets(this.persons[g][i],this.persons[h][i]))return this.common_term=!1,void 0}},CSL.NameOutput.prototype._compareNamesets=function(a,b){if(a.length!==b.length)return!1;for(var c=0,d=b.length;d>c;c+=1){b[c];for(var f=0,g=CSL.NAME_PARTS.length;g>f;f+=1){var h=CSL.NAME_PARTS[f];if(!a[c]||a[c][h]!=b[c][h])return!1}}return!0},CSL.NameOutput.prototype.constrainNames=function(){this.names_count=0;for(var a,b=0,c=this.variables.length;c>b;b+=1){var d=this.variables[b];a=this.nameset_base+b,this.freeters[d].length&&(this.state.tmp.names_max.push(this.freeters[d].length,"literal"),this._imposeNameConstraints(this.freeters,this.freeters_count,d,a),this.names_count+=this.freeters[d].length),this.institutions[d].length&&(this.state.tmp.names_max.push(this.institutions[d].length,"literal"),this._imposeNameConstraints(this.institutions,this.institutions_count,d,a),this.persons[d]=this.persons[d].slice(0,this.institutions[d].length),this.names_count+=this.institutions[d].length);for(var e=0,f=this.persons[d].length;f>e;e+=1)this.persons[d][e].length&&(this.state.tmp.names_max.push(this.persons[d][e].length,"literal"),this._imposeNameConstraints(this.persons[d],this.persons_count[d],e,a),this.names_count+=this.persons[d][e].length)}},CSL.NameOutput.prototype._imposeNameConstraints=function(a,b,c,d){var e=a[c],f=this.state.tmp["et-al-min"];this.state.tmp.suppress_decorations?this.state.tmp.disambig_request&&this.state.tmp.disambig_request.names[d]?f=this.state.tmp.disambig_request.names[d]:b[c]>=this.etal_min&&(f=this.etal_use_first):(this.state.tmp.disambig_request&&this.state.tmp.disambig_request.names[d]>this.etal_use_first?f=b[c]<this.etal_min?b[c]:this.state.tmp.disambig_request.names[d]:b[c]>=this.etal_min&&(f=this.etal_use_first),this.etal_use_last&&f>this.etal_min-2&&(f=this.etal_min-2));var g=this.etal_min>=this.etal_use_first,h=b[c]>f;f>b[c]&&(f=e.length),g&&h&&(a[c]=this.etal_use_last?e.slice(0,f).concat(e.slice(-1)):e.slice(0,f)),this.state.tmp.disambig_settings.names[d]=a[c].length,this.state.disambiguate.padBase(this.state.tmp.disambig_settings)},CSL.NameOutput.prototype.disambigNames=function(){for(var a,b=0,c=this.variables.length;c>b;b+=1){var d=this.variables[b];if(a=this.nameset_base+b,this.freeters[d].length&&this._runDisambigNames(this.freeters[d],a),this.institutions[d].length){"undefined"==typeof this.state.tmp.disambig_settings.givens[a]&&(this.state.tmp.disambig_settings.givens[a]=[]);for(var e=0,f=this.institutions[d].length;f>e;e+=1)"undefined"==typeof this.state.tmp.disambig_settings.givens[a][e]&&this.state.tmp.disambig_settings.givens[a].push(2)}for(var e=0,f=this.persons[d].length;f>e;e+=1)this.persons[d][e].length&&this._runDisambigNames(this.persons[d][e],a)}},CSL.NameOutput.prototype._runDisambigNames=function(a,b){var c,d,e,f,g,h,i;for(g=0,h=a.length;h>g;g+=1)if(a[g].given||a[g].family){if(e=this.name.strings["initialize-with"],this.state.registry.namereg.addname(""+this.Item.id,a[g],g),c=this.state.tmp.disambig_settings.givens[b],"undefined"==typeof c)for(var j=0,k=b+1;k>j;j+=1)this.state.tmp.disambig_settings.givens[j]||(this.state.tmp.disambig_settings.givens[j]=[]);if(c=this.state.tmp.disambig_settings.givens[b][g],"undefined"==typeof c&&(d=this.name.strings.form,f=this.state.registry.namereg.evalname(""+this.Item.id,a[g],g,0,d,e),this.state.tmp.disambig_settings.givens[b].push(f)),d=this.name.strings.form,i=this.state.registry.namereg.evalname(""+this.Item.id,a[g],g,0,d,e),this.state.tmp.disambig_request){var l=this.state.tmp.disambig_settings.givens[b][g];1!==l||"by-cite"!==this.state.citation.opt["givenname-disambiguation-rule"]||"undefined"!=typeof this.name.strings["initialize-with"]&&"undefined"!=typeof a[g].given||(l=2),f=l,this.state.opt["disambiguate-add-givenname"]&&a[g].given&&(f=this.state.registry.namereg.evalname(""+this.Item.id,a[g],g,f,this.name.strings.form,this.name.strings["initialize-with"]))}else f=i;!this.state.tmp.just_looking&&this.item&&this.item.position===CSL.POSITION_FIRST&&i>f&&(f=i),this.state.tmp.sort_key_flag||(this.state.tmp.disambig_settings.givens[b][g]=f,"string"!=typeof e||"undefined"!=typeof this.name.strings.initialize&&!0!==this.name.strings.initialize||(this.state.tmp.disambig_settings.use_initials=!0))}},CSL.NameOutput.prototype.getEtAlConfig=function(){var a=this.item;this["et-al"]={},this.state.output.append(this.etal_term,this.etal_style,!0),this["et-al"].single=this.state.output.pop(),this["et-al"].single.strings.suffix=this.etal_suffix,this["et-al"].single.strings.prefix=this.etal_prefix_single,this.state.output.append(this.etal_term,this.etal_style,!0),this["et-al"].multiple=this.state.output.pop(),this["et-al"].multiple.strings.suffix=this.etal_suffix,this["et-al"].multiple.strings.prefix=this.etal_prefix_multiple,"undefined"==typeof a&&(a={}),a.position?(this.etal_min=this.name.strings["et-al-subsequent-min"]?this.name.strings["et-al-subsequent-min"]:this.name.strings["et-al-min"],this.etal_use_first=this.name.strings["et-al-subsequent-use-first"]?this.name.strings["et-al-subsequent-use-first"]:this.name.strings["et-al-use-first"]):(this.etal_min=this.state.tmp["et-al-min"]?this.state.tmp["et-al-min"]:this.name.strings["et-al-min"],this.etal_use_first=this.state.tmp["et-al-use-first"]?this.state.tmp["et-al-use-first"]:this.name.strings["et-al-use-first"],this.etal_use_last="boolean"==typeof this.state.tmp["et-al-use-last"]?this.state.tmp["et-al-use-last"]:this.name.strings["et-al-use-last"]),this.state.tmp["et-al-min"]||(this.state.tmp["et-al-min"]=this.etal_min)},CSL.NameOutput.prototype.setEtAlParameters=function(){var a,b,c,d;for(a=0,b=this.variables.length;b>a;a+=1){var e=this.variables[a];for("undefined"==typeof this.etal_spec[e]&&(this.etal_spec[e]={freeters:0,institutions:0,persons:[]}),this.etal_spec[this.nameset_base+a]=this.etal_spec[e],this.freeters[e].length&&this._setEtAlParameter("freeters",e),c=0,d=this.persons[e].length;d>c;c+=1)"undefined"==typeof this.etal_spec[e][c]&&(this.etal_spec[e].persons[c]=0),this._setEtAlParameter("persons",e,c);this.institutions[e].length&&this._setEtAlParameter("institutions",e)}},CSL.NameOutput.prototype._setEtAlParameter=function(a,b,c){var d,e;"persons"===a?(d=this.persons[b][c],e=this.persons_count[b][c]):(d=this[a][b],e=this[a+"_count"][b]),d.length<e&&!this.state.tmp.sort_key_flag?this.etal_use_last?"persons"===a?this.etal_spec[b].persons[c]=2:this.etal_spec[b][a]=2:"persons"===a?this.etal_spec[b].persons[c]=1:this.etal_spec[b][a]=1:"persons"===a?this.etal_spec[b].persons[c]=0:this.etal_spec[b][a]=0},CSL.NameOutput.prototype.renderAllNames=function(){for(var a,b=0,c=this.variables.length;c>b;b+=1){var d=this.variables[b];a=this.nameset_base+b,this.freeters[d].length&&(this.freeters[d]=this._renderPersonalNames(this.freeters[d],a));for(var e=0,f=this.institutions[d].length;f>e;e+=1)this.persons[d][e]=this._renderPersonalNames(this.persons[d][e],a,e)}this.renderInstitutionNames()},CSL.NameOutput.prototype.renderInstitutionNames=function(){for(var a=0,b=this.variables.length;b>a;a+=1)for(var c=this.variables[a],d=0,e=this.institutions[c].length;e>d;d+=1){var f,g,h,i,j,d,e,o,k=this.institutions[c][d];if(o=this.state.tmp.extension?["sort"]:k.isInstitution?this.state.opt["cite-lang-prefs"].institutions:this.state.opt["cite-lang-prefs"].persons,slot={primary:"locale-orig",secondary:!1,tertiary:!1},o)for(var p=["primary","secondary","tertiary"],q=0,r=p.length;r>q&&!(o.length-1<q);q+=1)o[q]&&(slot[p[q]]="locale-"+o[q]);else slot.primary="locale-translat";"bibliography"===this.state.tmp.area||"citation"===this.state.tmp.area&&"note"===this.state.opt.xclass&&this.item&&!this.item.position||(slot.secondary=!1,slot.tertiary=!1);var s;this.setRenderedName(k),s=this.getName(k,slot.primary,!0);var t=s.name,u=s.usedOrig;switch(t&&(t=this.fixupInstitution(t,c,d)),secondary=!1,slot.secondary&&(s=this.getName(k,slot.secondary,!1,u),secondary=s.name,u=s.usedOrig,secondary&&(secondary=this.fixupInstitution(secondary,c,d))),tertiary=!1,slot.tertiary&&(s=this.getName(k,slot.tertiary,!1,u),tertiary=s.name,tertiary&&(tertiary=this.fixupInstitution(tertiary,c,d))),this.institution.strings["institution-parts"]){case"short":t["short"].length?(i=this._getShortStyle(),f=[this._renderOneInstitutionPart(t["short"],i)]):(j=this._getLongStyle(t,c,d),f=[this._renderOneInstitutionPart(t["long"],j)]);break;case"short-long":j=this._getLongStyle(t,c,d),i=this._getShortStyle(),g=this._renderOneInstitutionPart(t["short"],i),h=this._composeOneInstitutionPart([t,secondary,tertiary],slot,j),f=[g,h];break;case"long-short":j=this._getLongStyle(t,c,d),i=this._getShortStyle(),g=this._renderOneInstitutionPart(t["short"],i),h=this._composeOneInstitutionPart([t,secondary,tertiary],slot,j,!0),f=[h,g];break;default:j=this._getLongStyle(t,c,d),f=[this._composeOneInstitutionPart([t,secondary,tertiary],slot,j)]}this.institutions[c][d]=this._join(f,"")}},CSL.NameOutput.prototype._composeOneInstitutionPart=function(a,b,c){var d=!1,e=!1,f=!1;a[0]&&(d=this._renderOneInstitutionPart(a[0]["long"],c)),a[1]&&(e=this._renderOneInstitutionPart(a[1]["long"],c)),a[2]&&(f=this._renderOneInstitutionPart(a[2]["long"],c));var g;return e||f?(this.state.output.openLevel("empty"),this.state.output.append(d),secondary_tok=CSL.Util.cloneToken(c),b.secondary&&(secondary_tok.strings.prefix=this.state.opt.citeAffixes.institutions[b.secondary].prefix,secondary_tok.strings.suffix=this.state.opt.citeAffixes.institutions[b.secondary].suffix,secondary_tok.strings.prefix||(secondary_tok.strings.prefix=" ")),this.state.output.append(e,secondary_tok),tertiary_tok=CSL.Util.cloneToken(c),b.tertiary&&(tertiary_tok.strings.prefix=this.state.opt.citeAffixes.institutions[b.tertiary].prefix,tertiary_tok.strings.suffix=this.state.opt.citeAffixes.institutions[b.tertiary].suffix,tertiary_tok.strings.prefix||(tertiary_tok.strings.prefix=" ")),this.state.output.append(f,tertiary_tok),this.state.output.closeLevel(),g=this.state.output.pop()):g=d,g},CSL.NameOutput.prototype._renderOneInstitutionPart=function(a,b){for(var c=0,d=a.length;d>c;c+=1)if(a[c]){var e=a[c];if(this.state.tmp.strip_periods)e=e.replace(/\./g,"");else for(var f=0,g=b.decorations.length;g>f;f+=1)if("@strip-periods"===b.decorations[f][0]&&"true"===b.decorations[f][1]){e=e.replace(/\./g,"");break}this.state.tmp.group_context.value()[2]=!0,this.state.tmp.can_substitute.replace(!1,CSL.LITERAL),"!here>>>"===e?a[c]=!1:(this.state.output.append(e,b,!0),a[c]=this.state.output.pop())}return"undefined"==typeof this.institution.strings["part-separator"]&&(this.institution.strings["part-separator"]=this.name.strings.delimiter),this._join(a,this.institution.strings["part-separator"])},CSL.NameOutput.prototype._renderPersonalNames=function(a,b,c){var d=!1;if(a.length){for(var e=[],f=0,g=a.length;g>f;f+=1){var d,l,h=a[f];if(l=this.state.tmp.extension?["sort"]:h.isInstitution?this.state.opt["cite-lang-prefs"].institutions:this.state.opt["cite-lang-prefs"].persons,slot={primary:"locale-orig",secondary:!1,tertiary:!1},l)for(var m=["primary","secondary","tertiary"],n=0,o=m.length;o>n&&!(l.length-1<n);n+=1)slot[m[n]]="locale-"+l[n];else slot.primary="locale-translat";(this.state.tmp.sort_key_flag||"bibliography"!==this.state.tmp.area&&("citation"!==this.state.tmp.area||"note"!==this.state.opt.xclass||!this.item||this.item.position))&&(slot.secondary=!1,slot.tertiary=!1),this.setRenderedName(h);var p=this.getName(h,slot.primary,!0),q=this._renderOnePersonalName(p.name,b,f,c);secondary=!1,slot.secondary&&(p=this.getName(h,slot.secondary,!1,p.usedOrig),p.name&&(secondary=this._renderOnePersonalName(p.name,b,f,c))),tertiary=!1,slot.tertiary&&(p=this.getName(h,slot.tertiary,!1,p.usedOrig),p.name&&(tertiary=this._renderOnePersonalName(p.name,b,f,c)));var r;secondary||tertiary?(this.state.output.openLevel("empty"),this.state.output.append(q),secondary_tok=new CSL.Token,slot.secondary&&(secondary_tok.strings.prefix=this.state.opt.citeAffixes.persons[slot.secondary].prefix,secondary_tok.strings.suffix=this.state.opt.citeAffixes.persons[slot.secondary].suffix,secondary_tok.strings.prefix||(secondary_tok.strings.prefix=" ")),this.state.output.append(secondary,secondary_tok),tertiary_tok=new CSL.Token,slot.tertiary&&(tertiary_tok.strings.prefix=this.state.opt.citeAffixes.persons[slot.tertiary].prefix,tertiary_tok.strings.suffix=this.state.opt.citeAffixes.persons[slot.tertiary].suffix,tertiary_tok.strings.prefix||(tertiary_tok.strings.prefix=" ")),this.state.output.append(tertiary,tertiary_tok),this.state.output.closeLevel(),r=this.state.output.pop()):r=q,e.push(r)}d=this.joinPersons(e,b,c)}return d},CSL.NameOutput.prototype._isRomanesque=function(a){var b=2;if(a.family.replace('"',"","g").match(CSL.ROMANESQUE_REGEXP)||(b=0),!b&&a.given&&a.given.match(CSL.STARTSWITH_ROMANESQUE_REGEXP)&&(b=1),2==b){if(a.multi&&a.multi.main)var c=a.multi.main.slice(0,2);else this.Item.language&&(c=this.Item.language.slice(0,2));["ja","zh"].indexOf(c)>-1&&(b=1)}return b},CSL.NameOutput.prototype._renderOnePersonalName=function(a,b,c,d){var e=a,f=this._droppingParticle(e,b,d),g=this._familyName(e),h=this._nonDroppingParticle(e),i=this._givenName(e,b,c),j=this._nameSuffix(e);this._isShort(b,c)&&!e["full-form-always"]&&(f=!1,i=!1,j=!1);var k=this.name.strings["sort-separator"];k||(k="");var l;l=e["comma-suffix"]?", ":" ";var o,p,q,r,m=this._isRomanesque(e),n=h&&"-"===h.blobs.slice(-1);return 0===m?o=this._join([h,g,i],""):1===m||e["static-ordering"]?o=this._join([h,g,i]," "):e["reverse-ordering"]?o=this._join([i,h,g]," "):this.state.tmp.sort_key_flag?"never"===this.state.opt["demote-non-dropping-particle"]?(q=this._join([h,g,f]," "),p=this._join([q,i]," "),o=this._join([p,j]," ")):(r=this._join([i,f,h]," "),p=this._join([g,r]," "),o=this._join([p,j]," ")):"all"===this.name.strings["name-as-sort-order"]||"first"===this.name.strings["name-as-sort-order"]&&0===c&&(0===d||"undefined"==typeof d)?(["Lord","Lady"].indexOf(e.given)>-1&&(k=", "),["always","display-and-sort"].indexOf(this.state.opt["demote-non-dropping-particle"])>-1&&!n?(r=this._join([i,f],e["comma-dropping-particle"]+" "),r=this._join([r,h]," "),r&&this.given&&(r.strings.prefix=this.given.strings.prefix,r.strings.suffix=this.given.strings.suffix),g&&this.family&&(g.strings.prefix=this.family.strings.prefix,g.strings.suffix=this.family.strings.suffix),p=this._join([g,r],k),o=this._join([p,j],k)):("bibliography"===this.state.tmp.area&&!this.state.tmp.term_predecessor&&h&&(n||(h.blobs=CSL.Output.Formatters["capitalize-first"](this.state,h.blobs))),q=n?this._join([h,g],""):this._join([h,g]," "),q&&this.family&&(q.strings.prefix=this.family.strings.prefix,q.strings.suffix=this.family.strings.suffix),r=this._join([i,f],e["comma-dropping-particle"]+" "),r&&this.given&&(r.strings.prefix=this.given.strings.prefix,r.strings.suffix=this.given.strings.suffix),p=this._join([q,r],k),o=this._join([p,j],k))):(e["dropping-particle"]&&e.family&&!e["non-dropping-particle"]&&["'","\u02bc","\u2019"].indexOf(e["dropping-particle"].slice(-1))>-1&&(g=this._join([f,g],""),f=!1),this.state.tmp.term_predecessor||i||"bibliography"!==this.state.tmp.area||(!f&&h?n||(h.blobs=CSL.Output.Formatters["capitalize-first"](this.state,h.blobs)):f&&(f.blobs=CSL.Output.Formatters["capitalize-first"](this.state,f.blobs))),n?(r=this._join([h,g],""),r=this._join([f,r]," ")):r=this._join([f,h,g]," "),r=this._join([r,j],l),r&&this.family&&(r.strings.prefix=this.family.strings.prefix,r.strings.suffix=this.family.strings.suffix),i&&this.given&&(i.strings.prefix=this.given.strings.prefix,i.strings.suffix=this.given.strings.suffix),r.strings.prefix&&(e["comma-dropping-particle"]=""),o=this._join([i,r],e["comma-dropping-particle"]+" ")),this.state.tmp.group_context.value()[2]=!0,this.state.tmp.can_substitute.replace(!1,CSL.LITERAL),this.state.tmp.term_predecessor=!0,this.state.tmp.name_node.children.push(o),o},CSL.NameOutput.prototype._isShort=function(a,b){return 0===this.state.tmp.disambig_settings.givens[a][b]?!0:!1},CSL.NameOutput.prototype._normalizeNameInput=function(a){var b={literal:a.literal,family:a.family,isInstitution:a.isInstitution,given:a.given,suffix:a.suffix,"comma-suffix":a["comma-suffix"],"non-dropping-particle":a["non-dropping-particle"],"dropping-particle":a["dropping-particle"],"static-ordering":a["static-ordering"],"reverse-ordering":a["reverse-ordering"],"full-form-always":a["full-form-always"],"parse-names":a["parse-names"],"comma-dropping-particle":"",block_initialize:a.block_initialize,multi:a.multi};
    return this._parseName(b),b},CSL.NameOutput.prototype._stripPeriods=function(a,b){var c=this[a+"_decor"];if(b)if(this.state.tmp.strip_periods)b=b.replace(/\./g,"");else if(c)for(var d=0,e=c.decorations.length;e>d;d+=1)if("@strip-periods"===c.decorations[d][0]&&"true"===c.decorations[d][1]){b=b.replace(/\./g,"");break}return b},CSL.NameOutput.prototype._nonDroppingParticle=function(a){var b=a["non-dropping-particle"];b&&this.state.tmp.sort_key_flag&&(b=b.replace(/[\'\u2019]/,""));var c=this._stripPeriods("family",b);return this.state.output.append(c,this.family_decor,!0)?this.state.output.pop():!1},CSL.NameOutput.prototype._droppingParticle=function(a,b,c){var d=a["dropping-particle"];d&&this.state.tmp.sort_key_flag&&(d=d.replace(/[\'\u2019]/,""));var e=this._stripPeriods("given",d);if(a["dropping-particle"]&&a["dropping-particle"].match(/^et.?al[^a-z]$/))this.name.strings["et-al-use-last"]?"undefined"==typeof c?this.etal_spec[b].freeters=2:this.etal_spec[b].persons=2:"undefined"==typeof c?this.etal_spec[b].freeters=1:this.etal_spec[b].persons=1,a["comma-dropping-particle"]="";else if(this.state.output.append(e,this.given_decor,!0))return this.state.output.pop();return!1},CSL.NameOutput.prototype._familyName=function(a){var b=this._stripPeriods("family",a.family);return this.state.output.append(b,this.family_decor,!0)?this.state.output.pop():!1},CSL.NameOutput.prototype._givenName=function(a,b,c){if(this.name.strings.initialize===!1)a.family&&a.given&&this.name.strings.initialize===!1&&(a.given=CSL.Util.Names.initializeWith(this.state,a.given,this.name.strings["initialize-with"],!0)),a.given=CSL.Util.Names.unInitialize(this.state,a.given);else if(a.family&&1===this.state.tmp.disambig_settings.givens[b][c]&&!a.block_initialize){var d=this.name.strings["initialize-with"];a.given=CSL.Util.Names.initializeWith(this.state,a.given,d)}else a.given=CSL.Util.Names.unInitialize(this.state,a.given);var e=this._stripPeriods("given",a.given),f=this.state.output.append(e,this.given_decor,!0);return f?ret=this.state.output.pop():!1},CSL.NameOutput.prototype._nameSuffix=function(a){var b=a.suffix;"string"==typeof this.name.strings["initialize-with"]&&(b=CSL.Util.Names.initializeWith(this.state,a.suffix,this.name.strings["initialize-with"],!0)),b=this._stripPeriods("family",b);var c="";b&&"."===b.slice(-1)&&(b=b.slice(0,-1),c=".");var d=this.state.output.append(b,"empty",!0);return d?(ret=this.state.output.pop(),ret.strings.suffix=c+ret.strings.suffix,ret):!1},CSL.NameOutput.prototype._getLongStyle=function(a){var d;return d=a["short"].length?this.institutionpart["long-with-short"]?this.institutionpart["long-with-short"]:this.institutionpart["long"]:this.institutionpart["long"],d||(d=new CSL.Token),d},CSL.NameOutput.prototype._getShortStyle=function(){var a;return a=this.institutionpart["short"]?this.institutionpart["short"]:new CSL.Token},CSL.NameOutput.prototype._parseName=function(a){var b,c;if(!a["parse-names"]&&"undefined"!=typeof a["parse-names"])return a;a.family&&!a.given&&a.isInstitution&&(a.literal=a.family,a.family=void 0,a.isInstitution=void 0);var d;if(a.family&&'"'===a.family.slice(0,1)&&'"'===a.family.slice(-1)||!a["parse-names"]&&"undefined"!=typeof a["parse-names"]?(a.family=a.family.slice(1,-1),d=!0,a["parse-names"]=0):d=!1,!a["non-dropping-particle"]&&a.family&&!d&&a.given&&(b=a.family.match(/^((?:[\'\u2019a-z][ \'\u2019a-z]*[-\s\'\u2019]+|[ABDVL][^ ][-\s]+[a-z]*\s*|[ABDVL][^ ][^ ][-\s]+[a-z]*\s*))/),b&&(a.family=a.family.slice(b[1].length),a["non-dropping-particle"]=b[1].replace(/\s+$/,"").replace("'","\u2019"))),!a.suffix&&a.given&&(b=a.given.match(/(\s*,!*\s*)/))){c=a.given.indexOf(b[1]);var e=a.given.slice(c+b[1].length),f=a.given.slice(c,c+b[1].length).replace(/\s*/g,"");e.length<=3?(2===f.length&&(a["comma-suffix"]=!0),a.suffix=e):!a["dropping-particle"]&&a.given&&(a["dropping-particle"]=e,a["comma-dropping-particle"]=","),a.given=a.given.slice(0,c)}!a["dropping-particle"]&&a.given&&(b=a.given.match(/(\s+)([a-z][ \'\u2019a-z]*)$/),b&&(a.given=a.given.slice(0,-1*(b[1].length+b[2].length)),a["dropping-particle"]=b[2]))},CSL.NameOutput.prototype.getName=function(a,b,c,d){if(d&&"locale-orig"===b)return{name:!1,usedOrig:d};a.family||(a.family=""),a.given||(a.given="");var e={};e["static-ordering"]=this.getStaticOrder(a);var f=!0;if("locale-orig"!==b&&(f=!1,a.multi)){var g=this.state.opt[b];for(i=0,ilen=g.length;ilen>i;i+=1)if(h=g[i],a.multi._key[h]){f=!0,a=a.multi._key[h],e=this.getNameParams(h),e.transliterated=!0;break}}if(!f){var h=!1;a.multi&&a.multi.main?h=a.multi.main:this.Item.language&&(h=this.Item.language),h&&(e=this.getNameParams(h))}if(!c&&!f)return{name:!1,usedOrig:d};a.family||(a.family=""),a.given||(a.given=""),a={family:a.family,given:a.given,"non-dropping-particle":a["non-dropping-particle"],"dropping-particle":a["dropping-particle"],suffix:a.suffix,"static-ordering":e["static-ordering"],"reverse-ordering":e["reverse-ordering"],"full-form-always":e["full-form-always"],"parse-names":a["parse-names"],"comma-suffix":a["comma-suffix"],"comma-dropping-particle":a["comma-dropping-particle"],transliterated:e.transliterated,block_initialize:e["block-initialize"],literal:a.literal,isInstitution:a.isInstitution,multi:a.multi},!a.literal&&!a.given&&a.family&&a.isInstitution&&(a.literal=a.family),a.literal&&(delete a.family,delete a.given),a=this._normalizeNameInput(a);var j;return j=d?d:!f,{name:a,usedOrig:j}},CSL.NameOutput.prototype.getNameParams=function(a){var b={},c=CSL.localeResolve(this.Item.language,this.state.opt["default-locale"][0]),d=this.state.locale[c.best]?c.best:this.state.opt["default-locale"][0],e=this.state.locale[d].opts["name-as-sort-order"],f=this.state.locale[d].opts["name-as-reverse-order"],g=this.state.locale[d].opts["name-never-short"],h=a.split("-")[0];return e&&e[h]&&(b["static-ordering"]=!0,b["reverse-ordering"]=!1),f&&f[h]&&(b["reverse-ordering"]=!0,b["static-ordering"]=!1),g&&g[h]&&(b["full-form-always"]=!0),b["static-ordering"]&&(b["block-initialize"]=!0),b},CSL.NameOutput.prototype.setRenderedName=function(a){if("bibliography"===this.state.tmp.area){for(var b="",c=0,d=CSL.NAME_PARTS.length;d>c;c+=1)a[CSL.NAME_PARTS[c]]&&(b+=a[CSL.NAME_PARTS[c]]);this.state.tmp.rendered_name.push(b)}},CSL.NameOutput.prototype.fixupInstitution=function(a,b,c){this.state.sys.getHumanForm&&"legal_case"===this.Item.type&&"authority"===b&&(a.literal=this.state.sys.getHumanForm(this.Item.jurisdiction,a.literal)),a=this._splitInstitution(a,b,c),this.institution.strings["reverse-order"]&&a["long"].reverse();var d=a["long"],e=d.slice();if(this.state.sys.getAbbreviation)for(var f=this.Item.jurisdiction,g=0,h=d.length;h>g;g+=1)f=this.state.transform.loadAbbreviation(f,"institution-part",d[g]),this.state.transform.abbrevs[f]["institution-part"][d[g]]&&(e[g]=this.state.transform.abbrevs[f]["institution-part"][d[g]]);return a["short"]=e,a},CSL.NameOutput.prototype.getStaticOrder=function(a,b){var c=!1;return!b&&a["static-ordering"]?c=!0:0===this._isRomanesque(a)?c=!0:(!a.multi||!a.multi.main)&&this.Item.language&&["vi","hu"].indexOf(this.Item.language)>-1?c=!0:a.multi&&a.multi.main&&["vi","hu"].indexOf(a.multi.main.slice(0,2))>-1?c=!0:this.state.opt["auto-vietnamese-names"]&&CSL.VIETNAMESE_NAMES.exec(a.family+" "+a.given)&&CSL.VIETNAMESE_SPECIALS.exec(a.family+a.given)&&(c=!0),c},CSL.NameOutput.prototype._splitInstitution=function(a,b,c){var d={},e=a.literal.replace(/\s*\|\s*/g,"|");if(e=e.split("|"),"short"===this.institution.strings.form&&this.state.sys.getAbbreviation)for(var f=this.Item.jurisdiction,g=e.length;g>0;g+=-1){var h=e.slice(0,g).join("|");if(f=this.state.transform.loadAbbreviation(f,"institution-entire",h),this.state.transform.abbrevs[f]["institution-entire"][h]){var i=this.state.transform.abbrevs[f]["institution-entire"][h];i=this.state.transform.quashCheck(i);var j=i.split(/>>[0-9]{4}>>/),k=i.match(/>>([0-9]{4})>>/);if(i=j.pop(),j.length>0&&this.Item["original-date"]&&this.Item["original-date"].year)for(var l=k.length-1;l>0&&!(parseInt(this.Item["original-date"].year,10)>=parseInt(k[l],10));l+=-1)i=j.pop();i=i.replace(/\s*\|\s*/g,"|"),e=[i]}}return e.reverse(),d["long"]=this._trimInstitution(e,b,c),d},CSL.NameOutput.prototype._trimInstitution=function(a,b){var d=!1,e=!1,f=!1,g=a.slice();return this.institution&&("undefined"!=typeof this.institution.strings["use-first"]&&(d=this.institution.strings["use-first"]),"undefined"!=typeof this.institution.strings["stop-last"]&&(g=g.slice(0,this.institution.strings["stop-last"]),a=a.slice(0,this.institution.strings["stop-last"])),"undefined"!=typeof this.institution.strings["use-last"]&&(e=this.institution.strings["use-last"])),!1===d&&(0===this.persons[b].length&&(d=this.institution.strings["substitute-use-first"]),d||(d=0)),!1===e&&(e=d?0:a.length),d>a.length-e&&(d=a.length-e),f&&(e=0),a=a.slice(0,d),g=g.slice(d),e&&(e>g.length&&(e=g.length),e&&(a=a.concat(g.slice(g.length-e)))),a},CSL.PublisherOutput=function(a,b){this.state=a,this.group_tok=b,this.varlist=[]},CSL.PublisherOutput.prototype.render=function(){this.clearVars(),this.composeAndBlob(),this.composeElements(),this.composePublishers(),this.joinPublishers()},CSL.PublisherOutput.prototype.composeAndBlob=function(){this.and_blob={};var a=!1;"text"===this.group_tok.strings.and?a=this.state.getTerm("and"):"symbol"===this.group_tok.strings.and&&(a="&");var b=new CSL.Token;b.strings.suffix=" ",b.strings.prefix=" ",this.state.output.append(a,b,!0);var c=this.state.output.pop();b.strings.prefix=this.group_tok.strings["subgroup-delimiter"],this.state.output.append(a,b,!0);var d=this.state.output.pop();this.and_blob.single=!1,this.and_blob.multiple=!1,a&&("always"===this.group_tok.strings["subgroup-delimiter-precedes-last"]?this.and_blob.single=d:"never"===this.group_tok.strings["subgroup-delimiter-precedes-last"]?(this.and_blob.single=c,this.and_blob.multiple=c):(this.and_blob.single=c,this.and_blob.multiple=d))},CSL.PublisherOutput.prototype.composeElements=function(){for(var a=0,b=2;b>a;a+=1)for(var c=["publisher","publisher-place"][a],d=0,e=this["publisher-list"].length;e>d;d+=1){var f=this[c+"-list"][d],g=this[c+"-token"];this.state.output.append(f,g,!0),this[c+"-list"][d]=this.state.output.pop()}},CSL.PublisherOutput.prototype.composePublishers=function(){for(var a,b=0,c=this["publisher-list"].length;c>b;b+=1)a=[this[this.varlist[0]+"-list"][b],this[this.varlist[1]+"-list"][b]],this["publisher-list"][b]=this._join(a,this.group_tok.strings.delimiter)},CSL.PublisherOutput.prototype.joinPublishers=function(){var a=this["publisher-list"];this.name_delimiter;var c=this._join(a,this.group_tok.strings["subgroup-delimiter"],this.and_blob.single,this.and_blob.multiple,this.group_tok);this.state.output.append(c,"literal")},CSL.PublisherOutput.prototype._join=CSL.NameOutput.prototype._join,CSL.PublisherOutput.prototype._getToken=CSL.NameOutput.prototype._getToken,CSL.PublisherOutput.prototype.clearVars=function(){this.state.tmp["publisher-list"]=!1,this.state.tmp["publisher-place-list"]=!1,this.state.tmp["publisher-group-token"]=!1,this.state.tmp["publisher-token"]=!1,this.state.tmp["publisher-place-token"]=!1},CSL.evaluateLabel=function(a,b,c,d){var e;"locator"===a.strings.term?(d&&d.label&&(e="sub verbo"===d.label?"sub-verbo":d.label),e||(e="page")):e=a.strings.term;var f=a.strings.plural;return d&&"number"==typeof d.force_pluralism?f=d.force_pluralism:"number"!=typeof f&&("locator"===a.strings.term?d&&d.locator&&(b.opt.development_extensions.locator_parsing_for_plurals?(b.tmp.shadow_numbers.locator||b.processNumber(!1,d,"locator",c.type),f=b.tmp.shadow_numbers.locator.plural):f=CSL.evaluateStringPluralism(d.locator)):["page","page-first"].indexOf(a.variables[0])>-1?(b.processNumber(!1,c,e,c.type),f=b.tmp.shadow_numbers[e].plural,e=b.tmp.shadow_numbers[e].label):(b.tmp.shadow_numbers[e]||b.processNumber(!1,c,e,c.type),f=b.tmp.shadow_numbers[e].plural),a.decorations&&(b.opt.development_extensions.csl_reverse_lookup_support||b.sys.csl_reverse_lookup_support)&&(a.decorations.reverse(),a.decorations.push(["@showid","true",a.cslid]),a.decorations.reverse())),CSL.castLabel(b,a,e,f,CSL.TOLERANT)},CSL.evaluateStringPluralism=function(a){if(a){var b=a.match(/(?:[0-9],\s*[0-9]|\s+and\s+|&|([0-9]+)\s*[\-\u2013]\s*([0-9]+))/);if(b&&(!b[1]||parseInt(b[1],10)<parseInt(b[2],10)))return 1}return 0},CSL.castLabel=function(a,b,c,d,e){var f=b.strings.form;a.tmp.group_context.value()[5]&&(f=a.tmp.group_context.value()[5]);var g=a.getTerm(c,f,d,!1,e);if(a.tmp.strip_periods)g=g.replace(/\./g,"");else for(var h=0,i=b.decorations.length;i>h;h+=1)if("@strip-periods"===b.decorations[h][0]&&"true"===b.decorations[h][1]){g=g.replace(/\./g,"");break}return g},CSL.Node.name={build:function(a,b){var c;[CSL.SINGLETON,CSL.START].indexOf(this.tokentype)>-1&&(a.fixOpt(this,"name-delimiter","name_delimiter"),a.fixOpt(this,"name-form","form"),a.fixOpt(this,"and","and"),a.fixOpt(this,"delimiter-precedes-last","delimiter-precedes-last"),a.fixOpt(this,"delimiter-precedes-et-al","delimiter-precedes-et-al"),a.fixOpt(this,"initialize-with","initialize-with"),a.fixOpt(this,"initialize","initialize"),a.fixOpt(this,"name-as-sort-order","name-as-sort-order"),a.fixOpt(this,"sort-separator","sort-separator"),a.fixOpt(this,"and","and"),a.fixOpt(this,"et-al-min","et-al-min"),a.fixOpt(this,"et-al-use-first","et-al-use-first"),a.fixOpt(this,"et-al-use-last","et-al-use-last"),a.fixOpt(this,"et-al-subsequent-min","et-al-subsequent-min"),a.fixOpt(this,"et-al-subsequent-use-first","et-al-subsequent-use-first"),this.strings["et-al-subsequent-min"]&&this.strings["et-al-subsequent-min"]!==this.strings["et-al-min"]&&(a.opt.update_mode=CSL.POSITION),this.strings["et-al-subsequent-use-first"]&&this.strings["et-al-subsequent-use-first"]!==this.strings["et-al-use-first"]&&(a.opt.update_mode=CSL.POSITION),this.strings.delimiter="undefined"==typeof this.strings.name_delimiter?", ":this.strings.name_delimiter,this.strings["et-al-use-last"]&&(this.ellipsis_term="\u2026",this.ellipsis_prefix_single=" ",this.ellipsis_prefix_multiple=this.strings.delimiter,this.ellipsis_suffix=" "),c=function(a){a.tmp.etal_term="et-al",a.tmp.name_delimiter=this.strings.delimiter,a.tmp["delimiter-precedes-et-al"]=this.strings["delimiter-precedes-et-al"],"text"===this.strings.and?this.and_term=a.getTerm("and","long",0):"symbol"===this.strings.and&&(this.and_term=a.opt.development_extensions.expect_and_symbol_form?a.getTerm("and","symbol",0):"&"),a.tmp.and_term=this.and_term,CSL.STARTSWITH_ROMANESQUE_REGEXP.test(this.and_term)?(this.and_prefix_single=" ",this.and_prefix_multiple=", ","string"==typeof this.strings.delimiter&&(this.and_prefix_multiple=this.strings.delimiter),this.and_suffix=" ",a.build.name_delimiter=this.strings.delimiter):(this.and_prefix_single="",this.and_prefix_multiple="",this.and_suffix=""),"always"===this.strings["delimiter-precedes-last"]?this.and_prefix_single=this.strings.delimiter:"never"===this.strings["delimiter-precedes-last"]?this.and_prefix_multiple&&(this.and_prefix_multiple=" "):"after-inverted-name"===this.strings["delimiter-precedes-last"]&&(this.and_prefix_single&&(this.and_prefix_single=this.strings.delimiter),this.and_prefix_multiple&&(this.and_prefix_multiple=" ")),this.and={},this.strings.and?(a.output.append(this.and_term,"empty",!0),this.and.single=a.output.pop(),this.and.single.strings.prefix=this.and_prefix_single,this.and.single.strings.suffix=this.and_suffix,a.output.append(this.and_term,"empty",!0),this.and.multiple=a.output.pop(),this.and.multiple.strings.prefix=this.and_prefix_multiple,this.and.multiple.strings.suffix=this.and_suffix):this.strings.delimiter&&(this.and.single=new CSL.Blob(this.strings.delimiter),this.and.single.strings.prefix="",this.and.single.strings.suffix="",this.and.multiple=new CSL.Blob(this.strings.delimiter),this.and.multiple.strings.prefix="",this.and.multiple.strings.suffix=""),this.ellipsis={},this.strings["et-al-use-last"]&&(this.ellipsis.single=new CSL.Blob(this.ellipsis_term),this.ellipsis.single.strings.prefix=this.ellipsis_prefix_single,this.ellipsis.single.strings.suffix=this.ellipsis_suffix,this.ellipsis.multiple=new CSL.Blob(this.ellipsis_term),this.ellipsis.multiple.strings.prefix=this.ellipsis_prefix_multiple,this.ellipsis.multiple.strings.suffix=this.ellipsis_suffix),"undefined"==typeof a.tmp["et-al-min"]&&(a.tmp["et-al-min"]=this.strings["et-al-min"]),"undefined"==typeof a.tmp["et-al-use-first"]&&(a.tmp["et-al-use-first"]=this.strings["et-al-use-first"]),"undefined"==typeof a.tmp["et-al-use-last"]&&(a.tmp["et-al-use-last"]=this.strings["et-al-use-last"]),a.nameOutput.name=this},a.build.name_flag=!0,this.execs.push(c)),b.push(this)}},CSL.Node["name-part"]={build:function(a){a.build[this.strings.name]=this}},CSL.Node.names={build:function(a,b){var c;if((this.tokentype===CSL.START||this.tokentype===CSL.SINGLETON)&&(CSL.Util.substituteStart.call(this,a,b),a.build.substitute_level.push(1),a.fixOpt(this,"names-delimiter","delimiter")),this.tokentype===CSL.SINGLETON){a.build.names_variables.push(this.variables);for(var h=0,i=this.variables.length;i>h;h+=1)a.build.name_label[this.variables[h]]=a.build.name_label[a.build.names_variables.slice(0)[0]];c=function(a){a.nameOutput.reinit(this)},this.execs.push(c)}if(this.tokentype===CSL.START&&(a.build.names_flag=!0,a.build.names_level+=1,1===a.build.names_level&&(a.build.names_variables=[],a.build.name_label={}),a.build.names_variables.push(this.variables),c=function(a){a.tmp.can_substitute.push(!0),a.parallel.StartVariable("names",this.variables[0]),a.nameOutput.init(this)},this.execs.push(c)),this.tokentype===CSL.END){for(var h=0,i=3;i>h;h+=1){var j=["family","given","et-al"][h];this[j]=a.build[j],1===a.build.names_level&&(a.build[j]=void 0)}this.label=a.build.name_label,1===a.build.names_level&&(a.build.name_label={}),a.build.names_level+=-1,a.build.names_variables.pop();var k="with",l="",m="";CSL.STARTSWITH_ROMANESQUE_REGEXP.test(k)&&(l=" ",m=" "),this["with"]={},this["with"].single=new CSL.Blob(k),this["with"].single.strings.suffix=m,this["with"].multiple=new CSL.Blob(k),this["with"].multiple.strings.suffix=m,"always"===this.strings["delimiter-precedes-last"]?(this["with"].single.strings.prefix=this.strings.delimiter,this["with"].multiple.strings.prefix=this.strings.delimiter):"contextual"===this.strings["delimiter-precedes-last"]?(this["with"].single.strings.prefix=l,this["with"].multiple.strings.prefix=this.strings.delimiter):"after-inverted-name"===this.strings["delimiter-precedes-last"]?(this["with"].single.strings.prefix=this.strings.delimiter,this["with"].multiple.strings.prefix=l):(this["with"].single.strings.prefix=l,this["with"].multiple.strings.prefix=l),c=function(a){this.etal_style=a.tmp.etal_node?a.tmp.etal_node:"empty",this.etal_term=a.getTerm(a.tmp.etal_term,"long",0),CSL.STARTSWITH_ROMANESQUE_REGEXP.test(this.etal_term)?(this.etal_prefix_single=" ",this.etal_prefix_multiple=a.tmp.name_delimiter,"always"===a.tmp["delimiter-precedes-et-al"]?this.etal_prefix_single=a.tmp.name_delimiter:"never"===a.tmp["delimiter-precedes-et-al"]?this.etal_prefix_multiple=" ":"after-inverted-name"===a.tmp["delimiter-precedes-et-al"]&&(this.etal_prefix_single=a.tmp.name_delimiter,this.etal_prefix_multiple=" "),this.etal_suffix=""):(this.etal_prefix_single="",this.etal_prefix_multiple="",this.etal_suffix="");for(var d=0,e=3;e>d;d+=1){var f=["family","given"][d];a.nameOutput[f]=this[f]}a.nameOutput["with"]=this["with"],a.nameOutput.label=this.label,a.nameOutput.etal_style=this.etal_style,a.nameOutput.etal_term=this.etal_term,a.nameOutput.etal_prefix_single=this.etal_prefix_single,a.nameOutput.etal_prefix_multiple=this.etal_prefix_multiple,a.nameOutput.etal_suffix=this.etal_suffix,a.nameOutput.outputNames(),a.tmp["et-al-use-first"]=void 0,a.tmp["et-al-min"]=void 0,a.tmp["et-al-use-last"]=void 0},this.execs.push(c),c=function(a){a.tmp.can_substitute.pop()||a.tmp.can_substitute.replace(!1,CSL.LITERAL),a.parallel.CloseVariable("names"),1===a.tmp.can_substitute.mystack.length&&(a.tmp.can_block_substitute=!1)},this.execs.push(c),a.build.name_flag=!1}b.push(this),(this.tokentype===CSL.END||this.tokentype===CSL.SINGLETON)&&(a.build.substitute_level.pop(),CSL.Util.substituteEnd.call(this,a,b))}},CSL.Node.number={build:function(a,b){var c;CSL.Util.substituteStart.call(this,a,b),"roman"===this.strings.form?this.formatter=a.fun.romanizer:"ordinal"===this.strings.form?this.formatter=a.fun.ordinalizer:"long-ordinal"===this.strings.form&&(this.formatter=a.fun.long_ordinalizer),"undefined"==typeof this.successor_prefix&&(this.successor_prefix=a[a.build.area].opt.layout_delimiter),"undefined"==typeof this.splice_prefix&&(this.splice_prefix=a[a.build.area].opt.layout_delimiter),c=function(a,b,c){var d,e,f,g;if(0!==this.variables.length){if("undefined"==typeof c)var c={};var h,k;if(h=this.variables[0],"locator"!==h||!a.tmp.just_looking){a.parallel.StartVariable(this.variables[0]),"locator"===this.variables[0]?a.parallel.AppendToVariable(b.section):a.parallel.AppendToVariable(b[this.variables[0]]);var n=new RegExp("(?:&|, | and |"+a.getTerm("page-range-delimiter")+")");"collection-number"===h&&"legal_case"===b.type&&(a.tmp.renders_collection_number=!0);var o=b[this.variables[0]],p="long";if(this.strings.label_form_override&&(p=this.strings.label_form_override),"locator"===h&&c.locator)if(c.locator=c.locator.replace(/([^\\])\s*-\s*/,"$1"+a.getTerm("page-range-delimiter")),k=c.locator.match(CSL.STATUTE_SUBDIV_GROUPED_REGEX)){for(g=c.locator.split(CSL.STATUTE_SUBDIV_PLAIN_REGEX),d=0,e=g.length;e>d;d+=1)g[d]=a.fun.page_mangler(g[d]);for(f=[g[0]],!this.strings.label_form_override&&a.tmp.group_context.value()[5]&&(p=a.tmp.group_context.value()[5]),d=1,e=g.length;e>d;d+=1){var q=0;g[d].match(n)&&(q=1);var r=CSL.STATUTE_SUBDIV_STRINGS[k[d-1].replace(/^\s*/,"")],s=p;c.section_label_count>d&&c.section_form_override&&(s=c.section_form_override),f.push(a.getTerm(r,s,q)),f.push(g[d].replace(/^\s*/,""))}o=f.join(" "),o=o.replace(/\\/,"","g"),a.output.append(o,this)}else o=a.fun.page_mangler(c.locator),o=o.replace(/\\/,"","g"),a.output.append(o,this);else{var t=this;(!a.tmp.shadow_numbers[h]||a.tmp.shadow_numbers[h].values.length&&a.tmp.shadow_numbers[h].values[0][2]===!1)&&("locator"===h?a.processNumber(t,c,h,b.type):a.processNumber(t,b,h,b.type));var v,u=a.tmp.shadow_numbers[h].values,w="",x="page";if(["bill","gazette","legislation","legal_case","treaty"].indexOf(b.type)>-1&&"collection-number"===h&&(x="year"),("number"===h&&["bill","gazette","legislation","treaty"].indexOf(b.type)>-1||a.opt[x+"-range-format"])&&!this.strings.prefix&&!this.strings.suffix&&!this.strings.form)for(d=0,e=u.length;e>d;d+=1)w+=u[d][1];if(w&&!w.match(/^[\-.\u20130-9]+$/)){if("number"===h&&["bill","gazette","legislation","treaty"].indexOf(b.type)>-1){var y=w.split(/\s/)[0];if(y&&(f=[],k=w.match(CSL.STATUTE_SUBDIV_GROUPED_REGEX))){for(g=w.split(CSL.STATUTE_SUBDIV_PLAIN_REGEX),d=1,e=g.length;e>d;d+=1)f.push(a.getTerm(CSL.STATUTE_SUBDIV_STRINGS[k[d-1].replace(/^\s+/,"")],this.strings.label_form_override)),f.push(g[d].replace(/^\s+/,""));w=f.join(" ")}}a.output.append(w,this)}else if(u.length){for(a.output.openLevel("empty"),d=0,e=u.length;e>d;d+=1)v=new CSL[u[d][0]](u[d][1],u[d][2],b.id),d>0&&(v.strings.prefix=v.strings.prefix.replace(/^\s*/,"")),d<u.length-1&&(v.strings.suffix=v.strings.suffix.replace(/\s*$/,"")),"undefined"==typeof v.gender&&(v.gender=a.locale[a.opt.lang]["noun-genders"][h]),a.output.append(v,"literal",!1,!1,!0);a.output.closeLevel("empty")}}"locator"===h&&a.tmp.done_vars.push("locator"),a.parallel.CloseVariable("number")}}},this.execs.push(c),b.push(this),CSL.Util.substituteEnd.call(this,a,b)}},CSL.Node.sort={build:function(a,b){if(b=a[a.build.root+"_sort"].tokens,this.tokentype===CSL.START){"citation"===a.build.area&&(a.parallel.use_parallels=!1,a.opt.sort_citations=!0),a.build.area=a.build.root+"_sort",a.build.extension="_sort";var c=function(a,b){if(a.opt.has_layout_locale){for(var e,c=CSL.localeResolve(b.language,a.opt["default-locale"][0]),d=a[a.tmp.area.slice(0,-5)].opt.sort_locales,f=0,g=d.length;g>f&&(e=d[f][c.bare],e||(e=d[f][c.best]),!e);f+=1);e||(e=a.opt["default-locale"][0]),a.tmp.lang_sort_hold=a.opt.lang,a.opt.lang=e}};this.execs.push(c)}if(this.tokentype===CSL.END){a.build.area=a.build.root,a.build.extension="";var c=function(a){a.opt.has_layout_locale&&(a.opt.lang=a.tmp.lang_sort_hold,delete a.tmp.lang_sort_hold)};this.execs.push(c)}b.push(this)}},CSL.Node.substitute={build:function(a,b){var c;this.tokentype===CSL.START&&(c=function(a){a.tmp.can_block_substitute=!0,a.tmp.value.length&&a.tmp.can_substitute.replace(!1,CSL.LITERAL)},this.execs.push(c)),b.push(this)}},CSL.Node.text={build:function(a,b){var d,e,f,g,h,i,j,k,l,m,r,s,u,v,z;if(this.postponed_macro)return CSL.expandMacro.call(a,this);if(CSL.Util.substituteStart.call(this,a,b),this.variables_real||(this.variables_real=[]),this.variables||(this.variables=[]),e="long",f=0,this.strings.form&&(e=this.strings.form),this.strings.plural&&(f=this.strings.plural),"citation-number"===this.variables_real[0]||"year-suffix"===this.variables_real[0]||"citation-label"===this.variables_real[0])"citation-number"===this.variables_real[0]?("citation"===a.build.root&&(a.opt.update_mode=CSL.NUMERIC),"bibliography"===a.build.root&&(a.opt.bib_mode=CSL.NUMERIC),"bibliography_sort"===a.build.area&&(a.opt.citation_number_sort_used=!0),"citation-number"===a[a.tmp.area].opt.collapse&&(this.range_prefix=a.getTerm("citation-range-delimiter")),this.successor_prefix=a[a.build.area].opt.layout_delimiter,this.splice_prefix=a[a.build.area].opt.layout_delimiter,d=function(a,b,c){if(g=""+b.id,!a.tmp.just_looking){if(c&&c["author-only"]){a.tmp.element_trace.replace("do-not-suppress-me");var d=a.getTerm("reference","long","singular");"undefined"==typeof d&&(d="reference"),s=CSL.Output.Formatters["capitalize-first"](a,d),a.output.append(s+" "),a.tmp.last_element_trace=!0}c&&c["suppress-author"]&&(a.tmp.last_element_trace&&a.tmp.element_trace.replace("suppress-me"),a.tmp.last_element_trace=!1),h=a.registry.registry[g].seq,a.opt.citation_number_slug?a.output.append(a.opt.citation_number_slug,this):(i=new CSL.NumericBlob(h,this,b.id),a.output.append(i,"literal"))}},this.execs.push(d)):"year-suffix"===this.variables_real[0]?(a.opt.has_year_suffix=!0,"year-suffix-ranged"===a[a.tmp.area].opt.collapse&&(this.range_prefix=a.getTerm("citation-range-delimiter")),this.successor_prefix=a[a.build.area].opt.layout_delimiter,a[a.tmp.area].opt["year-suffix-delimiter"]&&(this.successor_prefix=a[a.build.area].opt["year-suffix-delimiter"]),d=function(a,b){if(a.registry.registry[b.id]&&a.registry.registry[b.id].disambig.year_suffix!==!1&&!a.tmp.just_looking){for(h=parseInt(a.registry.registry[b.id].disambig.year_suffix,10),i=new CSL.NumericBlob(h,this,b.id),j=new CSL.Util.Suffixator(CSL.SUFFIX_CHARS),i.setFormatter(j),a.output.append(i,"literal"),k=!1,u=a.tmp.group_context.mystack.length,v=0;u>v;v+=1)if(z=a.tmp.group_context.mystack[v],!z[2]&&(z[1]||!z[1]&&!z[0])){k=!0;break}l=a[a.tmp.area].opt["year-suffix-delimiter"],k&&l&&!a.tmp.sort_key_flag&&(a.tmp.splice_delimiter=a[a.tmp.area].opt["year-suffix-delimiter"])}},this.execs.push(d)):"citation-label"===this.variables_real[0]&&(a.opt.has_year_suffix=!0,d=function(a,b){m=b["citation-label"],m||(m=a.getCitationLabel(b)),a.tmp.just_looking||(r="",a.registry.registry[b.id]&&a.registry.registry[b.id].disambig.year_suffix!==!1&&(h=parseInt(a.registry.registry[b.id].disambig.year_suffix,10),r=a.fun.suffixator.format(h)),m+=r),a.output.append(m,this)},this.execs.push(d));else if(this.strings.term)d=function(a,b){var d=a.opt.gender[b.type],g=this.strings.term;g=a.getTerm(g,e,f,d,!1,"accessed"===g);var h;if(""!==g&&(z=a.tmp.group_context.value(),z[0]=!0,a.tmp.group_context.replace(z)),h=a.tmp.term_predecessor||"in-text"===a.opt["class"]&&"citation"===a.tmp.area?g:CSL.Output.Formatters["capitalize-first"](a,g),a.tmp.strip_periods)h=h.replace(/\./g,"");else for(var i=0,j=this.decorations.length;j>i;i+=1)if("@strip-periods"===this.decorations[i][0]&&"true"===this.decorations[i][1]){h=h.replace(/\./g,"");break}a.output.append(h,this)},this.execs.push(d),a.build.term=!1,a.build.form=!1,a.build.plural=!1;else if(this.variables_real.length){if(d=function(a,b){var d=this.variables[0];"title"!==d||"short"!==e&&!b["title-short"]||(d="title-short"),a.parallel.StartVariable(d),a.parallel.AppendToVariable(b[d],d)},this.execs.push(d),CSL.MULTI_FIELDS.indexOf(this.variables_real[0])>-1){var A=this.variables[0],B=!1,C=!1,D=!1;"short"===e?"container-title"===this.variables_real[0]?C="journalAbbreviation":"title"===this.variables_real[0]&&(C="title-short"):A=!1,a.build.extension?D=!0:(D=!0,B=!0),d=a.transform.getOutputFunction(this.variables,A,B,C,D)}else d=CSL.CITE_FIELDS.indexOf(this.variables_real[0])>-1?function(a,b,c){if(c&&c[this.variables[0]]){var d=""+c[this.variables[0]];d=d.replace(/([^\\])--*/g,"$1"+a.getTerm("page-range-delimiter")),d=d.replace(/\\-/g,"-"),a.output.append(d,this,!1,!1,!0),"locator-revision"===this.variables[0]&&a.tmp.done_vars.push("locator-revision")}}:"page-first"===this.variables_real[0]?function(a,b){var d;d=a.getVariable(b,"page-first",e),d&&(d=d.replace("\\",""),a.output.append(d,this,!1,!1,!0))}:"page"===this.variables_real[0]?function(a,b){var c=a.getVariable(b,"page",e);c&&(c=""+c,c=c.replace(/([^\\])--*/g,"$1"+a.getTerm("page-range-delimiter")),c=c.replace(/\\-/g,"-"),c=a.fun.page_mangler(c),a.output.append(c,this,!1,!1,!0))}:"volume"===this.variables_real[0]?function(a,b){if(this.variables[0]){var c=a.getVariable(b,this.variables[0],e);c&&a.output.append(c,this)}}:["URL","DOI"].indexOf(this.variables_real[0])>-1?function(a,b){var c;this.variables[0]&&(c=a.getVariable(b,this.variables[0],e),c&&(a.opt.development_extensions.wrap_url_and_doi?this.decorations.length&&this.decorations[0][0]==="@"+this.variables[0]||(this.decorations=[["@"+this.variables[0],"true"]].concat(this.decorations)):this.decorations.length&&this.decorations[0][0]==="@"+this.variables[0]&&(this.decorations=this.decorations.slice(1)),a.output.append(c,this,!1,!1,!0)))}:"section"===this.variables_real[0]?function(a,b){var c;c=a.getVariable(b,this.variables[0],e),c&&a.output.append(c,this)}:"hereinafter"===this.variables_real[0]?function(a,b){var c=a.transform.abbrevs["default"].hereinafter[b.id];c&&(a.output.append(c,this),a.tmp.group_context.value()[2]=!0)}:function(a,b){var c;this.variables[0]&&(c=a.getVariable(b,this.variables[0],e),c&&(c=""+c,c=c.replace("\\","","g"),a.output.append(c,this)))};this.execs.push(d),d=function(a){a.parallel.CloseVariable("text")},this.execs.push(d)}else this.strings.value&&(d=function(a){var c;c=a.tmp.group_context.value(),c[0]=!0,a.tmp.group_context.replace(c),a.output.append(this.strings.value,this)},this.execs.push(d));b.push(this),CSL.Util.substituteEnd.call(this,a,b)}},CSL.Attributes={},CSL.Attributes["@genre"]=function(a,b){b=b.replace("-"," ");var c=function(a){return b===a.genre?!0:!1};this.tests.push(c)},CSL.Attributes["@disambiguate"]=function(a,b){if("true"===b){a.opt.has_disambiguate=!0;var c=function(){return a.tmp.disambiguate_maxMax+=1,a.tmp.disambig_settings.disambiguate&&a.tmp.disambiguate_count<a.tmp.disambig_settings.disambiguate?(a.tmp.disambiguate_count+=1,!0):!1};this.tests.push(c)}else if("check-ambiguity-and-backreference"===b){var c=function(b){return a.registry.registry[b.id].disambig.disambiguate&&a.registry.registry[b.id]["citation-count"]>1?!0:!1};this.tests.push(c)}},CSL.Attributes["@is-numeric"]=function(a,b){for(var d=b.split(/\s+/),e=function(b){return function(c,d){var e=c;if(["locator","locator-revision"].indexOf(b)>-1&&(e=d),"undefined"==typeof e)return!1;if(CSL.NUMERIC_VARIABLES.indexOf(b)>-1){if(a.tmp.shadow_numbers[b]||a.processNumber(!1,e,b,c.type),e[b]&&a.tmp.shadow_numbers[b].numeric)return!0}else if(["title","locator-revision","version"].indexOf(b)>-1&&e[b]&&e[b].slice(-1)===""+parseInt(e[b].slice(-1),10))return!0;return!1}},f=0;f<d.length;f+=1)this.tests.push(e(d[f]))
},CSL.Attributes["@is-uncertain-date"]=function(a,b){for(var c=b.split(/\s+/),d=function(a){return function(b){return b[a]&&b[a].circa?!0:!1}},e=0,f=c.length;f>e;e+=1)this.tests.push(d(c[e]))},CSL.Attributes["@locator"]=function(a,b){var c=b.replace("sub verbo","sub-verbo");c=c.split(/\s+/);for(var d=function(a){return function(b,c){var d;return d="undefined"!=typeof c&&c.label?"sub verbo"===c.label?"sub-verbo":c.label:"page",a===d?!0:!1}},e=0,f=c.length;f>e;e+=1)this.tests.push(d(c[e]))},CSL.Attributes["@position"]=function(a,b){var c;a.opt.update_mode=CSL.POSITION,a.parallel.use_parallels=!0;for(var d=b.split(/\s+/),e=function(b){return function(c,d){if("bibliography"===a.tmp.area)return!1;if(d&&"undefined"==typeof d.position&&(d.position=0),d&&"number"==typeof d.position){if(0===d.position&&0===b)return!0;if(b>0&&d.position>=b)return!0}else if(0===b)return!0;return!1}},f=0,g=d.length;g>f;f+=1){var c=d[f];"first"===c?c=CSL.POSITION_FIRST:"subsequent"===c?c=CSL.POSITION_SUBSEQUENT:"ibid"===c?c=CSL.POSITION_IBID:"ibid-with-locator"===c&&(c=CSL.POSITION_IBID_WITH_LOCATOR),"near-note"===c?this.tests.push(function(a,b){return b&&b.position>=CSL.POSITION_SUBSEQUENT&&b["near-note"]?!0:!1}):this.tests.push(e(c))}},CSL.Attributes["@type"]=function(a,b){for(var c=b.split(/\s+/),d=function(a){return function(b){var d=b.type===a;return d?!0:!1}},e=[],f=0,g=c.length;g>f;f+=1)e.push(d(c[f]));this.tests.push(a.fun.match.any(this,a,e))},CSL.Attributes["@variable"]=function(a,b){var c;if(this.variables=b.split(/\s+/),this.variables_real=this.variables.slice(),"label"===this.name&&this.variables[0])this.strings.term=this.variables[0];else if(["names","date","text","number"].indexOf(this.name)>-1)c=function(a,b,c){variables=this.variables_real.slice();for(var d=this.variables.length-1;d>-1;d+=-1)this.variables.pop();for(len=variables.length,pos=0;len>pos;pos+=1)-1!==a.tmp.done_vars.indexOf(variables[pos])||c&&"legal_case"===b.type&&c["suppress-author"]&&"title"===variables[pos]||this.variables.push(variables[pos]),a.tmp.can_block_substitute&&a.tmp.done_vars.push(variables[pos])},this.execs.push(c),c=function(a,b,c){for(output=!1,len=this.variables.length,pos=0;len>pos;pos+=1){if(variable=this.variables[pos],"authority"===variable&&"string"==typeof b[variable]&&"names"===this.name){var e={family:b[variable],isInstitution:!0,multi:{_key:{}}};if(b.multi&&b.multi._keys&&b.multi._keys[variable])for(var f in b.multi._keys[variable])creatorChild={family:b.multi._keys[variable][f],isInstitution:!0},e.multi._key[f]=creatorChild;b[variable]=[e]}if("short"!==this.strings.form||b[variable]||("title"===variable?variable="title-short":"container-title"===variable&&(variable="journalAbbreviation")),"year-suffix"===variable){output=!0;break}if(CSL.DATE_VARIABLES.indexOf(variable)>-1){if(a.opt.development_extensions.locator_date_and_revision&&"locator-date"===variable){output=!0;break}if(b[variable]){for(var g in b[variable])if((-1!==this.dateparts.indexOf(g)||"literal"===g)&&b[variable][g]){output=!0;break}if(output)break}}else{if("locator"===variable){c&&c.locator&&(output=!0);break}if("locator-revision"===variable){c&&c["locator-revision"]&&(output=!0);break}if(["citation-number","citation-label"].indexOf(variable)>-1){output=!0;break}if("first-reference-note-number"===variable){c&&c["first-reference-note-number"]&&(output=!0);break}if("hereinafter"===variable){a.transform.abbrevs["default"].hereinafter[b.id]&&a.sys.getAbbreviation&&b.id&&(output=!0);break}if("object"==typeof b[variable]){b[variable].length;break}if("string"==typeof b[variable]&&b[variable]){output=!0;break}if("number"==typeof b[variable]){output=!0;break}}if(output)break}flag=a.tmp.group_context.value(),output?(("citation-number"!==variable||"bibliography"!==a.tmp.area)&&(a.tmp.cite_renders_content=!0),flag[2]=!0,a.tmp.group_context.replace(flag),a.tmp.can_substitute.value()&&"bibliography"===a.tmp.area&&"string"==typeof b[variable]&&a.tmp.rendered_name.push(b[variable]),a.tmp.can_substitute.replace(!1,CSL.LITERAL)):flag[1]=!0},this.execs.push(c);else if(["if","else-if","condition"].indexOf(this.name)>-1)for(var d=function(b){return function(c,d){var e=c;if(d&&["locator","locator-revision","first-reference-note-number","locator-date"].indexOf(b)>-1&&(e=d),"hereinafter"===b&&a.sys.getAbbreviation&&e.id){if(a.transform.abbrevs["default"].hereinafter[e.id])return!0}else if(e[b]){if("number"==typeof e[b]||"string"==typeof e[b])return!0;if("object"==typeof e[b])for(key in e[b])if(e[b][key])return!0}return!1}},e=0,f=this.variables.length;f>e;e+=1)this.tests.push(d(this.variables[e]))},CSL.Attributes["@page"]=function(a,b){var c=b.replace("sub verbo","sub-verbo");c=c.split(/\s+/);for(var d=function(b){return function(c){var e;return a.processNumber(!1,c,"page",c.type),e=a.tmp.shadow_numbers.page.label?"sub verbo"===a.tmp.shadow_numbers.page.label?"sub-verbo":a.tmp.shadow_numbers.page.label:"page",b===e?!0:!1}},e=0,f=c.length;f>e;e+=1)this.tests.push(d(c[e]))},CSL.Attributes["@jurisdiction"]=function(a,b){for(var c=b.split(/\s+/),d=0,e=c.length;e>d;d+=1)c[d]=c[d].split(";");for(var f=function(a){return function(b){if(!b.jurisdiction)return!1;for(var d=b.jurisdiction.split(";"),e=0,f=d.length;f>e;e+=1)d[e]=d[e].split(";");for(e=a.length;e>0;e+=-1){var g=a.slice(0,e).join(";"),h=d.slice(0,e).join(";");if(g!==h)return!1}return!0}},d=0,e=c.length;e>d;d+=1){var g=c[d].slice();this.tests.push(f(g))}},CSL.Attributes["@context"]=function(a,b){var c=function(){var e=a.tmp.area.slice(0,b.length);return e===b?!0:!1};this.tests.push(c)},CSL.Attributes["@has-year-only"]=function(a,b){for(var c=b.split(/\s+/),d=function(a){return function(b){var d=b[a];return!d||d.month||d.season?!1:!0}},e=0,f=c.length;f>e;e+=1)this.tests.push(d(c[e]))},CSL.Attributes["@has-to-month-or-season"]=function(a,b){for(var c=b.split(/\s+/),d=function(a){return function(b){var d=b[a];return!d||!d.month&&!d.season||d.day?!1:!0}},e=0,f=c.length;f>e;e+=1)this.tests.push(d(c[e]))},CSL.Attributes["@has-day"]=function(a,b){for(var c=b.split(/\s+/),d=function(a){return function(b){var d=b[a];return d&&d.day?!0:!1}},e=0,f=c.length;f>e;e+=1)this.tests.push(d(c[e]))},CSL.Attributes["@subjurisdictions"]=function(a,b){var c=parseInt(b,10),d=function(a){var d=0;return a.jurisdiction&&(d=a.jurisdiction.split(";").length),d&&(d+=-1),d>=c?!0:!1};this.tests.push(d)},CSL.Attributes["@is-plural"]=function(a,b){var c=function(a){var d=a[b];if(d&&d.length){for(var e=0,f=0,g=!1,h=0,i=d.length;i>h;h+=1)d[h].isInstitution&&(d[h].literal||d[h].family&&!d[h].given)?(f+=1,g=!1):(e+=1,g=!0);if(e>1)return!0;if(f>1)return!0;if(f&&g)return!0}return!1};this.tests.push(c)},CSL.Attributes["@locale"]=function(a,b){var d,i,j,k,l,m,o=a.opt["default-locale"][0];if("layout"===this.name){if(this.locale_raw=b,this.tokentype===CSL.START){var p=b.split(/\s+/),q={},r=CSL.localeResolve(p[0],o);r.generic?q[r.generic]=r.best:q[r.best]=r.best;for(var l=1,m=p.length;m>l;l+=1){var s=CSL.localeResolve(p[l],o);s.generic?q[s.generic]=r.best:q[s.best]=r.best}a[a.build.area].opt.sort_locales.push(q)}a.opt.has_layout_locale=!0}else{k=b.split(/\s+/);var t=[];for(l=0,m=k.length;m>l;l+=1)j=k[l],i=CSL.localeResolve(j,o),2===k[l].length&&t.push(i.bare),a.localeConfigure(i,!0),k[l]=i;var u=k.slice(),v=function(a,b,c){return function(e){var h;d=[],h=!1;var j,i=!1;for(j=e.language?e.language:b,i=CSL.localeResolve(j,b),l=0,m=a.length;m>l;l+=1)if(i.best===a[l].best){h=!0;break}return!h&&c.indexOf(i.bare)>-1&&(h=!0),h}};this.tests.push(v(u,o,t))}},CSL.Attributes["@locale-internal"]=function(a,b){var d,i,j,k,l,m;for(k=b.split(/\s+/),this.locale_bares=[],l=0,m=k.length;m>l;l+=1)j=k[l],i=CSL.localeResolve(j,a.opt["default-locale"][0]),2===k[l].length&&this.locale_bares.push(i.bare),a.localeConfigure(i),k[l]=i;this.locale_default=a.opt["default-locale"][0],this.locale=k[0].best,this.locale_list=k.slice();var o=function(b){return function(c){var g;d=[],g=!1;var h=!1;if(c.language&&(j=c.language,h=CSL.localeResolve(j,a.opt["default-locale"][0]),h.best===a.opt["default-locale"][0]&&(h=!1)),h){for(l=0,m=b.locale_list.length;m>l;l+=1)if(h.best===b.locale_list[l].best){a.opt.lang=b.locale,a.tmp.last_cite_locale=b.locale,a.output.openLevel("empty"),a.output.current.value().new_locale=b.locale,g=!0;break}!g&&b.locale_bares.indexOf(h.bare)>-1&&(a.opt.lang=b.locale,a.tmp.last_cite_locale=b.locale,a.output.openLevel("empty"),a.output.current.value().new_locale=b.locale,g=!0)}return g}},p=this;this.tests.push(o(p))},CSL.Attributes["@is-parallel"]=function(a,b){for(var c=b.split(" "),d=0,e=c.length;e>d;d+=1)"true"===c[d]?c[d]=!0:"false"===c[d]&&(c[d]=!1);this.strings.set_parallel_condition=c},CSL.Attributes["@gender"]=function(a,b){this.gender=b},CSL.Attributes["@cslid"]=function(a,b){this.cslid=parseInt(b,10)},CSL.Attributes["@label-form"]=function(a,b){this.strings.label_form_override=b},CSL.Attributes["@part-separator"]=function(a,b){this.strings["part-separator"]=b},CSL.Attributes["@leading-noise-words"]=function(a,b){this["leading-noise-words"]=b},CSL.Attributes["@name-never-short"]=function(a,b){this["name-never-short"]=b},CSL.Attributes["@class"]=function(a,b){a.opt["class"]=b},CSL.Attributes["@version"]=function(a,b){a.opt.version=b},CSL.Attributes["@value"]=function(a,b){this.strings.value=b},CSL.Attributes["@name"]=function(a,b){this.strings.name=b},CSL.Attributes["@form"]=function(a,b){this.strings.form=b},CSL.Attributes["@date-parts"]=function(a,b){this.strings["date-parts"]=b},CSL.Attributes["@range-delimiter"]=function(a,b){this.strings["range-delimiter"]=b},CSL.Attributes["@macro"]=function(a,b){this.postponed_macro=b},CSL.Attributes["@term"]=function(a,b){this.strings.term="sub verbo"===b?"sub-verbo":b},CSL.Attributes["@xmlns"]=function(){},CSL.Attributes["@lang"]=function(a,b){b&&(a.build.lang=b)},CSL.Attributes["@lingo"]=function(){},CSL.Attributes["@macro-has-date"]=function(){this["macro-has-date"]=!0},CSL.Attributes["@suffix"]=function(a,b){this.strings.suffix=b},CSL.Attributes["@prefix"]=function(a,b){this.strings.prefix=b},CSL.Attributes["@delimiter"]=function(a,b){"name"==this.name?this.strings.name_delimiter=b:this.strings.delimiter=b},CSL.Attributes["@match"]=function(a,b){this.match=b},CSL.Attributes["@names-min"]=function(a,b){var c=parseInt(b,10);a[a.tmp.area].opt.max_number_of_names<c&&(a[a.tmp.area].opt.max_number_of_names=c),this.strings["et-al-min"]=c},CSL.Attributes["@names-use-first"]=function(a,b){this.strings["et-al-use-first"]=parseInt(b,10)},CSL.Attributes["@names-use-last"]=function(a,b){this.strings["et-al-use-last"]="true"===b?!0:!1},CSL.Attributes["@sort"]=function(a,b){"descending"===b&&(this.strings.sort_direction=CSL.DESCENDING)},CSL.Attributes["@plural"]=function(a,b){"always"===b||"true"===b?this.strings.plural=1:"never"===b||"false"===b?this.strings.plural=0:"contextual"===b&&(this.strings.plural=!1)},CSL.Attributes["@number"]=function(a,b){var c,d=b.replace("sub verbo","sub-verbo");d=d.split(/\s+/),["if","else-if"].indexOf(this.name)>-1&&(c=function(a,b){var f,e=[];a.processNumber(!1,b,"number",b.type),f=a.tmp.shadow_numbers.number.label?"sub verbo"===a.tmp.shadow_numbers.number.label?"sub-verbo":a.tmp.shadow_numbers.number.label:"number";for(var g=0,h=d.length;h>g;g+=1)d[g]===f?e.push(!0):e.push(!1);return e},this.tests.push(c))},CSL.Attributes["@has-publisher-and-publisher-place"]=function(){this.strings["has-publisher-and-publisher-place"]=!0},CSL.Attributes["@publisher-delimiter-precedes-last"]=function(a,b){this.strings["publisher-delimiter-precedes-last"]=b},CSL.Attributes["@publisher-delimiter"]=function(a,b){this.strings["publisher-delimiter"]=b},CSL.Attributes["@publisher-and"]=function(a,b){this.strings["publisher-and"]=b},CSL.Attributes["@newdate"]=function(){},CSL.Attributes["@givenname-disambiguation-rule"]=function(a,b){CSL.GIVENNAME_DISAMBIGUATION_RULES.indexOf(b)>-1&&(a.citation.opt["givenname-disambiguation-rule"]=b)},CSL.Attributes["@collapse"]=function(a,b){b&&(a[this.name].opt.collapse=b)},CSL.Attributes["@cite-group-delimiter"]=function(a,b){b&&(a[a.tmp.area].opt.cite_group_delimiter=b)},CSL.Attributes["@names-delimiter"]=function(a,b){a.setOpt(this,"names-delimiter",b)},CSL.Attributes["@name-form"]=function(a,b){a.setOpt(this,"name-form",b)},CSL.Attributes["@subgroup-delimiter"]=function(a,b){this.strings["subgroup-delimiter"]=b},CSL.Attributes["@subgroup-delimiter-precedes-last"]=function(a,b){this.strings["subgroup-delimiter-precedes-last"]=b},CSL.Attributes["@name-delimiter"]=function(a,b){a.setOpt(this,"name-delimiter",b)},CSL.Attributes["@et-al-min"]=function(a,b){var c=parseInt(b,10);a[a.tmp.area].opt.max_number_of_names<c&&(a[a.tmp.area].opt.max_number_of_names=c),a.setOpt(this,"et-al-min",c)},CSL.Attributes["@et-al-use-first"]=function(a,b){a.setOpt(this,"et-al-use-first",parseInt(b,10))},CSL.Attributes["@et-al-use-last"]=function(a,b){"true"===b?a.setOpt(this,"et-al-use-last",!0):a.setOpt(this,"et-al-use-last",!1)},CSL.Attributes["@et-al-subsequent-min"]=function(a,b){var c=parseInt(b,10);a[a.tmp.area].opt.max_number_of_names<c&&(a[a.tmp.area].opt.max_number_of_names=c),a.setOpt(this,"et-al-subsequent-min",c)},CSL.Attributes["@et-al-subsequent-use-first"]=function(a,b){a.setOpt(this,"et-al-subsequent-use-first",parseInt(b,10))},CSL.Attributes["@suppress-min"]=function(a,b){this.strings["suppress-min"]=parseInt(b,10)},CSL.Attributes["@suppress-max"]=function(a,b){this.strings["suppress-max"]=parseInt(b,10)},CSL.Attributes["@and"]=function(a,b){a.setOpt(this,"and",b)},CSL.Attributes["@delimiter-precedes-last"]=function(a,b){a.setOpt(this,"delimiter-precedes-last",b)},CSL.Attributes["@delimiter-precedes-et-al"]=function(a,b){a.setOpt(this,"delimiter-precedes-et-al",b)},CSL.Attributes["@initialize-with"]=function(a,b){a.setOpt(this,"initialize-with",b)},CSL.Attributes["@initialize"]=function(a,b){"false"===b&&a.setOpt(this,"initialize",!1)},CSL.Attributes["@name-as-reverse-order"]=function(a,b){this["name-as-reverse-order"]=b},CSL.Attributes["@name-as-sort-order"]=function(a,b){"style-options"===this.name?this["name-as-sort-order"]=b:a.setOpt(this,"name-as-sort-order",b)},CSL.Attributes["@sort-separator"]=function(a,b){a.setOpt(this,"sort-separator",b)},CSL.Attributes["@year-suffix-delimiter"]=function(a,b){a[this.name].opt["year-suffix-delimiter"]=b},CSL.Attributes["@after-collapse-delimiter"]=function(a,b){a[this.name].opt["after-collapse-delimiter"]=b},CSL.Attributes["@subsequent-author-substitute"]=function(a,b){a[this.name].opt["subsequent-author-substitute"]=b},CSL.Attributes["@subsequent-author-substitute-rule"]=function(a,b){a[this.name].opt["subsequent-author-substitute-rule"]=b},CSL.Attributes["@disambiguate-add-names"]=function(a,b){"true"===b&&(a.opt["disambiguate-add-names"]=!0)},CSL.Attributes["@disambiguate-add-givenname"]=function(a,b){"true"===b&&(a.opt["disambiguate-add-givenname"]=!0)},CSL.Attributes["@disambiguate-add-year-suffix"]=function(a,b){"true"===b&&"numeric"!==a.opt.xclass&&(a.opt["disambiguate-add-year-suffix"]=!0)},CSL.Attributes["@second-field-align"]=function(a,b){("flush"===b||"margin"===b)&&(a[this.name].opt["second-field-align"]=b)},CSL.Attributes["@hanging-indent"]=function(a,b){"true"===b&&(a[this.name].opt.hangingindent=2)},CSL.Attributes["@line-spacing"]=function(a,b){b&&b.match(/^[.0-9]+$/)&&(a[this.name].opt["line-spacing"]=parseFloat(b,10))},CSL.Attributes["@entry-spacing"]=function(a,b){b&&b.match(/^[.0-9]+$/)&&(a[this.name].opt["entry-spacing"]=parseFloat(b,10))},CSL.Attributes["@near-note-distance"]=function(a,b){a[this.name].opt["near-note-distance"]=parseInt(b,10)},CSL.Attributes["@text-case"]=function(a,b){var c=function(a,c){"normal"===b?this.text_case_normal=!0:(this.strings["text-case"]=b,"title"===b&&(a.opt["default-locale"][0].slice(0,2),c.jurisdiction&&(this.strings["text-case"]="passthrough")))};this.execs.push(c)},CSL.Attributes["@page-range-format"]=function(a,b){a.opt["page-range-format"]=b},CSL.Attributes["@year-range-format"]=function(a,b){a.opt["year-range-format"]=b},CSL.Attributes["@default-locale"]=function(a,b){var c,d,e,f,g;if(f=b.match(/-x-(sort|translit|translat)-/g))for(e=0,d=f.length;d>e;e+=1)f[e]=f[e].replace(/^-x-/,"").replace(/-$/,"");for(c=b.split(/-x-(?:sort|translit|translat)-/),g=[c[0]],e=1,d=c.length;d>e;e+=1)g.push(f[e-1]),g.push(c[e]);for(c=g.slice(),d=c.length,e=1;d>e;e+=2)a.opt["locale-"+c[e]].push(c[e+1].replace(/^\s*/g,"").replace(/\s*$/g,""));a.opt["default-locale"]=c.length?c.slice(0,1):["en"]},CSL.Attributes["@default-locale-sort"]=function(a,b){a.opt["default-locale-sort"]=b},CSL.Attributes["@demote-non-dropping-particle"]=function(a,b){a.opt["demote-non-dropping-particle"]=b},CSL.Attributes["@initialize-with-hyphen"]=function(a,b){"false"===b&&(a.opt["initialize-with-hyphen"]=!1)},CSL.Attributes["@institution-parts"]=function(a,b){this.strings["institution-parts"]=b},CSL.Attributes["@if-short"]=function(a,b){"true"===b&&(this.strings["if-short"]=!0)},CSL.Attributes["@substitute-use-first"]=function(a,b){this.strings["substitute-use-first"]=parseInt(b,10)},CSL.Attributes["@use-first"]=function(a,b){this.strings["use-first"]=parseInt(b,10)},CSL.Attributes["@stop-last"]=function(a,b){this.strings["stop-last"]=-1*parseInt(b,10)},CSL.Attributes["@oops"]=function(a,b){this.strings.oops=b},CSL.Attributes["@use-last"]=function(a,b){this.strings["use-last"]=parseInt(b,10)},CSL.Attributes["@reverse-order"]=function(a,b){"true"===b&&(this.strings["reverse-order"]=!0)},CSL.Attributes["@display"]=function(a,b){this.strings.cls=b},CSL.Stack=function(a,b){this.mystack=[],(b||a)&&this.mystack.push(a)},CSL.Stack.prototype.push=function(a,b){b||a?this.mystack.push(a):this.mystack.push("")},CSL.Stack.prototype.clear=function(){this.mystack=[]},CSL.Stack.prototype.replace=function(a,b){if(0===this.mystack.length)throw"Internal CSL processor error: attempt to replace nonexistent stack item with "+a;this.mystack[this.mystack.length-1]=b||a?a:""},CSL.Stack.prototype.pop=function(){return this.mystack.pop()},CSL.Stack.prototype.value=function(){return this.mystack.slice(-1)[0]},CSL.Stack.prototype.length=function(){return this.mystack.length},CSL.Parallel=function(a){this.state=a,this.sets=new CSL.Stack([]),this.try_cite=!0,this.use_parallels=!1,this.midVars=["section","volume","container-title","collection-number","issue","page-first","page","number"],this.ignoreVarsLawGeneral=["first-reference-note-number","locator","label","page-first","page","genre"],this.ignoreVarsLawProceduralHistory=["issued","first-reference-note-number","locator","label","page-first","page","genre","jurisdiction"],this.ignoreVarsOrders=["first-reference-note-number"],this.ignoreVarsOther=["first-reference-note-number","locator","label","section","page-first","page"]},CSL.Parallel.prototype.isMid=function(a){return this.midVars.indexOf(a)>-1},CSL.Parallel.prototype.StartCitation=function(a,b){this.parallel_conditional_blobs_list=[],this.use_parallels&&(this.sortedItems=a,this.sortedItemsPos=-1,this.sets.clear(),this.sets.push([]),this.in_series=!0,this.delim_counter=0,this.delim_pointers=[],this.out=b?b:this.state.output.queue,this.master_was_neutral_cite=!0)},CSL.Parallel.prototype.StartCite=function(a,b,c){var d,e,f,h,i,j,k,l;if(this.use_parallels){this.sets.value().length&&this.sets.value()[0].itemId==a.id&&this.ComposeSet(),this.sortedItemsPos+=1,b&&(d=b.position),this.try_cite=!0;for(var o=!1,p=0,q=CSL.PARALLEL_MATCH_VARS.length;q>p;p+=1)if(a[CSL.PARALLEL_MATCH_VARS[p]]){o=!0;break}var r=!0,s=this.sets.value().slice(-1)[0];if(s&&s.Item){var t=s.Item.jurisdiction?s.Item.jurisdiction.split(";")[0]:"",u=a.jurisdiction?a.jurisdiction.split(";")[0]:"";s.Item.title!==a.title?r=!1:t!==u?r=!1:s.Item.type!==a.type?r=!1:["article-journal","article-magazine"].indexOf(a.type)>-1&&(this.state.opt.development_extensions.handle_parallel_articles&&s.Item["container-title"]===a["container-title"]||(r=!1))}if(r&&o&&-1!==CSL.PARALLEL_TYPES.indexOf(a.type)||(this.try_cite=!0,this.in_series&&(this.in_series=!1)),this.cite={},this.cite.front=[],this.cite.mid=[],this.cite.back=[],this.cite.front_collapse={},this.cite.back_forceme=[],this.cite.position=d,this.cite.Item=a,this.cite.itemId=""+a.id,this.cite.prevItemID=""+c,this.target="front",["treaty"].indexOf(a.type)>-1)this.ignoreVars=this.ignoreVarsOrders;else if(["article-journal","article-magazine"].indexOf(a.type)>-1)this.ignoreVars=this.ignoreVarsOther;else if(b&&b.prefix){this.ignoreVars=this.ignoreVarsLawProceduralHistory,this.cite.useProceduralHistory=!0;var v=this.sets.value()[this.sets.value().length-1];if(v&&v.back)for(var p=v.back.length-1;p>-1;p+=-1)v.back[p]&&v[v.back[p]]&&delete v[v.back[p]]}else this.ignoreVars=this.ignoreVarsLawGeneral;if(this.sortedItems&&this.sortedItemsPos>0&&this.sortedItemsPos<this.sortedItems.length){if(h=this.sortedItems[this.sortedItemsPos][1],j=""+this.sortedItems[this.sortedItemsPos-1][1].id,i=this.state.registry.registry[j].parallel,k=!1,i==h.id){for(e=this.sortedItemsPos-1,f=e;f>-1;f+=-1)if(this.sortedItems[f][1].id==a.id){k=this.sortedItems[f][1].locator;break}l=this.sortedItems[this.sortedItemsPos][1].locator,h.position=!k&&l?CSL.POSITION_IBID_WITH_LOCATOR:l===k?CSL.POSITION_IBID:CSL.POSITION_IBID_WITH_LOCATOR}}else{if(!this.state.registry.registry[a.id])return this.try_cite=!1,this.force_collapse=!1,void 0;this.state.registry.registry[a.id].parallel=!1}this.force_collapse=!1,this.state.registry.registry[a.id].parallel&&(this.force_collapse=!0)}},CSL.Parallel.prototype.StartVariable=function(a,b){if(this.use_parallels&&(this.try_cite||this.force_collapse)){if(this.variable="names"===a?a+":"+this.target:a,this.ignoreVars.indexOf(a)>-1)return;"container-title"===a&&0===this.sets.value().length&&(this.master_was_neutral_cite=!1),this.data={},this.data.value="",this.data.blobs=[];var c=this.isMid(a);"authority"===b&&"names:front"===this.variable?(this.try_cite=!0,this.in_series=!1):"front"===this.target&&c?this.target="mid":"mid"===this.target&&!c&&this.cite.Item.title&&"names"!==a?this.target="back":"back"===this.target&&c&&(this.try_cite=!0,this.in_series=!1),"number"===a?this.cite.front.push(this.variable):CSL.PARALLEL_COLLAPSING_MID_VARSET.indexOf(a)>-1?["article-journal","article-magazine"].indexOf(this.cite.Item.type)>-1?this.cite.mid.push(this.variable):this.cite.front.push(this.variable):this.cite[this.target].push(this.variable)}},CSL.Parallel.prototype.AppendBlobPointer=function(a){if(this.use_parallels){if(this.ignoreVars.indexOf(this.variable)>-1)return;if(this.use_parallels&&(this.force_collapse||this.try_cite)){if(["article-journal","article-magazine"].indexOf(this.cite.Item.type)>-1){if(["volume","page","page-first","issue"].indexOf(this.variable)>-1)return;if("container-title"===this.variable&&this.cite.mid.length>1)return}this.variable&&(this.try_cite||this.force_collapse)&&a&&a.blobs&&(this.cite.useProceduralHistory&&"back"===this.target||this.data.blobs.push([a,a.blobs.length]))}}},CSL.Parallel.prototype.AppendToVariable=function(a){if(this.use_parallels){if(this.ignoreVars.indexOf(this.variable)>-1)return;if(this.try_cite||this.force_collapse){this.data.value+="::"+a}}},CSL.Parallel.prototype.CloseVariable=function(){if(this.use_parallels){if(this.ignoreVars.indexOf(this.variable)>-1)return;if((this.try_cite||this.force_collapse)&&(this.cite[this.variable]=this.data,this.sets.value().length>0)){var a=this.sets.value()[this.sets.value().length-1];"front"===this.target&&"issued"===this.variable&&this.data.value&&this.master_was_neutral_cite&&(this.target="mid"),"front"===this.target?!a[this.variable]&&!this.data.value||a[this.variable]&&this.data.value===a[this.variable].value||"issued"!==this.variable&&(this.in_series=!1):"mid"===this.target?CSL.PARALLEL_COLLAPSING_MID_VARSET.indexOf(this.variable)>-1&&(this.cite.front_collapse[this.variable]=a[this.variable]?a[this.variable].value===this.data.value?!0:!1:!1):"back"===this.target&&a[this.variable]&&this.data.value!==a[this.variable].value&&-1===this.sets.value().slice(-1)[0].back_forceme.indexOf(this.variable)&&(this.in_series=!1)}this.variable=!1}},CSL.Parallel.prototype.CloseCite=function(){var a,b,c,e,f,g,h;if(this.use_parallels&&(this.force_collapse||this.try_cite)){if(e=!1,this.cite.front_collapse["container-title"]||(e=!0),this.cite.front_collapse.volume===!1&&(e=!0),this.cite.front_collapse["collection-number"]===!1&&(e=!0),this.cite.front_collapse.section===!1&&(e=!0),e&&(this.cite.use_journal_info=!0,h=this.cite.front.indexOf("section"),h>-1&&(this.cite.front=this.cite.front.slice(0,h).concat(this.cite.front.slice(h+1))),f=this.cite.front.indexOf("volume"),f>-1&&(this.cite.front=this.cite.front.slice(0,f).concat(this.cite.front.slice(f+1))),g=this.cite.front.indexOf("container-title"),g>-1&&(this.cite.front=this.cite.front.slice(0,g).concat(this.cite.front.slice(g+1))),collection_number_pos=this.cite.front.indexOf("collection-number"),collection_number_pos>-1&&(this.cite.front=this.cite.front.slice(0,collection_number_pos).concat(this.cite.front.slice(collection_number_pos+1)))),this.in_series||this.force_collapse||this.ComposeSet(!0),0===this.sets.value().length){for(has_date=!1,b=0,c=this.cite.back.length;c>b;b+=1)if(a=this.cite.back[b],"issued"===a&&this.cite.issued&&this.cite.issued.value){has_date=!0;break}has_date||this.cite.back_forceme.push("issued")}else{var i=this.cite.front.indexOf("issued");if((-1===i||this.master_was_neutral_cite)&&(this.cite.back_forceme=this.sets.value().slice(-1)[0].back_forceme),i>-1){var j=this.sets.value()[this.sets.value().length-1];j.issued||(this.cite.front=this.cite.front.slice(0,i).concat(this.cite.front.slice(i+1)))}this.master_was_neutral_cite&&this.cite.mid.indexOf("names:mid")>-1&&this.cite.front.push("names:mid")}this.sets.value().push(this.cite)}},CSL.Parallel.prototype.ComposeSet=function(){var b,c,e;if(this.use_parallels&&(this.force_collapse||this.try_cite)){var f=this.sets.value().length;if(1===this.sets.value().length)this.in_series||(this.sets.value().pop(),this.delim_counter+=1);else{for(e=this.sets.value().length,c=0;e>c;c+=1)b=this.sets.value()[c],0===c?this.delim_counter+=1:(!b.Item.title&&b.use_journal_info?this.delim_pointers.push(!1):this.delim_pointers.push(this.delim_counter),this.delim_counter+=1),CSL.POSITION_FIRST===b.position&&(0===c?(this.state.registry.registry[b.itemId].master=!0,this.state.registry.registry[b.itemId].siblings=[],this.state.registry.registry[b.itemId].parallel=!1):b.prevItemID&&(this.state.registry.registry[b.itemId].parallel=this.state.registry.registry[b.prevItemID].parallel?this.state.registry.registry[b.prevItemID].parallel:b.prevItemID,this.state.registry.registry[b.itemId].siblings=this.state.registry.registry[b.prevItemID].siblings,this.state.registry.registry[b.itemId].siblings||(this.state.registry.registry[b.itemId].siblings=[],CSL.debug("WARNING: adding missing siblings array to registry object")),this.state.registry.registry[b.itemId].siblings.push(b.itemId)));this.sets.push([])}2>f?this.purgeGroupsIfParallel(!1):this.purgeGroupsIfParallel(!0),this.in_series=!0}},CSL.Parallel.prototype.PruneOutputQueue=function(){var a,b,c,d,e,f;if(this.use_parallels)for(a=this.sets.mystack.length,b=0;a>b;b+=1)if(c=this.sets.mystack[b],c.length>1)for(e=c.length,d=0;e>d;d+=1)f=c[d],0===d?this.purgeVariableBlobs(f,f.back):d===c.length-1?this.purgeVariableBlobs(f,f.front.concat(f.back_forceme)):this.purgeVariableBlobs(f,f.front.concat(f.back))},CSL.Parallel.prototype.purgeVariableBlobs=function(a,b){var c,d,e,f,g,h,i;if(this.use_parallels){for(i=this.state.output.current.value(),"undefined"==typeof i.length&&(i=i.blobs),d=0,c=this.delim_pointers.length;c>d;d+=1)h=this.delim_pointers[d],h!==!1&&(i[h].parallel_delimiter=", ");for(c=b.length-1,d=c;d>-1;d+=-1)if(e=b[d],a[e])for(g=a[e].blobs.length-1,h=g;h>-1;h+=-1)f=a[e].blobs[h],f[0].blobs=f[0].blobs.slice(0,f[1]).concat(f[0].blobs.slice(f[1]+1)),this.state.tmp.has_purged_parallel=!0,f[0]&&f[0].strings&&"string"==typeof f[0].strings.oops&&f[0].parent&&f[0].parent&&(f[0].parent.parent.strings.delimiter=f[0].strings.oops)}},CSL.Parallel.prototype.purgeGroupsIfParallel=function(a){for(var b=this.parallel_conditional_blobs_list.length-1;b>-1;b+=-1){for(var c=this.parallel_conditional_blobs_list[b],d=!0,e=0,f=c.conditions.length;f>e;e+=1)if(!c.conditions[e]!=!!a&&("master"!==c.conditions[e]||this.state.registry.registry[c.id].master)&&("servant"!==c.conditions[e]||this.state.registry.registry[c.id].parallel)){var d=!1;break}if(d){for(var g=[];c.blobs.length>c.pos;)g.push(c.blobs.pop());for(g.length&&g.pop();g.length;)c.blobs.push(g.pop())}this.parallel_conditional_blobs_list.pop()}},CSL.Util={},CSL.Util.Match=function(){this.any=function(a,b,c){return function(a,b){for(var d=0,e=c.length;e>d;d+=1)if(result=c[d](a,b))return!0;return!1}},this.none=function(a,b,c){return function(a,b){for(var d=0,e=c.length;e>d;d+=1)if(result=c[d](a,b))return!1;return!0}},this.all=function(a,b,c){return function(a,b){for(var d=0,e=c.length;e>d;d+=1)if(result=c[d](a,b),!result)return!1;return!0}},this[void 0]=this.all,this.nand=function(a,b,c){return function(a,b){for(var d=0,e=c.length;e>d;d+=1)if(result=c[d](a,b),!result)return!0;return!1}}},CSL.Transform=function(a){function h(a,b,c,d,e,f){var g;if(!e)return d;var h=e,i=!1;if(["title","title-short"].indexOf(h)>-1&&!b.jurisdiction&&(i=!0),CSL.NUMERIC_VARIABLES.indexOf(e)>-1&&(e="number"),["publisher-place","event-place","jurisdiction","archive-place"].indexOf(e)>-1&&(e="place"),["publisher","authority"].indexOf(e)>-1&&(e="institution-part"),["genre","event","medium","title-short"].indexOf(e)>-1&&(e="title"),["archive"].indexOf(e)>-1&&(e="collection-title"),"jurisdiction"===h&&a.sys.getHumanForm&&d&&(d=a.sys.getHumanForm(d)),g="",a.sys.getAbbreviation){var j=a.transform.loadAbbreviation(b.jurisdiction,e,d,b.type,i);a.transform.abbrevs[j][e]&&d&&a.sys.getAbbreviation&&a.transform.abbrevs[j][e][d]&&(g=a.transform.abbrevs[j][e][d].replace("{stet}",d))}return g||a.opt.development_extensions.require_explicit_legal_case_title_short&&"legal_case"===b.type||!c||!b[c]||!f||(g=b[c]),g||(g=d),g&&g.match(/^\!(?:[^>]+,)*here(?:,[^>]+)*>>>/)&&(g="jurisdiction"===h&&["treaty","patent"].indexOf(b.type)>-1?g.replace(/^\![^>]*>>>\s*/,""):!1),g}function i(b,c){var e,d=a.opt["default-locale"][0].slice(0,2);return e=a.opt.development_extensions.strict_text_case_locales?new RegExp("^([a-zA-Z]{2})(?:$|-.*| .*)"):new RegExp("^([a-zA-Z]{2})(?:$|-.*|.*)"),b.language&&(m=(""+b.language).match(e),d=m?m[1]:"tlh"),b.multi&&b.multi&&b.multi.main&&b.multi.main[c]&&(d=b.multi.main[c]),(!a.opt.development_extensions.strict_text_case_locales||a.opt.development_extensions.normalize_lang_keys_to_lowercase)&&(d=d.toLowerCase()),d}function j(b,c,d,e,f){var j,k,o,r;if(!b[c])return{name:"",usedOrig:f};if(o={name:"",usedOrig:f,locale:i(b,c)},r=a.opt[d],"locale-orig"===d)return o=f?{name:"",usedOrig:f}:{name:b[c],usedOrig:!1,locale:i(b,c)};if(e&&("undefined"==typeof r||0===r.length))return{name:b[c],usedOrig:!0,locale:i(b,c)};for(var t=0,u=r.length;u>t;t+=1){if(j=r[t],k=j.split(/[\-_]/)[0],j&&b.multi&&b.multi._keys[c]&&b.multi._keys[c][j]){o.name=b.multi._keys[c][j],o.locale=k;break}if(k&&b.multi&&b.multi._keys[c]&&b.multi._keys[c][k]){o.name=b.multi._keys[c][k],o.locale=k;break}}return!o.name&&e&&(o={name:b[c],usedOrig:!0,locale:i(b,c)}),o}function k(b,c,d,e,f){if(b||(b="default"),!d)return a.transform.abbrevs[b]||(a.transform.abbrevs[b]=new a.sys.AbbreviationSegments),b;if(a.sys.getAbbreviation){var i=["default"];if("default"!==b)for(var j=b.split(/\s*;\s*/),k=0,l=j.length;l>k;k+=1)i.push(j.slice(0,k+1).join(";"));for(var k=i.length-1;k>-1;k+=-1)if(a.transform.abbrevs[i[k]]||(a.transform.abbrevs[i[k]]=new a.sys.AbbreviationSegments),a.transform.abbrevs[i[k]][c][d]||a.sys.getAbbreviation(a.opt.styleID,a.transform.abbrevs,i[k],c,d,e,f),a.transform.abbrevs[i[k]][c][d]){k<i.length&&(a.transform.abbrevs[b][c][d]=a.transform.abbrevs[i[k]][c][d]);break}}return b}function l(b,c,d,e){var f=b.variables[0];
    if(a.publisherOutput&&d){if(-1===["publisher","publisher-place"].indexOf(f))return!1;a.publisherOutput[f+"-token"]=b,a.publisherOutput.varlist.push(f);var g=d.split(/;\s*/);g.length===a.publisherOutput[f+"-list"].length&&(a.publisherOutput[f+"-list"]=g);for(var i=0,j=g.length;j>i;i+=1)g[i]=h(a,c,!1,g[i],e,!0);return a.tmp[f+"-token"]=b,!0}return!1}function n(b,c,d,e){var g,i=CSL.LangPrefsMap[b[0]];return g=i?a.opt["cite-lang-prefs"][i]:!1,function(a,d,f){var m,n,p,q,r,s,t;if(!b[0]||!d[b[0]]&&!d[e])return null;if(a.opt.suppressJurisdictions&&"jurisdiction"===b[0]&&a.opt.suppressJurisdictions[d.jurisdiction]&&["legal_case","gazette","regulation","legislation"].indexOf(d.type)>-1)return null;var w={primary:!1,secondary:!1,tertiary:!1};if("_sort"===a.tmp.area.slice(-5))w.primary="locale-sort";else if(g)for(var x=["primary","secondary","tertiary"],y=0,z=x.length;z>y&&!(g.length-1<y);y+=1)g[y]&&(w[x[y]]="locale-"+g[y]);else w.primary="locale-orig";if("bibliography"===a.tmp.area||"citation"===a.tmp.area&&"note"===a.opt.xclass&&f&&!f.position||(w.secondary=!1,w.tertiary=!1),a.tmp["publisher-list"])return"publisher"===b[0]?a.tmp["publisher-token"]=this:"publisher-place"===b[0]&&(a.tmp["publisher-place-token"]=this),null;var A=j(d,b[0],w.primary,!0);m=A.name,n=A.locale;var B=A.usedOrig;if(l(this,d,m,c))return null;p=!1,r=!1,w.secondary&&(A=j(d,b[0],w.secondary,!1,A.usedOrig),p=A.name,q=A.locale),w.tertiary&&(A=j(d,b[0],w.tertiary,!1,A.usedOrig),r=A.name,s=A.locale),c&&(m=h(a,d,e,m,c,!0),m&&(m=o(m)),p=h(a,d,!1,p,c,!0),r=h(a,d,!1,r,c,!0));var D,C=CSL.Util.cloneToken(this),t=CSL.Util.cloneToken(this);if("locale-translit"===w.primary&&(D=a.opt.citeAffixes[i][w.primary].prefix),"<i>"===D&&"title"===b[0]&&!B){for(var E=!1,y=0,z=t.decorations.length;z>y;y+=1)"@font-style"===t.decorations[y][0]&&"italic"===t.decorations[y][1]&&(E=!0);E||t.decorations.push(["@font-style","italic"])}if("en"!==n&&"title"===t.strings["text-case"]&&(t.strings["text-case"]="passthrough"),"title"===b[0]&&(m=CSL.demoteNoiseWords(a,m,this["leading-noise-words"])),p||r){if(a.output.openLevel("empty"),t.strings.suffix=t.strings.suffix.replace(/[ .,]+$/,""),a.output.append(m,t),p){secondary_tok=CSL.Util.cloneToken(C),secondary_tok.strings.prefix=a.opt.citeAffixes[i][w.secondary].prefix,secondary_tok.strings.suffix=a.opt.citeAffixes[i][w.secondary].suffix,secondary_tok.strings.prefix||(secondary_tok.strings.prefix=" ");for(var y=secondary_tok.decorations.length-1;y>-1;y+=-1)["@quotes/true","@font-style/italic","@font-style/oblique","@font-weight/bold"].indexOf(secondary_tok.decorations[y].join("/"))>-1&&(secondary_tok.decorations=secondary_tok.decorations.slice(0,y).concat(secondary_tok.decorations.slice(y+1)));"en"!==q&&"title"===secondary_tok.strings["text-case"]&&(secondary_tok.strings["text-case"]="passthrough"),a.output.append(p,secondary_tok);var F=a.output.current.value(),G=a.output.current.value().blobs.length-1;a.parallel.use_parallels&&(a.parallel.cite.front.push(b[0]+":secondary"),a.parallel.cite[b[0]+":secondary"]={blobs:[[F,G]]})}if(r){tertiary_tok=CSL.Util.cloneToken(C),tertiary_tok.strings.prefix=a.opt.citeAffixes[i][w.tertiary].prefix,tertiary_tok.strings.suffix=a.opt.citeAffixes[i][w.tertiary].suffix,tertiary_tok.strings.prefix||(tertiary_tok.strings.prefix=" ");for(var y=tertiary_tok.decorations.length-1;y>-1;y+=-1)["@quotes/true","@font-style/italic","@font-style/oblique","@font-weight/bold"].indexOf(tertiary_tok.decorations[y].join("/"))>-1&&(tertiary_tok.decorations=tertiary_tok.decorations.slice(0,y).concat(tertiary_tok.decorations.slice(y+1)));"en"!==s&&"title"===tertiary_tok.strings["text-case"]&&(tertiary_tok.strings["text-case"]="passthrough"),a.output.append(r,tertiary_tok);var F=a.output.current.value(),G=a.output.current.value().blobs.length-1;a.parallel.use_parallels&&(a.parallel.cite.front.push(b[0]+":tertiary"),a.parallel.cite[b[0]+":tertiary"]={blobs:[[F,G]]})}a.output.closeLevel()}else a.output.append(m,t);return null}}function o(b){var c=b.match(/^!([-,_a-z]+)>>>/);if(c){var d=c[1].split(",");b=b.slice(c[0].length);for(var e=0,f=d.length;f>e;e+=1)-1===a.tmp.done_vars.indexOf(d[e])&&a.tmp.done_vars.push(d[e])}return b}this.abbrevs={},this.abbrevs["default"]=new a.sys.AbbreviationSegments,this.getTextSubField=j,this.loadAbbreviation=k,this.getOutputFunction=n,this.quashCheck=o},CSL.Token=function(a,b){this.name=a,this.strings={},this.strings.delimiter=void 0,this.strings.prefix="",this.strings.suffix="",this.decorations=[],this.variables=[],this.execs=[],this.tokentype=b,this.evaluator=!1,this.tests=[],this.rawtests=[],this.succeed=!1,this.fail=!1,this.next=!1},CSL.Util.cloneToken=function(a){var b,c,d,e;if("string"==typeof a)return a;b=new CSL.Token(a.name,a.tokentype);for(c in a.strings)a.strings.hasOwnProperty(c)&&(b.strings[c]=a.strings[c]);if(a.decorations)for(b.decorations=[],d=0,e=a.decorations.length;e>d;d+=1)b.decorations.push(a.decorations[d].slice());return a.variables&&(b.variables=a.variables.slice()),a.execs&&(b.execs=a.execs.slice(),b.tests=a.tests.slice(),b.rawtests=a.tests.slice()),b},CSL.AmbigConfig=function(){this.maxvals=[],this.minval=1,this.names=[],this.givens=[],this.year_suffix=!1,this.disambiguate=0},CSL.Blob=function(a,b,c){var d,e,f;if(this.levelname=c,b){this.strings={prefix:"",suffix:""};for(f in b.strings)b.strings.hasOwnProperty(f)&&(this.strings[f]=b.strings[f]);for(this.decorations=[],d=void 0===b.decorations?0:b.decorations.length,e=0;d>e;e+=1)this.decorations.push(b.decorations[e].slice())}else this.strings={},this.strings.prefix="",this.strings.suffix="",this.strings.delimiter="",this.decorations=[];this.blobs="string"==typeof a?a:a?[a]:[],this.alldecor=[this.decorations]},CSL.Blob.prototype.push=function(a){if("string"==typeof this.blobs)throw"Attempt to push blob onto string object";!1!==a&&(a.alldecor=a.alldecor.concat(this.alldecor),this.blobs.push(a))},CSL.NumericBlob=function(a,b,c){this.id=c,this.alldecor=[],this.num=a,this.blobs=a.toString(),this.status=CSL.START,this.strings={},b?(this.gender=b.gender,this.decorations=b.decorations,this.strings.prefix=b.strings.prefix,this.strings.suffix=b.strings.suffix,this.strings["text-case"]=b.strings["text-case"],this.successor_prefix=b.successor_prefix,this.range_prefix=b.range_prefix,this.splice_prefix=b.splice_prefix,this.formatter=b.formatter,this.formatter||(this.formatter=new CSL.Output.DefaultFormatter),this.formatter&&(this.type=this.formatter.format(1))):(this.decorations=[],this.strings.prefix="",this.strings.suffix="",this.successor_prefix="",this.range_prefix="",this.splice_prefix="",this.formatter=new CSL.Output.DefaultFormatter)},CSL.NumericBlob.prototype.setFormatter=function(a){this.formatter=a,this.type=this.formatter.format(1)},CSL.Output.DefaultFormatter=function(){},CSL.Output.DefaultFormatter.prototype.format=function(a){return a.toString()},CSL.NumericBlob.prototype.checkNext=function(a,b){b?(this.status=CSL.START,"object"==typeof a&&(a.status=a.num===this.num+1?CSL.SUCCESSOR:CSL.SEEN)):a&&a.num&&this.type===a.type&&a.num===this.num+1?this.status===CSL.START||this.status===CSL.SEEN?a.status=CSL.SUCCESSOR:(this.status===CSL.SUCCESSOR||this.status===CSL.SUCCESSOR_OF_SUCCESSOR)&&(this.range_prefix?(a.status=CSL.SUCCESSOR_OF_SUCCESSOR,this.status=CSL.SUPPRESS):a.status=CSL.SUCCESSOR):(this.status===CSL.SUCCESSOR_OF_SUCCESSOR&&(this.status=CSL.END),"object"==typeof a&&(a.status=CSL.SEEN))},CSL.NumericBlob.prototype.checkLast=function(a){return this.status===CSL.SEEN||a.num!==this.num-1&&this.status===CSL.SUCCESSOR?(this.status=CSL.SUCCESSOR,!0):!1},CSL.Util.fixDateNode=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,q,r;this.build.date_key=!0,d=this.sys.xml.getAttributeValue(c,"form");var s;if(s="accessed"===this.sys.xml.getAttributeValue(c,"variable")?this.opt["default-locale"][0]:this.sys.xml.getAttributeValue(c,"lingo"),!this.getDate(d))return a;var t=this.sys.xml.getAttributeValue(c,"date-parts");e=this.sys.xml.getAttributeValue(c,"variable"),k=this.sys.xml.getAttributeValue(c,"prefix"),l=this.sys.xml.getAttributeValue(c,"suffix"),q=this.sys.xml.getAttributeValue(c,"display"),r=this.sys.xml.getAttributeValue(c,"cslid"),f=this.sys.xml.nodeCopy(this.getDate(d,"accessed"===e)),this.sys.xml.setAttribute(f,"lingo",this.opt.lang),this.sys.xml.setAttribute(f,"form",d),this.sys.xml.setAttribute(f,"date-parts",t),this.sys.xml.setAttribute(f,"cslid",r),this.sys.xml.setAttribute(f,"variable",e),k&&this.sys.xml.setAttribute(f,"prefix",k),l&&this.sys.xml.setAttribute(f,"suffix",l),q&&this.sys.xml.setAttribute(f,"display",q),m=this.sys.xml.children(c);for(n in m)if(g=m[n],"date-part"===this.sys.xml.nodename(g)){h=this.sys.xml.getAttributeValue(g,"name"),o=this.sys.xml.attributes(g);for(i in o)if(o.hasOwnProperty(i)){if("@name"===i)continue;if(s&&s!==this.opt.lang&&["@suffix","@prefix","@form"].indexOf(i)>-1)continue;j=o[i],this.sys.xml.setAttributeOnNodeIdentifiedByNameAttribute(f,"date-part",h,i,j)}}return"year"===this.sys.xml.getAttributeValue(c,"date-parts")?(this.sys.xml.deleteNodeByNameAttribute(f,"month"),this.sys.xml.deleteNodeByNameAttribute(f,"day")):"year-month"===this.sys.xml.getAttributeValue(c,"date-parts")&&this.sys.xml.deleteNodeByNameAttribute(f,"day"),this.sys.xml.insertChildNodeAfter(a,c,b,f)},CSL.dateMacroAsSortKey=function(a,b){CSL.dateAsSortKey.call(this,a,b,!0)},CSL.dateAsSortKey=function(a,b,c){var d,e,f,g,h,i,j,k,m=this.variables[0],n="empty";for(c&&(n="macro-with-date"),d=b[m],"undefined"==typeof d&&(d={"date-parts":[[0]]},d.year||(a.tmp.empty_date=!0)),"undefined"==typeof this.dateparts&&(this.dateparts=["year","month","day"]),d.raw?d=a.fun.dateparser.parse(d.raw):d["date-parts"]&&(d=a.dateParseArray(d)),"undefined"==typeof d&&(d={}),j=0,k=CSL.DATE_PARTS_INTERNAL.length;k>j;j+=1)e=CSL.DATE_PARTS_INTERNAL[j],f=0,g=e,"_end"===g.slice(-4)&&(g=g.slice(0,-4)),d[e]&&this.dateparts.indexOf(g)>-1&&(f=d[e]),"year"===e.slice(0,4)?(h=CSL.Util.Dates[g].numeric(a,f),i="Y","-"===h[0]&&(i="X",h=h.slice(1),h=9999-parseInt(h,10)),a.output.append(CSL.Util.Dates[e.slice(0,4)].numeric(a,i+h),n)):(f=CSL.Util.Dates[g]["numeric-leading-zeros"](a,f),f||(f="00"),a.output.append(f,n))},CSL.Engine.prototype.dateParseArray=function(a){var b,c,f,g;b={};for(c in a)if("date-parts"===c){f=a["date-parts"],f.length>1&&f[0].length!==f[1].length&&CSL.error("CSL data error: element mismatch in date range input."),g=["","_end"];for(var m=0,n=f.length;n>m;m+=1)for(var o=0,p=CSL.DATE_PARTS.length;p>o;o+=1)b[CSL.DATE_PARTS[o]+g[m]]="undefined"==typeof f[m][o]?f[m][o]:parseInt(f[m][o],10)}else a.hasOwnProperty(c)&&("literal"===c&&"object"==typeof a.literal&&"string"==typeof a.literal.part?(CSL.debug("Warning: fixing up weird literal date value"),b.literal=a.literal.part):b[c]=a[c]);return b},CSL.Util.Names={},CSL.Util.Names.compareNamesets=CSL.NameOutput.prototype._compareNamesets,CSL.Util.Names.unInitialize=function(a,b){var c,d,e,f,g;if(!b)return"";for(e=b.split(/(?:\-|\s+)/),f=b.match(/(\-|\s+)/g),g="",c=0,d=e.length;d>c;c+=1)CSL.ALL_ROMANESQUE_REGEXP.exec(e[c].slice(0,-1))&&e[c]&&e[c]!==e[c].toUpperCase()&&(e[c]=e[c].slice(0,1)+e[c].slice(1,2).toLowerCase()+e[c].slice(2)),g+=e[c],d-1>c&&(g+=f[c]);return g},CSL.Util.Names.initializeWith=function(a,b,c,d){var e,f,g,h,k,m,n;if(!b)return"";if(["Lord","Lady"].indexOf(b)>-1||!b.match(CSL.STARTSWITH_ROMANESQUE_REGEXP)&&!c.match("%s"))return b;c||(c="");var o=b;if(a.opt["initialize-with-hyphen"]===!1&&(o=o.replace(/\-/g," ")),o=o.replace(/\s*\-\s*/g,"-").replace(/\s+/g," "),o=o.replace(/-([a-z])/g,"\u2013$1"),k=o.match(/[\-\s]+/g),m=o.split(/[\-\s]+/),0===m.length)o=k;else for(o=[m[0]],e=1,f=m.length;f>e;e+=1)o.push(k[e-1]),o.push(m[e]);for(m=o,e=m.length-1;e>-1;e+=-1)if(m[e]&&m[e].slice(0,-1).indexOf(".")>-1){var p=m.slice(e+1),q=m[e].slice(0,-1).split(".");for(m=m.slice(0,e),g=0,h=q.length;h>g;g+=1)m.push(q[g]+"."),g<q.length-1&&m.push(" ");m=m.concat(p)}return n=d?CSL.Util.Names.doNormalize(a,m,c):CSL.Util.Names.doInitialize(a,m,c),n=n.replace(/\u2013([a-z])/g,"-$1")},CSL.Util.Names.doNormalize=function(a,b,c){var e,f,g=[];for(e=0,f=b.length;f>e;e+=1)b[e].length>1&&"."===b[e].slice(-1)?(b[e]=b[e].slice(0,-1),g.push(!0)):1===b[e].length&&b[e].toUpperCase()===b[e]?g.push(!0):g.push(!1);for(e=0,f=b.length;f>e;e+=2)g[e]&&(e<b.length-2&&(b[e+1]="",(!c||c.slice(-1)&&" "!==c.slice(-1))&&b[e].length&&b[e].match(CSL.ALL_ROMANESQUE_REGEXP)&&(b[e].length>1||b[e+2].length>1)&&(b[e+1]=" "),b[e]=b[e]+c),e===b.length-1&&(b[e]=b[e]+c));return b.join("").replace(/\s+$/,"")},CSL.Util.Names.doInitialize=function(a,b,c){var e,f,g,h,i,j,k;for(e=0,f=b.length;f>e;e+=2)if(k=b[e])if(g=k.match(CSL.NAME_INITIAL_REGEXP),!g&&!k.match(CSL.STARTSWITH_ROMANESQUE_REGEXP)&&k.length>1&&c.match("%s")&&(g=k.match(/(.)(.*)/)),g&&g[1]===g[1].toUpperCase()){var l="";if(g[2]){var m="";for(j=g[2].split(""),h=0,i=j.length;i>h;h+=1){var n=j[h];if(n!==n.toUpperCase())break;m+=n}m.length<g[2].length&&(l=m.toLocaleLowerCase())}b[e]=g[1].toLocaleUpperCase()+l,f-1>e?c.match("%s")?b[e]=c.replace("%s",b[e]):b[e+1]=b[e+1].indexOf("-")>-1?c+b[e+1]:c:c.match("%s")?b[e]=c.replace("%s",b[e]):b.push(c)}else k.match(CSL.ROMANESQUE_REGEXP)&&(b[e]=" "+k);var o=b.join("");return o=o.replace(/\s+$/,"").replace(/\s*\-\s*/g,"-").replace(/\s+/g," ")},CSL.Util.Names.getRawName=function(a){var b=[];return a.given&&b.push(a.given),a.family&&b.push(a.family),b.join(" ")},CSL.Util.Dates={},CSL.Util.Dates.year={},CSL.Util.Dates.year["long"]=function(a,b){return b||(b="boolean"==typeof b?"":0),b.toString()},CSL.Util.Dates.year.imperial=function(a,b,c){b||(b="boolean"==typeof b?"":0),c=c?"_end":"";var e=a.tmp.date_object["month"+c];for(e=e?""+e:"1";e.length<2;)e="0"+e;var f=a.tmp.date_object["day"+c];for(f=f?""+f:"1";f.length<2;)f="0"+f;var h,i,g=parseInt(b+e+f,10);return g>=18680908&&19120730>g?(h="\u660e\u6cbb",i=1867):g>=19120730&&19261225>g?(h="\u5927\u6b63",i=1911):g>=19261225&&19890108>g?(h="\u662d\u548c",i=1925):g>=19890108&&(h="\u5e73\u6210",i=1988),h&&i&&(a.transform.abbrevs["default"].number[h]||a.transform.loadAbbreviation("default","number",h),a.transform.abbrevs["default"].number[h]&&(h=a.transform.abbrevs["default"].number[h]),year=h+(b-i)),year},CSL.Util.Dates.year["short"]=function(a,b){return b=b.toString(),b&&4===b.length?b.substr(2):void 0},CSL.Util.Dates.year.numeric=function(a,b){var c,d;for(b=""+b,c=b.match(/([0-9]*)$/),c?(d=b.slice(0,-1*c[1].length),b=c[1]):(d=b,b="");b.length<4;)b="0"+b;return d+b},CSL.Util.Dates.normalizeMonth=function(a,b){var c;if(a||(a=0),a=""+a,a.match(/^[0-9]+$/)||(a=0),a=parseInt(a,10),b){var d={stub:"month-",num:a};d.num<1||d.num>20?d.num=0:d.num>16?(d.stub="season-",d.num=d.num-16):d.num>12&&(d.stub="season-",d.num=d.num-12),c=d}else(1>a||a>12)&&(a=0),c=a;return c},CSL.Util.Dates.month={},CSL.Util.Dates.month.numeric=function(a,b){var b=CSL.Util.Dates.normalizeMonth(b);return b||(b=""),b},CSL.Util.Dates.month["numeric-leading-zeros"]=function(a,b){var b=CSL.Util.Dates.normalizeMonth(b);if(b)for(b=""+b;b.length<2;)b="0"+b;else b="";return b},CSL.Util.Dates.month["long"]=function(a,b,c,d){var e=CSL.Util.Dates.normalizeMonth(b,!0),b=e.num;if(b){for(b=""+b;b.length<2;)b="0"+b;b=a.getTerm(e.stub+b,"long",0,0,!1,d)}else b="";return b},CSL.Util.Dates.month["short"]=function(a,b,c,d){var e=CSL.Util.Dates.normalizeMonth(b,!0),b=e.num;if(b){for(b=""+b;b.length<2;)b="0"+b;b=a.getTerm(e.stub+b,"short",0,0,!1,d)}else b="";return b},CSL.Util.Dates.day={},CSL.Util.Dates.day.numeric=function(a,b){return b.toString()},CSL.Util.Dates.day["long"]=CSL.Util.Dates.day.numeric,CSL.Util.Dates.day["numeric-leading-zeros"]=function(a,b){for(b||(b=0),b=b.toString();b.length<2;)b="0"+b;return b.toString()},CSL.Util.Dates.day.ordinal=function(a,b,c){return a.fun.ordinalizer.format(b,c)},CSL.Util.Sort={},CSL.Util.Sort.strip_prepositions=function(a){var b;return"string"==typeof a&&(b=a.toLocaleLowerCase(),b=a.match(/^((a|an|the)\s+)/)),b&&(a=a.substr(b[1].length)),a},CSL.Util.substituteStart=function(a,b){var c,d,e,f,g,h,i;f=function(a){for(var c=0,d=this.decorations.length;d>c;c+=1)if("@strip-periods"===this.decorations[c][0]&&"true"===this.decorations[c][1]){a.tmp.strip_periods+=1;break}},this.execs.push(f),this.decorations&&(a.opt.development_extensions.csl_reverse_lookup_support||a.sys.csl_reverse_lookup_support)&&(this.decorations.reverse(),this.decorations.push(["@showid","true",this.cslid]),this.decorations.reverse()),i=["number","date","names"],("text"===this.name&&!this.postponed_macro||i.indexOf(this.name)>-1)&&(c=function(a,b,c){"author"===a.tmp.element_trace.value()||"names"===this.name?c&&c["author-only"]?a.tmp.element_trace.push("do-not-suppress-me"):c&&c["suppress-author"]:c&&c["author-only"]?a.tmp.element_trace.push("suppress-me"):c&&c["suppress-author"]&&a.tmp.element_trace.push("do-not-suppress-me")},this.execs.push(c)),d=this.strings.cls,this.strings.cls=!1,0===a.build.render_nesting_level&&("bibliography"===a.build.area&&a.bibliography.opt["second-field-align"]?(e=new CSL.Token("group",CSL.START),e.decorations=[["@display","left-margin"]],f=function(a,b){a.tmp.render_seen||(e.strings.first_blob=b.id,a.output.startTag("bib_first",e))},e.execs.push(f),b.push(e)):CSL.DISPLAY_CLASSES.indexOf(d)>-1&&(e=new CSL.Token("group",CSL.START),e.decorations=[["@display",d]],f=function(a,b){e.strings.first_blob=b.id,a.output.startTag("bib_first",e)},e.execs.push(f),b.push(e)),a.build.cls=d),a.build.render_nesting_level+=1,1===a.build.substitute_level.value()&&(g=new CSL.Token("choose",CSL.START),CSL.Node.choose.build.call(g,a,b),h=new CSL.Token("if",CSL.START),f=function(){return a.tmp.can_substitute.value()?!0:!1},h.tests.push(f),h.test=a.fun.match.any(this,a,h.tests),b.push(h)),a.sys.variableWrapper&&this.variables_real&&this.variables_real.length&&(f=function(a,b,c){if(!a.tmp.just_looking&&!a.tmp.suppress_decorations){variable_entry=new CSL.Token("text",CSL.START),variable_entry.decorations=[["@showid","true"]],a.output.startTag("variable_entry",variable_entry);var d=null;c&&(d=c.position),d||(d=0);var e=["first","subsequent","ibid","ibid-with-locator"],f=0;c&&c.noteIndex&&(f=c.noteIndex);var g=0;c&&c["first-reference-note-number"]&&(g=c["first-reference-note-number"]);var h=0;c&&c["citation-number"]&&(h=c["citation-number"]);var i=0;c&&c.index&&(i=c.index);var j={itemData:b,variableNames:this.variables,context:a.tmp.area,xclass:a.opt.xclass,position:e[d],"note-number":f,"first-reference-note-number":g,"citation-number":h,index:i,mode:a.opt.mode};a.output.current.value().params=j}},this.execs.push(f))},CSL.Util.substituteEnd=function(a,b){var c,d,e,f,g,h,i,j,k;a.sys.variableWrapper&&(this.hasVariable||this.variables_real&&this.variables_real.length)&&(c=function(a){a.tmp.just_looking||a.tmp.suppress_decorations||a.output.endTag("variable_entry")},this.execs.push(c)),c=function(a){for(var c=0,d=this.decorations.length;d>c;c+=1)if("@strip-periods"===this.decorations[c][0]&&"true"===this.decorations[c][1]){a.tmp.strip_periods+=-1;break}},this.execs.push(c),a.build.render_nesting_level+=-1,0===a.build.render_nesting_level&&(a.build.cls?(c=function(a){a.output.endTag("bib_first")},this.execs.push(c),a.build.cls=!1):"bibliography"===a.build.area&&a.bibliography.opt["second-field-align"]&&(d=new CSL.Token("group",CSL.END),c=function(a){a.tmp.render_seen||a.output.endTag()},d.execs.push(c),b.push(d),e=new CSL.Token("group",CSL.START),e.decorations=[["@display","right-inline"]],c=function(a){a.tmp.render_seen||(a.tmp.render_seen=!0,a.output.startTag("bib_other",e))},e.execs.push(c),b.push(e))),1===a.build.substitute_level.value()&&(f=new CSL.Token("if",CSL.END),b.push(f),g=new CSL.Token("choose",CSL.END),CSL.Node.choose.build.call(g,a,b)),h="names"===this.name&&0===a.build.substitute_level.value(),i="string"==typeof a[a.build.area].opt["subsequent-author-substitute"];var l=a[a.build.area].opt["subsequent-author-substitute-rule"];h&&i&&(j=new CSL.Token("text",CSL.SINGLETON),c=function(a){var c,d,e=!a.tmp.suppress_decorations;if(e&&"bibliography"===a.tmp.area&&a.tmp.subsequent_author_substitute_ok&&a.tmp.rendered_name)if("partial-each"===l||"partial-first"===l){var f=!0,g=[];for(c=0,d=a.tmp.name_node.children.length;d>c;c+=1){var h=a.tmp.rendered_name[c];f&&a.tmp.last_rendered_name&&a.tmp.last_rendered_name.length>c-1&&h&&!h.localeCompare(a.tmp.last_rendered_name[c])?(k=new CSL.Blob(a[a.tmp.area].opt["subsequent-author-substitute"]),a.tmp.name_node.children[c].blobs=[k],"partial-first"===l&&(f=!1)):f=!1,g.push(h)}a.tmp.last_rendered_name=g}else if("complete-each"===l){var g=a.tmp.rendered_name.join(",");if(g){if(!g.localeCompare(a.tmp.last_rendered_name))for(c=0,d=a.tmp.name_node.children.length;d>c;c+=1)k=new CSL.Blob(a[a.tmp.area].opt["subsequent-author-substitute"]),a.tmp.name_node.children[c].blobs=[k];a.tmp.last_rendered_name=g}}else{var g=a.tmp.rendered_name.join(",");g&&(g.localeCompare(a.tmp.last_rendered_name)||(k=new CSL.Blob(a[a.tmp.area].opt["subsequent-author-substitute"]),a.tmp.name_node.top.blobs=a.tmp.label_blob?[k,a.tmp.label_blob]:[k]),a.tmp.last_rendered_name=g)}},j.execs.push(c),b.push(j)),("text"===this.name&&!this.postponed_macro||["number","date","names"].indexOf(this.name)>-1)&&(c=function(a){a.tmp.element_trace.pop()},this.execs.push(c))},CSL.Util.padding=function(a){var b=a.match(/\s*(-{0,1}[0-9]+)/);if(b)for(a=parseInt(b[1],10),0>a&&(a=1e20+a),a=""+a;a.length<20;)a="0"+a;return a},CSL.Util.LongOrdinalizer=function(){},CSL.Util.LongOrdinalizer.prototype.init=function(a){this.state=a},CSL.Util.LongOrdinalizer.prototype.format=function(a,b){10>a&&(a="0"+a);var c=CSL.Engine.getField(CSL.LOOSE,this.state.locale[this.state.opt.lang].terms,"long-ordinal-"+a,"long",0,b);return c||(c=this.state.fun.ordinalizer.format(a,b)),this.state.tmp.cite_renders_content=!0,c},CSL.Util.Ordinalizer=function(a){this.state=a,this.suffixes={}},CSL.Util.Ordinalizer.prototype.init=function(){if(!this.suffixes[this.state.opt.lang]){this.suffixes[this.state.opt.lang]={};for(var a=0,b=3;b>a;a+=1){var c=[void 0,"masculine","feminine"][a];this.suffixes[this.state.opt.lang][c]=[];for(var d=1;5>d;d+=1){var e=this.state.getTerm("ordinal-0"+d,"long",!1,c);if("undefined"==typeof e){delete this.suffixes[this.state.opt.lang][c];break}this.suffixes[this.state.opt.lang][c].push(e)}}}},CSL.Util.Ordinalizer.prototype.format=function(a,b){var c;a=parseInt(a,10),c=""+a;var d="",e=[];if(b&&e.push(b),e.push("neuter"),this.state.locale[this.state.opt.lang].ord["1.0.1"]){d=this.state.getTerm("ordinal",!1,0,b);for(var f,g=0,h=e.length;h>g;g+=1){f=e[g];var i=this.state.locale[this.state.opt.lang].ord["1.0.1"];if(i["whole-number"][c]&&i["whole-number"][c][f]?d=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["whole-number"][c][f],!1,0,b):i["last-two-digits"][c.slice(c.length-2)]&&i["last-two-digits"][c.slice(c.length-2)][f]?d=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["last-two-digits"][c.slice(c.length-2)][f],!1,0,b):i["last-digit"][c.slice(c.length-1)]&&i["last-digit"][c.slice(c.length-1)][f]&&(d=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["last-digit"][c.slice(c.length-1)][f],!1,0,b)),d)break}}else b||(b=void 0),this.state.fun.ordinalizer.init(),d=1===a/10%10||a>10&&20>a?this.suffixes[this.state.opt.lang][b][3]:1===a%10&&11!==a%100?this.suffixes[this.state.opt.lang][b][0]:2===a%10&&12!==a%100?this.suffixes[this.state.opt.lang][b][1]:3===a%10&&13!==a%100?this.suffixes[this.state.opt.lang][b][2]:this.suffixes[this.state.opt.lang][b][3];return c=c+=d},CSL.Util.Romanizer=function(){},CSL.Util.Romanizer.prototype.format=function(a){var b,c,d,e,f;if(b="",6e3>a)for(e=a.toString().split(""),e.reverse(),c=0,d=0,f=e.length,c=0;f>c;c+=1)d=parseInt(e[c],10),b=CSL.ROMAN_NUMERALS[c][d]+b;return b},CSL.Util.Suffixator=function(a){a||(a=CSL.SUFFIX_CHARS),this.slist=a.split(",")},CSL.Util.Suffixator.prototype.format=function(a){var b;a+=1;var c="";do b=0===a%26?26:a%26,c=this.slist[b-1]+c,a=(a-b)/26;while(0!==a);return c},CSL.Engine.prototype.processNumber=function(a,b,c,d){var e,f,g,h,i,j;if(this.tmp.shadow_numbers[c]){if(this.tmp.shadow_numbers[c].numeric)for(var g=0,h=this.tmp.shadow_numbers[c].values.length;h>g;g+=2)this.tmp.shadow_numbers[c].values[g][2]=a}else if(this.tmp.shadow_numbers[c]={},this.tmp.shadow_numbers[c].values=[],this.tmp.shadow_numbers[c].plural=0,this.tmp.shadow_numbers[c].numeric=!1,this.tmp.shadow_numbers[c].label=!1,b){var l=CSL.LangPrefsMap[c];if(l){var m=this.opt["cite-lang-prefs"][l][0];e=this.transform.getTextSubField(b,c,"locale-"+m,!0),e=e.name}else e=b[c];if(e&&this.sys.getAbbreviation){e=(""+e).replace(/^\"/,"").replace(/\"$/,"");var n=this.transform.loadAbbreviation(b.jurisdiction,"number",e);this.transform.abbrevs[n].number[e]?e=this.transform.abbrevs[n].number[e]:"undefined"!=typeof this.transform.abbrevs[n].number[e]&&delete this.transform.abbrevs[n].number[e]}if("undefined"!=typeof e){if("number"==typeof e&&(e=""+e),this.tmp.shadow_numbers[c].label=c,'"'===e.slice(0,1)&&'"'===e.slice(-1)&&(e=e.slice(1,-1)),e&&["number-of-volumes","number-of-pages"].indexOf(c)>-1){var f=e.match(/[^0-9]*([0-9]+).*/);f&&(this.tmp.shadow_numbers[c].numeric=!0,"1"!==f[1]&&(this.tmp.shadow_numbers[c].plural=1))}"locator"===c&&["bill","gazette","legislation","treaty"].indexOf(d)>-1&&(e=e.split(CSL.STATUTE_SUBDIV_PLAIN_REGEX)[0]);var o="page";if(["bill","gazette","legislation","legal_case","treaty"].indexOf(d)>-1&&"collection-number"===c&&(o="year"),["page","page-first"].indexOf(c)>-1){var f=e.split(" ")[0].match(CSL.STATUTE_SUBDIV_GROUPED_REGEX);if(f){this.opt.development_extensions.static_statute_locator&&(this.tmp.shadow_numbers[c].label=CSL.STATUTE_SUBDIV_STRINGS[f[0]]);var p=e.match(/[^ ]+\s+(.*)/);p&&(e=p[1])}}for(var q=e.split(/(?:,\s+|\s*\\*[\-\u2013]+\s*|\s*&\s*)/),f=e.match(/(,\s+|\s*\\*[\-\u2013]+\s*|\s*&\s*)/g),r=[],g=0,h=q.length-1;h>g;g+=1)r.push(q[g]),r.push(f[g]);r.push(q[q.length-1]);for(var s=0,t=!0,g=0,h=r.length;h>g;g+=1){var u=0===g%2;if(u){if(r[g]){if(r[g].match(/(?:[0-9]|[xivcmlXIVCML])/))if(r[g-1]&&r[g-1].match(/^\s*\\*[\-\u2013]+\s*$/)){var v=this.tmp.shadow_numbers[c].values.slice(-1);if(-1==v[0][1].indexOf("\\")){if(r[g-2]&&(""+r[g-2]).match(/(:?[a-zA-Z]*[0-9]+$|^[ivxlcmIVXLCM]+$)/)&&r[g].match(/(?:^[a-zA-Z]*[0-9]+|^[ivxlcmIVXLCM]+$)/)){var w=this.tmp.shadow_numbers[c].values.slice(-2);if(v[0][1]=this.getTerm(o+"-range-delimiter"),this.opt[o+"-range-format"]){var x=this.fun[o+"_mangler"](w[0][1]+"-"+r[g]);x=x.split(this.getTerm(o+"-range-delimiter")),r[g]=x[1]}s+=1}v[0][1].indexOf("--")>-1&&(v[0][1]=v[0][1].replace(/--*/,"\u2013"))}else v[0][1]=v[0][1].replace(/\\/,"","g")}else-1===r[g].indexOf(" ")&&(s+=1);for(var y=r[g].split(/\s+/),i=0,j=y.length;j>i;i+=1)this.opt.development_extensions.strict_page_numbers&&"page"===c&&!y[i].match(/^-*[0-9]/)?t=!1:y[i].match(/[-0-9]/)||(t=!1);if(r[g].match(/^[1-9][0-9]*$/))r[g]=parseInt(r[g],10),a&&"undefined"==typeof a.gender&&(a.gender=this.locale[this.opt.lang]["noun-genders"][c],a.gender||(a.gender="")),this.tmp.shadow_numbers[c].values.push(["NumericBlob",r[g],a]);else{var z=r[g];this.tmp.shadow_numbers[c].values.push(["Blob",z,a])}}}else r[g]&&this.tmp.shadow_numbers[c].values.push(["Blob",r[g],void 0])}this.tmp.shadow_numbers[c].numeric=this.opt.development_extensions.strict_page_numbers&&"page"===c?-1===e.indexOf(" ")&&e.match(/^-*[0-9]/)?!0:t:-1===e.indexOf(" ")&&e.match(/[0-9]/)?!0:t,this.tmp.shadow_numbers[c].numeric||this.transform.loadAbbreviation(b.jurisdiction,"number",e),s>1&&(this.tmp.shadow_numbers[c].plural=1),1===b.force_pluralism?this.tmp.shadow_numbers[c].plural=1:0===b.force_pluralism&&(this.tmp.shadow_numbers[c].plural=0)}}},CSL.Util.PageRangeMangler={},CSL.Util.PageRangeMangler.getFunction=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,v=a.getTerm(b+"-range-delimiter");c=/([a-zA-Z]*)([0-9]+)\s*(?:\u2013|-)\s*([a-zA-Z]*)([0-9]+)/,f=function(c){for(e=c.length,d=1;e>d;d+=2)"object"==typeof c[d]&&(c[d]=c[d].join(""));var f=c.join("");return f=f.replace(/([^\\])\-/g,"$1"+a.getTerm(b+"-range-delimiter"))},g=function(a){var b,c,f,g="\\s+\\-\\s+",h="-"===v?"":v,i=new RegExp("([^\\\\])[-"+h+"\\u2013]","g");a=a.replace(i,"$1 - ").replace(/\s+-\s+/g," - ");var j=new RegExp("([a-zA-Z]*[0-9]+"+g+"[a-zA-Z]*[0-9]+)","g"),k=new RegExp("[a-zA-Z]*[0-9]+"+g+"[a-zA-Z]*[0-9]+");if(b=a.match(j),c=a.split(k),0===c.length)f=b;else for(f=[c[0]],d=1,e=c.length;e>d;d+=1)f.push(b[d-1].replace(/\s*\-\s*/,"-","g")),f.push(c[d]);return f},h=function(a){for(a=""+a,l=g(a),e=l.length,d=1;e>d;d+=2)m=l[d].match(c),m&&(m[3]&&m[1]!==m[3]||(m[4].length<m[2].length&&(m[4]=m[2].slice(0,m[2].length-m[4].length)+m[4]),parseInt(m[2],10)<parseInt(m[4],10)&&(m[3]=v+m[1],l[d]=m.slice(1)))),"string"==typeof l[d]&&(l[d]=l[d].replace("-",v,"g"));return l},i=function(a,b,c){e=a.length;for(var d=1,g=a.length;g>d;d+=2)a[d][3]=j(a[d][1],a[d][3],b,c),a[d][2].slice(1)===a[d][0]&&(a[d][2]=v);return f(a)},j=function(a,b,c,d){if(c||(c=0),n=(""+a).split(""),o=(""+b).split(""),p=o.slice(),p.reverse(),n.length===o.length)for(var e=0,f=n.length;f>e;e+=1){if(!(n[e]===o[e]&&p.length>c)){if(c&&d&&3===p.length){var g=n.slice(0,e);g.reverse(),p=p.concat(g)}break}p.pop()}return p.reverse(),p.join("")},k=function(a){for(e=a.length,d=1;e>d;d+=2)"object"==typeof a[d]&&(m=a[d],q=parseInt(m[1],10),r=parseInt(m[3],10),q>100&&q%100&&parseInt(q/100,10)===parseInt(r/100,10)?m[3]=""+r%100:q>=1e4&&(m[3]=""+r%1e3)),m[2].slice(1)===m[0]&&(m[2]=v);return f(a)};var w=function(a,b,c,d){var e;a=""+a;var f=h(a),e=b(f,c,d);return e};return a.opt[b+"-range-format"]?"expanded"===a.opt[b+"-range-format"]?s=function(a){return w(a,f)}:"minimal"===a.opt[b+"-range-format"]?s=function(a){return w(a,i)}:"minimal-two"===a.opt[b+"-range-format"]?s=function(a,b){return w(a,i,2,b)}:"chicago"===a.opt[b+"-range-format"]&&(s=function(a){return w(a,k)}):s=function(a){return a},s},CSL.Util.FlipFlopper=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;for(this.state=a,this.blob=!1,this.quotechars=['"',"'"],b=[["<i>","</i>","italics","@font-style",["italic","normal","normal"],!0],["<b>","</b>","bold","@font-weight",["bold","normal","normal"],!0],["<sup>","</sup>","superscript","@vertical-align",["sup","sup","baseline"],!0],["<sub>","</sub>","subscript","@vertical-align",["sub","sub","baseline"],!0],["<sc>","</sc>","smallcaps","@font-variant",["small-caps","small-caps","normal"],!0],['<span style="font-variant:small-caps;">',"</span>","smallcaps","@font-variant",["small-caps","normal","normal"],!0],['<span class="nocase">',"</span>","passthrough","@passthrough",["true","true","true"],!0],['<span class="nodecor">',"</span>","passthrough","@passthrough",["true","true","true"],!0],['"','"',"quotes","@quotes",["true","inner","true"],"'"],[" '","'","quotes","@quotes",["inner","true","true"],'"']],c=0;2>c;c+=1){e=["-","-inner-"][c],f=[];var t=a.getTerm("open"+e+"quote");f.push(t),this.quotechars.push(t);var u=a.getTerm("close"+e+"quote");f.push(u),this.quotechars.push(u),f.push("quotes"),f.push("@quotes"),"-"===e?f.push(["true","inner"]):f.push(["inner","true"]),f.push(!0),"-"===e?f.push(a.getTerm("close-inner-quote")):f.push(a.getTerm("close-quote")),b.push(f)}for(g=function(a){for(h=[],d=a.length,c=0;d>c;c+=1)i=a[c],-1===h.indexOf(i[0])&&(j="",["(",")","[","]"].indexOf(i[0])>-1&&(j="\\"),h.push(j+i[0])),-1===h.indexOf(i[1])&&(j="",["(",")","[","]"].indexOf(i[1])>-1&&(j="\\"),h.push(j+i[1]));return h},r=g(b),s=[],c=0,d=r.length;d>c;c+=1)r[c]&&s.push(r[c]);r=s.slice(),this.allTagsRexMatch=new RegExp("("+r.join("|")+")","g"),this.allTagsRexSplit=new RegExp("(?:"+r.join("|")+")"),k=function(a){for(l={},m={},n={},o={},p={},d=a.length,c=0;d>c;c+=1)l[a[c][1]]=!0,m[a[c][1]]=a[c][5],n[a[c][0]]=a[c][1],o[a[c][0]]=[a[c][3],a[c][4]],p[a[c][3]]=[a[c][3],[a[c][4][2],a[c][1]]];return[l,m,n,o,p]},q=k(b),this.closeTagsHash=q[0],this.flipTagsHash=q[1],this.openToCloseHash=q[2],this.openToDecorations=q[3],this.okReverseHash=q[4]},CSL.Util.FlipFlopper.prototype.init=function(a,b){this.txt_esc=CSL.getSafeEscape(this.state),b?(this.blob=b,this.strs=this.getSplitStrings(this.blob.blobs),this.blob.blobs=[]):(this.strs=this.getSplitStrings(a),this.blob=new CSL.Blob),this.blobstack=new CSL.Stack(this.blob)
},CSL.Util.FlipFlopper.prototype._normalizeString=function(a){var b,c;if(a=a.replace(/\s+'\s+/g," \u2019 "),a.indexOf(this.quotechars[0])>-1)for(b=0,c=2;c>b;b+=1)this.quotechars[b+2]&&(a=a.replace(this.quotechars[b+2],this.quotechars[0]));if(a.indexOf(this.quotechars[1])>-1)for(b=0,c=2;c>b;b+=1)this.quotechars[b+4]&&(a=0===b?a.replace(this.quotechars[b+4]," "+this.quotechars[1]):a.replace(this.quotechars[b+4],this.quotechars[1]));return a},CSL.Util.FlipFlopper.prototype.getSplitStrings=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D;for(a=this._normalizeString(a),C=a.match(this.allTagsRexMatch),b=a.split(this.allTagsRexSplit),D=[b[0]],c=1,d=b.length;d>c;c+=1)D.push(C[c-1]),D.push(b[c]);for(b=D.slice(),d=b.length-2,c=d;c>0;c+=-2)"\\"===b[c-1].slice(b[c-1].length-1)&&(e=b[c-1].slice(0,b[c-1].length-1)+b[c]+b[c+1],f=b.slice(0,c-1),g=b.slice(c+2),f.push(e),b=f.concat(g));for(h=[],i=[],j=[],k=[],l=[],y=b.length-1,m=1;y>m;m+=2)if(q=b[m],this.closeTagsHash[q]&&(h.reverse(),n=this.openToCloseHash[q],o=h.indexOf(q),p=j.indexOf(q),h.reverse(),!n||o>-1&&(p>o||-1===p))){for(r=!1,z=h.length-1,s=z;s>-1;s+=-1){if(r=!0,t=h[s],q===t){h.pop(),i.pop(),j.pop(),k.pop();break}l.push(m)}r||l.push(m)}else this.openToCloseHash[q]&&(h.push(this.openToCloseHash[q]),i.push(q),j.push(this.flipTagsHash[q]),k.push(m));for(A=h.length-1,u=A;u>-1;u+=-1)h.pop(),j.pop(),i.pop(),l.push(k.pop());for(l.sort(function(a,b){return b>a?1:a>b?-1:0}),d=l.length,c=0;d>c;c+=1)B=l[c],f=b.slice(0,B-1),g=b.slice(B+2),v=b[B],v.length&&"<"!==v[0]&&this.openToDecorations[v]&&-1===this.quotechars.indexOf(v.replace(/\s+/g,""))&&(x=this.openToDecorations[v],v=this.state.fun.decorate[x[0]][x[1][0]](this.state)),w=b[B-1]+v+b[B+1],f.push(w),b=f.concat(g);for(d=b.length,c=0;d>c;c+=2)b[c]=b[c].replace("'","\u2019","g"),b[c]=b[c].replace("  \u2019"," \u2019","g");return b},CSL.Util.FlipFlopper.prototype.processTags=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;if(a=[],b=[],c=[],d=[],e="",1===this.strs.length)this.blob.blobs=this.strs[0];else if(this.strs.length>2){for(u=this.strs.length-1,f=1;u>f;f+=2)if(g=this.strs[f],h=this.strs[f-1],h&&(i=new CSL.Blob(h),j=this.blobstack.value(),j.push(i)),this.closeTagsHash[g]&&(a.reverse(),k=this.openToCloseHash[g],l=a.indexOf(g),m=c.indexOf(g),a.reverse(),!k||l>-1&&(m>l||-1===m))){for(v=a.length,n=v;n>-1;n+=-1)if(o=a[n],g===o){a.pop(),b.pop(),c.pop(),d.pop(),this.blobstack.pop();break}}else if(this.openToCloseHash[g]){if(a.push(this.openToCloseHash[g]),b.push(g),c.push(this.flipTagsHash[g]),j=this.blobstack.value(),p=new CSL.Blob,j.push(p),q=this.addFlipFlop(p,this.openToDecorations[g]),'<span class="nodecor">'===g)for(r=this.state[this.state.tmp.area].opt.topdecor.concat(this.blob.alldecor).concat([[["@quotes","inner"]]]),v=r.length,n=0;v>n;n+=1)for(s=r[n],x=s.length,w=0;x>w;w+=1)t=s[w],["@font-style","@font-weight","@font-variant"].indexOf(t[0])>-1&&(q=this.addFlipFlop(p,this.okReverseHash[t[0]]));d.push(this.state.fun.decorate[q[0]][q[1]](this.state)),this.blobstack.push(p)}this.strs.length>2&&(e=this.strs[this.strs.length-1],e&&(j=this.blobstack.value(),i=new CSL.Blob(e),j.push(i)))}return this.blob},CSL.Util.FlipFlopper.prototype.addFlipFlop=function(a,b){var c,d,e,f,g,h,i,j,k,l;for(d=0,e=this.state[this.state.tmp.area].opt.topdecor.concat(a.alldecor).concat([[["@quotes","inner"]]]),f=e.length,c=0;f>c;c+=1){for(g=e[c],h=!1,l=g.length-1,j=l;j>-1;j+=-1)if(i=g[j],i[0]===b[0]){i[1]===b[1][0]&&(d=1),h=!0;break}if(h)break}return k=[b[0],b[1][d]],a.decorations.reverse(),a.decorations.push(k),a.decorations.reverse(),k},CSL.Output.Formatters={},CSL.getSafeEscape=function(a){if(["bibliography","citation"].indexOf(a.tmp.area)>-1){var b=[];return a.opt.development_extensions.thin_non_breaking_space_html_hack&&"html"===a.opt.mode&&b.push(function(a){return a.replace(/\u202f/g,'<span style="white-space:nowrap">&thinsp;</span>')}),b.length?function(c){for(var d=0,e=b.length;e>d;d+=1)c=b[d](c);return CSL.Output.Formats[a.opt.mode].text_escape(c)}:CSL.Output.Formats[a.opt.mode].text_escape}return function(a){return a}},CSL.Output.Formatters.passthrough=function(a,b){return b},CSL.Output.Formatters.lowercase=function(a,b){var c=CSL.Output.Formatters.doppelString(b,CSL.TAG_USEALL);return c.string=c.string.toLowerCase(),CSL.Output.Formatters.undoppelString(c)},CSL.Output.Formatters.uppercase=function(a,b){var c=CSL.Output.Formatters.doppelString(b,CSL.TAG_USEALL);return c.string=c.string.toUpperCase(),CSL.Output.Formatters.undoppelString(c)},CSL.Output.Formatters["capitalize-first"]=function(a,b){var c=CSL.Output.Formatters.doppelString(b,CSL.TAG_ESCAPE);return c.string.length?(c.string=c.string.slice(0,1).toUpperCase()+c.string.substr(1),CSL.Output.Formatters.undoppelString(c)):""},CSL.Output.Formatters.sentence=function(a,b){var c=CSL.Output.Formatters.doppelString(b,CSL.TAG_ESCAPE);return c.string=c.string.slice(0,1).toUpperCase()+c.string.substr(1).toLowerCase(),CSL.Output.Formatters.undoppelString(c)},CSL.Output.Formatters["capitalize-all"]=function(a,b){for(var c=CSL.Output.Formatters.doppelString(b,CSL.TAG_ESCAPE),d=c.string.split(" "),e=0,f=d.length;f>e;e+=1)d[e].length>1?d[e]=a.opt.development_extensions.allow_force_lowercase?d[e].slice(0,1).toUpperCase()+d[e].substr(1).toLowerCase():d[e].slice(0,1).toUpperCase()+d[e].substr(1):1===d[e].length&&(d[e]=d[e].toUpperCase());return c.string=d.join(" "),CSL.Output.Formatters.undoppelString(c)},CSL.Output.Formatters.title=function(a,b){function z(a){var b=a.match(/([:?!]+\s+|-|^)(.)(.*)/);return b?b[1]+b[2].toUpperCase()+b[3]:a}var c,d,i,j,v;if(a.locale[a.opt.lang].opts["skip-words"],!b)return"";var y=CSL.Output.Formatters.doppelString(b,CSL.TAG_ESCAPE),c=y.string,v=c.split(a.locale[a.opt.lang].opts["skip-words-regexp"]);for(A=1,B=v.length;B>A;A+=2)v[A].match(/^[:?!]/)&&(v[A]=z(v[A]));v[0]||(v[1]=z(v[1])),v.length>2&&!v[v.length-1]&&(v[v.length-2]=z(v[v.length-2]));for(var A=0,B=v.length;B>A;A+=2){for(var d=v[A].split(/([:?!]*\s+|-)/),C=0,D=d.length;D>C;C+=2)if(0!==d[C].length){if(i=d[C].toUpperCase(),j=d[C].toLowerCase(),d[C].match(/[0-9]/))continue;d[C]===j&&(d[C]=z(d[C]))}v[A]=d.join("")}y.string=v.join("");var E=CSL.Output.Formatters.undoppelString(y);return E},CSL.Output.Formatters.doppelString=function(a,b){var c;c={},c.array=b(a),c.string="";for(var f=0,g=c.array.length;g>f;f+=2)c.string+=c.array[f];return c},CSL.Output.Formatters.undoppelString=function(a){var b;b="";for(var e=0,f=a.array.length;f>e;e+=1)e%2?b+=a.array[e]:(b+=a.string.slice(0,a.array[e].length),a.string=a.string.slice(a.array[e].length));return b},CSL.Output.Formatters.serializeItemAsRdf=function(){return""},CSL.Output.Formatters.serializeItemAsRdfA=function(){return""},CSL.demoteNoiseWords=function(a,b,c){var d=a.locale[a.opt.lang].opts["leading-noise-words"];if(b&&c){b=b.split(/\s+/),b.reverse();for(var e=[],f=b.length-1;f>-1&&d.indexOf(b[f].toLowerCase())>-1;f+=-1)e.push(b.pop());b.reverse();var g=b.join(" "),h=e.join(" ");"drop"!==c&&h?"demote"===c&&(b=[g,h].join(", ")):b=g}return b},CSL.Output.Formats=function(){},CSL.Output.Formats.prototype.html={text_escape:function(a){return a||(a=""),a.replace(/&/g,"&#38;").replace(/</g,"&#60;").replace(/>/g,"&#62;").replace("  ","&#160; ","g").replace(CSL.SUPERSCRIPTS_REGEXP,function(a){return"<sup>"+CSL.SUPERSCRIPTS[a]+"</sup>"})},bibstart:'<div class="csl-bib-body">\n',bibend:"</div>","@font-style/italic":"<i>%%STRING%%</i>","@font-style/oblique":"<em>%%STRING%%</em>","@font-style/normal":'<span style="font-style:normal;">%%STRING%%</span>',"@font-variant/small-caps":'<span style="font-variant:small-caps;">%%STRING%%</span>',"@passthrough/true":CSL.Output.Formatters.passthrough,"@font-variant/normal":'<span style="font-variant:normal;">%%STRING%%</span>',"@font-weight/bold":"<b>%%STRING%%</b>","@font-weight/normal":'<span style="font-weight:normal;">%%STRING%%</span>',"@font-weight/light":!1,"@text-decoration/none":'<span style="text-decoration:none;">%%STRING%%</span>',"@text-decoration/underline":'<span style="text-decoration:underline;">%%STRING%%</span>',"@vertical-align/sup":"<sup>%%STRING%%</sup>","@vertical-align/sub":"<sub>%%STRING%%</sub>","@vertical-align/baseline":'<span style="baseline">%%STRING%%</span>',"@strip-periods/true":CSL.Output.Formatters.passthrough,"@strip-periods/false":CSL.Output.Formatters.passthrough,"@quotes/true":function(a,b){return"undefined"==typeof b?a.getTerm("open-quote"):a.getTerm("open-quote")+b+a.getTerm("close-quote")},"@quotes/inner":function(a,b){return"undefined"==typeof b?"\u2019":a.getTerm("open-inner-quote")+b+a.getTerm("close-inner-quote")},"@quotes/false":!1,"@cite/entry":function(a,b){return a.sys.wrapCitationEntry(b,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(a,b){var c="";return a.sys.embedBibliographyEntry&&(c=a.sys.embedBibliographyEntry(this.item_id)+"\n"),'  <div class="csl-entry">'+b+"</div>\n"+c},"@display/block":function(a,b){return'\n\n    <div class="csl-block">'+b+"</div>\n"},"@display/left-margin":function(a,b){return'\n    <div class="csl-left-margin">'+b+"</div>"},"@display/right-inline":function(a,b){return'<div class="csl-right-inline">'+b+"</div>\n  "},"@display/indent":function(a,b){return'<div class="csl-indent">'+b+"</div>\n  "},"@showid/true":function(a,b,c){if(a.tmp.just_looking||a.tmp.suppress_decorations)return b;if(c)return'<span class="'+a.opt.nodenames[c]+'" cslid="'+c+'">'+b+"</span>";if("string"==typeof b){var d="";if(b){var e=b.match(CSL.VARIABLE_WRAPPER_PREPUNCT_REX);d=e[1],b=e[2]}var f="";return b&&CSL.SWAPPING_PUNCTUATION.indexOf(b.slice(-1))>-1&&(f=b.slice(-1),b=b.slice(0,-1)),a.sys.variableWrapper(this.params,d,b,f)}return b},"@URL/true":function(a,b){return'<a href="'+b+'">'+b+"</a>"},"@DOI/true":function(a,b){return'<a href="http://dx.doi.org/'+b+'">'+b+"</a>"}},CSL.Output.Formats.prototype.text={text_escape:function(a){return a||(a=""),a},bibstart:"",bibend:"","@font-style/italic":!1,"@font-style/oblique":!1,"@font-style/normal":!1,"@font-variant/small-caps":!1,"@passthrough/true":CSL.Output.Formatters.passthrough,"@font-variant/normal":!1,"@font-weight/bold":!1,"@font-weight/normal":!1,"@font-weight/light":!1,"@text-decoration/none":!1,"@text-decoration/underline":!1,"@vertical-align/baseline":!1,"@vertical-align/sup":!1,"@vertical-align/sub":!1,"@strip-periods/true":CSL.Output.Formatters.passthrough,"@strip-periods/false":CSL.Output.Formatters.passthrough,"@quotes/true":function(a,b){return"undefined"==typeof b?a.getTerm("open-quote"):a.getTerm("open-quote")+b+a.getTerm("close-quote")},"@quotes/inner":function(a,b){return"undefined"==typeof b?"\u2019":a.getTerm("open-inner-quote")+b+a.getTerm("close-inner-quote")},"@quotes/false":!1,"@cite/entry":function(a,b){return a.sys.wrapCitationEntry(b,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(a,b){return b+"\n"},"@display/block":function(a,b){return"\n"+b},"@display/left-margin":function(a,b){return b},"@display/right-inline":function(a,b){return b},"@display/indent":function(a,b){return"\n    "+b},"@showid/true":function(a,b){return b},"@URL/true":function(a,b){return b},"@DOI/true":function(a,b){return b}},CSL.Output.Formats.prototype.rtf={text_escape:function(a){return a||(a=""),a.replace(/([\\{}])/g,"\\$1","g").replace(CSL.SUPERSCRIPTS_REGEXP,function(a){return"\\super "+CSL.SUPERSCRIPTS[a]+"\\nosupersub{}"}).replace(/[\u007F-\uFFFF]/g,function(a){return"\\uc0\\u"+a.charCodeAt(0).toString()+"{}"}).replace("	","\\tab{}","g")},"@passthrough/true":CSL.Output.Formatters.passthrough,"@font-style/italic":"\\i %%STRING%%\\i0{}","@font-style/normal":"\\i0{}%%STRING%%\\i{}","@font-style/oblique":"\\i %%STRING%%\\i0{}","@font-variant/small-caps":"\\scaps %%STRING%%\\scaps0{}","@font-variant/normal":"\\scaps0{}%%STRING%%\\scaps{}","@font-weight/bold":"\\b %%STRING%%\\b0{}","@font-weight/normal":"\\b0{}%%STRING%%\\b{}","@font-weight/light":!1,"@text-decoration/none":!1,"@text-decoration/underline":"\\ul %%STRING%%\\ul0{}","@vertical-align/baseline":!1,"@vertical-align/sup":"\\super %%STRING%%\\nosupersub{}","@vertical-align/sub":"\\sub %%STRING%%\\nosupersub{}","@strip-periods/true":CSL.Output.Formatters.passthrough,"@strip-periods/false":CSL.Output.Formatters.passthrough,"@quotes/true":function(a,b){return"undefined"==typeof b?CSL.Output.Formats.rtf.text_escape(a.getTerm("open-quote")):CSL.Output.Formats.rtf.text_escape(a.getTerm("open-quote"))+b+CSL.Output.Formats.rtf.text_escape(a.getTerm("close-quote"))},"@quotes/inner":function(a,b){return"undefined"==typeof b?CSL.Output.Formats.rtf.text_escape("\u2019"):CSL.Output.Formats.rtf.text_escape(a.getTerm("open-inner-quote"))+b+CSL.Output.Formats.rtf.text_escape(a.getTerm("close-inner-quote"))},"@quotes/false":!1,bibstart:"{\\rtf ",bibend:"}","@display/block":"\\line{}%%STRING%%\\line\r\n","@cite/entry":function(a,b){return b},"@cite/entry":function(a,b){return a.sys.wrapCitationEntry(b,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(a,b){return b},"@display/left-margin":function(a,b){return b+"\\tab "},"@display/right-inline":function(a,b){return b+"\\line\r\n"},"@display/indent":function(a,b){return"\n\\tab "+b+"\\line\r\n"},"@showid/true":function(a,b){if(a.tmp.just_looking||a.tmp.suppress_decorations)return b;var d="";if(b){var e=b.match(CSL.VARIABLE_WRAPPER_PREPUNCT_REX);d=e[1],b=e[2]}var f="";return b&&CSL.SWAPPING_PUNCTUATION.indexOf(b.slice(-1))>-1&&(f=b.slice(-1),b=b.slice(0,-1)),a.sys.variableWrapper(this.params,d,b,f)},"@URL/true":function(a,b){return b},"@DOI/true":function(a,b){return b}},CSL.Output.Formats=new CSL.Output.Formats,CSL.Registry=function(a){var d,e,f;this.debug=!1,this.state=a,this.registry={},this.reflist=[],this.namereg=new CSL.Registry.NameReg(a),this.citationreg=new CSL.Registry.CitationReg(a),this.authorstrings={},this.mylist=[],this.myhash={},this.deletes=[],this.inserts=[],this.uncited={},this.refreshes={},this.akeys={},this.oldseq={},this.return_data={},this.ambigcites={},this.ambigresets={},this.sorter=new CSL.Registry.Comparifier(a,"bibliography_sort"),this.getSortedIds=function(){for(d=[],e=0,f=this.reflist.length;f>e;e+=1)d.push(""+this.reflist[e].id);return d},this.getSortedRegistryItems=function(){for(d=[],e=0,f=this.reflist.length;f>e;e+=1)d.push(this.reflist[e]);return d}},CSL.Registry.prototype.init=function(a,b){var c,d;if(this.oldseq={},b){this.uncited={};for(var c=0,d=a.length;d>c;c+=1)this.myhash[a[c]]||this.mylist.push(""+a[c]),this.uncited[a[c]]=!0,this.myhash[a[c]]=!0}else{for(var e in this.uncited)a.push(e);var f={};for(c=a.length-1;c>-1;c+=-1)f[a[c]]?a=a.slice(0,c).concat(a.slice(c+1)):f[a[c]]=!0;this.mylist=[];for(var c=0,d=a.length;d>c;c+=1)this.mylist.push(""+a[c]);this.myhash=f}this.refreshes={},this.touched={},this.ambigsTouched={},this.ambigresets={}},CSL.Registry.prototype.dopurge=function(a){for(var b=this.mylist.length-1;b>-1;b+=-1)this.citationreg.citationsByItemId&&(this.citationreg.citationsByItemId[this.mylist[b]]||a[this.mylist[b]]||(delete this.myhash[this.mylist[b]],this.mylist=this.mylist.slice(0,b).concat(this.mylist.slice(b+1))));this.dodeletes(this.myhash)},CSL.Registry.prototype.dodeletes=function(a){var b,c,d,e,f,g,h,i,j;"string"==typeof a&&(a={},a[a]=!0);for(c in this.registry)if(!a[c]){if(this.uncited[c])continue;b=this.namereg.delitems(c);for(h in b)this.refreshes[h]=!0;for(d=this.registry[c].ambig,i=this.ambigcites[d].indexOf(c),i>-1&&(g=this.ambigcites[d].slice(),this.ambigcites[d]=g.slice(0,i).concat(g.slice(i+1,g.length)),this.ambigresets[d]=this.ambigcites[d].length),f=this.ambigcites[d].length,e=0;f>e;e+=1)j=""+this.ambigcites[d][e],this.refreshes[j]=!0;if(this.registry[c].siblings)if(1==this.registry[c].siblings.length){var k=this.registry[c].siblings[0];this.registry[k].master=!0,this.registry[k].siblings.pop(),this.registry[k].parallel=!1}else if(this.registry[c].siblings.length>1){var l=[c];if(this.registry[c].master){var m=this.registry[c].siblings[0],n=this.registry[m];n.master=!0,n.parallel=!1,l.push(m);for(var o=0,p=this.registry[c].siblings.length;p>o;o+=1)this.registry[this.registry[c].siblings[o]].parallel=m}for(var q=[],o=this.registry[c].siblings.length-1;o>-1;o+=-1){var r=this.registry[c].siblings.pop();-1===l.indexOf(r)&&q.push(r)}for(var o=q.length-1;o>-1;o+=-1)this.registry[c].siblings.push(q[o])}delete this.registry[c],this.return_data.bibchange=!0}},CSL.Registry.prototype.doinserts=function(a){var d,e,f,g,h,m,n;for("string"==typeof a&&(a=[a]),m=0,n=a.length;n>m;m+=1)d=a[m],this.registry[d]||(e=this.state.retrieveItem(d),f=CSL.getAmbiguousCite.call(this.state,e),this.ambigsTouched[f]=!0,e.legislation_id||(this.akeys[f]=!0),g={id:""+d,seq:0,offset:0,sortkeys:!1,ambig:!1,rendered:!1,disambig:!1,ref:e},this.registry[d]=g,this.citationreg.citationsByItemId&&this.citationreg.citationsByItemId[d]&&(this.registry[d]["first-reference-note-number"]=this.citationreg.citationsByItemId[d][0].properties.noteIndex),h=CSL.getAmbigConfig.call(this.state),this.registerAmbigToken(f,d,h),this.touched[d]=!0,this.return_data.bibchange=!0)},CSL.Registry.prototype.rebuildlist=function(){var b,c,d;for(this.reflist=[],this.state.opt.citation_number_sort_direction===CSL.DESCENDING&&this.state.opt.citation_number_sort_used,b=this.mylist.length,c=0;b>c;c+=1)d=this.mylist[c],this.reflist.push(this.registry[d]),this.oldseq[d]=this.registry[d].seq,this.registry[d].seq=c+1;this.state.opt.citation_number_sort_direction===CSL.DESCENDING&&this.state.opt.citation_number_sort_used},CSL.Registry.prototype.dorefreshes=function(){var a,b,c,e,f;for(a in this.refreshes)if(b=this.registry[a]){b.sortkeys=void 0,c=this.state.retrieveItem(a);var e=b.ambig;"undefined"==typeof e&&(this.state.tmp.disambig_settings=!1,e=CSL.getAmbiguousCite.call(this.state,c),f=CSL.getAmbigConfig.call(this.state),this.registerAmbigToken(e,a,f));for(var g in this.ambigresets)if(1===this.ambigresets[g]){var h=this.ambigcites[e][0],c=this.state.retrieveItem(h);this.registry[h].disambig=new CSL.AmbigConfig,this.state.tmp.disambig_settings=!1;var e=CSL.getAmbiguousCite.call(this.state,c),f=CSL.getAmbigConfig.call(this.state);this.registerAmbigToken(e,h,f)}this.state.tmp.taintedItemIDs[a]=!0,this.ambigsTouched[e]=!0,c.legislation_id||(this.akeys[e]=!0),this.touched[a]=!0}},CSL.Registry.prototype.setdisambigs=function(){var a;this.leftovers=[];for(a in this.ambigsTouched)this.state.disambiguate.run(a);this.ambigsTouched={},this.akeys={}},CSL.Registry.prototype.renumber=function(){var a,b,c;for(this.state.opt.citation_number_sort_direction===CSL.DESCENDING&&this.state.opt.citation_number_sort_used,a=this.reflist.length,b=0;a>b;b+=1)c=this.reflist[b],c.seq=b+1,this.state.opt.update_mode===CSL.NUMERIC&&c.seq!=this.oldseq[c.id]&&(this.state.tmp.taintedItemIDs[c.id]=!0),this.state.opt.bib_mode===CSL.NUMERIC&&c.seq!=this.oldseq[c.id]&&(this.return_data.bibchange=!0);this.state.opt.citation_number_sort_direction===CSL.DESCENDING&&this.state.opt.citation_number_sort_used&&this.reflist.reverse()},CSL.Registry.prototype.setsortkeys=function(){for(var a,b=0,c=this.mylist.length;c>b;b+=1){var a=this.mylist[b];(this.touched[a]||this.state.tmp.taintedItemIDs[a]||!this.registry[a].sortkeys)&&(this.registry[a].sortkeys=CSL.getSortKeys.call(this.state,this.state.retrieveItem(a),"bibliography_sort"))}},CSL.Registry.prototype.sorttokens=function(){this.reflist.sort(this.sorter.compareKeys)},CSL.Registry.Comparifier=function(a,b){var c,d,e,f,g=CSL.getSortCompare(a.opt["default-locale-sort"]);c=a[b].opt.sort_directions,this.compareKeys=function(a,b){for(d=a.sortkeys?a.sortkeys.length:0,e=0;d>e;e+=1){var f=0;if(f=a.sortkeys[e]===b.sortkeys[e]?0:"undefined"==typeof a.sortkeys[e]?c[e][1]:"undefined"==typeof b.sortkeys[e]?c[e][0]:g(a.sortkeys[e],b.sortkeys[e]),f>0)return c[e][1];if(0>f)return c[e][0]}return a.seq>b.seq?1:a.seq<b.seq?-1:0},f=this.compareKeys,this.compareCompositeKeys=function(a,b){return f(a[1],b[1])}},CSL.Registry.prototype.compareRegistryTokens=function(a,b){return a.seq>b.seq?1:a.seq<b.seq?-1:0},CSL.Registry.prototype.registerAmbigToken=function(a,b,c){if(this.registry[b]&&this.registry[b].disambig&&this.registry[b].disambig.names)for(var d=0,e=c.names.length;e>d;d+=1){var f=c.names[d],g=this.registry[b].disambig.names[d];if(f!==g)this.state.tmp.taintedItemIDs[b]=!0;else if(c.givens[d])for(var h=0,i=c.givens[d].length;i>h;h+=1){var j=c.givens[d][h],k=this.registry[b].disambig.givens[d][h];j!==k&&(this.state.tmp.taintedItemIDs[b]=!0)}}this.ambigcites[a]||(this.ambigcites[a]=[]),-1===this.ambigcites[a].indexOf(""+b)&&this.ambigcites[a].push(""+b),this.registry[b].ambig=a,this.registry[b].disambig=CSL.cloneAmbigConfig(c)},CSL.getSortKeys=function(a,b){var c,d,e,f,g,h;for(c=this.tmp.area,d=this.tmp.extension,e=CSL.Util.Sort.strip_prepositions,this.tmp.area=b,this.tmp.extension="_sort",this.tmp.disambig_override=!0,this.tmp.disambig_request=!1,f=this.parallel.use_parallels,this.parallel.use_parallels=!1,this.tmp.suppress_decorations=!0,CSL.getCite.call(this,a),this.tmp.suppress_decorations=!1,this.parallel.use_parallels=f,this.tmp.disambig_override=!1,g=this[b].keys.length,h=0;g>h;h+=1)this[b].keys[h]=e(this[b].keys[h]);return this.tmp.area=c,this.tmp.extension=d,this[b].keys},CSL.Registry.NameReg=function(a){var b,c,d,g,h,i,k,l,m,n,o,p,q,r,s,t;this.state=a,this.namereg={},this.nameind={},this.nameindpkeys={},this.itemkeyreg={},l=function(a){return a||(a=""),a.replace("."," ","g").replace(/\s+/g," ").replace(/\s+$/,"")},m=function(a,e,f){b=l(f.family),d=l(f.given);var g=d.match(/[,\!]* ([^,]+)$/);g&&g[1]===g[1].toLowerCase()&&(d=d.replace(/[,\!]* [^,]+$/,"")),c=CSL.Util.Names.initializeWith(a,d,"%s"),"by-cite"===a.citation.opt["givenname-disambiguation-rule"]&&(b=""+e+b)},n=function(d,e,f,i,j,k){var p;if("bibliography"===a.tmp.area.slice(0,12)&&!j)return"string"==typeof k?1:2;var q=a.nameOutput.getName(e,"locale-translit",!0);e=q.name,m(this.state,""+d,e),p=2,g=a.opt["disambiguate-add-givenname"],h=a.citation.opt["givenname-disambiguation-rule"];var r=h;return"by-cite"===h&&(h="all-names"),"short"===j?p=0:"string"==typeof k&&(p=1),"undefined"==typeof this.namereg[b]||"undefined"==typeof this.namereg[b].ikey[c]?p:"by-cite"===r&&i>=p?i:g?"string"==typeof h&&"primary-name"===h.slice(0,12)&&f>0?p:(h&&"all-names"!==h&&"primary-name"!==h?("all-names-with-initials"===h||"primary-name-with-initials"===h)&&(p=this.namereg[b].count>1?1:0):(this.namereg[b].count>1&&(p=1),(this.namereg[b].ikey&&this.namereg[b].ikey[c].count>1||this.namereg[b].count>1&&"string"!=typeof k)&&(p=2)),a.registry.registry[d]?p:"short"==j?0:"string"==typeof k?1:void 0):p},o=function(e){var g,h,l,m,n;for(("string"==typeof e||"number"==typeof e)&&(e=[""+e]),i={},h=e.length,g=0;h>g;g+=1)if(m=""+e[g],this.nameind[m]){for(n in this.nameind[m])if(this.nameind[m].hasOwnProperty(n)){if(q=n.split("::"),b=q[0],c=q[1],d=q[2],"undefined"==typeof this.namereg[b])continue;if(k=this.namereg[b].items,d&&this.namereg[b].ikey[c]&&this.namereg[b].ikey[c].skey[d]&&(r=this.namereg[b].ikey[c].skey[d].items,l=r.indexOf(""+m),l>-1&&(this.namereg[b].ikey[c].skey[d].items=r.slice(0,l).concat(r.slice([l+1]))),0===this.namereg[b].ikey[c].skey[d].items.length&&(delete this.namereg[b].ikey[c].skey[d],this.namereg[b].ikey[c].count+=-1,this.namereg[b].ikey[c].count<2)))for(s=0,t=this.namereg[b].ikey[c].items.length;t>s;s+=1)a.tmp.taintedItemIDs[this.namereg[b].ikey[c].items[s]]=!0;if(c&&this.namereg[b].ikey[c]&&(l=this.namereg[b].ikey[c].items.indexOf(""+m),l>-1&&(k=this.namereg[b].ikey[c].items.slice(),this.namereg[b].ikey[c].items=k.slice(0,l).concat(k.slice([l+1]))),0===this.namereg[b].ikey[c].items.length&&(delete this.namereg[b].ikey[c],this.namereg[b].count+=-1,this.namereg[b].count<2)))for(s=0,t=this.namereg[b].items.length;t>s;s+=1)a.tmp.taintedItemIDs[this.namereg[b].items[s]]=!0;b&&(l=this.namereg[b].items.indexOf(""+m),l>-1&&(k=this.namereg[b].items.slice(),this.namereg[b].items=k.slice(0,l).concat(k.slice([l+1],k.length))),this.namereg[b].items.length<2&&delete this.namereg[b]),delete this.nameind[m][n]}delete this.nameind[m],delete this.nameindpkeys[m]}return i},p=function(e,f,g){var h,i,j=a.nameOutput.getName(f,"locale-translit",!0);if(f=j.name,!a.citation.opt["givenname-disambiguation-rule"]||"primary-"!==a.citation.opt["givenname-disambiguation-rule"].slice(0,8)||0===g){if(m(this.state,""+e,f),b&&("undefined"==typeof this.namereg[b]?(this.namereg[b]={},this.namereg[b].count=0,this.namereg[b].ikey={},this.namereg[b].items=[e]):-1===this.namereg[b].items.indexOf(e)&&this.namereg[b].items.push(e)),b&&c)if("undefined"==typeof this.namereg[b].ikey[c]){if(this.namereg[b].ikey[c]={},this.namereg[b].ikey[c].count=0,this.namereg[b].ikey[c].skey={},this.namereg[b].ikey[c].items=[e],this.namereg[b].count+=1,2===this.namereg[b].count)for(h=0,i=this.namereg[b].items.length;i>h;h+=1)a.tmp.taintedItemIDs[this.namereg[b].items[h]]=!0}else-1===this.namereg[b].ikey[c].items.indexOf(e)&&this.namereg[b].ikey[c].items.push(e);if(b&&c&&d)if("undefined"==typeof this.namereg[b].ikey[c].skey[d]){if(this.namereg[b].ikey[c].skey[d]={},this.namereg[b].ikey[c].skey[d].items=[e],this.namereg[b].ikey[c].count+=1,2===this.namereg[b].ikey[c].count)for(h=0,i=this.namereg[b].ikey[c].items.length;i>h;h+=1)a.tmp.taintedItemIDs[this.namereg[b].ikey[c].items[h]]=!0}else-1===this.namereg[b].ikey[c].skey[d].items.indexOf(e)&&this.namereg[b].ikey[c].skey[d].items.push(e);"undefined"==typeof this.nameind[e]&&(this.nameind[e]={},this.nameindpkeys[e]={}),b&&(this.nameind[e][b+"::"+c+"::"+d]=!0,this.nameindpkeys[e][b]=this.namereg[b])}},this.addname=p,this.delitems=o,this.evalname=n},CSL.Registry.CitationReg=function(){this.citationById={},this.citationByIndex=[]},CSL.Disambiguation=function(a){this.state=a,this.sys=this.state.sys,this.registry=a.registry.registry,this.ambigcites=a.registry.ambigcites,this.configModes(),this.debug=!1},CSL.Disambiguation.prototype.run=function(a){this.modes.length&&(this.akey=a,this.initVars(a)&&this.runDisambig())},CSL.Disambiguation.prototype.runDisambig=function(){var g;for(this.initGivens=!0;this.lists.length;){for(this.gnameset=0,this.gname=0,this.clashes=[1,0];this.lists[0][1].length;)this.listpos=0,this.base||(this.base=this.lists[0][0]),g=this.incrementDisambig(),this.scanItems(this.lists[0]),this.evalScan(g);this.lists=this.lists.slice(1)}},CSL.Disambiguation.prototype.scanItems=function(a){var b,c,e;this.Item=a[1][0],this.ItemCite=CSL.getAmbiguousCite.call(this.state,this.Item,this.base,!0),this.scanlist=a[1],this.partners=[],this.partners.push(this.Item),this.nonpartners=[];var i=0;for(b=1,c=a[1].length;c>b;b+=1){e=a[1][b];var j=CSL.getAmbiguousCite.call(this.state,e,this.base,!0);this.ItemCite===j?(i+=1,this.partners.push(e)):this.nonpartners.push(e)}this.clashes[0]=this.clashes[1],this.clashes[1]=i},CSL.Disambiguation.prototype.evalScan=function(a){this[this.modes[this.modeindex]](a),a&&(this.modeindex<this.modes.length-1?this.modeindex+=1:this.lists[this.listpos+1]=[this.base,[]])},CSL.Disambiguation.prototype.disNames=function(a){var e,f;if(0===this.clashes[1]&&1===this.nonpartners.length)this.captureStepToBase(),this.state.registry.registerAmbigToken(this.akey,""+this.nonpartners[0].id,this.betterbase),this.state.registry.registerAmbigToken(this.akey,""+this.partners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,[]];else if(0===this.clashes[1])this.captureStepToBase(),this.state.registry.registerAmbigToken(this.akey,""+this.partners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,this.nonpartners],this.nonpartners.length&&(this.initGivens=!0);else if(1===this.nonpartners.length)this.captureStepToBase(),this.state.registry.registerAmbigToken(this.akey,""+this.nonpartners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,this.partners];else if(this.clashes[1]<this.clashes[0])this.captureStepToBase(),this.lists[this.listpos]=[this.betterbase,this.partners],this.lists.push([this.betterbase,this.nonpartners]);else if(a&&(this.lists[this.listpos]=[this.betterbase,this.nonpartners],this.lists.push([this.betterbase,this.partners]),this.modeindex===this.modes.length-1)){for(e=0,f=this.partners.length;f>e;e+=1)this.state.registry.registerAmbigToken(this.akey,""+this.partners[e].id,this.betterbase);this.lists[this.listpos]=[this.betterbase,[]]}},CSL.Disambiguation.prototype.disExtraText=function(){var d=!1;if(0===this.clashes[1]&&this.nonpartners.length<2&&(d=!0),d||this.base.disambiguate&&this.state.tmp.disambiguate_count===this.state.tmp.disambiguate_maxMax){if(d||this.state.tmp.disambiguate_count===this.state.tmp.disambiguate_maxMax)if(d||this.modeindex===this.modes.length-1){for(var g=this.lists[this.listpos][0],e=0,f=this.lists[this.listpos][1].length;f>e;e+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][e].id]=!0,this.state.registry.registerAmbigToken(this.akey,""+this.lists[this.listpos][1][e].id,g);this.lists[this.listpos]=[this.betterbase,[]]}else{this.modeindex=this.modes.length-1;var g=this.lists[this.listpos][0];g.disambiguate=!0;for(var e=0,f=this.lists[this.listpos][1].length;f>e;e+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][e].id]=!0,this.state.registry.registerAmbigToken(this.akey,""+this.lists[this.listpos][1][e].id,g)}}else if(this.modeindex=0,this.base.disambiguate=this.state.tmp.disambiguate_count,this.betterbase.disambiguate=this.state.tmp.disambiguate_count,this.base.disambiguate)this.disNames();else{this.initGivens=!0,this.base.disambiguate=1;for(var e=0,f=this.lists[this.listpos][1].length;f>e;e+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][e].id]=!0}},CSL.Disambiguation.prototype.disYears=function(){var a,b,c,d;c=[];var f=this.lists[this.listpos][0];if(this.clashes[1])for(var g=0,h=this.state.registry.mylist.length;h>g;g+=1)for(var i=this.state.registry.mylist[g],j=0,k=this.lists[this.listpos][1].length;k>j;j+=1){var d=this.lists[this.listpos][1][j];if(d.id==i){c.push(this.registry[d.id]);break}}for(c.sort(this.state.registry.sorter.compareKeys),a=0,b=c.length;b>a;a+=1){f.year_suffix=""+a;var l=this.state.registry.registry[c[a].id].disambig;this.state.registry.registerAmbigToken(this.akey,""+c[a].id,f),CSL.ambigConfigDiff(l,f)&&(this.state.tmp.taintedItemIDs[c[a].id]=!0)}this.lists[this.listpos]=[this.betterbase,[]]},CSL.Disambiguation.prototype.incrementDisambig=function(){if(this.initGivens)return this.initGivens=!1,!1;var b=!1,c=!0;if("disNames"===this.modes[this.modeindex]){c=!1,"number"!=typeof this.givensMax&&(c=!0);var e=!1;"number"!=typeof this.namesMax&&(e=!0),"number"==typeof this.givensMax&&(this.base.givens.length&&this.base.givens[this.gnameset][this.gname]<this.givensMax?this.base.givens[this.gnameset][this.gname]+=1:c=!0),"number"==typeof this.namesMax&&c&&(this.state.opt["disambiguate-add-names"]?(e=!1,this.gname<this.namesMax?(this.base.names[this.gnameset]+=1,this.gname+=1):e=!0):e=!0),"number"==typeof this.namesetsMax&&e&&this.gnameset<this.namesetsMax&&(this.gnameset+=1,this.base.names[this.gnameset]=1,this.gname=0),"number"==typeof this.namesetsMax&&-1!==this.namesetsMax&&this.gnameset!==this.namesetsMax||this.state.opt["disambiguate-add-names"]&&"number"==typeof this.namesMax&&this.gname!==this.namesMax||"number"==typeof this.givensMax&&"undefined"!=typeof this.base.givens[this.gnameset]&&"undefined"!=typeof this.base.givens[this.gnameset][this.gname]&&this.base.givens[this.gnameset][this.gname]!==this.givensMax||(b=!0)}else"disExtraText"===this.modes[this.modeindex]&&(this.base.disambiguate+=1,this.betterbase.disambiguate+=1);return b},CSL.Disambiguation.prototype.initVars=function(a){var b,c,d,e,f;if(this.lists=[],this.base=!1,this.betterbase=!1,this.akey=a,this.maxNamesByItemId={},e=[],d=this.ambigcites[a],!d||!d.length)return!1;var h=this.state.retrieveItem(""+d[0]);if(this.getCiteData(h),this.base=CSL.getAmbigConfig.call(this.state),d&&d.length>1){for(e.push([this.maxNamesByItemId[h.id],h]),b=1,c=d.length;c>b;b+=1)h=this.state.retrieveItem(""+d[b]),this.getCiteData(h,this.base),e.push([this.maxNamesByItemId[h.id],h]);
    for(e.sort(function(a,b){return a[0]>b[0]?1:a[0]<b[0]?-1:a[1].id>b[1].id?1:a[1].id<b[1].id?-1:0}),f=[],b=0,c=e.length;c>b;b+=1)f.push(e[b][1]);this.lists.push([this.base,f]),this.Item=this.lists[0][1][0]}else this.Item=this.state.retrieveItem(""+d[0]);this.modeindex=0;var b,c;return this.namesMax=this.maxNamesByItemId[this.Item.id][0],this.padBase(this.base),this.padBase(this.betterbase),this.base.year_suffix=!1,this.base.disambiguate=!1,this.betterbase.year_suffix=!1,this.betterbase.disambiguate=!1,"by-cite"===this.state.citation.opt["givenname-disambiguation-rule"]&&this.state.opt["disambiguate-add-givenname"]&&(this.givensMax=2),!0},CSL.Disambiguation.prototype.padBase=function(a){for(var b=0,c=a.names.length;c>b;b+=1){a.givens[b]||(a.givens[b]=[]);for(var d=0,e=a.names[b];e>d;d+=1)a.givens[b][d]||(a.givens[b][d]=0)}},CSL.Disambiguation.prototype.configModes=function(){var a,b;this.modes=[],a=this.state.opt["disambiguate-add-givenname"],b=this.state.citation.opt["givenname-disambiguation-rule"],(this.state.opt["disambiguate-add-names"]||a&&"by-cite"===b)&&this.modes.push("disNames"),this.state.opt.has_disambiguate&&this.modes.push("disExtraText"),this.state.opt["disambiguate-add-year-suffix"]&&this.modes.push("disYears")},CSL.Disambiguation.prototype.getCiteData=function(a,b){if(!this.maxNamesByItemId[a.id]){CSL.getAmbiguousCite.call(this.state,a,b),b=CSL.getAmbigConfig.call(this.state),this.maxNamesByItemId[a.id]=CSL.getMaxVals.call(this.state),this.state.registry.registry[a.id].disambig.givens=this.state.tmp.disambig_settings.givens.slice();for(var c=0,d=this.state.registry.registry[a.id].disambig.givens.length;d>c;c+=1)this.state.registry.registry[a.id].disambig.givens[c]=this.state.tmp.disambig_settings.givens[c].slice();this.namesetsMax=this.state.registry.registry[a.id].disambig.names.length-1,this.base||(this.base=b,this.betterbase=CSL.cloneAmbigConfig(b)),b.names.length<this.base.names.length&&(this.base=b);for(var c=0,d=b.names.length;d>c;c+=1)b.names[c]>this.base.names[c]&&(this.base.givens[c]=b.givens[c].slice(),this.base.names[c]=b.names[c],this.betterbase.names=this.base.names.slice(),this.betterbase.givens=this.base.givens.slice(),this.padBase(this.base),this.padBase(this.betterbase));this.betterbase.givens=this.base.givens.slice();for(var f=0,g=this.base.givens.length;g>f;f+=1)this.betterbase.givens[f]=this.base.givens[f].slice()}},CSL.Disambiguation.prototype.captureStepToBase=function(){"by-cite"===this.state.citation.opt["givenname-disambiguation-rule"]&&this.base.givens&&this.base.givens.length&&"undefined"!=typeof this.base.givens[this.gnameset][this.gname]&&(this.betterbase.givens[this.gnameset][this.gname]=this.base.givens[this.gnameset][this.gname]),this.betterbase.names[this.gnameset]=this.base.names[this.gnameset]};