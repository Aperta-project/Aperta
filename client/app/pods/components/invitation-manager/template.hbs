{{#util/async-content concurrencyTask=loadDecisions}}
  {{#with (hash group=(component 'invitation-group'
                        activeInvitation=activeInvitation
                        activeInvitationState=activeInvitationState
                        composedInvitation=composedInvitation
                        owner=task
                        destroyInvite=(action 'destroyInvite')
                        saveInvite=(action 'saveInvite')
                        setRowState=(action 'toggleActiveInvitation')
                        class='active-invitations')
                      ) as |i| }}

    {{#if groupByDecision}}
      {{i.group invitations=draftDecisionInvitations}}
    {{else}}
      {{i.group invitations=persistedInvitations}}
    {{/if}}

    {{#unless isEditingInvitation}}
      <div class="invitation-email-entry">
        {{#auto-suggest endpoint=autoSuggestSourceUrl
                        queryParameter="query"
                        inputId="invitation-recipient"
                        placeholder=placeholder
                        errorMessage=emailErrorMessage
                        parseResponseFunction=parseUserSearchResponse
                        resultText=autoSuggestSelectedText
                        itemSelected="didSelectUser"
                        inputChanged="inputChanged"
                        focusOut="focusOut"
                        itemDisplayTextFunction=displayUserSelected
                        as |user|}}
          {{user.full_name}} &lt;{{user.email}}&gt;
        {{/auto-suggest}}
        {{invitation-due-period
          value=dueIn
          display=(eq inviteeRole "Reviewer")
          onchange=(action "updateReviewDurationPeriod")}}
        <button class="button-secondary button--green invitation-email-entry-button {{if disableButton "button--disabled"}}"
                {{action "createInvitation"}}>
          Add to Queue
        </button>
        {{#if createInvitation.isRunning}}
          <div class="invitation-email-entry-progress animation-fade-in">
            {{progress-spinner visible=true size="small"}}
          </div>
        {{/if}}
      </div>
    {{/unless}}

    {{#if groupByDecision}}
      {{#each sortedPreviousDecisionsWithFilteredInvitations as |decision|}}
        <div class='invitation-revision-round'>
          v{{decision.revisionNumber}} {{humanize decision.verdict}}
        </div>
        {{i.group invitations=decision.filteredInvitations
                  previousRound=true
                  class='expired-invitations'}}
      {{/each}}
    {{/if}}
  {{/with}}
{{else}}
  <h2> Loading invitations... </h2>
  {{progress-spinner visible=true size="large" align="middle"}}
{{/util/async-content}}
