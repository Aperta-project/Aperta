{{partial "task-completed-section"}}

<div>
  {{#each latestVersionPrimaryFailedChecks as |check|}}
    {{flash-message remove=(action "dismissMessage")
                    message=(format-report-error check)}}
  {{/each}}

  {{#unless (or automatedReportsDisabled confirmVisible)}}
    <div class="automated-report-status">
      <div class="messages">
       <p>Automated similarity check is active: This manuscript will be sent to iThenticate on first full submission.</p>
       <p>Manually generating a report below will disable the automated similarity check for this manuscript.</p>
      </div>
    </div>

    <p>Click below to generate a similarity report via iThenticate. If a report was generated for a previous version it can be found in the version history.</p><br>
  {{/unless}}

  {{#if latestVersionHasChecks}}
    <h3>Similarity Check Report</h3>
  {{/if}}

  {{#each sortedChecks as |check|}}
    {{similarity-check check=check}}
  {{/each}}

  {{#if confirmVisible}}
    <div class="confirm-container">

      {{#if automatedReportsDisabled}}
        <h4>Are you sure?</h4>
        <br>
        <button class="button-link button--white" {{action "cancel"}}>cancel</button>
        <button class="button-secondary button--green delete-button" {{action "generateReport"}}>Generate Report</button>
      {{#else }}
        <h4>Manually generating the report will disable the automated similarity check for this manuscript</h4>
        <br>
        <button class="button-link button--white" {{action "cancel"}}>cancel</button>
        <button class="button-secondary button--green delete-button" {{action "generateReport"}}>Generate Report</button>
      {{/if}}
    </div>

  {{else}}
    <button class="button-primary button--green" {{ action "confirmGenerateReport" }}>Generate Report</button>
  {{/if}}

  {{#if task.paper.hasSimilarityChecks }}
    <hr>
    <h3>Report History</h3>
    {{#each task.paper.versionedTexts as |version|}}
      {{#if (and version.hasSimilarityChecks (not version.isDraft))}}
        {{similarity-check-bar version=version}}
      {{/if}}
    {{/each}}
  {{/if}}

</div>
