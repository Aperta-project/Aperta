// Generated by CoffeeScript 1.10.0
import Ember from 'ember';
import { test, moduleFor } from 'ember-qunit';
import startApp from '../helpers/start-app';
moduleFor('controller:admin/journal/index', 'JournalIndexController', {
  beforeEach: function() {
    startApp();
    this.store = getStore();
    this.journal = Ember.Object.create({
      title: 'test journal'
    });
    this.journalWithLogo = Ember.Object.create({
      title: 'test journal with logo',
      logoUrl: 'http://example.com/test.png'
    });
    return Ember.run((function(_this) {
      return function() {
        return _this.controller = _this.subject();
      };
    })(this));
  }
});

test('#destroyMMTemplate does not delete the last MMT', function(assert) {
  Ember.run((function(_this) {
    return function() {
      _this.journal.set('manuscriptManagerTemplates', []);
      _this.controller.set('model', _this.journal);
      _this.mmt = _this.store.createRecord('manuscriptManagerTemplate', {
        paperType: 'research'
      });
      _this.controller.get('model.manuscriptManagerTemplates').addObject(_this.mmt);
      return _this.controller.send('destroyMMTemplate', _this.mmt);
    };
  })(this));
  return assert.equal(this.controller.get('model.manuscriptManagerTemplates.length'), 1);
});

test('#destroyMMTemplate deletes the given MMT when there are more than one MMTs', function(assert) {
  var handler;
  handler = function() {};
  Ember.run((function(_this) {
    return function() {
      _this.mmt = _this.store.createRecord('manuscriptManagerTemplate', {
        paperType: 'research'
      });
      _this.mmt2 = _this.store.createRecord('manuscriptManagerTemplate', {
        paperType: 'hcraeser'
      });
      _this.journal.set('manuscriptManagerTemplates', [_this.mmt, _this.mmt2]);
      return _this.controller.set('model', _this.journal);
    };
  })(this));
  sinon.stub(this.mmt2, 'destroyRecord').returns(new Ember.RSVP.Promise(handler, handler));
  assert.equal(this.controller.get('model.manuscriptManagerTemplates.length'), 2);
  return Ember.run((function(_this) {
    return function() {
      _this.controller.send('destroyMMTemplate', _this.mmt2);
      return assert.ok(_this.mmt2.destroyRecord.called);
    };
  })(this));
});
