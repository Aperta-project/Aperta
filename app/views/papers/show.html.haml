- content_for :control_bar do
  #control-bar-container
    #control-bar
      %section
        %ul
          %li#control-bar-paper-journal-logo
            - if @paper.journal.logo.present?
              = image_tag @paper.journal.logo.url
            - else
              %div
                = @paper.journal.name
          -# %li#control-bar-paper-short-title= @paper.short_title
        %ul
          - if current_user.admin?
            %li= link_to 'Manuscript Manager', manage_paper_path(@paper)

%main
  %article
    %div
      .title
        %h2#paper-title
          = @paper.title

      #paper-abstract
        = @paper.abstract

      - authors_array = @paper.authors.map { |a| a.slice(:first_name, :last_name, :email, :affiliation) }
      #paper-authors{data: { authors: authors_array.to_json }}

      #paper-body
        = @paper.body.html_safe

  %aside
    %div
      - author_tasks = Task.where(role: 'author', phase: @paper.phases.where(name: 'Submission Data').first)
      - assigned_tasks = @tasks - author_tasks
      - unless assigned_tasks.empty?
        %ul.assigned-tasks.cards
          %ul.cards
            - assigned_tasks.each do |task|
              %li= card task

      - task = author_tasks.detect { |t| t.title == 'Upload Manuscript' }
      = card task

      - task = author_tasks.detect { |t| t.title == 'Add Authors' }
      = card task

      - task = author_tasks.detect { |t| t.title == 'Upload Figures' }
      = card task

      - task = author_tasks.detect { |t| t.title == 'Enter Declarations' }
      = card task
