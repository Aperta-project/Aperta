<%= render_ember_app :client do |head, body| %>
  <% head.append do %>
    <%= git_commit_id_meta_tag %>

    <script type='text/javascript'>
      window.appName = "<%= app_name %>"
    </script>
    <title><%= app_name %></title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <%= stylesheet_link_tag "application", media: "all" %>

    <%= csrf_meta_tags %>

    <% if !(Rails.env.test? || Rails.env.development?) %>
      <%= render "shared/bugsnag_javascript" %>
    <% end %>
  <% end %>

  <% body.append do %>
    <% unless Rails.env.test? %>
      <!-- Tag manager immediately after opening body. https://support.google.com/tagmanager/answer/6103696?hl=en -->
      <!-- Google Tag Manager -->
      <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-TP26BH"
      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
      <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-TP26BH');</script>

      <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MQQMGF"
      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
      <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-MQQMGF');</script>
      <!-- End Google Tag Manager -->
    <% end %>
    <script type="text/javascript">
      window.eventStreamConfig = <%= TahiPusher::Config.to_json.html_safe %>;
      <% if current_user %>
        <%# :scope and :scope_name give OrcidAccountSerializer a current_user  %>
        window.currentUserData = <%= CurrentUserSerializer.new(current_user, root: :user, :scope_name => :current_user, :scope => current_user).to_json.html_safe %>;
      <% end %>
      window.pdfviewerPath = "<%= asset_path('pdfviewer.js') %>";
      window.RailsEnv = {};
      window.RailsEnv.orcidConnectEnabled = <%= TahiEnv.orcid_connect_enabled? %>;
      window.RailsEnv.testing = <%= Rails.env.test? %>;
      window.flashMessages = [];
      <% if flash[:notice] %>
        window.flashMessages.push({type: 'success', text: "<%= flash[:notice] %>" });
      <% end %>
    </script>

    <% if Rails.env.test? %>
      <% # disable jquery animations %>
      <%= javascript_tag "$.fx.off = true" %>
    <% end %>

  <% end %>
<% end %>
