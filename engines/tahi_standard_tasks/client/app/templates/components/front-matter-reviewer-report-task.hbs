{{partial "task-completed-section"}}

<div class="task-main-content reviewer-form">
  <div class="reviewer-report-wrapper">
    {{reviewer-report-status report=currentReviewerReport canEditDueDate=(can 'edit_due_date' task)}}
    {{#if (and (can 'manage_scheduled_events' task)
               currentReviewerReport.dueDatetime.scheduledEvents)}}
      {{scheduled-events events=currentReviewerReport.dueDatetime.scheduledEvents
                         dueDate=currentReviewerReport.dueDatetime.dueAt}}
    {{/if}}
    {{#if task.isSubmitted}}
      {{front-matter-reviewer-report-questions report=currentReviewerReport readOnly=noActiveAdminEdit}}
      {{reviewer-report-edit-notes currentReviewerReport=currentReviewerReport}}
    {{else}}
      {{front-matter-reviewer-report-questions report=currentReviewerReport readOnly=isNotEditable}}

      {{#if currentReviewerReport.needsSubmission }}
      <div class="reviewer-report-confirmation">
        {{#if submissionConfirmed}}
          <h4>Once you submit the report, you will no longer be able to edit it. Are you sure?</h4>

          <button class="button-primary button--green" {{action "submitReport"}}>Yes, Iâ€™m sure</button>
          <button class="button-secondary button--green" {{action "cancelSubmission"}}>No</button>
        {{else}}
          <button class="button-primary button--green" {{action "confirmSubmission"}}>Submit this Report</button>
        {{/if}}
      </div>
      {{/if}}
    {{/if}}

    {{#if previousReviewerReports}}
      <hr>

      <h3>Review History</h3>

      <div class="previous-decisions review-history">
        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
          {{#each previousReviewerReports as |report|}}
          <div class="panel panel-default previous-decision">
            <div class="panel-heading" role="tab" id="decision-{{unbound report.decision.id}}" >
              <h4 class="panel-title">
                <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapse-{{unbound report.decision.id}}" aria-expanded="false" aria-controls="collapse-{{unbound report.decision.id}}">
                  v{{report.decision.majorVersion}}.{{report.decision.minorVersion}} {{reviewer-report-status report=report short=true}}
                </a>
              </h4>
            </div>
            <div id="collapse-{{unbound report.decision.id}}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="decision-{{unbound report.decision.id}}">
              <div class="panel-body">
                {{reviewer-report-status report=report}}
                {{front-matter-reviewer-report-questions report=report readOnly=true}}
              </div>
            </div>
          </div>
          {{/each}}
        </div>
      </div>
    {{/if}}
  </div>
</div>
